<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Record Postgresql - Rails Dokümantasyonu - Türkçe</title>
    <link rel="stylesheet" href="/rails-tr-TR/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <a href="/rails-tr-TR/">Rails Kılavuzları</a>
                </h1>
                <nav class="nav">
                    <a href="/rails-tr-TR/">Ana Sayfa</a>
                    <a href="https://dilankaya127.github.io">Portföy</a>
                    <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="guide-container">
    <aside class="guide-sidebar">
        <div class="guide-toc">
            <h3>İçindekiler</h3>
            <div id="toc"></div>
        </div>
        
        <div class="guide-nav">
            <h3>Diğer Kılavuzlar</h3>
            <ul>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/getting_started">Rails ile Başlarken</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/en/active_record_basics">Active Record Temelleri</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides//en/action_controller_overview">Action Controller</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/action_cable_overview">Action Cable</a></li>
            </ul>
        </div>
    </aside>

    <article class="guide-content">
        <header class="guide-header">
            <h1>Active Record Postgresql</h1>
            
        </header>

        <div class="guide-body">
            <p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1 id="active-record-and-postgresql">Active Record and PostgreSQL</h1>

<p>This guide covers PostgreSQL specific usage of Active Record.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>How to use PostgreSQL’s datatypes.</li>
  <li>How to use UUID primary keys.</li>
  <li>How to include non-key columns in indexes.</li>
  <li>How to use deferrable foreign keys.</li>
  <li>How to use unique constraints.</li>
  <li>How to implement exclusion constraints.</li>
  <li>How to implement full text search with PostgreSQL.</li>
  <li>How to back your Active Record models with database views.</li>
</ul>

<hr />

<p>In order to use the PostgreSQL adapter you need to have at least version 9.3
installed. Older versions are not supported.</p>

<p>To get started with PostgreSQL have a look at the
<a href="configuring.html#configuring-a-postgresql-database">configuring Rails guide</a>.
It describes how to properly set up Active Record for PostgreSQL.</p>

<h2 id="datatypes">Datatypes</h2>

<p>PostgreSQL offers a number of specific datatypes. Following is a list of types,
that are supported by the PostgreSQL adapter.</p>

<h3 id="bytea">Bytea</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-binary.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-binarystring.html">functions and operators</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20140207133952_create_documents.rb</span>
<span class="n">create_table</span> <span class="ss">:documents</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">binary</span> <span class="s2">"payload"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/document.rb</span>
<span class="k">class</span> <span class="nc">Document</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Usage</span>
<span class="n">data</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span> <span class="o">+</span> <span class="s2">"tmp/output.pdf"</span><span class="p">)</span>
<span class="no">Document</span><span class="p">.</span><span class="nf">create</span> <span class="ss">payload: </span><span class="n">data</span>
</code></pre></div></div>

<h3 id="array">Array</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/arrays.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-array.html">functions and operators</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20140207133952_create_books.rb</span>
<span class="n">create_table</span> <span class="ss">:books</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"title"</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"tags"</span><span class="p">,</span> <span class="ss">array: </span><span class="kp">true</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="s2">"ratings"</span><span class="p">,</span> <span class="ss">array: </span><span class="kp">true</span>
<span class="k">end</span>
<span class="n">add_index</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:tags</span><span class="p">,</span> <span class="ss">using: </span><span class="s2">"gin"</span>
<span class="n">add_index</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:ratings</span><span class="p">,</span> <span class="ss">using: </span><span class="s2">"gin"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/book.rb</span>
<span class="k">class</span> <span class="nc">Book</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Usage</span>
<span class="no">Book</span><span class="p">.</span><span class="nf">create</span> <span class="ss">title: </span><span class="s2">"Brave New World"</span><span class="p">,</span>
            <span class="ss">tags: </span><span class="p">[</span><span class="s2">"fantasy"</span><span class="p">,</span> <span class="s2">"fiction"</span><span class="p">],</span>
            <span class="ss">ratings: </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="c1">## Books for a single tag</span>
<span class="no">Book</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"'fantasy' = ANY (tags)"</span><span class="p">)</span>

<span class="c1">## Books for multiple tags</span>
<span class="no">Book</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"tags @&gt; ARRAY[?]::varchar[]"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"fantasy"</span><span class="p">,</span> <span class="s2">"fiction"</span><span class="p">])</span>

<span class="c1">## Books with 3 or more ratings</span>
<span class="no">Book</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"array_length(ratings, 1) &gt;= 3"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="hstore">Hstore</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/hstore.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/hstore.html#id-1.11.7.26.5">functions and operators</a></li>
</ul>

<p>NOTE: You need to enable the <code class="language-plaintext highlighter-rouge">hstore</code> extension to use hstore.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131009135255_create_profiles.rb</span>
<span class="k">class</span> <span class="nc">CreateProfiles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="n">enable_extension</span> <span class="s2">"hstore"</span> <span class="k">unless</span> <span class="n">extension_enabled?</span><span class="p">(</span><span class="s2">"hstore"</span><span class="p">)</span>
  <span class="n">create_table</span> <span class="ss">:profiles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">hstore</span> <span class="s2">"settings"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/profile.rb</span>
<span class="k">class</span> <span class="nc">Profile</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Profile</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">settings: </span><span class="p">{</span> <span class="s2">"color"</span> <span class="o">=&gt;</span> <span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"resolution"</span> <span class="o">=&gt;</span> <span class="s2">"800x600"</span> <span class="p">})</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">profile</span> <span class="o">=</span> <span class="no">Profile</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">profile</span><span class="p">.</span><span class="nf">settings</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"color"</span><span class="o">=&gt;</span><span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"resolution"</span><span class="o">=&gt;</span><span class="s2">"800x600"</span><span class="p">}</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">profile</span><span class="p">.</span><span class="nf">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"color"</span> <span class="o">=&gt;</span> <span class="s2">"yellow"</span><span class="p">,</span> <span class="s2">"resolution"</span> <span class="o">=&gt;</span> <span class="s2">"1280x1024"</span><span class="p">}</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">profile</span><span class="p">.</span><span class="nf">save!</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Profile</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"settings-&gt;'color' = ?"</span><span class="p">,</span> <span class="s2">"yellow"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Relation</span> <span class="p">[</span><span class="kt">#&lt;</span><span class="no">Profile</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">settings: </span><span class="p">{</span><span class="s2">"color"</span><span class="o">=</span><span class="kt">&gt;</span><span class="s2">"yellow"</span><span class="p">,</span> <span class="s2">"resolution"</span><span class="o">=</span><span class="kt">&gt;</span><span class="s2">"1280x1024"</span><span class="p">}</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div>

<h3 id="json-and-jsonb">JSON and JSONB</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-json.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-json.html">functions and operators</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_events.rb</span>
<span class="c1"># ... for json datatype:</span>
<span class="n">create_table</span> <span class="ss">:events</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">json</span> <span class="s2">"payload"</span>
<span class="k">end</span>
<span class="c1"># ... or for jsonb datatype:</span>
<span class="n">create_table</span> <span class="ss">:events</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">jsonb</span> <span class="s2">"payload"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/event.rb</span>
<span class="k">class</span> <span class="nc">Event</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Event</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">payload: </span><span class="p">{</span> <span class="ss">kind: </span><span class="s2">"user_renamed"</span><span class="p">,</span> <span class="ss">change: </span><span class="p">[</span><span class="s2">"jack"</span><span class="p">,</span> <span class="s2">"john"</span><span class="p">]})</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span> <span class="o">=</span> <span class="no">Event</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="nf">payload</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"kind"</span><span class="o">=&gt;</span><span class="s2">"user_renamed"</span><span class="p">,</span> <span class="s2">"change"</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"jack"</span><span class="p">,</span> <span class="s2">"john"</span><span class="p">]}</span>

<span class="c">## Query based on JSON document
</span><span class="gp"># The -&gt; operator returns the original JSON type (which might be an object), whereas -&gt;&gt;</span><span class="w"> </span><span class="n">returns</span> <span class="n">text</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Event</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"payload-&gt;&gt;'kind' = ?"</span><span class="p">,</span> <span class="s2">"user_renamed"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="range-types">Range Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/rangetypes.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-range.html">functions and operators</a></li>
</ul>

<p>This type is mapped to Ruby <a href="https://docs.ruby-lang.org/en/master/Range.html"><code class="language-plaintext highlighter-rouge">Range</code></a> objects.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20130923065404_create_events.rb</span>
<span class="n">create_table</span> <span class="ss">:events</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">daterange</span> <span class="s2">"duration"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/event.rb</span>
<span class="k">class</span> <span class="nc">Event</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Event</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">duration: </span><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span> <span class="o">=</span> <span class="no">Event</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="nf">duration</span>
<span class="p">=&gt;</span> <span class="no">Tue</span><span class="p">,</span> <span class="mi">11</span> <span class="no">Feb</span> <span class="mi">2014</span><span class="o">...</span><span class="no">Thu</span><span class="p">,</span> <span class="mi">13</span> <span class="no">Feb</span> <span class="mi">2014</span>

<span class="c">## All Events on a given date
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Event</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"duration @&gt; ?::date"</span><span class="p">,</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="err">
</span><span class="c">## Working with range bounds
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span> <span class="o">=</span> <span class="no">Event</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="s2">"lower(duration) AS starts_at"</span><span class="p">).</span><span class="nf">select</span><span class="p">(</span><span class="s2">"upper(duration) AS ends_at"</span><span class="p">).</span><span class="nf">first</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="nf">starts_at</span>
<span class="p">=&gt;</span> <span class="no">Tue</span><span class="p">,</span> <span class="mi">11</span> <span class="no">Feb</span> <span class="mi">2014</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="nf">ends_at</span>
<span class="p">=&gt;</span> <span class="no">Thu</span><span class="p">,</span> <span class="mi">13</span> <span class="no">Feb</span> <span class="mi">2014</span>
</code></pre></div></div>

<h3 id="composite-types">Composite Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/rowtypes.html">type definition</a></li>
</ul>

<p>Currently there is no special support for composite types. They are mapped to
normal text columns:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="n">full_address</span> <span class="k">AS</span>
<span class="p">(</span>
  <span class="n">city</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span>
  <span class="n">street</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20140207133952_create_contacts.rb</span>
<span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
  CREATE TYPE full_address AS
  (
    city VARCHAR(90),
    street VARCHAR(90)
  );
</span><span class="no">SQL</span>
<span class="n">create_table</span> <span class="ss">:contacts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">column</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:full_address</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/contact.rb</span>
<span class="k">class</span> <span class="nc">Contact</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Contact</span><span class="p">.</span><span class="nf">create</span> <span class="ss">address: </span><span class="s2">"(Paris,Champs-Élysées)"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="nf">address</span>
<span class="p">=&gt;</span> <span class="s2">"(Paris,Champs-Élysées)"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="nf">address</span> <span class="o">=</span> <span class="s2">"(Paris,Rue Basse)"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="nf">save!</span>
</code></pre></div></div>

<h3 id="enumerated-types">Enumerated Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-enum.html">type definition</a></li>
</ul>

<p>The type can be mapped as a normal text column, or to an <a href="https://api.rubyonrails.org/classes/ActiveRecord/Enum.html"><code class="language-plaintext highlighter-rouge">ActiveRecord::Enum</code></a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_articles.rb</span>
<span class="k">def</span> <span class="nf">change</span>
  <span class="n">create_enum</span> <span class="ss">:article_status</span><span class="p">,</span> <span class="p">[</span><span class="s2">"draft"</span><span class="p">,</span> <span class="s2">"published"</span><span class="p">,</span> <span class="s2">"archived"</span><span class="p">]</span>

  <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">enum</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">enum_type: :article_status</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"draft"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also create an enum type and add an enum column to an existing table:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20230113024409_add_status_to_articles.rb</span>
<span class="k">def</span> <span class="nf">change</span>
  <span class="n">create_enum</span> <span class="ss">:article_status</span><span class="p">,</span> <span class="p">[</span><span class="s2">"draft"</span><span class="p">,</span> <span class="s2">"published"</span><span class="p">,</span> <span class="s2">"archived"</span><span class="p">]</span>

  <span class="n">add_column</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">:enum</span><span class="p">,</span> <span class="ss">enum_type: :article_status</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"draft"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The above migrations are both reversible, but you can define separate <code class="language-plaintext highlighter-rouge">#up</code> and <code class="language-plaintext highlighter-rouge">#down</code> methods if required. Make sure you remove any columns or tables that depend on the enum type before dropping it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">down</span>
  <span class="n">drop_table</span> <span class="ss">:articles</span>

  <span class="c1"># OR: remove_column :articles, :status</span>
  <span class="n">drop_enum</span> <span class="ss">:article_status</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Declaring an enum attribute in the model adds helper methods and prevents invalid values from being assigned to instances of the class:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/article.rb</span>
<span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">enum</span> <span class="ss">:status</span><span class="p">,</span> <span class="p">{</span>
    <span class="ss">draft: </span><span class="s2">"draft"</span><span class="p">,</span> <span class="ss">published: </span><span class="s2">"published"</span><span class="p">,</span> <span class="ss">archived: </span><span class="s2">"archived"</span>
  <span class="p">},</span> <span class="ss">prefix: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">status</span>
<span class="p">=&gt;</span> <span class="s2">"draft"</span> <span class="c1"># default status from PostgreSQL, as defined in migration above</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">status_published!</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">status</span>
<span class="p">=&gt;</span> <span class="s2">"published"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">status_archived?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">status</span> <span class="o">=</span> <span class="s2">"deleted"</span>
<span class="gr">ArgumentError: 'deleted' is not a valid status
</span></code></pre></div></div>

<p>To rename the enum you can use <code class="language-plaintext highlighter-rouge">rename_enum</code> along with updating any model
usage:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20150718144917_rename_article_status.rb</span>
<span class="k">def</span> <span class="nf">change</span>
  <span class="n">rename_enum</span> <span class="ss">:article_status</span><span class="p">,</span> <span class="ss">:article_state</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To add a new value you can use <code class="language-plaintext highlighter-rouge">add_enum_value</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20150720144913_add_new_state_to_articles.rb</span>
<span class="k">def</span> <span class="nf">up</span>
  <span class="n">add_enum_value</span> <span class="ss">:article_state</span><span class="p">,</span> <span class="s2">"archived"</span> <span class="c1"># will be at the end after published</span>
  <span class="n">add_enum_value</span> <span class="ss">:article_state</span><span class="p">,</span> <span class="s2">"in review"</span><span class="p">,</span> <span class="ss">before: </span><span class="s2">"published"</span>
  <span class="n">add_enum_value</span> <span class="ss">:article_state</span><span class="p">,</span> <span class="s2">"approved"</span><span class="p">,</span> <span class="ss">after: </span><span class="s2">"in review"</span>
  <span class="n">add_enum_value</span> <span class="ss">:article_state</span><span class="p">,</span> <span class="s2">"rejected"</span><span class="p">,</span> <span class="ss">if_not_exists: </span><span class="kp">true</span> <span class="c1"># won't raise an error if the value already exists</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Enum values can’t be dropped, which also means add_enum_value is irreversible. You can read why <a href="https://www.postgresql.org/message-id/29F36C7C98AB09499B1A209D48EAA615B7653DBC8A@mail2a.alliedtesting.com">here</a>.</p>

<p>To rename a value you can use <code class="language-plaintext highlighter-rouge">rename_enum_value</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20150722144915_rename_article_state.rb</span>
<span class="k">def</span> <span class="nf">change</span>
  <span class="n">rename_enum_value</span> <span class="ss">:article_state</span><span class="p">,</span> <span class="ss">from: </span><span class="s2">"archived"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"deleted"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Hint: to show all the values of the all enums you have, you can call this query in <code class="language-plaintext highlighter-rouge">bin/rails db</code> or <code class="language-plaintext highlighter-rouge">psql</code> console:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">n</span><span class="p">.</span><span class="n">nspname</span> <span class="k">AS</span> <span class="n">enum_schema</span><span class="p">,</span>
       <span class="n">t</span><span class="p">.</span><span class="n">typname</span> <span class="k">AS</span> <span class="n">enum_name</span><span class="p">,</span>
       <span class="n">e</span><span class="p">.</span><span class="n">enumlabel</span> <span class="k">AS</span> <span class="n">enum_value</span>
  <span class="k">FROM</span> <span class="n">pg_type</span> <span class="n">t</span>
      <span class="k">JOIN</span> <span class="n">pg_enum</span> <span class="n">e</span> <span class="k">ON</span> <span class="n">t</span><span class="p">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">enumtypid</span>
      <span class="k">JOIN</span> <span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_namespace</span> <span class="n">n</span> <span class="k">ON</span> <span class="n">n</span><span class="p">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">typnamespace</span>
</code></pre></div></div>

<h3 id="uuid">UUID</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-uuid.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/pgcrypto.html">pgcrypto generator function</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/uuid-ossp.html">uuid-ossp generator functions</a></li>
</ul>

<p>NOTE: If you’re using PostgreSQL earlier than version 13.0 you may need to enable special extensions to use UUIDs. Enable the <code class="language-plaintext highlighter-rouge">pgcrypto</code> extension (PostgreSQL &gt;= 9.4) or <code class="language-plaintext highlighter-rouge">uuid-ossp</code> extension (for even earlier releases).</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_revisions.rb</span>
<span class="n">create_table</span> <span class="ss">:revisions</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">uuid</span> <span class="ss">:identifier</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/revision.rb</span>
<span class="k">class</span> <span class="nc">Revision</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Revision</span><span class="p">.</span><span class="nf">create</span> <span class="ss">identifier: </span><span class="s2">"A0EEBC99-9C0B-4EF8-BB6D-6BB9BD380A11"</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">revision</span> <span class="o">=</span> <span class="no">Revision</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">revision</span><span class="p">.</span><span class="nf">identifier</span>
<span class="p">=&gt;</span> <span class="s2">"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"</span>
</code></pre></div></div>

<p>You can use <code class="language-plaintext highlighter-rouge">uuid</code> type to define references in migrations:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20150418012400_create_blog.rb</span>
<span class="n">enable_extension</span> <span class="s2">"pgcrypto"</span> <span class="k">unless</span> <span class="n">extension_enabled?</span><span class="p">(</span><span class="s2">"pgcrypto"</span><span class="p">)</span>
<span class="n">create_table</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">id: :uuid</span>

<span class="n">create_table</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="c1"># t.belongs_to :post, type: :uuid</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">type: :uuid</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/post.rb</span>
<span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/comment.rb</span>
<span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:post</span>
<span class="k">end</span>
</code></pre></div></div>

<p>See <a href="#uuid-primary-keys">this section</a> for more details on using UUIDs as primary key.</p>

<h3 id="bit-string-types">Bit String Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-bit.html">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-bitstring.html">functions and operators</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_users.rb</span>
<span class="n">create_table</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">column</span> <span class="ss">:settings</span><span class="p">,</span> <span class="s2">"bit(8)"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">User</span><span class="p">.</span><span class="nf">create</span> <span class="ss">settings: </span><span class="s2">"01010011"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">settings</span>
<span class="p">=&gt;</span> <span class="s2">"01010011"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">settings</span> <span class="o">=</span> <span class="s2">"0xAF"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">settings</span>
<span class="p">=&gt;</span> <span class="s2">"10101111"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">save!</span>
</code></pre></div></div>

<h3 id="network-address-types">Network Address Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-net-types.html">type definition</a></li>
</ul>

<p>The types <code class="language-plaintext highlighter-rouge">inet</code> and <code class="language-plaintext highlighter-rouge">cidr</code> are mapped to Ruby
<a href="https://docs.ruby-lang.org/en/master/IPAddr.html"><code class="language-plaintext highlighter-rouge">IPAddr</code></a>
objects. The <code class="language-plaintext highlighter-rouge">macaddr</code> type is mapped to normal text.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20140508144913_create_devices.rb</span>
<span class="n">create_table</span><span class="p">(</span><span class="ss">:devices</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">inet</span> <span class="s2">"ip"</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">cidr</span> <span class="s2">"network"</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">macaddr</span> <span class="s2">"address"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/device.rb</span>
<span class="k">class</span> <span class="nc">Device</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">macbook</span> <span class="o">=</span> <span class="no">Device</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">ip: </span><span class="s2">"192.168.1.12"</span><span class="p">,</span> <span class="ss">network: </span><span class="s2">"192.168.2.0/24"</span><span class="p">,</span> <span class="ss">address: </span><span class="s2">"32:01:16:6d:05:ef"</span><span class="p">)</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">macbook</span><span class="p">.</span><span class="nf">ip</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">IPAddr</span><span class="p">:</span> <span class="no">IPv4</span><span class="p">:</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.12</span><span class="o">/</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span><span class="kt">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">macbook</span><span class="p">.</span><span class="nf">network</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">IPAddr</span><span class="p">:</span> <span class="no">IPv4</span><span class="p">:</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span><span class="kt">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">macbook</span><span class="p">.</span><span class="nf">address</span>
<span class="p">=&gt;</span> <span class="s2">"32:01:16:6d:05:ef"</span>
</code></pre></div></div>

<h3 id="geometric-types">Geometric Types</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-geometric.html">type definition</a></li>
</ul>

<p>All geometric types, with the exception of <code class="language-plaintext highlighter-rouge">points</code> are mapped to normal text.
A point is cast to an array containing <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> coordinates.</p>

<h3 id="interval">Interval</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/datatype-datetime.html#DATATYPE-INTERVAL-INPUT">type definition</a></li>
  <li><a href="https://www.postgresql.org/docs/current/static/functions-datetime.html">functions and operators</a></li>
</ul>

<p>This type is mapped to <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code class="language-plaintext highlighter-rouge">ActiveSupport::Duration</code></a> objects.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20200120000000_create_events.rb</span>
<span class="n">create_table</span> <span class="ss">:events</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">interval</span> <span class="s2">"duration"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/event.rb</span>
<span class="k">class</span> <span class="nc">Event</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Event</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">duration: </span><span class="mi">2</span><span class="p">.</span><span class="nf">days</span><span class="p">)</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span> <span class="o">=</span> <span class="no">Event</span><span class="p">.</span><span class="nf">first</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="nf">duration</span>
<span class="p">=&gt;</span> <span class="mi">2</span> <span class="n">days</span>
</code></pre></div></div>

<h3 id="timestamps">Timestamps</h3>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/datatype-datetime.html">Date/Time Types</a></li>
</ul>

<p>Rails migrations with timestamps store the time a model was created or updated. By default and for legacy reasons, the columns use the <code class="language-plaintext highlighter-rouge">timestamp without time zone</code> data type.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20241220144913_create_devices.rb</span>
<span class="n">create_table</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="ss">:published_at</span>
  <span class="c1"># By default, Active Record will set the data type of this column to `timestamp without time zone`.</span>
<span class="k">end</span>
</code></pre></div></div>

<p>While this works ok, <a href="https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29">PostgreSQL best practices</a> recommend that <code class="language-plaintext highlighter-rouge">timestamp with time zone</code> is used instead for timezone-aware timestamps.
This must be configured before it can be used for new migrations.</p>

<p>To configure <code class="language-plaintext highlighter-rouge">timestamp with time zone</code> as your new timestamp default data type, place the following configuration in the <code class="language-plaintext highlighter-rouge">config/application.rb</code> file.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/application.rb</span>
<span class="no">ActiveSupport</span><span class="p">.</span><span class="nf">on_load</span><span class="p">(</span><span class="ss">:active_record_postgresqladapter</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">datetime_type</span> <span class="o">=</span> <span class="ss">:timestamptz</span>
<span class="k">end</span>
</code></pre></div></div>

<p>With that configuration in place, generate and apply new migrations, then verify their timestamps use the <code class="language-plaintext highlighter-rouge">timestamp with time zone</code> data type.</p>

<h2 id="uuid-primary-keys">UUID Primary Keys</h2>

<p>NOTE: You need to enable the <code class="language-plaintext highlighter-rouge">pgcrypto</code> (only PostgreSQL &gt;= 9.4) or <code class="language-plaintext highlighter-rouge">uuid-ossp</code>
extension to generate random UUIDs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_devices.rb</span>
<span class="n">enable_extension</span> <span class="s2">"pgcrypto"</span> <span class="k">unless</span> <span class="n">extension_enabled?</span><span class="p">(</span><span class="s2">"pgcrypto"</span><span class="p">)</span>
<span class="n">create_table</span> <span class="ss">:devices</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:kind</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/device.rb</span>
<span class="k">class</span> <span class="nc">Device</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">device</span> <span class="o">=</span> <span class="no">Device</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="nf">id</span>
<span class="p">=&gt;</span> <span class="s2">"814865cd-5a1d-4771-9306-4268f188fe9e"</span>
</code></pre></div></div>

<p>NOTE: <code class="language-plaintext highlighter-rouge">gen_random_uuid()</code> (from <code class="language-plaintext highlighter-rouge">pgcrypto</code>) is assumed if no <code class="language-plaintext highlighter-rouge">:default</code> option
was passed to <code class="language-plaintext highlighter-rouge">create_table</code>.</p>

<p>To use the Rails model generator for a table using UUID as the primary key, pass
<code class="language-plaintext highlighter-rouge">--primary-key-type=uuid</code> to the model generator.</p>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails generate model Device <span class="nt">--primary-key-type</span><span class="o">=</span>uuid kind:string
</code></pre></div></div>

<p>When building a model with a foreign key that will reference this UUID, treat
<code class="language-plaintext highlighter-rouge">uuid</code> as the native field type, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails generate model Case device_id:uuid
</code></pre></div></div>

<h2 id="indexing">Indexing</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/sql-createindex.html">index creation</a></li>
</ul>

<p>PostgreSQL includes a variety of index options. The following options are
supported by the PostgreSQL adapter in addition to the
<a href="https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_index">common index options</a></p>

<h3 id="include">Include</h3>

<p>When creating a new index, non-key columns can be included with the <code class="language-plaintext highlighter-rouge">:include</code> option.
These keys are not used in index scans for searching, but can be read during an index
only scan without having to visit the associated table.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_add_index_users_on_email_include_id.rb</span>

<span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">include: :id</span>
</code></pre></div></div>

<p>Multiple columns are supported:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_add_index_users_on_email_include_id_and_created_at.rb</span>

<span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">include: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:created_at</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="generated-columns">Generated Columns</h2>

<p>NOTE: Generated columns are supported since version 12.0 of PostgreSQL.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_users.rb</span>
<span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">virtual</span> <span class="ss">:name_upcased</span><span class="p">,</span> <span class="ss">type: :string</span><span class="p">,</span> <span class="ss">as: </span><span class="s2">"upper(name)"</span><span class="p">,</span> <span class="ss">stored: </span><span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>

<span class="c1"># Usage</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John"</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">name_upcased</span> <span class="c1"># =&gt; "JOHN"</span>
</code></pre></div></div>

<h2 id="deferrable-foreign-keys">Deferrable Foreign Keys</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/sql-set-constraints.html">foreign key table constraints</a></li>
</ul>

<p>By default, table constraints in PostgreSQL are checked immediately after each statement. It intentionally does not allow creating records where the referenced record is not yet in the referenced table. It is possible to run this integrity check later on when the transaction is committed by adding <code class="language-plaintext highlighter-rouge">DEFERRABLE</code> to the foreign key definition though. To defer all checks by default it can be set to <code class="language-plaintext highlighter-rouge">DEFERRABLE INITIALLY DEFERRED</code>. Rails exposes this PostgreSQL feature by adding the <code class="language-plaintext highlighter-rouge">:deferrable</code> key to the <code class="language-plaintext highlighter-rouge">foreign_key</code> options in the <code class="language-plaintext highlighter-rouge">add_reference</code> and <code class="language-plaintext highlighter-rouge">add_foreign_key</code> methods.</p>

<p>One example of this is creating circular dependencies in a transaction even if you have created foreign keys:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_reference</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">:alias</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="p">{</span> <span class="ss">deferrable: :deferred</span> <span class="p">}</span>
<span class="n">add_reference</span> <span class="ss">:alias</span><span class="p">,</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="p">{</span> <span class="ss">deferrable: :deferred</span> <span class="p">}</span>
</code></pre></div></div>

<p>If the reference was created with the <code class="language-plaintext highlighter-rouge">foreign_key: true</code> option, the following transaction would fail when executing the first <code class="language-plaintext highlighter-rouge">INSERT</code> statement. It does not fail when the <code class="language-plaintext highlighter-rouge">deferrable: :deferred</code> option is set though.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">lease_connection</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">id: </span><span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span><span class="p">,</span> <span class="ss">alias_id: </span><span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
  <span class="no">Alias</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">id: </span><span class="n">person</span><span class="p">.</span><span class="nf">alias_id</span><span class="p">,</span> <span class="ss">person_id: </span><span class="n">person</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"jaydee"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When the <code class="language-plaintext highlighter-rouge">:deferrable</code> option is set to <code class="language-plaintext highlighter-rouge">:immediate</code>, let the foreign keys keep the default behavior of checking the constraint immediately, but allow manually deferring the checks using <code class="language-plaintext highlighter-rouge">set_constraints</code> within a transaction. This will cause the foreign keys to be checked when the transaction is committed:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">lease_connection</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">lease_connection</span><span class="p">.</span><span class="nf">set_constraints</span><span class="p">(</span><span class="ss">:deferred</span><span class="p">)</span>
  <span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">alias_id: </span><span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
  <span class="no">Alias</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">id: </span><span class="n">person</span><span class="p">.</span><span class="nf">alias_id</span><span class="p">,</span> <span class="ss">person_id: </span><span class="n">person</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"jaydee"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>By default <code class="language-plaintext highlighter-rouge">:deferrable</code> is <code class="language-plaintext highlighter-rouge">false</code> and the constraint is always checked immediately.</p>

<h2 id="unique-constraint">Unique Constraint</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS">unique constraints</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20230422225213_create_items.rb</span>
<span class="n">create_table</span> <span class="ss">:items</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:position</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">unique_constraint</span> <span class="p">[</span><span class="ss">:position</span><span class="p">],</span> <span class="ss">deferrable: :immediate</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you want to change an existing unique index to deferrable, you can use <code class="language-plaintext highlighter-rouge">:using_index</code> to create deferrable unique constraints.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_unique_constraint</span> <span class="ss">:items</span><span class="p">,</span> <span class="ss">deferrable: :deferred</span><span class="p">,</span> <span class="ss">using_index: </span><span class="s2">"index_items_on_position"</span>
</code></pre></div></div>

<p>Like foreign keys, unique constraints can be deferred by setting <code class="language-plaintext highlighter-rouge">:deferrable</code> to either <code class="language-plaintext highlighter-rouge">:immediate</code> or <code class="language-plaintext highlighter-rouge">:deferred</code>. By default, <code class="language-plaintext highlighter-rouge">:deferrable</code> is <code class="language-plaintext highlighter-rouge">false</code> and the constraint is always checked immediately.</p>

<h2 id="exclusion-constraints">Exclusion Constraints</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-EXCLUSION">exclusion constraints</a></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_products.rb</span>
<span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">daterange</span> <span class="ss">:availability_range</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>

  <span class="n">t</span><span class="p">.</span><span class="nf">exclusion_constraint</span> <span class="s2">"price WITH =, availability_range WITH &amp;&amp;"</span><span class="p">,</span> <span class="ss">using: :gist</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"price_check"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Like foreign keys, exclusion constraints can be deferred by setting <code class="language-plaintext highlighter-rouge">:deferrable</code> to either <code class="language-plaintext highlighter-rouge">:immediate</code> or <code class="language-plaintext highlighter-rouge">:deferred</code>. By default, <code class="language-plaintext highlighter-rouge">:deferrable</code> is <code class="language-plaintext highlighter-rouge">false</code> and the constraint is always checked immediately.</p>

<h2 id="full-text-search">Full Text Search</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_documents.rb</span>
<span class="n">create_table</span> <span class="ss">:documents</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:body</span>
<span class="k">end</span>

<span class="n">add_index</span> <span class="ss">:documents</span><span class="p">,</span> <span class="s2">"to_tsvector('english', title || ' ' || body)"</span><span class="p">,</span> <span class="ss">using: :gin</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"documents_idx"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/document.rb</span>
<span class="k">class</span> <span class="nc">Document</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Usage</span>
<span class="no">Document</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Cats and Dogs"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"are nice!"</span><span class="p">)</span>

<span class="c1">## all documents matching 'cat &amp; dog'</span>
<span class="no">Document</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"to_tsvector('english', title || ' ' || body) @@ to_tsquery(?)"</span><span class="p">,</span>
                 <span class="s2">"cat &amp; dog"</span><span class="p">)</span>
</code></pre></div></div>

<p>Optionally, you can store the vector as automatically generated column (from PostgreSQL 12.0):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_documents.rb</span>
<span class="n">create_table</span> <span class="ss">:documents</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:body</span>

  <span class="n">t</span><span class="p">.</span><span class="nf">virtual</span> <span class="ss">:textsearchable_index_col</span><span class="p">,</span>
            <span class="ss">type: :tsvector</span><span class="p">,</span> <span class="ss">as: </span><span class="s2">"to_tsvector('english', title || ' ' || body)"</span><span class="p">,</span> <span class="ss">stored: </span><span class="kp">true</span>
<span class="k">end</span>

<span class="n">add_index</span> <span class="ss">:documents</span><span class="p">,</span> <span class="ss">:textsearchable_index_col</span><span class="p">,</span> <span class="ss">using: :gin</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"documents_idx"</span>

<span class="c1"># Usage</span>
<span class="no">Document</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Cats and Dogs"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"are nice!"</span><span class="p">)</span>

<span class="c1">## all documents matching 'cat &amp; dog'</span>
<span class="no">Document</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"textsearchable_index_col @@ to_tsquery(?)"</span><span class="p">,</span> <span class="s2">"cat &amp; dog"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="database-views">Database Views</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/current/static/sql-createview.html">view creation</a></li>
</ul>

<p>Imagine you need to work with a legacy database containing the following table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails_pg_guide=# \d "TBL_ART"
                                        Table "public.TBL_ART"
   Column   |            Type             |                         Modifiers
------------+-----------------------------+------------------------------------------------------------
 INT_ID     | integer                     | not null default nextval('"TBL_ART_INT_ID_seq"'::regclass)
 STR_TITLE  | character varying           |
 STR_STAT   | character varying           | default 'draft'::character varying
 DT_PUBL_AT | timestamp without time zone |
 BL_ARCH    | boolean                     | default false
Indexes:
    "TBL_ART_pkey" PRIMARY KEY, btree ("INT_ID")
</code></pre></div></div>

<p>This table does not follow the Rails conventions at all.
Because simple PostgreSQL views are updateable by default,
we can wrap it as follows:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20131220144913_create_articles_view.rb</span>
<span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
CREATE VIEW articles AS
  SELECT "INT_ID" AS id,
         "STR_TITLE" AS title,
         "STR_STAT" AS status,
         "DT_PUBL_AT" AS published_at,
         "BL_ARCH" AS archived
  FROM "TBL_ART"
  WHERE "BL_ARCH" = 'f'
</span><span class="no">SQL</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/article.rb</span>
<span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">primary_key</span> <span class="o">=</span> <span class="s2">"id"</span>
  <span class="k">def</span> <span class="nf">archive!</span>
    <span class="n">update_attribute</span> <span class="ss">:archived</span><span class="p">,</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">first</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span> <span class="ss">title: </span><span class="s2">"Winter is coming"</span><span class="p">,</span> <span class="ss">status: </span><span class="s2">"published"</span><span class="p">,</span> <span class="ss">published_at: </span><span class="mi">1</span><span class="p">.</span><span class="nf">year</span><span class="p">.</span><span class="nf">ago</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">second</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span> <span class="ss">title: </span><span class="s2">"Brace yourself"</span><span class="p">,</span> <span class="ss">status: </span><span class="s2">"draft"</span><span class="p">,</span> <span class="ss">published_at: </span><span class="mi">1</span><span class="p">.</span><span class="nf">month</span><span class="p">.</span><span class="nf">ago</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">count</span>
<span class="p">=&gt;</span> <span class="mi">2</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">first</span><span class="p">.</span><span class="nf">archive!</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">count</span>
<span class="p">=&gt;</span> <span class="mi">1</span>
</code></pre></div></div>

<p>NOTE: This application only cares about non-archived <code class="language-plaintext highlighter-rouge">Articles</code>. A view also
allows for conditions so we can exclude the archived <code class="language-plaintext highlighter-rouge">Articles</code> directly.</p>

<h2 id="structure-dumps">Structure Dumps</h2>

<p>If your <code class="language-plaintext highlighter-rouge">config.active_record.schema_format</code> is <code class="language-plaintext highlighter-rouge">:sql</code>, Rails will call <code class="language-plaintext highlighter-rouge">pg_dump</code> to generate a
structure dump.</p>

<p>You can use <code class="language-plaintext highlighter-rouge">ActiveRecord::Tasks::DatabaseTasks.structure_dump_flags</code> to configure <code class="language-plaintext highlighter-rouge">pg_dump</code>.
For example, to exclude comments from your structure dump, add this to an initializer:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Tasks</span><span class="o">::</span><span class="no">DatabaseTasks</span><span class="p">.</span><span class="nf">structure_dump_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"--no-comments"</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="explain">Explain</h2>

<p>Along with the standard <a href="active_record_querying.html#explain-options"><code class="language-plaintext highlighter-rouge">explain</code></a> options, the PostgreSQL adapter supports <a href="https://www.postgresql.org/docs/current/sql-explain.html"><code class="language-plaintext highlighter-rouge">buffers</code></a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Company</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="n">owning_companies_ids</span><span class="p">).</span><span class="nf">explain</span><span class="p">(</span><span class="ss">:analyze</span><span class="p">,</span> <span class="ss">:buffers</span><span class="p">)</span>
<span class="c1">#=&gt; EXPLAIN (ANALYZE, BUFFERS) SELECT "companies".* FROM "companies"</span>
<span class="c1"># ...</span>
<span class="c1"># Seq Scan on companies  (cost=0.00..2.21 rows=3 width=64)</span>
<span class="c1"># ...</span>
</code></pre></div></div>

<p>See their documentation for more details.</p>


        </div>

        <footer class="guide-footer">
            <div class="feedback">
                <h3>Geri Bildirim</h3>
                <p>Bu kılavuzun kalitesini artırmamıza yardımcı olmak için geri bildirimlerinizi bekliyoruz.</p>
                <p>Lütfen <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub Issues</a> üzerinden katkıda bulunun.</p>
            </div>
        </footer>
    </article>
</div>

<script>
// İçindekiler tablosunu otomatik oluştur
document.addEventListener('DOMContentLoaded', function() {
    const toc = document.getElementById('toc');
    const headings = document.querySelectorAll('.guide-content h2, .guide-content h3, .guide-content h4');
    
    if (headings.length > 0) {
        const tocList = document.createElement('ul');
        
        headings.forEach(function(heading, index) {
            const id = 'heading-' + index;
            heading.id = id;
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();
            
            li.appendChild(a);
            tocList.appendChild(li);
        });
        
        toc.appendChild(tocList);
    }
});
</script>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Rails Kılavuzları Türkçe Çevirisi. Gönüllüler tarafından hazırlanmıştır.</p>
            <p>Orijinal dokümantasyon <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine aittir.</p>
        </div>
    </footer>

    <script>hljs.highlightAll();</script>
</body>
</html>