<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Record Validations - </title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <a href="/">Rails Kılavuzları</a>
                </h1>
                <nav class="nav">
                    <a href="/">Ana Sayfa</a>
                    <a href="https://dilankaya127.github.io">Portföy</a>
                    <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="guide-container">
    <aside class="guide-sidebar">
        <div class="guide-toc">
            <h3>İçindekiler</h3>
            <div id="toc"></div>
        </div>
        
        <div class="guide-nav">
            <h3>Diğer Kılavuzlar</h3>
            <ul>
                <li><a href="/rails-tr-TR/guides/tr/getting_started">Rails ile Başlarken</a></li>
                <li><a href="/rails-tr-TR/guides/en/active_record_basics">Active Record Temelleri</a></li>
                <li><a href="/rails-tr-TR/guides//en/action_controller_overview">Action Controller</a></li>
                <li><a href="/rails-tr-TR/guides/tr/action_cable_overview">Action Cable</a></li>
            </ul>
        </div>
    </aside>

    <article class="guide-content">
        <header class="guide-header">
            <h1>Active Record Validations</h1>
            
        </header>

        <div class="guide-body">
            <p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1 id="active-record-validations">Active Record Validations</h1>

<p>This guide teaches you how to validate Active Record objects before saving them
to the database using Active Record’s validations feature.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>How to use the built-in Active Record validations and options.</li>
  <li>How to check the validity of objects.</li>
  <li>How to create conditional and strict validations.</li>
  <li>How to create your own custom validation methods.</li>
  <li>How to work with the validation error messages and displaying them in views.</li>
</ul>

<hr />

<h2 id="validations-overview">Validations Overview</h2>

<p>Here’s an example of a very simple validation:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<p>As you can see, the <code class="language-plaintext highlighter-rouge">Person</code> is not valid without a <code class="language-plaintext highlighter-rouge">name</code> attribute.</p>

<p>Before we dig into more details, let’s talk about how validations fit into the
big picture of your application.</p>

<h3 id="why-use-validations">Why Use Validations?</h3>

<p>Validations are used to ensure that only valid data is saved into your database.
For example, it may be important to your application to ensure that every user
provides a valid email address and mailing address. Model-level validations are
the best way to ensure that only valid data is saved into your database. They
can be used with any database, cannot be bypassed by end users, and are
convenient to test and maintain. Rails provides built-in helpers for common
needs, and allows you to create your own validation methods as well.</p>

<h3 id="alternate-ways-to-validate">Alternate Ways to Validate</h3>

<p>There are several other ways to validate data before it is saved into your
database, including native database constraints, client-side validations and
controller-level validations. Here’s a summary of the pros and cons:</p>

<ul>
  <li>Database constraints and/or stored procedures make the validation mechanisms
database-dependent and can make testing and maintenance more difficult.
However, if your database is used by other applications, it may be a good idea
to use some constraints at the database level. Additionally, database-level
validations can safely handle some things (such as uniqueness in heavily-used
tables) that can be difficult to implement otherwise.</li>
  <li>Client-side validations can be useful, but are generally unreliable if used
alone. If they are implemented using JavaScript, they may be bypassed if
JavaScript is turned off in the user’s browser. However, if combined with
other techniques, client-side validation can be a convenient way to provide
users with immediate feedback as they use your site.</li>
  <li>Controller-level validations can be tempting to use, but often become unwieldy
and difficult to test and maintain. Whenever possible, it’s a good idea to
keep your controllers simple, as it will make working with your application
easier in the long run.</li>
</ul>

<p>Rails recommends using model-level validations in most circumstances, however
there may be specific cases where you want to complement them with alternate
validations.</p>

<h3 id="validation-triggers">Validation Triggers</h3>

<p>There are two kinds of Active Record objects - those that correspond to a row
inside your database and those that do not. When you instantiate a new object,
using the <code class="language-plaintext highlighter-rouge">new</code> method, the object does not get saved in the database as yet.
Once you call <code class="language-plaintext highlighter-rouge">save</code> on that object then will it be saved into the appropriate
database table. Active Record uses an instance method called <code class="language-plaintext highlighter-rouge">persisted?</code> (and
its inverse <code class="language-plaintext highlighter-rouge">new_record?</code>) to determine whether an object is already in the
database or not. Consider the following Active Record class:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can see how it works by looking at some <code class="language-plaintext highlighter-rouge">bin/rails console</code> output:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="kp">nil</span><span class="kt">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">new_record?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">persisted?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">new_record?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">persisted?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Saving a new record will send an SQL <code class="language-plaintext highlighter-rouge">INSERT</code> operation to the database, whereas
updating an existing record will send an SQL <code class="language-plaintext highlighter-rouge">UPDATE</code> operation. Validations are
typically run before these commands are sent to the database. If any validations
fail, the object will be marked as invalid and Active Record will not perform
the <code class="language-plaintext highlighter-rouge">INSERT</code> or <code class="language-plaintext highlighter-rouge">UPDATE</code> operation. This helps to avoid storing an invalid
object in the database. You can choose to have specific validations run when an
object is created, saved, or updated.</p>

<p>WARNING: While validations usually prevent invalid data from being saved to the
database, it’s important to be aware that not all methods in Rails trigger
validations. Some methods allow changes to be made directly to the database
without performing validations. As a result, if you’re not careful, it’s
possible to <a href="#skipping-validations">bypass validations</a> and save an object in an
invalid state.</p>

<p>The following methods trigger validations, and will save the object to the
database only if the object is valid:</p>

<ul>
  <li>[<code class="language-plaintext highlighter-rouge">create</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">create!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">save</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">save!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update!</code>][]</li>
</ul>

<p>The bang versions (methods that end with an exclamation mark, like <code class="language-plaintext highlighter-rouge">save!</code>)
raise an exception if the record is invalid. The non-bang versions - <code class="language-plaintext highlighter-rouge">save</code> and
<code class="language-plaintext highlighter-rouge">update</code> returns <code class="language-plaintext highlighter-rouge">false</code>, and <code class="language-plaintext highlighter-rouge">create</code> returns the object.</p>

<p>[<code class="language-plaintext highlighter-rouge">create</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence/ClassMethods.html#method-i-create
[<code class="language-plaintext highlighter-rouge">create!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence/ClassMethods.html#method-i-create-21
[<code class="language-plaintext highlighter-rouge">save</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-save
[<code class="language-plaintext highlighter-rouge">save!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-save-21
[<code class="language-plaintext highlighter-rouge">update</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update
[<code class="language-plaintext highlighter-rouge">update!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update-21</p>

<h3 id="skipping-validations">Skipping Validations</h3>

<p>The following methods skip validations, and will save the object to the database
regardless of its validity. They should be used with caution. Refer to the
method documentation to learn more.</p>

<ul>
  <li>[<code class="language-plaintext highlighter-rouge">decrement!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">decrement_counter</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">increment!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">increment_counter</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">insert</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">insert!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">insert_all</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">insert_all!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">toggle!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">touch</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">touch_all</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_all</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_attribute</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_attribute!</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_column</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_columns</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">update_counters</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">upsert</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">upsert_all</code>][]</li>
  <li><code class="language-plaintext highlighter-rouge">save(validate: false)</code></li>
</ul>

<p>NOTE: <code class="language-plaintext highlighter-rouge">save</code> also has the ability to skip validations if <code class="language-plaintext highlighter-rouge">validate: false</code> is
passed as an argument. This technique should be used with caution.</p>

<p>[<code class="language-plaintext highlighter-rouge">decrement!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-decrement-21
[<code class="language-plaintext highlighter-rouge">decrement_counter</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/CounterCache/ClassMethods.html#method-i-decrement_counter
[<code class="language-plaintext highlighter-rouge">increment!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-increment-21
[<code class="language-plaintext highlighter-rouge">increment_counter</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/CounterCache/ClassMethods.html#method-i-increment_counter
[<code class="language-plaintext highlighter-rouge">insert</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-insert
[<code class="language-plaintext highlighter-rouge">insert!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-insert-21
[<code class="language-plaintext highlighter-rouge">insert_all</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-insert_all
[<code class="language-plaintext highlighter-rouge">insert_all!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-insert_all-21
[<code class="language-plaintext highlighter-rouge">toggle!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-toggle-21
[<code class="language-plaintext highlighter-rouge">touch</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-touch
[<code class="language-plaintext highlighter-rouge">touch_all</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-touch_all
[<code class="language-plaintext highlighter-rouge">update_all</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-update_all
[<code class="language-plaintext highlighter-rouge">update_attribute</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_attribute
[<code class="language-plaintext highlighter-rouge">update_attribute!</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_attribute-21
[<code class="language-plaintext highlighter-rouge">update_column</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_column
[<code class="language-plaintext highlighter-rouge">update_columns</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-update_columns
[<code class="language-plaintext highlighter-rouge">update_counters</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-update_counters
[<code class="language-plaintext highlighter-rouge">upsert</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-upsert
[<code class="language-plaintext highlighter-rouge">upsert_all</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-upsert_all</p>

<h3 id="checking-validity">Checking Validity</h3>

<p>Before saving an Active Record object, Rails runs your validations, and if these
validations produce any validation errors, then Rails will not save the object.</p>

<p>You can also run the validations on your own. [<code class="language-plaintext highlighter-rouge">valid?</code>][] triggers your
validations and returns true if no errors are found in the object, and false
otherwise. As you saw above:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<p>After Active Record has performed validations, any failures can be accessed
through the [<code class="language-plaintext highlighter-rouge">errors</code>][] instance method, which returns a collection of errors.
By definition, an object is valid if the collection is empty after running
validations.</p>

<p>NOTE: An object instantiated with <code class="language-plaintext highlighter-rouge">new</code> will not report errors even if it’s
technically invalid, because validations are automatically run only when the
object is saved, such as with the <code class="language-plaintext highlighter-rouge">create</code> or <code class="language-plaintext highlighter-rouge">save</code> methods.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">created_at: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="kp">nil</span><span class="kt">&gt;</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">0</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">objects</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name can't be blank"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save!</span>
<span class="go">ActiveRecord::RecordInvalid: Validation failed: Name can't be blank
</span><span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create!</span>
<span class="go">ActiveRecord::RecordInvalid: Validation failed: Name can't be blank
</span></code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">invalid?</code>][] is the inverse of <code class="language-plaintext highlighter-rouge">valid?</code>. It triggers your validations,
returning true if any errors were found in the object, and false otherwise.</p>

<p>[<code class="language-plaintext highlighter-rouge">errors</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-errors
[<code class="language-plaintext highlighter-rouge">invalid?</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-invalid-3F
[<code class="language-plaintext highlighter-rouge">valid?</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Validations.html#method-i-valid-3F</p>

<h3 id="inspecting-and-handling-errors">Inspecting and Handling Errors</h3>

<p>To verify whether or not a particular attribute of an object is valid, you can
use [<code class="language-plaintext highlighter-rouge">errors[:attribute]</code>][Errors#squarebrackets]. It returns an array of all
the error messages for <code class="language-plaintext highlighter-rouge">:attribute</code>. If there are no errors on the specified
attribute, an empty array is returned. This allows you to easily determine
whether there are any validation issues with a specific attribute.</p>

<p>Here’s an example illustrating how to check for errors on an attribute:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">new_person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">new_person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[]</span> <span class="c1"># no errors since validations are not run until saved</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">new_person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">any?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">create_person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">create_person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]</span> <span class="c1"># validation error because `name` is required</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">create_person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">any?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Additionally, you can use the
<a href="https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-add"><code class="language-plaintext highlighter-rouge">errors.add</code></a>
method to manually add error messages for specific attributes. This is
particularly useful when defining custom validation scenarios.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_short</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"is not long enough"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: To read about validation errors in greater depth refer to the <a href="#working-with-validation-errors">Working
with Validation Errors</a> section.</p>

<p>[Errors#squarebrackets]:
    https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-5B-5D</p>

<h2 id="validations">Validations</h2>

<p>Active Record offers many predefined validations that you can use directly
inside your class definitions. These predefined validations provide common
validation rules. Each time a validation fails, an error message is added to the
object’s <code class="language-plaintext highlighter-rouge">errors</code> collection, and this error is associated with the specific
attribute being validated.</p>

<p>When a validation fails, the error message is stored in the <code class="language-plaintext highlighter-rouge">errors</code> collection
under the attribute name that triggered the validation. This means you can
easily access the errors related to any specific attribute. For instance, if you
validate the <code class="language-plaintext highlighter-rouge">:name</code> attribute and the validation fails, you will find the error
message under <code class="language-plaintext highlighter-rouge">errors[:name]</code>.</p>

<p>In modern Rails applications, the more concise validate syntax is commonly used,
for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
</code></pre></div></div>

<p>However, older versions of Rails used “helper” methods, such as:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates_presence_of</span> <span class="ss">:name</span>
</code></pre></div></div>

<p>Both notations perform the same function, but the newer form is recommended for
its readability and alignment with Rails’ conventions.</p>

<p>Each validation accepts an arbitrary number of attribute names, allowing you to
apply the same type of validation to multiple attributes in a single line of
code.</p>

<p>Additionally, all validations accept the <code class="language-plaintext highlighter-rouge">:on</code> and <code class="language-plaintext highlighter-rouge">:message</code> options. The <code class="language-plaintext highlighter-rouge">:on</code>
option specifies when the validation should be triggered, with possible values
being <code class="language-plaintext highlighter-rouge">:create</code> or <code class="language-plaintext highlighter-rouge">:update</code>. The <code class="language-plaintext highlighter-rouge">:message</code> option allows you to define a
custom error message that will be added to the errors collection if the
validation fails. If you do not specify a message, Rails will use a default
error message for that validation.</p>

<p>INFO: To see a list of the available default helpers, take a look at
[<code class="language-plaintext highlighter-rouge">ActiveModel::Validations::HelperMethods</code>][]. This API section uses the older
notation as described above.</p>

<p>[<code class="language-plaintext highlighter-rouge">ActiveModel::Validations::HelperMethods</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html</p>

<p>Below we outline the most commonly used validations.</p>

<h3 id="absence"><code class="language-plaintext highlighter-rouge">absence</code></h3>

<p>This validator validates that the specified attributes are absent. It uses the
[<code class="language-plaintext highlighter-rouge">Object#present?</code>][] method to check if the value is neither nil nor a blank
string - that is, a string that is either empty or consists of whitespace only.</p>

<p><code class="language-plaintext highlighter-rouge">#absence</code> is commonly used for conditional validations. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:phone_number</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">absence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">if: :invited?</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">,</span> <span class="ss">invitation_sent_at: </span><span class="no">Time</span><span class="p">.</span><span class="nf">current</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span> <span class="c1"># absence validation passes</span>
</code></pre></div></div>

<p>If you want to be sure that an association is absent, you’ll need to test
whether the associated object itself is absent, and not the foreign key used to
map the association.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">LineItem</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:order</span><span class="p">,</span> <span class="ss">optional: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:order</span><span class="p">,</span> <span class="ss">absence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">line_item</span> <span class="o">=</span> <span class="no">LineItem</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">line_item</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span> <span class="c1"># absence validation passes</span>

<span class="n">order</span> <span class="o">=</span> <span class="no">Order</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">line_item_with_order</span> <span class="o">=</span> <span class="no">LineItem</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">order: </span><span class="n">order</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">line_item_with_order</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span> <span class="c1"># absence validation fails</span>
</code></pre></div></div>

<p>NOTE: For <code class="language-plaintext highlighter-rouge">belongs_to</code> the association presence is validated by default. If you
don’t want to have association presence validated, use <code class="language-plaintext highlighter-rouge">optional: true</code>.</p>

<p>Rails will usually infer the inverse association automatically. In cases where
you use a custom <code class="language-plaintext highlighter-rouge">:foreign_key</code> or a <code class="language-plaintext highlighter-rouge">:through</code> association, it’s important to
explicitly set the <code class="language-plaintext highlighter-rouge">:inverse_of</code> option to optimize the association lookup. This
helps avoid unnecessary database queries during validation.</p>

<p>For more details, check out the <a href="association_basics.html#bi-directional-associations">Bi-directional Associations
documentation</a>.</p>

<p>NOTE: If you want to ensure that the association is both present and valid, you
also need to use <code class="language-plaintext highlighter-rouge">validates_associated</code>. More on that in the
<a href="#validates-associated">validates_associated section</a>.</p>

<p>If you validate the absence of an object associated via a
<a href="association_basics.html#the-has-one-association"><code class="language-plaintext highlighter-rouge">has_one</code></a> or
<a href="association_basics.html#the-has-many-association"><code class="language-plaintext highlighter-rouge">has_many</code></a> relationship, it
will check that the object is neither <code class="language-plaintext highlighter-rouge">present?</code> nor <code class="language-plaintext highlighter-rouge">marked_for_destruction?</code>.</p>

<p>Since <code class="language-plaintext highlighter-rouge">false.present?</code> is false, if you want to validate the absence of a
boolean field you should use:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates</span> <span class="ss">:field_name</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div>

<p>The default error message is <em>“must be blank”</em>.</p>

<p>[<code class="language-plaintext highlighter-rouge">Object#present?</code>]:
    https://api.rubyonrails.org/classes/Object.html#method-i-present-3F</p>

<h3 id="acceptance"><code class="language-plaintext highlighter-rouge">acceptance</code></h3>

<p>This method validates that a checkbox on the user interface was checked when a
form was submitted. This is typically used when the user needs to agree to your
application’s terms of service, confirm that some text is read, or any similar
concept.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This check is performed only if <code class="language-plaintext highlighter-rouge">terms_of_service</code> is not <code class="language-plaintext highlighter-rouge">nil</code>. The default
error message for this validation is <em>“must be accepted”</em>. You can also pass in
a custom message via the <code class="language-plaintext highlighter-rouge">message</code> option.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">message: </span><span class="s2">"must be agreed to"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It can also receive an <code class="language-plaintext highlighter-rouge">:accept</code> option, which determines the allowed values
that will be considered as acceptable. It defaults to <code class="language-plaintext highlighter-rouge">['1', true]</code> and can be
easily changed.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">accept: </span><span class="s2">"yes"</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:eula</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">accept: </span><span class="p">[</span><span class="s2">"TRUE"</span><span class="p">,</span> <span class="s2">"accepted"</span><span class="p">]</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This validation is very specific to web applications and this ‘acceptance’ does
not need to be recorded anywhere in your database. If you don’t have a field for
it, the validator will create a virtual attribute. If the field does exist in
your database, the <code class="language-plaintext highlighter-rouge">accept</code> option must be set to or include <code class="language-plaintext highlighter-rouge">true</code> or else the
validation will not run.</p>

<h3 id="confirmation"><code class="language-plaintext highlighter-rouge">confirmation</code></h3>

<p>You should use this validator when you have two text fields that should receive
exactly the same content. For example, you may want to confirm an email address
or a password. This validation creates a virtual attribute whose name is the
name of the field that has to be confirmed with “_confirmation” appended.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In your view template you could use something like</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">text_field</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">text_field</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">:email_confirmation</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>NOTE: This check is performed only if <code class="language-plaintext highlighter-rouge">email_confirmation</code> is not <code class="language-plaintext highlighter-rouge">nil</code>. To
require confirmation, make sure to add a presence check for the confirmation
attribute (we’ll take a look at the <a href="#presence"><code class="language-plaintext highlighter-rouge">presence</code></a> check later on in
this guide):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email_confirmation</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There is also a <code class="language-plaintext highlighter-rouge">:case_sensitive</code> option that you can use to define whether the
confirmation constraint will be case sensitive or not. This option defaults to
true.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="p">{</span> <span class="ss">case_sensitive: </span><span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The default error message for this validator is <em>“doesn’t match confirmation”</em>.
You can also pass in a custom message via the <code class="language-plaintext highlighter-rouge">message</code> option.</p>

<p>Generally when using this validator, you will want to combine it with the <code class="language-plaintext highlighter-rouge">:if</code>
option to only validate the “_confirmation” field when the initial field has
changed and <strong>not</strong> every time you save the record. More on <a href="#conditional-validations">conditional
validations</a> later.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email_confirmation</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">if: :email_changed?</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="comparison"><code class="language-plaintext highlighter-rouge">comparison</code></h3>

<p>This validator will validate a comparison between any two comparable values.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Promotion</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:end_date</span><span class="p">,</span> <span class="ss">comparison: </span><span class="p">{</span> <span class="ss">greater_than: :start_date</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The default error message for this validator is <em>“failed comparison”</em>. You can
also pass in a custom message via the <code class="language-plaintext highlighter-rouge">message</code> option.</p>

<p>These options are all supported:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
      <th>Default Error Message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:greater_than</code></td>
      <td>Specifies the value must be greater than the supplied value.</td>
      <td>“must be greater than %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:greater_than_or_equal_to</code></td>
      <td>Specifies the value must be greater than or equal to the supplied value.</td>
      <td>“must be greater than or equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:equal_to</code></td>
      <td>Specifies the value must be equal to the supplied value.</td>
      <td>“must be equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:less_than</code></td>
      <td>Specifies the value must be less than the supplied value.</td>
      <td>“must be less than %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:less_than_or_equal_to</code></td>
      <td>Specifies the value must be less than or equal to the supplied value.</td>
      <td>“must be less than or equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:other_than</code></td>
      <td>Specifies the value must be other than the supplied value.</td>
      <td>“must be other than %{count}”</td>
    </tr>
  </tbody>
</table>

<p>NOTE: The validator requires a compare option be supplied. Each option accepts a
value, proc, or symbol. Any class that includes
<a href="https://docs.ruby-lang.org/en/master/Comparable.html">Comparable</a> can be compared.</p>

<h3 id="format"><code class="language-plaintext highlighter-rouge">format</code></h3>

<p>This validator validates the attributes’ values by testing whether they match a
given regular expression, which is specified using the <code class="language-plaintext highlighter-rouge">:with</code> option.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:legacy_code</span><span class="p">,</span> <span class="ss">format: </span><span class="p">{</span> <span class="ss">with: </span><span class="sr">/\A[a-zA-Z]+\z/</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"only allows letters"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Inversely, by using the <code class="language-plaintext highlighter-rouge">:without</code> option instead you can require that the
specified attribute does <em>not</em> match the regular expression.</p>

<p>In either case, the provided <code class="language-plaintext highlighter-rouge">:with</code> or <code class="language-plaintext highlighter-rouge">:without</code> option must be a regular
expression or a proc or lambda that returns one.</p>

<p>The default error message is <em>“is invalid”</em>.</p>

<p>WARNING. Use <code class="language-plaintext highlighter-rouge">\A</code> and <code class="language-plaintext highlighter-rouge">\z</code> to match the start and end of the string, <code class="language-plaintext highlighter-rouge">^</code> and <code class="language-plaintext highlighter-rouge">$</code>
match the start/end of a line. Due to frequent misuse of <code class="language-plaintext highlighter-rouge">^</code> and <code class="language-plaintext highlighter-rouge">$</code>, you need
to pass the <code class="language-plaintext highlighter-rouge">multiline: true</code> option in case you use any of these two anchors in
the provided regular expression. In most cases, you should be using <code class="language-plaintext highlighter-rouge">\A</code> and
<code class="language-plaintext highlighter-rouge">\z</code>.</p>

<h3 id="inclusion-and-exclusion"><code class="language-plaintext highlighter-rouge">inclusion</code> and <code class="language-plaintext highlighter-rouge">exclusion</code></h3>

<p>Both of these validators validate whether an attribute’s value is included or
excluded from a given set. The set can be any enumerable object such as an
array, range, or a dynamically generated collection using a proc, lambda, or
symbol.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">inclusion</code></strong> ensures that the value is present in the set.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">exclusion</code></strong> ensures that the value is <em>not</em> present in the set.</li>
</ul>

<p>In both cases, the option <code class="language-plaintext highlighter-rouge">:in</code> receives the set of values, and <code class="language-plaintext highlighter-rouge">:within</code> can be
used as an alias. For full options on customizing error messages, see the
<a href="#message">message documentation</a>.</p>

<p>If the enumerable is a numerical, time, or datetime range, the test is performed
using <code class="language-plaintext highlighter-rouge">Range#cover?</code>, otherwise, it uses <code class="language-plaintext highlighter-rouge">include?</code>. When using a proc or
lambda, the instance under validation is passed as an argument, allowing for
dynamic validation.</p>

<h4 id="examples">Examples</h4>

<p>For <code class="language-plaintext highlighter-rouge">inclusion</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Coffee</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(small medium large)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is not a valid size"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For <code class="language-plaintext highlighter-rouge">exclusion</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:subdomain</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(www us ca jp)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is reserved."</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Both validators allow the use of dynamic validation through methods that return
an enumerable. Here’s an example using a proc for <code class="language-plaintext highlighter-rouge">inclusion</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Coffee</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">coffee</span><span class="p">)</span> <span class="p">{</span> <span class="n">coffee</span><span class="p">.</span><span class="nf">available_sizes</span> <span class="p">}</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">available_sizes</span>
    <span class="sx">%w(small medium large extra_large)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Similarly, for <code class="language-plaintext highlighter-rouge">exclusion</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:subdomain</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="p">{</span> <span class="n">account</span><span class="p">.</span><span class="nf">reserved_subdomains</span> <span class="p">}</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">reserved_subdomains</span>
    <span class="sx">%w(www us ca jp admin)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="length"><code class="language-plaintext highlighter-rouge">length</code></h3>

<p>This validator validates the length of the attributes’ values. It provides a
variety of options, so you can specify length constraints in different ways:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">2</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:bio</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">500</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">in: </span><span class="mi">6</span><span class="o">..</span><span class="mi">20</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:registration_number</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">is: </span><span class="mi">6</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The possible length constraint options are:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:minimum</code></td>
      <td>The attribute cannot have less than the specified length.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:maximum</code></td>
      <td>The attribute cannot have more than the specified length.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:in</code></td>
      <td>The attribute length must be included in a given interval. The value for this option must be a range.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:is</code></td>
      <td>The attribute length must be equal to the given value.</td>
    </tr>
  </tbody>
</table>

<p>The default error messages depend on the type of length validation being
performed. You can customize these messages using the <code class="language-plaintext highlighter-rouge">:wrong_length</code>,
<code class="language-plaintext highlighter-rouge">:too_long</code>, and <code class="language-plaintext highlighter-rouge">:too_short</code> options and <code class="language-plaintext highlighter-rouge">%{count}</code> as a placeholder for the
number corresponding to the length constraint being used. You can still use the
<code class="language-plaintext highlighter-rouge">:message</code> option to specify an error message.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:bio</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">1000</span><span class="p">,</span>
    <span class="ss">too_long: </span><span class="s2">"%{count} characters is the maximum allowed"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: The default error messages are plural (e.g. “is too short (minimum is
%{count} characters)”). For this reason, when <code class="language-plaintext highlighter-rouge">:minimum</code> is 1 you should provide
a custom message or use <code class="language-plaintext highlighter-rouge">presence: true</code> instead. Similarly, when <code class="language-plaintext highlighter-rouge">:in</code> or
<code class="language-plaintext highlighter-rouge">:within</code> have a lower limit of 1, you should either provide a custom message or
call <code class="language-plaintext highlighter-rouge">presence</code> prior to <code class="language-plaintext highlighter-rouge">length</code>. Only one constraint option can be used at a
time apart from the <code class="language-plaintext highlighter-rouge">:minimum</code> and <code class="language-plaintext highlighter-rouge">:maximum</code> options which can be combined
together.</p>

<h3 id="numericality"><code class="language-plaintext highlighter-rouge">numericality</code></h3>

<p>This validator validates that your attributes have only numeric values. By
default, it will match an optional sign followed by an integer or floating point
number.</p>

<p>To specify that only integer numbers are allowed, set <code class="language-plaintext highlighter-rouge">:only_integer</code> to true.
Then it will use the following regular expression to validate the attribute’s
value.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/\A[+-]?\d+\z/</span>
</code></pre></div></div>

<p>Otherwise, it will try to convert the value to a number using <code class="language-plaintext highlighter-rouge">Float</code>. <code class="language-plaintext highlighter-rouge">Float</code>s
are converted to <code class="language-plaintext highlighter-rouge">BigDecimal</code> using the column’s precision value or a maximum of
15 digits.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Player</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:points</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:games_played</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">only_integer: </span><span class="kp">true</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The default error message for <code class="language-plaintext highlighter-rouge">:only_integer</code> is <em>“must be an integer”</em>.</p>

<p>Besides <code class="language-plaintext highlighter-rouge">:only_integer</code>, this validator also accepts the <code class="language-plaintext highlighter-rouge">:only_numeric</code> option
which specifies the value must be an instance of <code class="language-plaintext highlighter-rouge">Numeric</code> and attempts to parse
the value if it is a <code class="language-plaintext highlighter-rouge">String</code>.</p>

<p>NOTE: By default, <code class="language-plaintext highlighter-rouge">numericality</code> doesn’t allow <code class="language-plaintext highlighter-rouge">nil</code> values. You can use
<code class="language-plaintext highlighter-rouge">allow_nil: true</code> option to permit it. For <code class="language-plaintext highlighter-rouge">Integer</code> and <code class="language-plaintext highlighter-rouge">Float</code> columns empty
strings are converted to <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>The default error message when no options are specified is <em>“is not a number”</em>.</p>

<p>There are also many options that can be used to add constraints to acceptable
values:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
      <th>Default Error Message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:greater_than</code></td>
      <td>Specifies the value must be greater than the supplied value.</td>
      <td>“must be greater than %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:greater_than_or_equal_to</code></td>
      <td>Specifies the value must be greater than or equal to the supplied value.</td>
      <td>“must be greater than or equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:equal_to</code></td>
      <td>Specifies the value must be equal to the supplied value.</td>
      <td>“must be equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:less_than</code></td>
      <td>Specifies the value must be less than the supplied value.</td>
      <td>“must be less than %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:less_than_or_equal_to</code></td>
      <td>Specifies the value must be less than or equal to the supplied value.</td>
      <td>“must be less than or equal to %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:other_than</code></td>
      <td>Specifies the value must be other than the supplied value.</td>
      <td>“must be other than %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:in</code></td>
      <td>Specifies the value must be in the supplied range.</td>
      <td>“must be in %{count}”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:odd</code></td>
      <td>Specifies the value must be an odd number.</td>
      <td>“must be odd”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:even</code></td>
      <td>Specifies the value must be an even number.</td>
      <td>“must be even”</td>
    </tr>
  </tbody>
</table>

<h3 id="presence"><code class="language-plaintext highlighter-rouge">presence</code></h3>

<p>This validator validates that the specified attributes are not empty. It uses
the [<code class="language-plaintext highlighter-rouge">Object#blank?</code>][] method to check if the value is either <code class="language-plaintext highlighter-rouge">nil</code> or a blank
string - that is, a string that is either empty or consists of whitespace.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">person = Person.new(name: "Alice", login: "alice123", email: "alice@example.com")
person.valid?
</span><span class="p">=&gt;</span> <span class="kp">true</span> <span class="c1"># presence validation passes</span>

<span class="n">invalid_person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">""</span><span class="p">,</span> <span class="ss">login: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"bob@example.com"</span><span class="p">)</span>
<span class="n">invalid_person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="o">=&gt;</span> <span class="kp">false</span> <span class="c1"># presence validation fails</span>
</code></pre></div></div>

<p>To check that an association is present, you’ll need to test that the associated
object is present, and not the foreign key used to map the association. Testing
the association will help you to determine that the foreign key is not empty and
also that the referenced object exists.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Supplier</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:account</span>
  <span class="n">validates</span> <span class="ss">:account</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">account</span> <span class="o">=</span> <span class="no">Account</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Account A"</span><span class="p">)</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">supplier</span> <span class="o">=</span> <span class="no">Supplier</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">account: </span><span class="n">account</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">supplier</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span> <span class="c1"># presence validation passes</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">invalid_supplier</span> <span class="o">=</span> <span class="no">Supplier</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">invalid_supplier</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span> <span class="c1"># presence validation fails</span>
</code></pre></div></div>

<p>In cases where you use a custom <code class="language-plaintext highlighter-rouge">:foreign_key</code> or a <code class="language-plaintext highlighter-rouge">:through</code> association, it’s
important to explicitly set the <code class="language-plaintext highlighter-rouge">:inverse_of</code> option to optimize the association
lookup. This helps avoid unnecessary database queries during validation.</p>

<p>For more details, check out the <a href="association_basics.html#bi-directional-associations">Bi-directional Associations
documentation</a>.</p>

<p>NOTE: If you want to ensure that the association is both present and valid, you
also need to use <code class="language-plaintext highlighter-rouge">validates_associated</code>. More on that
<a href="#validates-associated">below</a>.</p>

<p>If you validate the presence of an object associated via a
<a href="association_basics.html#the-has-one-association"><code class="language-plaintext highlighter-rouge">has_one</code></a> or
<a href="association_basics.html#the-has-many-association"><code class="language-plaintext highlighter-rouge">has_many</code></a> relationship, it
will check that the object is neither <code class="language-plaintext highlighter-rouge">blank?</code> nor <code class="language-plaintext highlighter-rouge">marked_for_destruction?</code>.</p>

<p>Since <code class="language-plaintext highlighter-rouge">false.blank?</code> is true, if you want to validate the presence of a boolean
field you should use one of the following validations:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Value _must_ be true or false</span>
<span class="n">validates</span> <span class="ss">:boolean_field_name</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">]</span>
<span class="c1"># Value _must not_ be nil, aka true or false</span>
<span class="n">validates</span> <span class="ss">:boolean_field_name</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">[</span><span class="kp">nil</span><span class="p">]</span>
</code></pre></div></div>

<p>By using one of these validations, you will ensure the value will NOT be <code class="language-plaintext highlighter-rouge">nil</code>
which would result in a <code class="language-plaintext highlighter-rouge">NULL</code> value in most cases.</p>

<p>The default error message is <em>“can’t be blank”</em>.</p>

<p>[<code class="language-plaintext highlighter-rouge">Object#blank?</code>]:
    https://api.rubyonrails.org/classes/Object.html#method-i-blank-3F</p>

<h3 id="uniqueness"><code class="language-plaintext highlighter-rouge">uniqueness</code></h3>

<p>This validator validates that the attribute’s value is unique right before the
object gets saved.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The validation happens by performing an SQL query into the model’s table,
searching for an existing record with the same value in that attribute.</p>

<p>There is a <code class="language-plaintext highlighter-rouge">:scope</code> option that you can use to specify one or more attributes
that are used to limit the uniqueness check:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Holiday</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">scope: :year</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"should happen once per year"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>WARNING. This validation does not create a uniqueness constraint in the
database, so a scenario can occur whereby two different database connections
create two records with the same value for a column that you intended to be
unique. To avoid this, you must create a unique index on that column in your
database.</p>

<p>In order to add a uniqueness database constraint on your database, use the
[<code class="language-plaintext highlighter-rouge">add_index</code>][] statement in a migration and include the <code class="language-plaintext highlighter-rouge">unique: true</code> option.</p>

<p>If you are using the <code class="language-plaintext highlighter-rouge">:scope</code> option in your uniqueness validation, and you wish
to create a database constraint to prevent possible violations of the uniqueness
validation, you must create a unique index on both columns in your database. See
[the MySQL manual][] and [the MariaDB manual][] for more details about multiple
column indexes, or [the PostgreSQL manual][] for examples of unique constraints
that refer to a group of columns.</p>

<p>There is also a <code class="language-plaintext highlighter-rouge">:case_sensitive</code> option that you can use to define whether the
uniqueness constraint will be case sensitive, case insensitive, or if it should
respect the default database collation. This option defaults to respecting the
default database collation.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">case_sensitive: </span><span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>WARNING: Some databases are configured to perform case-insensitive searches
anyway.</p>

<p>A <code class="language-plaintext highlighter-rouge">:conditions</code> option can be used to specify additional conditions as a <code class="language-plaintext highlighter-rouge">WHERE</code>
SQL fragment to limit the uniqueness constraint lookup:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">conditions: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">status: </span><span class="s2">"active"</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>

<p>The default error message is <em>“has already been taken”</em>.</p>

<p>See [<code class="language-plaintext highlighter-rouge">validates_uniqueness_of</code>][] for more information.</p>

<p>[<code class="language-plaintext highlighter-rouge">validates_uniqueness_of</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_uniqueness_of
[<code class="language-plaintext highlighter-rouge">add_index</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_index
[the MySQL manual]:
    https://dev.mysql.com/doc/refman/en/multiple-column-indexes.html
[the MariaDB manual]: https://mariadb.com/kb/en/compound-composite-indexes/
[the PostgreSQL manual]:
    https://www.postgresql.org/docs/current/static/ddl-constraints.html</p>

<h3 id="validates_associated"><code class="language-plaintext highlighter-rouge">validates_associated</code></h3>

<p>You should use this validator when your model has associations that always need
to be validated. Every time you try to save your object, <code class="language-plaintext highlighter-rouge">valid?</code> will be called
on each one of the associated objects.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Library</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:books</span>
  <span class="n">validates_associated</span> <span class="ss">:books</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This validation will work with all of the association types.</p>

<p>WARNING: Don’t use <code class="language-plaintext highlighter-rouge">validates_associated</code> on both ends of your associations.
They would call each other in an infinite loop.</p>

<p>The default error message for [<code class="language-plaintext highlighter-rouge">validates_associated</code>][] is <em>“is invalid”</em>. Note
that each associated object will contain its own <code class="language-plaintext highlighter-rouge">errors</code> collection; errors do
not bubble up to the calling model.</p>

<p>NOTE: [<code class="language-plaintext highlighter-rouge">validates_associated</code>][] can only be used with ActiveRecord objects,
everything up until now can also be used on any object which includes
[<code class="language-plaintext highlighter-rouge">ActiveModel::Validations</code>][].</p>

<p>[<code class="language-plaintext highlighter-rouge">validates_associated</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_associated</p>

<h3 id="validates_each"><code class="language-plaintext highlighter-rouge">validates_each</code></h3>

<p>This validator validates attributes against a block. It doesn’t have a
predefined validation function. You should create one using a block, and every
attribute passed to [<code class="language-plaintext highlighter-rouge">validates_each</code>][] will be tested against it.</p>

<p>In the following example, we will reject names and surnames that begin with
lowercase.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_each</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:surname</span> <span class="k">do</span> <span class="o">|</span><span class="n">record</span><span class="p">,</span> <span class="kp">attr</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
    <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="kp">attr</span><span class="p">,</span> <span class="s2">"must start with upper case"</span><span class="p">)</span> <span class="k">if</span> <span class="sr">/\A[[:lower:]]/</span><span class="p">.</span><span class="nf">match?</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The block receives the record, the attribute’s name, and the attribute’s value.</p>

<p>You can do anything you like to check for valid data within the block. If your
validation fails, you should add an error to the model, therefore making it
invalid.</p>

<p>[<code class="language-plaintext highlighter-rouge">validates_each</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_each</p>

<h3 id="validates_with"><code class="language-plaintext highlighter-rouge">validates_with</code></h3>

<p>This validator passes the record to a separate class for validation.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddressValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">house_number</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:house_number</span><span class="p">,</span> <span class="s2">"is required"</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">street</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:street</span><span class="p">,</span> <span class="s2">"is required"</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">postcode</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:postcode</span><span class="p">,</span> <span class="s2">"is required"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">AddressValidator</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There is no default error message for <code class="language-plaintext highlighter-rouge">validates_with</code>. You must manually add
errors to the record’s errors collection in the validator class.</p>

<p>NOTE: Errors added to <code class="language-plaintext highlighter-rouge">record.errors[:base]</code> relate to the state of the record
as a whole.</p>

<p>To implement the validate method, you must accept a <code class="language-plaintext highlighter-rouge">record</code> parameter in the
method definition, which is the record to be validated.</p>

<p>If you want to add an error on a specific attribute, you can pass it as the
first argument to the <code class="language-plaintext highlighter-rouge">add</code> method.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">some_field</span> <span class="o">!=</span> <span class="s2">"acceptable"</span>
    <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:some_field</span><span class="p">,</span> <span class="s2">"this field is unacceptable"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We will cover <a href="#working-with-validation-errors">validation errors</a> in greater
detail later.</p>

<p>The [<code class="language-plaintext highlighter-rouge">validates_with</code>][] validator takes a class, or a list of classes to use
for validation.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">MyValidator</span><span class="p">,</span> <span class="no">MyOtherValidator</span><span class="p">,</span> <span class="ss">on: :create</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Like all other validations, <code class="language-plaintext highlighter-rouge">validates_with</code> takes the <code class="language-plaintext highlighter-rouge">:if</code>, <code class="language-plaintext highlighter-rouge">:unless</code> and
<code class="language-plaintext highlighter-rouge">:on</code> options. If you pass any other options, it will send those options to the
validator class as <code class="language-plaintext highlighter-rouge">options</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddressValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:fields</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">field</span><span class="p">).</span><span class="nf">blank?</span>
        <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="n">field</span><span class="p">,</span> <span class="s2">"is required"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">AddressValidator</span><span class="p">,</span> <span class="ss">fields: </span><span class="p">[</span><span class="ss">:house_number</span><span class="p">,</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">:postcode</span><span class="p">,</span> <span class="ss">:country</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: The validator will be initialized <em>only once</em> for the whole application
life cycle, and not on each validation run, so be careful about using instance
variables inside it.</p>

<p>If your validator is complex enough that you want instance variables, you can
easily use a plain old Ruby object instead:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoice</span><span class="o">|</span>
    <span class="no">AddressValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">invoice</span><span class="p">).</span><span class="nf">validate</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">AddressValidator</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>
    <span class="vi">@invoice</span> <span class="o">=</span> <span class="n">invoice</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">validate</span>
    <span class="n">validate_field</span><span class="p">(</span><span class="ss">:house_number</span><span class="p">)</span>
    <span class="n">validate_field</span><span class="p">(</span><span class="ss">:street</span><span class="p">)</span>
    <span class="n">validate_field</span><span class="p">(</span><span class="ss">:postcode</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">validate_field</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
      <span class="k">if</span> <span class="vi">@invoice</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">field</span><span class="p">).</span><span class="nf">blank?</span>
        <span class="vi">@invoice</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="n">field</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">field</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">humanize</span><span class="si">}</span><span class="s2"> is required"</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We will cover <a href="#performing-custom-validations">custom validations</a> more later.</p>

<p>[<code class="language-plaintext highlighter-rouge">validates_with</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_with</p>

<h2 id="validation-options">Validation Options</h2>

<p>There are several common options supported by the validators. These options are:</p>

<ul>
  <li><a href="#allow-nil"><code class="language-plaintext highlighter-rouge">:allow_nil</code></a>: Skip validation if the attribute is <code class="language-plaintext highlighter-rouge">nil</code>.</li>
  <li><a href="#allow-blank"><code class="language-plaintext highlighter-rouge">:allow_blank</code></a>: Skip validation if the attribute is blank.</li>
  <li><a href="#message"><code class="language-plaintext highlighter-rouge">:message</code></a>: Specify a custom error message.</li>
  <li><a href="#on"><code class="language-plaintext highlighter-rouge">:on</code></a>: Specify the contexts where this validation is active.</li>
  <li><a href="#strict-validations"><code class="language-plaintext highlighter-rouge">:strict</code></a>: Raise an exception when the validation
fails.</li>
  <li><a href="#conditional-validations"><code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code></a>: Specify when the validation
should or should not occur.</li>
</ul>

<p>NOTE: Not all of these options are supported by every validator, please refer to
the API documentation for [<code class="language-plaintext highlighter-rouge">ActiveModel::Validations</code>][].</p>

<p>[<code class="language-plaintext highlighter-rouge">ActiveModel::Validations</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations.html</p>

<h3 id="allow_nil"><code class="language-plaintext highlighter-rouge">:allow_nil</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">:allow_nil</code> option skips the validation when the value being validated is
<code class="language-plaintext highlighter-rouge">nil</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Coffee</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(small medium large)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is not a valid size"</span> <span class="p">},</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Coffee</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">size: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Coffee</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">size: </span><span class="s2">"mega"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<p>For full options to the message argument please see the <a href="#message">message
documentation</a>.</p>

<h3 id="allow_blank"><code class="language-plaintext highlighter-rouge">:allow_blank</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">:allow_blank</code> option is similar to the <code class="language-plaintext highlighter-rouge">:allow_nil</code> option. This option
will let validation pass if the attribute’s value is <code class="language-plaintext highlighter-rouge">blank?</code>, like <code class="language-plaintext highlighter-rouge">nil</code> or an
empty string for example.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Topic</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">is: </span><span class="mi">6</span> <span class="p">},</span> <span class="ss">allow_blank: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Topic</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">""</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Topic</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Topic</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"short"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span> <span class="c1"># 'short' is not of length 6, so validation fails even though it's not blank</span>
</code></pre></div></div>

<h3 id="message"><code class="language-plaintext highlighter-rouge">:message</code></h3>

<p>As you’ve already seen, the <code class="language-plaintext highlighter-rouge">:message</code> option lets you specify the message that
will be added to the <code class="language-plaintext highlighter-rouge">errors</code> collection when validation fails. When this option
is not used, Active Record will use the respective default error message for
each validation.</p>

<p>The <code class="language-plaintext highlighter-rouge">:message</code> option accepts either a <code class="language-plaintext highlighter-rouge">String</code> or <code class="language-plaintext highlighter-rouge">Proc</code> as its value.</p>

<p>A <code class="language-plaintext highlighter-rouge">String</code> <code class="language-plaintext highlighter-rouge">:message</code> value can optionally contain any/all of <code class="language-plaintext highlighter-rouge">%{value}</code>,
<code class="language-plaintext highlighter-rouge">%{attribute}</code>, and <code class="language-plaintext highlighter-rouge">%{model}</code> which will be dynamically replaced when
validation fails. This replacement is done using the <a href="https://github.com/ruby-i18n/i18n">i18n
gem</a>, and the placeholders must match
exactly, no spaces are allowed.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># Hard-coded message</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="p">{</span> <span class="ss">message: </span><span class="s2">"must be given please"</span> <span class="p">}</span>

  <span class="c1"># Message with dynamic attribute value. %{value} will be replaced</span>
  <span class="c1"># with the actual value of the attribute. %{attribute} and %{model}</span>
  <span class="c1"># are also available.</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">message: </span><span class="s2">"%{value} seems wrong"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">Proc</code> <code class="language-plaintext highlighter-rouge">:message</code> value is given two arguments: the object being validated,
and a hash with <code class="language-plaintext highlighter-rouge">:model</code>, <code class="language-plaintext highlighter-rouge">:attribute</code>, and <code class="language-plaintext highlighter-rouge">:value</code> key-value pairs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span>
    <span class="ss">uniqueness: </span><span class="p">{</span>
      <span class="c1"># object = person object being validated</span>
      <span class="c1"># data = { model: "Person", attribute: "Username", value: &lt;username&gt; }</span>
      <span class="ss">message: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="k">do</span>
        <span class="s2">"Hey </span><span class="si">#{</span><span class="n">object</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">data</span><span class="p">[</span><span class="ss">:value</span><span class="p">]</span><span class="si">}</span><span class="s2"> is already taken."</span>
      <span class="k">end</span>
    <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To translate error messages, see the <a href="i18n.html#error-message-scopes">I18n
guide</a>.</p>

<h3 id="on"><code class="language-plaintext highlighter-rouge">:on</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">:on</code> option lets you specify when the validation should happen. The default
behavior for all the built-in validations is to be run on save (both when you’re
creating a new record and when you’re updating it). If you want to change it,
you can use <code class="language-plaintext highlighter-rouge">on: :create</code> to run the validation only when a new record is
created or <code class="language-plaintext highlighter-rouge">on: :update</code> to run the validation only when a record is updated.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># it will be possible to update email with a duplicated value</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :create</span>

  <span class="c1"># it will be possible to create the record with a non-numerical age</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :update</span>

  <span class="c1"># the default (validates on both create and update)</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also use <code class="language-plaintext highlighter-rouge">:on</code> to define custom contexts. Custom contexts need to be
triggered explicitly by passing the name of the context to <code class="language-plaintext highlighter-rouge">valid?</code>, <code class="language-plaintext highlighter-rouge">invalid?</code>,
or <code class="language-plaintext highlighter-rouge">save</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">age: </span><span class="s1">'thirty-three'</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:account_setup</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"has already been taken"</span><span class="p">],</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"is not a number"</span><span class="p">]}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">person.valid?(:account_setup)</code> executes both the validations without saving the
model. <code class="language-plaintext highlighter-rouge">person.save(context: :account_setup)</code> validates <code class="language-plaintext highlighter-rouge">person</code> in the
<code class="language-plaintext highlighter-rouge">account_setup</code> context before saving.</p>

<p>Passing an array of symbols is also acceptable.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: </span><span class="p">[</span><span class="ss">:update</span><span class="p">,</span> <span class="ss">:ensure_title</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="kp">nil</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:ensure_title</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:title</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]}</span>
</code></pre></div></div>

<p>When triggered by an explicit context, validations are run for that context, as
well as any validations <em>without</em> a context.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:account_setup</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"has already been taken"</span><span class="p">],</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"is not a number"</span><span class="p">],</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]}</span>
</code></pre></div></div>

<p>You can read more about use-cases for <code class="language-plaintext highlighter-rouge">:on</code> in the <a href="#custom-contexts">Custom Contexts
section</a>.</p>

<h2 id="conditional-validations">Conditional Validations</h2>

<p>Sometimes it will make sense to validate an object only when a given condition
is met. You can do that by using the <code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code> options, which can take
a symbol, a <code class="language-plaintext highlighter-rouge">Proc</code> or an <code class="language-plaintext highlighter-rouge">Array</code>. You may use the <code class="language-plaintext highlighter-rouge">:if</code> option when you want to
specify when the validation <strong>should</strong> happen. Alternatively, if you want to
specify when the validation <strong>should not</strong> happen, then you may use the
<code class="language-plaintext highlighter-rouge">:unless</code> option.</p>

<h3 id="using-a-symbol-with-if-and-unless">Using a Symbol with <code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code></h3>

<p>You can associate the <code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code> options with a symbol corresponding to
the name of a method that will get called right before validation happens. This
is the most commonly used option.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:card_number</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">if: :paid_with_card?</span>

  <span class="k">def</span> <span class="nf">paid_with_card?</span>
    <span class="n">payment_type</span> <span class="o">==</span> <span class="s2">"card"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="using-a-proc-with-if-and-unless">Using a Proc with <code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code></h3>

<p>It is possible to associate <code class="language-plaintext highlighter-rouge">:if</code> and <code class="language-plaintext highlighter-rouge">:unless</code> with a <code class="language-plaintext highlighter-rouge">Proc</code> object which will
be called. Using a <code class="language-plaintext highlighter-rouge">Proc</code> object gives you the ability to write an inline
condition instead of a separate method. This option is best suited for
one-liners.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">unless: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span><span class="p">.</span><span class="nf">password</span><span class="p">.</span><span class="nf">blank?</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>As <code class="language-plaintext highlighter-rouge">lambda</code> is a type of <code class="language-plaintext highlighter-rouge">Proc</code>, it can also be used to write inline conditions
taking advantage of the shortened syntax.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">unless: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">password</span><span class="p">.</span><span class="nf">blank?</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="grouping-conditional-validations">Grouping Conditional Validations</h3>

<p>Sometimes it is useful to have multiple validations use one condition. It can be
easily achieved using [<code class="language-plaintext highlighter-rouge">with_options</code>][].</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">if: :is_admin?</span> <span class="k">do</span> <span class="o">|</span><span class="n">admin</span><span class="o">|</span>
    <span class="n">admin</span><span class="p">.</span><span class="nf">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
    <span class="n">admin</span><span class="p">.</span><span class="nf">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>All validations inside of the <code class="language-plaintext highlighter-rouge">with_options</code> block will automatically have <code class="language-plaintext highlighter-rouge">if:
:is_admin?</code> merged into its options.</p>

<p>[<code class="language-plaintext highlighter-rouge">with_options</code>]:
    https://api.rubyonrails.org/classes/Object.html#method-i-with_options</p>

<h3 id="combining-validation-conditions">Combining Validation Conditions</h3>

<p>On the other hand, when multiple conditions define whether or not a validation
should happen, an <code class="language-plaintext highlighter-rouge">Array</code> can be used. Moreover, you can apply both <code class="language-plaintext highlighter-rouge">:if</code> and
<code class="language-plaintext highlighter-rouge">:unless</code> to the same validation.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Computer</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:mouse</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">if: </span><span class="p">[</span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">market</span><span class="p">.</span><span class="nf">retail?</span> <span class="p">},</span> <span class="ss">:desktop?</span><span class="p">],</span>
                    <span class="ss">unless: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">trackpad</span><span class="p">.</span><span class="nf">present?</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The validation only runs when all the <code class="language-plaintext highlighter-rouge">:if</code> conditions and none of the <code class="language-plaintext highlighter-rouge">:unless</code>
conditions are evaluated to <code class="language-plaintext highlighter-rouge">true</code>.</p>

<h2 id="strict-validations">Strict Validations</h2>

<p>You can also specify validations to be strict and raise
<code class="language-plaintext highlighter-rouge">ActiveModel::StrictValidationFailed</code> when the object is invalid.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="p">{</span> <span class="ss">strict: </span><span class="kp">true</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">StrictValidationFailed</span><span class="p">:</span> <span class="no">Name</span> <span class="n">can</span><span class="err">'</span><span class="n">t</span> <span class="n">be</span> <span class="n">blank</span>
</code></pre></div></div>

<p>Strict validations ensure that an exception is raised immediately when
validation fails, which can be useful in situations where you want to enforce
immediate feedback or halt processing when invalid data is encountered. For
example, you might use strict validations in a scenario where invalid input
should prevent further operations, such as when processing critical transactions
or performing data integrity checks.</p>

<p>There is also the ability to pass a custom exception to the <code class="language-plaintext highlighter-rouge">:strict</code> option.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:token</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">strict: </span><span class="no">TokenGenerationException</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="no">TokenGenerationException</span><span class="p">:</span> <span class="no">Token</span> <span class="n">can</span><span class="err">'</span><span class="n">t</span> <span class="n">be</span> <span class="n">blank</span>
</code></pre></div></div>

<h2 id="listing-validators">Listing Validators</h2>

<p>If you want to find out all of the validators for a given object, you can use
<code class="language-plaintext highlighter-rouge">validators</code>.</p>

<p>For example, if we have the following model using a custom validator and a
built-in validator:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :create</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">format: </span><span class="no">URI</span><span class="o">::</span><span class="no">MailTo</span><span class="o">::</span><span class="no">EMAIL_REGEXP</span>
  <span class="n">validates_with</span> <span class="no">MyOtherValidator</span><span class="p">,</span> <span class="ss">strict: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can now use <code class="language-plaintext highlighter-rouge">validators</code> on the “Person” model to list all validators, or
even check a specific field using <code class="language-plaintext highlighter-rouge">validators_on</code>.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">validators</span>
<span class="c">#=&gt; [#&lt;ActiveRecord::Validations::PresenceValidator:0x10b2f2158
</span><span class="go">      @attributes=[:name], @options={:on=&gt;:create}&gt;,
</span><span class="c">     #&lt;MyOtherValidatorValidator:0x10b2f17d0
</span><span class="go">      @attributes=[:name], @options={:strict=&gt;true}&gt;,
</span><span class="c">     #&lt;ActiveModel::Validations::FormatValidator:0x10b2f0f10
</span><span class="go">      @attributes=[:email],
      @options={:with=&gt;URI::MailTo::EMAIL_REGEXP}&gt;]
</span><span class="c">     #&lt;MyOtherValidator:0x10b2f0948 @options={:strict=&gt;true}&gt;]
</span><span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">validators_on</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="c">#=&gt; [#&lt;ActiveModel::Validations::PresenceValidator:0x10b2f2158
</span><span class="go">      @attributes=[:name], @options={on: :create}&gt;]
</span></code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">validate</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validate</p>

<h2 id="performing-custom-validations">Performing Custom Validations</h2>

<p>When the built-in validations are not enough for your needs, you can write your
own validators or validation methods as you prefer.</p>

<h3 id="custom-validators">Custom Validators</h3>

<p>Custom validators are classes that inherit from [<code class="language-plaintext highlighter-rouge">ActiveModel::Validator</code>][].
These classes must implement the <code class="language-plaintext highlighter-rouge">validate</code> method which takes a record as an
argument and performs the validation on it. The custom validator is called using
the <code class="language-plaintext highlighter-rouge">validates_with</code> method.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">unless</span> <span class="n">record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">start_with?</span> <span class="s2">"X"</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:name</span><span class="p">,</span> <span class="s2">"Provide a name starting with X, please!"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">MyValidator</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The easiest way to add custom validators for validating individual attributes is
with the convenient [<code class="language-plaintext highlighter-rouge">ActiveModel::EachValidator</code>][]. In this case, the custom
validator class must implement a <code class="language-plaintext highlighter-rouge">validate_each</code> method which takes three
arguments: record, attribute, and value. These correspond to the instance, the
attribute to be validated, and the value of the attribute in the passed
instance.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EmailValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">EachValidator</span>
  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">unless</span> <span class="no">URI</span><span class="o">::</span><span class="no">MailTo</span><span class="o">::</span><span class="no">EMAIL_REGEXP</span><span class="p">.</span><span class="nf">match?</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="n">attribute</span><span class="p">,</span> <span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"is not an email"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">email: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>As shown in the example, you can also combine standard validations with your own
custom validators.</p>

<p>[<code class="language-plaintext highlighter-rouge">ActiveModel::EachValidator</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/EachValidator.html
[<code class="language-plaintext highlighter-rouge">ActiveModel::Validator</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Validator.html</p>

<h3 id="custom-methods">Custom Methods</h3>

<p>You can also create methods that verify the state of your models and add errors
to the <code class="language-plaintext highlighter-rouge">errors</code> collection when they are invalid. You must then register these
methods by using the [<code class="language-plaintext highlighter-rouge">validate</code>][] class method, passing in the symbols for the
validation methods’ names.</p>

<p>You can pass more than one symbol for each class method and the respective
validations will be run in the same order as they were registered.</p>

<p>The <code class="language-plaintext highlighter-rouge">valid?</code> method will verify that the <code class="language-plaintext highlighter-rouge">errors</code> collection is empty, so your
custom validation methods should add errors to it when you wish validation to
fail:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="ss">:expiration_date_cannot_be_in_the_past</span><span class="p">,</span>
    <span class="ss">:discount_cannot_be_greater_than_total_value</span>

  <span class="k">def</span> <span class="nf">expiration_date_cannot_be_in_the_past</span>
    <span class="k">if</span> <span class="n">expiration_date</span><span class="p">.</span><span class="nf">present?</span> <span class="o">&amp;&amp;</span> <span class="n">expiration_date</span> <span class="o">&lt;</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:expiration_date</span><span class="p">,</span> <span class="s2">"can't be in the past"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">discount_cannot_be_greater_than_total_value</span>
    <span class="k">if</span> <span class="n">discount</span> <span class="o">&gt;</span> <span class="n">total_value</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:discount</span><span class="p">,</span> <span class="s2">"can't be greater than total value"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>By default, such validations will run every time you call <code class="language-plaintext highlighter-rouge">valid?</code> or save the
object. But it is also possible to control when to run these custom validations
by giving an <code class="language-plaintext highlighter-rouge">:on</code> option to the <code class="language-plaintext highlighter-rouge">validate</code> method, with either: <code class="language-plaintext highlighter-rouge">:create</code> or
<code class="language-plaintext highlighter-rouge">:update</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="ss">:active_customer</span><span class="p">,</span> <span class="ss">on: :create</span>

  <span class="k">def</span> <span class="nf">active_customer</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:customer_id</span><span class="p">,</span> <span class="s2">"is not active"</span><span class="p">)</span> <span class="k">unless</span> <span class="n">customer</span><span class="p">.</span><span class="nf">active?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>See the section above for more details about <a href="#on"><code class="language-plaintext highlighter-rouge">:on</code></a>.</p>

<h3 id="custom-contexts">Custom Contexts</h3>

<p>You can define your own custom validation contexts for callbacks, which is
useful when you want to perform validations based on specific scenarios or group
certain callbacks together and run them in a specific context. A common scenario
for custom contexts is when you have a multi-step form and want to perform
validations per step.</p>

<p>For instance, you might define custom contexts for each step of the form:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="ss">:personal_information</span><span class="p">,</span> <span class="ss">on: :personal_info</span>
  <span class="n">validate</span> <span class="ss">:contact_information</span><span class="p">,</span> <span class="ss">on: :contact_info</span>
  <span class="n">validate</span> <span class="ss">:location_information</span><span class="p">,</span> <span class="ss">on: :location_info</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">personal_information</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"Name must be present"</span><span class="p">)</span> <span class="k">if</span> <span class="n">first_name</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"Age must be at least 18"</span><span class="p">)</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&amp;&amp;</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">contact_information</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"Email must be present"</span><span class="p">)</span> <span class="k">if</span> <span class="n">email</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"Phone number must be present"</span><span class="p">)</span> <span class="k">if</span> <span class="n">phone</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">location_information</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"Address must be present"</span><span class="p">)</span> <span class="k">if</span> <span class="n">address</span><span class="p">.</span><span class="nf">blank?</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"City must be present"</span><span class="p">)</span> <span class="k">if</span> <span class="n">city</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In these cases, you may be tempted to <a href="active_record_callbacks.html#skipping-callbacks">skip
callbacks</a> altogether, but
defining a custom context can be a more structured approach. You will need to
combine a context with the <code class="language-plaintext highlighter-rouge">:on</code> option to define a custom context for a
callback.</p>

<p>Once you’ve defined the custom context, you can use it to trigger the
validations:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">,</span> <span class="ss">age: </span><span class="mi">17</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"jane@example.com"</span><span class="p">,</span> <span class="ss">phone: </span><span class="s2">"1234567890"</span><span class="p">,</span> <span class="ss">address: </span><span class="s2">"123 Main St"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:personal_info</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:contact_info</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:location_info</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>You can also use the custom contexts to trigger the validations on any method
that supports callbacks. For example, you could use the custom context to
trigger the validations on <code class="language-plaintext highlighter-rouge">save</code>:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">,</span> <span class="ss">age: </span><span class="mi">17</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"jane@example.com"</span><span class="p">,</span> <span class="ss">phone: </span><span class="s2">"1234567890"</span><span class="p">,</span> <span class="ss">address: </span><span class="s2">"123 Main St"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="ss">context: :personal_info</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="ss">context: :contact_info</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="ss">context: :location_info</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<h2 id="working-with-validation-errors">Working with Validation Errors</h2>

<p>The [<code class="language-plaintext highlighter-rouge">valid?</code>][] and [<code class="language-plaintext highlighter-rouge">invalid?</code>][] methods only provide a summary status on
validity. However you can dig deeper into each individual error by using various
methods from the [<code class="language-plaintext highlighter-rouge">errors</code>][] collection.</p>

<p>The following is a list of the most commonly used methods. Please refer to the
[<code class="language-plaintext highlighter-rouge">ActiveModel::Errors</code>][] documentation for a list of all the available methods.</p>

<p>[<code class="language-plaintext highlighter-rouge">ActiveModel::Errors</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Errors.html</p>

<h3 id="errors"><code class="language-plaintext highlighter-rouge">errors</code></h3>

<p>The [<code class="language-plaintext highlighter-rouge">errors</code>][] method is the starting point through which you can drill down
into various details of each error.</p>

<p>This returns an instance of the class <code class="language-plaintext highlighter-rouge">ActiveModel::Errors</code> containing all
errors, each error is represented by an [<code class="language-plaintext highlighter-rouge">ActiveModel::Error</code>][] object.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"Name can't be blank"</span><span class="p">,</span> <span class="s2">"Name is too short (minimum is 3 characters)"</span><span class="p">]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="p">=&gt;</span> <span class="p">[]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">details</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="o">=&gt;</span><span class="ss">:too_short</span><span class="p">,</span> <span class="ss">:count</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">}</span>
</code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">ActiveModel::Error</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Error.html</p>

<h3 id="errors-1"><code class="language-plaintext highlighter-rouge">errors[]</code></h3>

<p>[<code class="language-plaintext highlighter-rouge">errors[]</code>][Errors#squarebrackets] is used when you want to check the error
messages for a specific attribute. It returns an array of strings with all error
messages for the given attribute, each string with one error message. If there
are no errors related to the attribute, it returns an empty array.</p>

<p>This method is only useful <em>after</em> validations have been run, because it only
inspects the <code class="language-plaintext highlighter-rouge">errors</code> collection and does not trigger validations itself. It’s
different from the <code class="language-plaintext highlighter-rouge">ActiveRecord::Base#invalid?</code> method explained above because
it doesn’t verify the validity of the object as a whole. <code class="language-plaintext highlighter-rouge">errors[]</code> only checks
to see whether there are errors found on an individual attribute of the object.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"JD"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"is too short (minimum is 3 characters)"</span><span class="p">]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">,</span> <span class="s2">"is too short (minimum is 3 characters)"</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="errorswhere-and-error-object"><code class="language-plaintext highlighter-rouge">errors.where</code> and Error Object</h3>

<p>Sometimes we may need more information about each error besides its message.
Each error is encapsulated as an <code class="language-plaintext highlighter-rouge">ActiveModel::Error</code> object, and the
[<code class="language-plaintext highlighter-rouge">where</code>][] method is the most common way of access.</p>

<p><code class="language-plaintext highlighter-rouge">where</code> returns an array of error objects filtered by various degrees of
conditions.</p>

<p>Given the following validation:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can filter for just the <code class="language-plaintext highlighter-rouge">attribute</code> by passing it as the first parameter to
<code class="language-plaintext highlighter-rouge">errors.where(:attr)</code>. The second parameter is used for filtering the <code class="language-plaintext highlighter-rouge">type</code> of
error we want by calling <code class="language-plaintext highlighter-rouge">errors.where(:attr, :type)</code>.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># all errors for :name attribute</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_short</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># :too_short errors for :name attribute</span>
</code></pre></div></div>

<p>Lastly, we can filter by any <code class="language-plaintext highlighter-rouge">options</code> that may exist on the given type of error
object.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_short</span><span class="p">,</span> <span class="ss">minimum: </span><span class="mi">3</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># all name errors being too short and minimum is 3</span>
</code></pre></div></div>

<p>You can read various information from these error objects:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">last</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">attribute</span>
<span class="p">=&gt;</span> <span class="ss">:name</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">type</span>
<span class="p">=&gt;</span> <span class="ss">:too_short</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">options</span><span class="p">[</span><span class="ss">:count</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="mi">3</span>
</code></pre></div></div>

<p>You can also generate the error message:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">message</span>
<span class="p">=&gt;</span> <span class="s2">"is too short (minimum is 3 characters)"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name is too short (minimum is 3 characters)"</span>
</code></pre></div></div>

<p>The [<code class="language-plaintext highlighter-rouge">full_message</code>][] method generates a more user-friendly message, with the
capitalized attribute name prepended. (To customize the format that
<code class="language-plaintext highlighter-rouge">full_message</code> uses, see the <a href="i18n.html#active-model-methods">I18n guide</a>.)</p>

<p>[<code class="language-plaintext highlighter-rouge">full_message</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-full_message
[<code class="language-plaintext highlighter-rouge">where</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-where</p>

<h3 id="errorsadd"><code class="language-plaintext highlighter-rouge">errors.add</code></h3>

<p>The [<code class="language-plaintext highlighter-rouge">add</code>][] method creates the error object by taking the <code class="language-plaintext highlighter-rouge">attribute</code>, the
error <code class="language-plaintext highlighter-rouge">type</code> and additional options hash. This is useful when writing your own
validator, as it lets you define very specific error situations.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_plain</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"is not cool enough"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">type</span>
<span class="p">=&gt;</span> <span class="ss">:too_plain</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name is not cool enough"</span>
</code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">add</code>]:
    https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-add</p>

<h3 id="errorsbase"><code class="language-plaintext highlighter-rouge">errors[:base]</code></h3>

<p>You can add errors that are related to the object’s state as a whole, instead of
being related to a specific attribute. To do this you must use <code class="language-plaintext highlighter-rouge">:base</code> as the
attribute when adding a new error.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="ss">:invalid</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"This person is invalid because ..."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:base</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"This person is invalid because ..."</span>
</code></pre></div></div>

<h3 id="errorssize"><code class="language-plaintext highlighter-rouge">errors.size</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">size</code> method returns the total number of errors for the object.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">2</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Andrea"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"andrea@example.com"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">0</span>
</code></pre></div></div>

<h3 id="errorsclear"><code class="language-plaintext highlighter-rouge">errors.clear</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">clear</code> method is used when you intentionally want to clear the <code class="language-plaintext highlighter-rouge">errors</code>
collection. Of course, calling <code class="language-plaintext highlighter-rouge">errors.clear</code> upon an invalid object won’t
actually make it valid: the <code class="language-plaintext highlighter-rouge">errors</code> collection will now be empty, but the next
time you call <code class="language-plaintext highlighter-rouge">valid?</code> or any method that tries to save this object to the
database, the validations will run again. If any of the validations fail, the
<code class="language-plaintext highlighter-rouge">errors</code> collection will be filled again.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">clear</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<h2 id="displaying-validation-errors-in-views">Displaying Validation Errors in Views</h2>

<p>Once you’ve defined a model and added validations, you’ll want to display an
error message when a validation fails during the creation of that model via a
web form.</p>

<p>Since every application handles displaying validation errors differently, Rails
does not include any view helpers for generating these messages. However, Rails
gives you a rich number of methods to interact with validations that you can use
to build your own. In addition, when generating a scaffold, Rails will put some
generated ERB into the <code class="language-plaintext highlighter-rouge">_form.html.erb</code> that displays the full list of errors on
that model.</p>

<p>Assuming we have a model that’s been saved in an instance variable named
<code class="language-plaintext highlighter-rouge">@article</code>, it looks like this:</p>

<pre><code class="language-html+erb">&lt;% if @article.errors.any? %&gt;
  &lt;div id="error_explanation"&gt;
    &lt;h2&gt;&lt;%= pluralize(@article.errors.count, "error") %&gt; prohibited this article from being saved:&lt;/h2&gt;

    &lt;ul&gt;
      &lt;% @article.errors.each do |error| %&gt;
        &lt;li&gt;&lt;%= error.full_message %&gt;&lt;/li&gt;
      &lt;% end %&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>Furthermore, if you use the Rails form helpers to generate your forms, when a
validation error occurs on a field, it will generate an extra <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> around the
entry.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field_with_errors"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"article_title"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>You can then style this div however you’d like. The default scaffold that Rails
generates, for example, adds this CSS rule:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.field_with_errors</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="nx">red</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">table</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This means that any field with an error ends up with a 2 pixel red border.</p>

<h3 id="customizing-error-field-wrapper">Customizing Error Field Wrapper</h3>

<p>Rails uses the <code class="language-plaintext highlighter-rouge">field_error_proc</code> configuration option to wrap fields with
errors in HTML. By default, this option wraps the erroneous form fields in a
<code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> with a <code class="language-plaintext highlighter-rouge">field_with_errors</code> class, as seen in the example above:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">action_view</span><span class="p">.</span><span class="nf">field_error_proc</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">html_tag</span><span class="p">,</span> <span class="n">instance</span><span class="o">|</span> <span class="n">content_tag</span> <span class="ss">:div</span><span class="p">,</span> <span class="n">html_tag</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"field_with_errors"</span> <span class="p">}</span>
</code></pre></div></div>

<p>You can customize this behavior by modifying the field_error_proc setting in
your application configuration, allowing you to change how errors are presented
in your forms. For more details,refer to the <a href="configuring.html#config-action-view-field-error-proc">Configuration Guide on
field_error_proc</a>.</p>

        </div>

        <footer class="guide-footer">
            <div class="feedback">
                <h3>Geri Bildirim</h3>
                <p>Bu kılavuzun kalitesini artırmamıza yardımcı olmak için geri bildirimlerinizi bekliyoruz.</p>
                <p>Lütfen <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub Issues</a> üzerinden katkıda bulunun.</p>
            </div>
        </footer>
    </article>
</div>

<script>
// İçindekiler tablosunu otomatik oluştur
document.addEventListener('DOMContentLoaded', function() {
    const toc = document.getElementById('toc');
    const headings = document.querySelectorAll('.guide-content h2, .guide-content h3, .guide-content h4');
    
    if (headings.length > 0) {
        const tocList = document.createElement('ul');
        
        headings.forEach(function(heading, index) {
            const id = 'heading-' + index;
            heading.id = id;
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();
            
            li.appendChild(a);
            tocList.appendChild(li);
        });
        
        toc.appendChild(tocList);
    }
});
</script>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Rails Kılavuzları Türkçe Çevirisi. Gönüllüler tarafından hazırlanmıştır.</p>
            <p>Orijinal dokümantasyon <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine aittir.</p>
        </div>
    </footer>

    <script>hljs.highlightAll();</script>
</body>
</html>