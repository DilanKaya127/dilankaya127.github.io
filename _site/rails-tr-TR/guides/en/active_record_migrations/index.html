<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Record Migrations - Rails Dokümantasyonu - Türkçe</title>
    <link rel="stylesheet" href="/rails-tr-TR/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <a href="/rails-tr-TR/">Rails Kılavuzları</a>
                </h1>
                <nav class="nav">
                    <a href="/rails-tr-TR/">Ana Sayfa</a>
                    <a href="https://dilankaya127.github.io">Portföy</a>
                    <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="guide-container">
    <aside class="guide-sidebar">
        <div class="guide-toc">
            <h3>İçindekiler</h3>
            <div id="toc"></div>
        </div>
        
        <div class="guide-nav">
            <h3>Diğer Kılavuzlar</h3>
            <ul>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/getting_started">Rails ile Başlarken</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/en/active_record_basics">Active Record Temelleri</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides//en/action_controller_overview">Action Controller</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/action_cable_overview">Action Cable</a></li>
            </ul>
        </div>
    </aside>

    <article class="guide-content">
        <header class="guide-header">
            <h1>Active Record Migrations</h1>
            
        </header>

        <div class="guide-body">
            <p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1 id="active-record-migrations">Active Record Migrations</h1>

<p>Migrations are a feature of Active Record that allows you to evolve your
database schema over time. Rather than write schema modifications in pure SQL,
migrations allow you to use a Ruby Domain Specific Language (DSL) to describe
changes to your tables.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>Which generators you can use to create migrations.</li>
  <li>Which methods Active Record provides to manipulate your database.</li>
  <li>How to change existing migrations and update your schema.</li>
  <li>How migrations relate to <code class="language-plaintext highlighter-rouge">schema.rb</code>.</li>
  <li>How to maintain referential integrity.</li>
</ul>

<hr />

<h2 id="migration-overview">Migration Overview</h2>

<p>Migrations are a convenient way to <a href="https://en.wikipedia.org/wiki/Schema_migration">evolve your database schema over
time</a> in a reproducible way.
They use a Ruby <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> so
that you don’t have to write <a href="https://en.wikipedia.org/wiki/SQL">SQL</a> by hand,
allowing your schema and changes to be database independent. We recommend that
you read the guides for <a href="active_record_basics.html">Active Record Basics</a> and
the <a href="association_basics.html">Active Record Associations</a> to learn more about
some of the concepts mentioned here.</p>

<p>You can think of each migration as being a new ‘version’ of the database. A
schema starts off with nothing in it, and each migration modifies it to add or
remove tables, columns, or indexes. Active Record knows how to update your
schema along this timeline, bringing it from whatever point it is in the history
to the latest version. Read more about <a href="#rails-migration-version-control">how Rails knows which migration in the
timeline to run</a>.</p>

<p>Active Record updates your <code class="language-plaintext highlighter-rouge">db/schema.rb</code> file to match the up-to-date structure
of your database. Here’s an example of a migration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20240502100843_create_products.rb</span>
<span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:description</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This migration adds a table called <code class="language-plaintext highlighter-rouge">products</code> with a string column called <code class="language-plaintext highlighter-rouge">name</code>
and a text column called <code class="language-plaintext highlighter-rouge">description</code>. A primary key column called <code class="language-plaintext highlighter-rouge">id</code> will
also be added implicitly, as it’s the default primary key for all Active Record
models. The <code class="language-plaintext highlighter-rouge">timestamps</code> macro adds two columns, <code class="language-plaintext highlighter-rouge">created_at</code> and <code class="language-plaintext highlighter-rouge">updated_at</code>.
These special columns are automatically managed by Active Record if they exist.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/schema.rb</span>
<span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Schema</span><span class="p">[</span><span class="mf">8.1</span><span class="p">].</span><span class="nf">define</span><span class="p">(</span><span class="ss">version: </span><span class="mi">2024_05_02_100843</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># These are extensions that must be enabled in order to support this database</span>
  <span class="n">enable_extension</span> <span class="s2">"plpgsql"</span>

  <span class="n">create_table</span> <span class="s2">"products"</span><span class="p">,</span> <span class="ss">force: :cascade</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"name"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="s2">"description"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We define the change that we want to happen moving forward in time. Before this
migration is run, there will be no table. After it is run, the table will exist.
Active Record knows how to reverse this migration as well; if we roll this
migration back, it will remove the table. Read more about rolling back
migrations in the <a href="#rolling-back">Rolling Back section</a>.</p>

<p>After defining the change that we want to occur moving forward in time, it’s
essential to consider the reversibility of the migration. While Active Record
can manage the forward progression of the migration, ensuring the creation of
the table, the concept of reversibility becomes crucial. With reversible
migrations, not only does the migration create the table when applied, but it
also enables smooth rollback functionality. In case of reverting the migration
above, Active Record intelligently handles the removal of the table, maintaining
database consistency throughout the process. See the <a href="#using-reversible">Reversing
Migrations section</a> for more details.</p>

<h2 id="generating-migration-files">Generating Migration Files</h2>

<h3 id="creating-a-standalone-migration">Creating a Standalone Migration</h3>

<p>Migrations are stored as files in the <code class="language-plaintext highlighter-rouge">db/migrate</code> directory, one for each
migration class.</p>

<p>The name of the file is of the form <code class="language-plaintext highlighter-rouge">YYYYMMDDHHMMSS_create_products.rb</code>, it
contains a UTC timestamp identifying the migration followed by an underscore
followed by the name of the migration. The name of the migration class
(CamelCased version) should match the latter part of the file name.</p>

<p>For example, <code class="language-plaintext highlighter-rouge">20240502100843_create_products.rb</code> should define class
<code class="language-plaintext highlighter-rouge">CreateProducts</code> and <code class="language-plaintext highlighter-rouge">20240502101659_add_details_to_products.rb</code> should define
class <code class="language-plaintext highlighter-rouge">AddDetailsToProducts</code>. Rails uses this timestamp to determine which
migration should be run and in what order, so if you’re copying a migration from
another application or generating a file yourself, be aware of its position in
the order. You can read more about how the timestamps are used in the <a href="#rails-migration-version-control">Rails
Migration Version Control section</a>.</p>

<p>When generating a migration, Active Record automatically prepends the current
timestamp to the file name of the migration. For example, running the command
below will create an empty migration file whereby the filename is made up of a
timestamp prepended to the underscored name of the migration.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddPartNumberToProducts
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/20240502101659_add_part_number_to_products.rb</span>
<span class="k">class</span> <span class="nc">AddPartNumberToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The generator can do much more than prepend a timestamp to the file name. Based
on naming conventions and additional (optional) arguments it can also start
fleshing out the migration.</p>

<p>The following sections will cover the various ways you can create migrations
based on conventions and additional arguments.</p>

<h3 id="creating-a-new-table">Creating a New Table</h3>

<p>When you want to create a new table in your database, you can use a migration
with the format “CreateXXX” followed by a list of column names and types. This
will generate a migration file that sets up the table with the specified
columns.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration CreateProducts name:string part_number:string
</code></pre></div></div>

<p>generates</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:part_number</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The generated file with its contents is just a starting point, and you can add
or remove from it as you see fit by editing the
<code class="language-plaintext highlighter-rouge">db/migrate/YYYYMMDDHHMMSS_create_products.rb</code> file.</p>

<h3 id="adding-columns">Adding Columns</h3>

<p>When you want to add a new column to an existing table in your database, you can
use a migration with the format “AddColumnToTable” followed by a list of column
names and types. This will generate a migration file containing the appropriate
[<code class="language-plaintext highlighter-rouge">add_column</code>][] statements.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddPartNumberToProducts part_number:string
</code></pre></div></div>

<p>This will generate the following migration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddPartNumberToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you’d like to add an index on the new column, you can do that as well.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddPartNumberToProducts part_number:string:index
</code></pre></div></div>

<p>This will generate the appropriate [<code class="language-plaintext highlighter-rouge">add_column</code>][] and [<code class="language-plaintext highlighter-rouge">add_index</code>][]
statements:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddPartNumberToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">add_index</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You are <strong>not</strong> limited to one magically generated column. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddDetailsToProducts part_number:string price:decimal
</code></pre></div></div>

<p>This will generate a schema migration which adds two additional columns to the
<code class="language-plaintext highlighter-rouge">products</code> table.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddDetailsToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:decimal</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="removing-columns">Removing Columns</h3>

<p>Similarly, if the migration name is of the form “RemoveColumnFromTable” and is
followed by a list of column names and types then a migration containing the
appropriate [<code class="language-plaintext highlighter-rouge">remove_column</code>][] statements will be created.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration RemovePartNumberFromProducts part_number:string
</code></pre></div></div>

<p>This will generate the appropriate [<code class="language-plaintext highlighter-rouge">remove_column</code>][] statements:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RemovePartNumberFromProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="creating-associations">Creating Associations</h3>

<p>Active Record associations are used to define relationships between different
models in your application, allowing them to interact with each other through
their relationships and making it easier to work with related data. To learn
more about associations, you can refer to the <a href="association_basics.html">Association Basics
guide</a>.</p>

<p>One common use case for associations is creating foreign key references between
tables. The generator accepts column types such as <code class="language-plaintext highlighter-rouge">references</code> to facilitate
this process. <a href="#references">References</a> are a shorthand for creating columns,
indexes, foreign keys, or even polymorphic association columns.</p>

<p>For example,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddUserRefToProducts user:references
</code></pre></div></div>

<p>generates the following [<code class="language-plaintext highlighter-rouge">add_reference</code>][] call:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddUserRefToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_reference</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The above migration creates a foreign key called <code class="language-plaintext highlighter-rouge">user_id</code> in the <code class="language-plaintext highlighter-rouge">products</code>
table, where <code class="language-plaintext highlighter-rouge">user_id</code> is a reference to the <code class="language-plaintext highlighter-rouge">id</code> column in the <code class="language-plaintext highlighter-rouge">users</code> table.
It also creates an index for the <code class="language-plaintext highlighter-rouge">user_id</code> column. The schema looks as follows:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">create_table</span> <span class="s2">"products"</span><span class="p">,</span> <span class="ss">force: :cascade</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">bigint</span> <span class="s2">"user_id"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">index</span> <span class="p">[</span><span class="s2">"user_id"</span><span class="p">],</span> <span class="ss">name: </span><span class="s2">"index_products_on_user_id"</span>
  <span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">belongs_to</code> is an alias of <code class="language-plaintext highlighter-rouge">references</code>, so the above could be alternatively
written as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddUserRefToProducts user:belongs_to
</code></pre></div></div>

<p>generating a migration and schema that is the same as above.</p>

<p>There is also a generator which will produce join tables if <code class="language-plaintext highlighter-rouge">JoinTable</code> is part
of the name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration CreateJoinTableUserProduct user product
</code></pre></div></div>

<p>will produce the following migration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateJoinTableUserProduct</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_join_table</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="c1"># t.index [:user_id, :product_id]</span>
      <span class="c1"># t.index [:product_id, :user_id]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">add_column</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_column
[<code class="language-plaintext highlighter-rouge">add_index</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_index
[<code class="language-plaintext highlighter-rouge">add_reference</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_reference
[<code class="language-plaintext highlighter-rouge">remove_column</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_column</p>

<h3 id="other-generators-that-create-migrations">Other Generators that Create Migrations</h3>

<p>In addition to the <code class="language-plaintext highlighter-rouge">migration</code> generator, the <code class="language-plaintext highlighter-rouge">model</code>, <code class="language-plaintext highlighter-rouge">resource</code>, and
<code class="language-plaintext highlighter-rouge">scaffold</code> generators will create migrations appropriate for adding a new model.
This migration will already contain instructions for creating the relevant
table. If you tell Rails what columns you want, then statements for adding these
columns will also be created. For example, running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate model Product name:string description:text
</code></pre></div></div>

<p>This will create a migration that looks like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:description</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can append as many column name/type pairs as you want.</p>

<h3 id="passing-modifiers">Passing Modifiers</h3>

<p>When generating migrations, you can pass commonly used <a href="#column-modifiers">type
modifiers</a> directly on the command line. These modifiers,
enclosed by curly braces and following the field type, allow you to tailor the
characteristics of your database columns without needing to manually edit the
migration file afterward.</p>

<p>For instance, running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddDetailsToProducts <span class="s1">'price:decimal{5,2}'</span> supplier:references<span class="o">{</span>polymorphic<span class="o">}</span>
</code></pre></div></div>

<p>will produce a migration that looks like this</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddDetailsToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:decimal</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">,</span> <span class="ss">scale: </span><span class="mi">2</span>
    <span class="n">add_reference</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:supplier</span><span class="p">,</span> <span class="ss">polymorphic: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">NOT NULL</code> constraints can be imposed from the command line using the <code class="language-plaintext highlighter-rouge">!</code>
shortcut:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddEmailToUsers email:string!
</code></pre></div></div>

<p>will produce this migration</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddEmailToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>TIP: For further help with generators, run <code class="language-plaintext highlighter-rouge">bin/rails generate --help</code>.
Alternatively, you can also run <code class="language-plaintext highlighter-rouge">bin/rails generate model --help</code> or <code class="language-plaintext highlighter-rouge">bin/rails
generate migration --help</code> for help with specific generators.</p>

<h2 id="updating-migrations">Updating Migrations</h2>

<p>Once you have created your migration file using one of the generators from the
above <a href="#generating-migration-files">section</a>, you can update the generated
migration file in the <code class="language-plaintext highlighter-rouge">db/migrate</code> folder to define further changes you want to
make to your database schema.</p>

<h3 id="creating-a-table">Creating a Table</h3>

<p>The [<code class="language-plaintext highlighter-rouge">create_table</code>][] method is one of the most fundamental migration type, but
most of the time, will be generated for you from using a model, resource, or
scaffold generator. A typical use would be</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This method creates a <code class="language-plaintext highlighter-rouge">products</code> table with a column called <code class="language-plaintext highlighter-rouge">name</code>.</p>

<h4 id="associations">Associations</h4>

<p>If you’re creating a table for a model that has an association, you can use the
<code class="language-plaintext highlighter-rouge">:references</code> type to create the appropriate column type. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:category</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This will create a <code class="language-plaintext highlighter-rouge">category_id</code> column. Alternatively, you can use <code class="language-plaintext highlighter-rouge">belongs_to</code>
as an alias for <code class="language-plaintext highlighter-rouge">references</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">belongs_to</span> <span class="ss">:category</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also specify the column type and index creation using the
<a href="association_basics.html#polymorphic-associations"><code class="language-plaintext highlighter-rouge">:polymorphic</code></a> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:taggings</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:taggable</span><span class="p">,</span> <span class="ss">polymorphic: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This will create <code class="language-plaintext highlighter-rouge">taggable_id</code>, <code class="language-plaintext highlighter-rouge">taggable_type</code> columns and the appropriate
indexes.</p>

<h4 id="primary-keys">Primary Keys</h4>

<p>By default, <code class="language-plaintext highlighter-rouge">create_table</code> will implicitly create a primary key called <code class="language-plaintext highlighter-rouge">id</code> for
you. You can change the name of the column with the <code class="language-plaintext highlighter-rouge">:primary_key</code> option, like
below:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="s2">"user_id"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:username</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:email</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This will yield the following schema:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="s2">"users"</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="s2">"user_id"</span><span class="p">,</span> <span class="ss">force: :cascade</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"username"</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"email"</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">6</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">6</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also pass an array to <code class="language-plaintext highlighter-rouge">:primary_key</code> for a composite primary key. Read
more about <a href="active_record_composite_primary_keys.html">composite primary keys</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:email</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you don’t want a primary key at all, you can pass the option <code class="language-plaintext highlighter-rouge">id: false</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">id: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:username</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:email</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="database-options">Database Options</h4>

<p>If you need to pass database-specific options you can place an SQL fragment in
the <code class="language-plaintext highlighter-rouge">:options</code> option. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">options: </span><span class="s2">"ENGINE=BLACKHOLE"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This will append <code class="language-plaintext highlighter-rouge">ENGINE=BLACKHOLE</code> to the SQL statement used to create the
table.</p>

<p>An index can be created on the columns created within the <code class="language-plaintext highlighter-rouge">create_table</code> block
by passing <code class="language-plaintext highlighter-rouge">index: true</code> or an options hash to the <code class="language-plaintext highlighter-rouge">:index</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">index: </span><span class="kp">true</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">index: </span><span class="p">{</span> <span class="ss">unique: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"unique_emails"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">create_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-create_table</p>

<h4 id="comments">Comments</h4>

<p>You can pass the <code class="language-plaintext highlighter-rouge">:comment</code> option with any description for the table that will
be stored in the database itself and can be viewed with database administration
tools, such as MySQL Workbench or PgAdmin III. Comments can help team members to
better understand the data model and to generate documentation in applications
with large databases. Currently only the MySQL and PostgreSQL adapters support
comments.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddDetailsToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:decimal</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">8</span><span class="p">,</span> <span class="ss">scale: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">comment: </span><span class="s2">"The price of the product in USD"</span>
    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:stock_quantity</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">,</span> <span class="ss">comment: </span><span class="s2">"The current stock quantity of the product"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="creating-a-join-table">Creating a Join Table</h3>

<p>The migration method [<code class="language-plaintext highlighter-rouge">create_join_table</code>][] creates an <a href="association_basics.html#the-has-and-belongs-to-many-association">HABTM (has and belongs
to many)</a> join
table. A typical use would be:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_join_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:categories</span>
</code></pre></div></div>

<p>This migration will create a <code class="language-plaintext highlighter-rouge">categories_products</code> table with two columns called
<code class="language-plaintext highlighter-rouge">category_id</code> and <code class="language-plaintext highlighter-rouge">product_id</code>.</p>

<p>These columns have the option <code class="language-plaintext highlighter-rouge">:null</code> set to <code class="language-plaintext highlighter-rouge">false</code> by default, meaning that
you <strong>must</strong> provide a value in order to save a record to this table. This can
be overridden by specifying the <code class="language-plaintext highlighter-rouge">:column_options</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_join_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:categories</span><span class="p">,</span> <span class="ss">column_options: </span><span class="p">{</span> <span class="ss">null: </span><span class="kp">true</span> <span class="p">}</span>
</code></pre></div></div>

<p>By default, the name of the join table comes from the union of the first two
arguments provided to create_join_table, in lexical order. In this case,
the table would be named <code class="language-plaintext highlighter-rouge">categories_products</code>.</p>

<p>WARNING: The precedence between model names is calculated using the <code class="language-plaintext highlighter-rouge">&lt;=&gt;</code>
operator for <code class="language-plaintext highlighter-rouge">String</code>. This means that if the strings are of different lengths,
and the strings are equal when compared up to the shortest length, then the
longer string is considered of higher lexical precedence than the shorter one.
For example, one would expect the tables “paper_boxes” and “papers” to generate
a join table name of “papers_paper_boxes” because of the length of the name
“paper_boxes”, but it in fact generates a join table name of
“paper_boxes_papers” (because the underscore ‘_’ is lexicographically <em>less</em>
than ‘s’ in common encodings).</p>

<p>To customize the name of the table, provide a <code class="language-plaintext highlighter-rouge">:table_name</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_join_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:categories</span><span class="p">,</span> <span class="ss">table_name: :categorization</span>
</code></pre></div></div>

<p>This creates a join table with the name <code class="language-plaintext highlighter-rouge">categorization</code>.</p>

<p>Also, <code class="language-plaintext highlighter-rouge">create_join_table</code> accepts a block, which you can use to add indices
(which are not created by default) or any additional columns you so choose.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_join_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:categories</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">index</span> <span class="ss">:product_id</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">index</span> <span class="ss">:category_id</span>
<span class="k">end</span>
</code></pre></div></div>

<p>[<code class="language-plaintext highlighter-rouge">create_join_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-create_join_table</p>

<h3 id="changing-tables">Changing Tables</h3>

<p>If you want to change an existing table in place, there is [<code class="language-plaintext highlighter-rouge">change_table</code>][].</p>

<p>It is used in a similar fashion to <code class="language-plaintext highlighter-rouge">create_table</code> but the object yielded inside
the block has access to a number of special functions, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">remove</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:name</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:part_number</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">index</span> <span class="ss">:part_number</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">rename</span> <span class="ss">:upccode</span><span class="p">,</span> <span class="ss">:upc_code</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This migration will remove the <code class="language-plaintext highlighter-rouge">description</code> and <code class="language-plaintext highlighter-rouge">name</code> columns, create a new
string column called <code class="language-plaintext highlighter-rouge">part_number</code> and add an index on it. Finally, it renames
the <code class="language-plaintext highlighter-rouge">upccode</code> column to <code class="language-plaintext highlighter-rouge">upc_code</code>.</p>

<p>[<code class="language-plaintext highlighter-rouge">change_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_table</p>

<h3 id="changing-columns">Changing Columns</h3>

<p>Similar to the <code class="language-plaintext highlighter-rouge">remove_column</code> and <code class="language-plaintext highlighter-rouge">add_column</code> methods we covered
<a href="#adding-columns">earlier</a>, Rails also provides the [<code class="language-plaintext highlighter-rouge">change_column</code>][]
migration method.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">change_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:text</span>
</code></pre></div></div>

<p>This changes the column <code class="language-plaintext highlighter-rouge">part_number</code> on products table to be a <code class="language-plaintext highlighter-rouge">:text</code> field.</p>

<p>NOTE: The <code class="language-plaintext highlighter-rouge">change_column</code> command is <strong>irreversible</strong>. To ensure your migration
can be safely reverted, you will need to provide your own <code class="language-plaintext highlighter-rouge">reversible</code>
migration. See the <a href="#using-reversible">Reversible Migrations section</a> for more
details.</p>

<p>Besides <code class="language-plaintext highlighter-rouge">change_column</code>, the [<code class="language-plaintext highlighter-rouge">change_column_null</code>][] and
[<code class="language-plaintext highlighter-rouge">change_column_default</code>][] methods are used to change a null constraint and
default values of a column.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">change_column_default</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:approved</span><span class="p">,</span> <span class="ss">from: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">to: </span><span class="kp">false</span>
</code></pre></div></div>

<p>This changes the default value of the <code class="language-plaintext highlighter-rouge">:approved</code> field from true to false. This
change will only be applied to future records, any existing records do not
change. Use [<code class="language-plaintext highlighter-rouge">change_column_null</code>][] to change a null constraint.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">change_column_null</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="kp">false</span>
</code></pre></div></div>

<p>This sets <code class="language-plaintext highlighter-rouge">:name</code> field on products to a <code class="language-plaintext highlighter-rouge">NOT NULL</code> column. This change applies
to existing records as well, so you need to make sure all existing records have
a <code class="language-plaintext highlighter-rouge">:name</code> that is <code class="language-plaintext highlighter-rouge">NOT NULL</code>.</p>

<p>Setting the null constraint to <code class="language-plaintext highlighter-rouge">true</code> implies that column will accept a null
value, otherwise the <code class="language-plaintext highlighter-rouge">NOT NULL</code> constraint is applied and a value must be passed
in order to persist the record to the database.</p>

<p>NOTE: You could also write the above <code class="language-plaintext highlighter-rouge">change_column_default</code> migration as
<code class="language-plaintext highlighter-rouge">change_column_default :products, :approved, false</code>, but unlike the previous
example, this would make your migration irreversible.</p>

<p>[<code class="language-plaintext highlighter-rouge">change_column</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column
[<code class="language-plaintext highlighter-rouge">change_column_default</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_default
[<code class="language-plaintext highlighter-rouge">change_column_null</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_null</p>

<h3 id="column-modifiers">Column Modifiers</h3>

<p>Column modifiers can be applied when creating or changing a column:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">comment</code>      Adds a comment for the column.</li>
  <li><code class="language-plaintext highlighter-rouge">collation</code>    Specifies the collation for a <code class="language-plaintext highlighter-rouge">string</code> or <code class="language-plaintext highlighter-rouge">text</code> column.</li>
  <li><code class="language-plaintext highlighter-rouge">default</code>      Allows to set a default value on the column. Note that if you
are using a dynamic value (such as a date), the default will only be
calculated the first time (i.e. on the date the migration is applied). Use
<code class="language-plaintext highlighter-rouge">nil</code> for <code class="language-plaintext highlighter-rouge">NULL</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">limit</code>        Sets the maximum number of characters for a <code class="language-plaintext highlighter-rouge">string</code> column and
the maximum number of bytes for <code class="language-plaintext highlighter-rouge">text/binary/integer</code> columns.</li>
  <li><code class="language-plaintext highlighter-rouge">null</code>         Allows or disallows <code class="language-plaintext highlighter-rouge">NULL</code> values in the column.</li>
  <li><code class="language-plaintext highlighter-rouge">precision</code>    Specifies the precision for <code class="language-plaintext highlighter-rouge">decimal/numeric/datetime/time</code>
columns.</li>
  <li><code class="language-plaintext highlighter-rouge">scale</code>        Specifies the scale for the <code class="language-plaintext highlighter-rouge">decimal</code> and <code class="language-plaintext highlighter-rouge">numeric</code> columns,
representing the number of digits after the decimal point.</li>
</ul>

<p>NOTE: For <code class="language-plaintext highlighter-rouge">add_column</code> or <code class="language-plaintext highlighter-rouge">change_column</code> there is no option for adding indexes.
They need to be added separately using <code class="language-plaintext highlighter-rouge">add_index</code>.</p>

<p>Some adapters may support additional options; see the adapter specific API docs
for further information.</p>

<p>NOTE: <code class="language-plaintext highlighter-rouge">default</code> cannot be specified via command line when generating migrations.</p>

<h3 id="references">References</h3>

<p>The <code class="language-plaintext highlighter-rouge">add_reference</code> method allows the creation of an appropriately named column
acting as the connection between one or more associations.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_reference</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span>
</code></pre></div></div>

<p>This migration will create a foreign key column called <code class="language-plaintext highlighter-rouge">role_id</code> in the users
table. <code class="language-plaintext highlighter-rouge">role_id</code> is a reference to the <code class="language-plaintext highlighter-rouge">id</code> column in the <code class="language-plaintext highlighter-rouge">roles</code> table. In
addition, it creates an index for the <code class="language-plaintext highlighter-rouge">role_id</code> column, unless it is explicitly
told not to do so with the <code class="language-plaintext highlighter-rouge">index: false</code> option.</p>

<p>INFO: See also the <a href="association_basics.html">Active Record Associations</a> guide to learn more.</p>

<p>The method <code class="language-plaintext highlighter-rouge">add_belongs_to</code> is an alias of <code class="language-plaintext highlighter-rouge">add_reference</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_belongs_to</span> <span class="ss">:taggings</span><span class="p">,</span> <span class="ss">:taggable</span><span class="p">,</span> <span class="ss">polymorphic: </span><span class="kp">true</span>
</code></pre></div></div>

<p>The polymorphic option will create two columns on the taggings table which can
be used for polymorphic associations: <code class="language-plaintext highlighter-rouge">taggable_type</code> and <code class="language-plaintext highlighter-rouge">taggable_id</code>.</p>

<p>INFO: See this guide to learn more about <a href="association_basics.html#polymorphic-associations">polymorphic associations</a>.</p>

<p>A foreign key can be created with the <code class="language-plaintext highlighter-rouge">foreign_key</code> option.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_reference</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>
</code></pre></div></div>

<p>For more <code class="language-plaintext highlighter-rouge">add_reference</code> options, visit the <a href="https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_reference">API
documentation</a>.</p>

<p>References can also be removed:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">remove_reference</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">index: </span><span class="kp">false</span>
</code></pre></div></div>

<h3 id="foreign-keys">Foreign Keys</h3>

<p>While it’s not required, you might want to add foreign key constraints to
<a href="#active-record-and-referential-integrity">guarantee referential integrity</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_foreign_key</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:authors</span>
</code></pre></div></div>

<p>The [<code class="language-plaintext highlighter-rouge">add_foreign_key</code>][] call adds a new constraint to the <code class="language-plaintext highlighter-rouge">articles</code> table.
The constraint guarantees that a row in the <code class="language-plaintext highlighter-rouge">authors</code> table exists where the
<code class="language-plaintext highlighter-rouge">id</code> column matches the <code class="language-plaintext highlighter-rouge">articles.author_id</code> to ensure all reviewers listed in
the articles table are valid authors listed in the authors table.</p>

<p>NOTE: When using <code class="language-plaintext highlighter-rouge">references</code> in a migration, you are creating a new column in
the table and you’ll have the option to add a foreign key using <code class="language-plaintext highlighter-rouge">foreign_key:
true</code> to that column. However, if you want to add a foreign key to an existing
column, you can use <code class="language-plaintext highlighter-rouge">add_foreign_key</code>.</p>

<p>If the column name of the table to which we’re adding the foreign key cannot be
derived from the table with the referenced primary key then you can use the
<code class="language-plaintext highlighter-rouge">:column</code> option to specify the column name. Additionally, you can use the
<code class="language-plaintext highlighter-rouge">:primary_key</code> option if the referenced primary key is not <code class="language-plaintext highlighter-rouge">:id</code>.</p>

<p>For example, to add a foreign key on <code class="language-plaintext highlighter-rouge">articles.reviewer</code> referencing
<code class="language-plaintext highlighter-rouge">authors.email</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_foreign_key</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:authors</span><span class="p">,</span> <span class="ss">column: :reviewer</span><span class="p">,</span> <span class="ss">primary_key: :email</span>
</code></pre></div></div>

<p>This will add a constraint to the <code class="language-plaintext highlighter-rouge">articles</code> table that guarantees a row in the
<code class="language-plaintext highlighter-rouge">authors</code> table exists where the <code class="language-plaintext highlighter-rouge">email</code> column matches the <code class="language-plaintext highlighter-rouge">articles.reviewer</code>
field.</p>

<p>Several other options such as <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">on_delete</code>, <code class="language-plaintext highlighter-rouge">if_not_exists</code>, <code class="language-plaintext highlighter-rouge">validate</code>,
and <code class="language-plaintext highlighter-rouge">deferrable</code> are supported by <code class="language-plaintext highlighter-rouge">add_foreign_key</code>.</p>

<p>Foreign keys can also be removed using [<code class="language-plaintext highlighter-rouge">remove_foreign_key</code>][]:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># let Active Record figure out the column name</span>
<span class="n">remove_foreign_key</span> <span class="ss">:accounts</span><span class="p">,</span> <span class="ss">:branches</span>

<span class="c1"># remove foreign key for a specific column</span>
<span class="n">remove_foreign_key</span> <span class="ss">:accounts</span><span class="p">,</span> <span class="ss">column: :owner_id</span>
</code></pre></div></div>

<p>NOTE: Active Record only supports single column foreign keys. <code class="language-plaintext highlighter-rouge">execute</code> and
<code class="language-plaintext highlighter-rouge">structure.sql</code> are required to use composite foreign keys. See <a href="#schema-dumping-and-you">Schema Dumping
and You</a>.</p>

<h3 id="composite-primary-keys">Composite Primary Keys</h3>

<p>Sometimes a single column’s value isn’t enough to uniquely identify every row of
a table, but a combination of two or more columns <em>does</em> uniquely identify it.
This can be the case when using a legacy database schema without a single <code class="language-plaintext highlighter-rouge">id</code>
column as a primary key, or when altering schemas for sharding or multitenancy.</p>

<p>You can create a table with a composite primary key by passing the
<code class="language-plaintext highlighter-rouge">:primary_key</code> option to <code class="language-plaintext highlighter-rouge">create_table</code> with an array value:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="p">[</span><span class="ss">:customer_id</span><span class="p">,</span> <span class="ss">:product_sku</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:customer_id</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:product_sku</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:description</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>INFO: Tables with composite primary keys require passing array values rather
than integer IDs to many methods. See also the <a href="active_record_composite_primary_keys.html">Active Record Composite Primary
Keys</a> guide to learn more.</p>

<h3 id="execute-sql">Execute SQL</h3>

<p>If the helpers provided by Active Record aren’t enough, you can use the
[<code class="language-plaintext highlighter-rouge">execute</code>][] method to execute SQL commands. For example,</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UpdateProductPrices</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">up</span>
    <span class="n">execute</span> <span class="s2">"UPDATE products SET price = 'free'"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">down</span>
    <span class="n">execute</span> <span class="s2">"UPDATE products SET price = 'original_price' WHERE price = 'free';"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In this example, we’re updating the <code class="language-plaintext highlighter-rouge">price</code> column of the products table to
‘free’ for all records.</p>

<p>WARNING: Modifying data directly in migrations should be approached with
caution. Consider if this is the best approach for your use case, and be aware
of potential drawbacks such as increased complexity and maintenance overhead,
risks to data integrity and database portability. See the <a href="#data-migrations">Data Migrations
documentation</a> for more details.</p>

<p>For more details and examples of individual methods, check the API
documentation.</p>

<p>In particular the documentation for
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::SchemaStatements</code>][], which provides the
methods available in the <code class="language-plaintext highlighter-rouge">change</code>, <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code> methods.</p>

<p>For methods available regarding the object yielded by <code class="language-plaintext highlighter-rouge">create_table</code>, see
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::TableDefinition</code>][].</p>

<p>And for the object yielded by <code class="language-plaintext highlighter-rouge">change_table</code>, see
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::Table</code>][].</p>

<p>[<code class="language-plaintext highlighter-rouge">execute</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#method-i-execute
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::SchemaStatements</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::TableDefinition</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/TableDefinition.html
[<code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::Table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/Table.html</p>

<h3 id="using-the-change-method">Using the <code class="language-plaintext highlighter-rouge">change</code> Method</h3>

<p>The <code class="language-plaintext highlighter-rouge">change</code> method is the primary way of writing migrations. It works for the
majority of cases in which Active Record knows how to reverse a migration’s
actions automatically. Below are some of the actions that <code class="language-plaintext highlighter-rouge">change</code> supports:</p>

<ul>
  <li>[<code class="language-plaintext highlighter-rouge">add_check_constraint</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">add_column</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">add_foreign_key</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">add_index</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">add_reference</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">add_timestamps</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">change_column_comment</code>][] (must supply <code class="language-plaintext highlighter-rouge">:from</code> and <code class="language-plaintext highlighter-rouge">:to</code> options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">change_column_default</code>][] (must supply <code class="language-plaintext highlighter-rouge">:from</code> and <code class="language-plaintext highlighter-rouge">:to</code> options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">change_column_null</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">change_table_comment</code>][] (must supply <code class="language-plaintext highlighter-rouge">:from</code> and <code class="language-plaintext highlighter-rouge">:to</code> options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">create_join_table</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">create_table</code>][]</li>
  <li><code class="language-plaintext highlighter-rouge">disable_extension</code></li>
  <li>[<code class="language-plaintext highlighter-rouge">drop_join_table</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">drop_table</code>][] (must supply table creation options and block)</li>
  <li><code class="language-plaintext highlighter-rouge">enable_extension</code></li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_check_constraint</code>][] (must supply original constraint expression)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_column</code>][] (must supply original type and column options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_columns</code>][] (must supply original type and column options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_foreign_key</code>][] (must supply other table and original options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_index</code>][] (must supply columns and original options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_reference</code>][] (must supply original options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">remove_timestamps</code>][] (must supply original options)</li>
  <li>[<code class="language-plaintext highlighter-rouge">rename_column</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">rename_index</code>][]</li>
  <li>[<code class="language-plaintext highlighter-rouge">rename_table</code>][]</li>
</ul>

<p>[<code class="language-plaintext highlighter-rouge">change_table</code>][] is also reversible, as long as the block only calls
reversible operations like the ones listed above.</p>

<p>If you need to use any other methods, you should use <code class="language-plaintext highlighter-rouge">reversible</code> or write the
<code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code> methods instead of using the <code class="language-plaintext highlighter-rouge">change</code> method.</p>

<p>[<code class="language-plaintext highlighter-rouge">add_check_constraint</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_check_constraint
[<code class="language-plaintext highlighter-rouge">add_foreign_key</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_foreign_key
[<code class="language-plaintext highlighter-rouge">add_timestamps</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_timestamps
[<code class="language-plaintext highlighter-rouge">change_column_comment</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_comment
[<code class="language-plaintext highlighter-rouge">change_table_comment</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_table_comment
[<code class="language-plaintext highlighter-rouge">drop_join_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-drop_join_table
[<code class="language-plaintext highlighter-rouge">drop_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-drop_table
[<code class="language-plaintext highlighter-rouge">remove_check_constraint</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_check_constraint
[<code class="language-plaintext highlighter-rouge">remove_foreign_key</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_foreign_key
[<code class="language-plaintext highlighter-rouge">remove_index</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_index
[<code class="language-plaintext highlighter-rouge">remove_reference</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_reference
[<code class="language-plaintext highlighter-rouge">remove_timestamps</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_timestamps
[<code class="language-plaintext highlighter-rouge">rename_column</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-rename_column
[<code class="language-plaintext highlighter-rouge">remove_columns</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_columns
[<code class="language-plaintext highlighter-rouge">rename_index</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-rename_index
[<code class="language-plaintext highlighter-rouge">rename_table</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-rename_table</p>

<h3 id="using-reversible">Using <code class="language-plaintext highlighter-rouge">reversible</code></h3>

<p>If you’d like for a migration to do something that Active Record doesn’t know
how to reverse, then you can use <code class="language-plaintext highlighter-rouge">reversible</code> to specify what to do when running
a migration and what else to do when reverting it.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ChangeProductsPrice</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">reversible</span> <span class="k">do</span> <span class="o">|</span><span class="n">direction</span><span class="o">|</span>
      <span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
        <span class="n">direction</span><span class="p">.</span><span class="nf">up</span>   <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="nf">change</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:string</span> <span class="p">}</span>
        <span class="n">direction</span><span class="p">.</span><span class="nf">down</span> <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="nf">change</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:integer</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This migration will change the type of the <code class="language-plaintext highlighter-rouge">price</code> column to a string, or back
to an integer when the migration is reverted. Notice the block being passed to
<code class="language-plaintext highlighter-rouge">direction.up</code> and <code class="language-plaintext highlighter-rouge">direction.down</code> respectively.</p>

<p>Alternatively, you can use <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code> instead of <code class="language-plaintext highlighter-rouge">change</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ChangeProductsPrice</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">up</span>
    <span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">change</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">down</span>
    <span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">change</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:integer</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Additionally, <code class="language-plaintext highlighter-rouge">reversible</code> is useful when executing raw SQL queries or
performing database operations that do not have a direct equivalent in
ActiveRecord methods. You can use [<code class="language-plaintext highlighter-rouge">reversible</code>][] to specify what to do when
running a migration and what else to do when reverting it. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleMigration</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:distributors</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:zipcode</span>
    <span class="k">end</span>

    <span class="n">reversible</span> <span class="k">do</span> <span class="o">|</span><span class="n">direction</span><span class="o">|</span>
      <span class="n">direction</span><span class="p">.</span><span class="nf">up</span> <span class="k">do</span>
        <span class="c1"># create a distributors view</span>
        <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
          CREATE VIEW distributors_view AS
          SELECT id, zipcode
          FROM distributors;
</span><span class="no">        SQL</span>
      <span class="k">end</span>
      <span class="n">direction</span><span class="p">.</span><span class="nf">down</span> <span class="k">do</span>
        <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
          DROP VIEW distributors_view;
</span><span class="no">        SQL</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">reversible</code> will ensure that the instructions are executed in the right
order too. If the previous example migration is reverted, the <code class="language-plaintext highlighter-rouge">down</code> block will
be run after the <code class="language-plaintext highlighter-rouge">users.address</code> column is removed and before the <code class="language-plaintext highlighter-rouge">distributors</code>
table is dropped.</p>

<p>[<code class="language-plaintext highlighter-rouge">reversible</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Migration.html#method-i-reversible</p>

<h3 id="using-the-updown-methods">Using the <code class="language-plaintext highlighter-rouge">up</code>/<code class="language-plaintext highlighter-rouge">down</code> Methods</h3>

<p>You can also use the old style of migration using <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code> methods
instead of the <code class="language-plaintext highlighter-rouge">change</code> method.</p>

<p>The <code class="language-plaintext highlighter-rouge">up</code> method should describe the transformation you’d like to make to your
schema, and the <code class="language-plaintext highlighter-rouge">down</code> method of your migration should revert the
transformations done by the <code class="language-plaintext highlighter-rouge">up</code> method. In other words, the database schema
should be unchanged if you do an <code class="language-plaintext highlighter-rouge">up</code> followed by a <code class="language-plaintext highlighter-rouge">down</code>.</p>

<p>For example, if you create a table in the <code class="language-plaintext highlighter-rouge">up</code> method, you should drop it in the
<code class="language-plaintext highlighter-rouge">down</code> method. It is wise to perform the transformations in precisely the
reverse order they were made in the <code class="language-plaintext highlighter-rouge">up</code> method. The example in the <code class="language-plaintext highlighter-rouge">reversible</code>
section is equivalent to:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleMigration</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">up</span>
    <span class="n">create_table</span> <span class="ss">:distributors</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:zipcode</span>
    <span class="k">end</span>

    <span class="c1"># create a distributors view</span>
    <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
      CREATE VIEW distributors_view AS
      SELECT id, zipcode
      FROM distributors;
</span><span class="no">    SQL</span>

    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">down</span>
    <span class="n">remove_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:address</span>

    <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
      DROP VIEW distributors_view;
</span><span class="no">    SQL</span>

    <span class="n">drop_table</span> <span class="ss">:distributors</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="throwing-an-error-to-prevent-reverts">Throwing an error to prevent reverts</h3>

<p>Sometimes your migration will do something which is just plain irreversible; for
example, it might destroy some data.</p>

<p>In such cases, you can raise <code class="language-plaintext highlighter-rouge">ActiveRecord::IrreversibleMigration</code> in your
<code class="language-plaintext highlighter-rouge">down</code> block.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">IrreversibleMigrationExample</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">up</span>
    <span class="n">drop_table</span> <span class="ss">:example_table</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">down</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">IrreversibleMigration</span><span class="p">,</span> <span class="s2">"This migration cannot be reverted because it destroys data."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If someone tries to revert your migration, an error message will be displayed
saying that it can’t be done.</p>

<h3 id="reverting-previous-migrations">Reverting Previous Migrations</h3>

<p>You can use Active Record’s ability to rollback migrations using the
[<code class="language-plaintext highlighter-rouge">revert</code>][] method:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require_relative</span> <span class="s2">"20121212123456_example_migration"</span>

<span class="k">class</span> <span class="nc">FixupExampleMigration</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">revert</span> <span class="no">ExampleMigration</span>

    <span class="n">create_table</span><span class="p">(</span><span class="ss">:apples</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:variety</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">revert</code> method also accepts a block of instructions to reverse. This could
be useful to revert selected parts of previous migrations.</p>

<p>For example, let’s imagine that <code class="language-plaintext highlighter-rouge">ExampleMigration</code> is committed and it is later
decided that a Distributors view is no longer needed.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DontUseDistributorsViewMigration</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">revert</span> <span class="k">do</span>
      <span class="c1"># copy-pasted code from ExampleMigration</span>
      <span class="n">create_table</span> <span class="ss">:distributors</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:zipcode</span>
      <span class="k">end</span>

      <span class="n">reversible</span> <span class="k">do</span> <span class="o">|</span><span class="n">direction</span><span class="o">|</span>
        <span class="n">direction</span><span class="p">.</span><span class="nf">up</span> <span class="k">do</span>
          <span class="c1"># create a distributors view</span>
          <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
            CREATE VIEW distributors_view AS
            SELECT id, zipcode
            FROM distributors;
</span><span class="no">          SQL</span>
        <span class="k">end</span>
        <span class="n">direction</span><span class="p">.</span><span class="nf">down</span> <span class="k">do</span>
          <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
            DROP VIEW distributors_view;
</span><span class="no">          SQL</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="c1"># The rest of the migration was ok</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The same migration could also have been written without using <code class="language-plaintext highlighter-rouge">revert</code> but this
would have involved a few more steps:</p>

<ol>
  <li>Reverse the order of <code class="language-plaintext highlighter-rouge">create_table</code> and <code class="language-plaintext highlighter-rouge">reversible</code>.</li>
  <li>Replace <code class="language-plaintext highlighter-rouge">create_table</code> with <code class="language-plaintext highlighter-rouge">drop_table</code>.</li>
  <li>Finally, replace <code class="language-plaintext highlighter-rouge">up</code> with <code class="language-plaintext highlighter-rouge">down</code> and vice-versa.</li>
</ol>

<p>This is all taken care of by <code class="language-plaintext highlighter-rouge">revert</code>.</p>

<p>[<code class="language-plaintext highlighter-rouge">revert</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Migration.html#method-i-revert</p>

<h2 id="running-migrations">Running Migrations</h2>

<p>Rails provides a set of commands to run certain sets of migrations.</p>

<p>The very first migration related rails command you will use will probably be
<code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code>. In its most basic form it just runs the <code class="language-plaintext highlighter-rouge">change</code> or <code class="language-plaintext highlighter-rouge">up</code>
method for all the migrations that have not yet been run. If there are no such
migrations, it exits. It will run these migrations in order based on the date of
the migration.</p>

<p>Note that running the <code class="language-plaintext highlighter-rouge">db:migrate</code> command also invokes the <code class="language-plaintext highlighter-rouge">db:schema:dump</code>
command, which will update your <code class="language-plaintext highlighter-rouge">db/schema.rb</code> file to match the structure of
your database.</p>

<p>If you specify a target version, Active Record will run the required migrations
(change, up, down) until it has reached the specified version. The version is
the numerical prefix on the migration’s filename. For example, to migrate to
version 20240428000000 run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate <span class="nv">VERSION</span><span class="o">=</span>20240428000000
</code></pre></div></div>

<p>If version 20240428000000 is greater than the current version (i.e., it is
migrating upwards), this will run the <code class="language-plaintext highlighter-rouge">change</code> (or <code class="language-plaintext highlighter-rouge">up</code>) method on all
migrations up to and including 20240428000000, and will not execute any later
migrations. If migrating downwards, this will run the <code class="language-plaintext highlighter-rouge">down</code> method on all the
migrations down to, but not including, 20240428000000.</p>

<h3 id="rolling-back">Rolling Back</h3>

<p>A common task is to rollback the last migration. For example, if you made a
mistake in it and wish to correct it. Rather than tracking down the version
number associated with the previous migration you can run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:rollback
</code></pre></div></div>

<p>This will rollback the latest migration, either by reverting the <code class="language-plaintext highlighter-rouge">change</code> method
or by running the <code class="language-plaintext highlighter-rouge">down</code> method. If you need to undo several migrations you can
provide a <code class="language-plaintext highlighter-rouge">STEP</code> parameter:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:rollback <span class="nv">STEP</span><span class="o">=</span>3
</code></pre></div></div>

<p>The last 3 migrations will be reverted.</p>

<p>In some cases where you modify a local migration and would like to rollback that
specific migration before migrating back up again, you can use the
<code class="language-plaintext highlighter-rouge">db:migrate:redo</code> command. As with the <code class="language-plaintext highlighter-rouge">db:rollback</code> command, you can use the
<code class="language-plaintext highlighter-rouge">STEP</code> parameter if you need to go more than one version back, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate:redo <span class="nv">STEP</span><span class="o">=</span>3
</code></pre></div></div>

<p>NOTE: You could get the same result using <code class="language-plaintext highlighter-rouge">db:migrate</code>. However, these are there
for convenience so that you do not need to explicitly specify the version to
migrate to.</p>

<h4 id="transactions">Transactions</h4>

<p>In databases that support DDL transactions, changing the schema in a single
transaction, each migration is wrapped in a transaction.</p>

<p>INFO: A transaction ensures that if a migration fails partway through, any
changes that were successfully applied are rolled back, maintaining database
consistency. This means that either all operations within the transaction are
executed successfully, or none of them are, preventing the database from being
left in an inconsistent state if an error occurs during the transaction.</p>

<p>If the database does not support DDL transactions with statements that change
the schema, then when a migration fails, the parts of it that have succeeded
will not be rolled back. You will have to rollback the changes manually.</p>

<p>There are queries that you can’t execute inside a transaction though, and for
these situations you can turn the automatic transactions off with
<code class="language-plaintext highlighter-rouge">disable_ddl_transaction!</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ChangeEnum</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="n">disable_ddl_transaction!</span>

  <span class="k">def</span> <span class="nf">up</span>
    <span class="n">execute</span> <span class="s2">"ALTER TYPE model_size ADD VALUE 'new_value'"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Remember that you can still open your own transactions, even if you are in
a Migration with self.disable_ddl_transaction!.</p>

<h3 id="setting-up-the-database">Setting Up the Database</h3>

<p>The <code class="language-plaintext highlighter-rouge">bin/rails db:setup</code> command will create the database, load the schema, and
initialize it with the seed data.</p>

<h3 id="preparing-the-database">Preparing the Database</h3>

<p>The <code class="language-plaintext highlighter-rouge">bin/rails db:prepare</code> command is similar to <code class="language-plaintext highlighter-rouge">bin/rails db:setup</code>, but it
operates idempotently, so it can safely be called several times, but it will
only perform the necessary tasks once.</p>

<ul>
  <li>If the database has not been created yet, the command will run as the
<code class="language-plaintext highlighter-rouge">bin/rails db:setup</code> does.</li>
  <li>If the database exists but the tables have not been created, the command will
load the schema, run any pending migrations, dump the updated schema, and
finally load the seed data. See the <a href="#migrations-and-seed-data">Seeding Data
documentation</a> for more details.</li>
  <li>If the database and tables exist, the command will do nothing.</li>
</ul>

<p>Once the database and tables exist, the <code class="language-plaintext highlighter-rouge">db:prepare</code> task will not try to reload
the seed data, even if the previously loaded seed data or the existing seed file
have been altered or deleted. To reload the seed data, you can manually run
<code class="language-plaintext highlighter-rouge">bin/rails db:seed:replant</code>.</p>

<p>NOTE: This task will only load seeds if one of the databases or tables created
is a primary database for the environment or is configured with <code class="language-plaintext highlighter-rouge">seeds: true</code>.</p>

<h3 id="resetting-the-database">Resetting the Database</h3>

<p>The <code class="language-plaintext highlighter-rouge">bin/rails db:reset</code> command will drop the database and set it up again.
This is functionally equivalent to <code class="language-plaintext highlighter-rouge">bin/rails db:drop db:setup</code>.</p>

<p>NOTE: This is not the same as running all the migrations. It will only use the
contents of the current <code class="language-plaintext highlighter-rouge">db/schema.rb</code> or <code class="language-plaintext highlighter-rouge">db/structure.sql</code> file. If a
migration can’t be rolled back, <code class="language-plaintext highlighter-rouge">bin/rails db:reset</code> may not help you. To find
out more about dumping the schema see <a href="#schema-dumping-and-you">Schema Dumping and You</a> section.</p>

<p>If you need an alternative to <code class="language-plaintext highlighter-rouge">db:reset</code> that explicitly runs all migrations,
consider using the <code class="language-plaintext highlighter-rouge">bin/rails db:migrate:reset</code> command. You can follow that
command with <code class="language-plaintext highlighter-rouge">bin/rails db:seed</code> if needed.</p>

<p>NOTE: <code class="language-plaintext highlighter-rouge">bin/rails db:reset</code> rebuilds the database using the current schema. On
the other hand, <code class="language-plaintext highlighter-rouge">bin/rails db:migrate:reset</code> replays all migrations from the
beginning, which can lead to schema drift if, for example, migrations have been
altered, reordered, or removed.</p>

<h3 id="running-specific-migrations">Running Specific Migrations</h3>

<p>If you need to run a specific migration up or down, the <code class="language-plaintext highlighter-rouge">db:migrate:up</code> and
<code class="language-plaintext highlighter-rouge">db:migrate:down</code> commands will do that. Just specify the appropriate version
and the corresponding migration will have its <code class="language-plaintext highlighter-rouge">change</code>, <code class="language-plaintext highlighter-rouge">up</code> or <code class="language-plaintext highlighter-rouge">down</code> method
invoked, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate:up <span class="nv">VERSION</span><span class="o">=</span>20240428000000
</code></pre></div></div>

<p>By running this command the <code class="language-plaintext highlighter-rouge">change</code> method (or the <code class="language-plaintext highlighter-rouge">up</code> method) will be
executed for the migration with the version “20240428000000”.</p>

<p>First, this command will check whether the migration exists and if it has
already been performed and if so, it will do nothing.</p>

<p>If the version specified does not exist, Rails will throw an exception.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate <span class="nv">VERSION</span><span class="o">=</span>00000000000000
rails aborted!
ActiveRecord::UnknownMigrationVersionError:

No migration with version number 00000000000000.
</code></pre></div></div>

<h3 id="running-migrations-in-different-environments">Running Migrations in Different Environments</h3>

<p>By default running <code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code> will run in the <code class="language-plaintext highlighter-rouge">development</code>
environment.</p>

<p>To run migrations against another environment you can specify it using the
<code class="language-plaintext highlighter-rouge">RAILS_ENV</code> environment variable while running the command. For example to run
migrations against the <code class="language-plaintext highlighter-rouge">test</code> environment you could run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nb">test</span>
</code></pre></div></div>

<h3 id="changing-the-output-of-running-migrations">Changing the Output of Running Migrations</h3>

<p>By default migrations tell you exactly what they’re doing and how long it took.
A migration creating a table and adding an index might produce output like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==  CreateProducts: migrating =================================================
-- create_table(:products)
   -&gt; 0.0028s
==  CreateProducts: migrated (0.0028s) ========================================
</code></pre></div></div>

<p>Several methods are provided in migrations that allow you to control all this:</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[<code class="language-plaintext highlighter-rouge">suppress_messages</code>][]</td>
      <td>Takes a block as an argument and suppresses any output generated by the block.</td>
    </tr>
    <tr>
      <td>[<code class="language-plaintext highlighter-rouge">say</code>][]</td>
      <td>Takes a message argument and outputs it as is. A second boolean argument can be passed to specify whether to indent or not.</td>
    </tr>
    <tr>
      <td>[<code class="language-plaintext highlighter-rouge">say_with_time</code>][]</td>
      <td>Outputs text along with how long it took to run its block. If the block returns an integer it assumes it is the number of rows affected.</td>
    </tr>
  </tbody>
</table>

<p>For example, take the following migration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">suppress_messages</span> <span class="k">do</span>
      <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:description</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">say</span> <span class="s2">"Created a table"</span>

    <span class="n">suppress_messages</span> <span class="p">{</span> <span class="n">add_index</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:name</span> <span class="p">}</span>
    <span class="n">say</span> <span class="s2">"and an index!"</span><span class="p">,</span> <span class="kp">true</span>

    <span class="n">say_with_time</span> <span class="s2">"Waiting for a while"</span> <span class="k">do</span>
      <span class="nb">sleep</span> <span class="mi">10</span>
      <span class="mi">250</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This will generate the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==  CreateProducts: migrating =================================================
-- Created a table
   -&gt; and an index!
-- Waiting for a while
   -&gt; 10.0013s
   -&gt; 250 rows
==  CreateProducts: migrated (10.0054s) =======================================
</code></pre></div></div>

<p>If you want Active Record to not output anything, then running <code class="language-plaintext highlighter-rouge">bin/rails
db:migrate VERBOSE=false</code> will suppress all output.</p>

<p>[<code class="language-plaintext highlighter-rouge">say</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Migration.html#method-i-say
[<code class="language-plaintext highlighter-rouge">say_with_time</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Migration.html#method-i-say_with_time
[<code class="language-plaintext highlighter-rouge">suppress_messages</code>]:
    https://api.rubyonrails.org/classes/ActiveRecord/Migration.html#method-i-suppress_messages</p>

<h3 id="rails-migration-version-control">Rails Migration Version Control</h3>

<p>Rails keeps track of which migrations have been run through the
<code class="language-plaintext highlighter-rouge">schema_migrations</code> table in the database. When you run a migration, Rails
inserts a row into the <code class="language-plaintext highlighter-rouge">schema_migrations</code> table with the version number of the
migration, stored in the <code class="language-plaintext highlighter-rouge">version</code> column. This allows Rails to determine which
migrations have already been applied to the database.</p>

<p>For example, if you have a migration file named 20240428000000_create_users.rb,
Rails will extract the version number (20240428000000) from the filename and
insert it into the schema_migrations table after the migration has been
successfully executed.</p>

<p>You can view the contents of the schema_migrations table directly in your
database management tool or by using Rails console:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">rails dbconsole
</span></code></pre></div></div>

<p>Then, within the database console, you can query the schema_migrations table:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">schema_migrations</span><span class="p">;</span>
</code></pre></div></div>

<p>This will show you a list of all migration version numbers that have been
applied to the database. Rails uses this information to determine which
migrations need to be run when you run rails db:migrate or rails db:migrate:up
commands.</p>

<h2 id="changing-existing-migrations">Changing Existing Migrations</h2>

<p>Occasionally you will make a mistake when writing a migration. If you have
already run the migration, then you cannot just edit the migration and run the
migration again: Rails thinks it has already run the migration and so will do
nothing when you run <code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code>. You must rollback the migration
(for example with <code class="language-plaintext highlighter-rouge">bin/rails db:rollback</code>), edit your migration, and then run
<code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code> to run the corrected version.</p>

<p>In general, editing existing migrations that have been already committed to
source control is not a good idea. You will be creating extra work for yourself
and your co-workers and cause major headaches if the existing version of the
migration has already been run on production machines. Instead, you should write
a new migration that performs the changes you require.</p>

<p>However, editing a freshly generated migration that has not yet been committed
to source control (or, more generally, has not been propagated beyond your
development machine) is common.</p>

<p>The <code class="language-plaintext highlighter-rouge">revert</code> method can be helpful when writing a new migration to undo previous
migrations in whole or in part (see <a href="#reverting-previous-migrations">Reverting Previous Migrations</a> above).</p>

<h2 id="schema-dumping-and-you">Schema Dumping and You</h2>

<h3 id="what-are-schema-files-for">What are Schema Files for?</h3>

<p>Migrations, mighty as they may be, are not the authoritative source for your
database schema. <strong>Your database remains the source of truth.</strong></p>

<p>By default, Rails generates <code class="language-plaintext highlighter-rouge">db/schema.rb</code> which attempts to capture the current
state of your database schema.</p>

<p>It tends to be faster and less error prone to create a new instance of your
application’s database by loading the schema file via <code class="language-plaintext highlighter-rouge">bin/rails db:schema:load</code>
than it is to replay the entire migration history. <a href="#old-migrations">Old migrations</a> may fail
to apply correctly if those migrations use changing external dependencies or
rely on application code which evolves separately from your migrations.</p>

<p>TIP: Schema files are also useful if you want a quick look at what attributes an
Active Record object has. This information is not in the model’s code and is
frequently spread across several migrations, but the information is nicely
summed up in the schema file.</p>

<h3 id="types-of-schema-dumps">Types of Schema Dumps</h3>

<p>The format of the schema dump generated by Rails is controlled by the
[<code class="language-plaintext highlighter-rouge">config.active_record.schema_format</code>][] setting defined in
<code class="language-plaintext highlighter-rouge">config/application.rb</code>, or the <code class="language-plaintext highlighter-rouge">schema_format</code> value in the database configuration.
By default, the format is <code class="language-plaintext highlighter-rouge">:ruby</code>, or alternatively can be set to <code class="language-plaintext highlighter-rouge">:sql</code>.</p>

<h4 id="using-the-default-ruby-schema">Using the default <code class="language-plaintext highlighter-rouge">:ruby</code> schema</h4>

<p>When <code class="language-plaintext highlighter-rouge">:ruby</code> is selected, then the schema is stored in <code class="language-plaintext highlighter-rouge">db/schema.rb</code>. If you
look at this file you’ll find that it looks an awful lot like one very big
migration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Schema</span><span class="p">[</span><span class="mf">8.1</span><span class="p">].</span><span class="nf">define</span><span class="p">(</span><span class="ss">version: </span><span class="mi">2008_09_06_171750</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">create_table</span> <span class="s2">"authors"</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">string</span>   <span class="s2">"name"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span>
  <span class="k">end</span>

  <span class="n">create_table</span> <span class="s2">"products"</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">string</span>   <span class="s2">"name"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">text</span>     <span class="s2">"description"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">string</span>   <span class="s2">"part_number"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In many ways this is exactly what it is. This file is created by inspecting the
database and expressing its structure using <code class="language-plaintext highlighter-rouge">create_table</code>, <code class="language-plaintext highlighter-rouge">add_index</code>, and so
on.</p>

<h4 id="using-the-sql-schema-dumper">Using the <code class="language-plaintext highlighter-rouge">:sql</code> schema dumper</h4>

<p>However, <code class="language-plaintext highlighter-rouge">db/schema.rb</code> cannot express everything your database may support such
as triggers, sequences, stored procedures, etc.</p>

<p>While migrations may use <code class="language-plaintext highlighter-rouge">execute</code> to create database constructs that are not
supported by the Ruby migration DSL, these constructs may not be able to be
reconstituted by the schema dumper.</p>

<p>If you are using features like these, you should set the schema format to <code class="language-plaintext highlighter-rouge">:sql</code>
in order to get an accurate schema file that is useful to create new database
instances.</p>

<p>When the schema format is set to <code class="language-plaintext highlighter-rouge">:sql</code>, the database structure will be dumped
using a tool specific to the database into <code class="language-plaintext highlighter-rouge">db/structure.sql</code>. For example, for
PostgreSQL, the <code class="language-plaintext highlighter-rouge">pg_dump</code> utility is used. For MySQL and MariaDB, this file will
contain the output of <code class="language-plaintext highlighter-rouge">SHOW CREATE TABLE</code> for the various tables.</p>

<p>To load the schema from <code class="language-plaintext highlighter-rouge">db/structure.sql</code>, run <code class="language-plaintext highlighter-rouge">bin/rails db:schema:load</code>.
Loading this file is done by executing the SQL statements it contains. By
definition, this will create a perfect copy of the database’s structure.</p>

<p>[<code class="language-plaintext highlighter-rouge">config.active_record.schema_format</code>]:
    configuring.html#config-active-record-schema-format</p>

<h3 id="schema-dumps-and-source-control">Schema Dumps and Source Control</h3>

<p>Because schema files are commonly used to create new databases, it is strongly
recommended that you check your schema file into source control.</p>

<p>Merge conflicts can occur in your schema file when two branches modify schema.
To resolve these conflicts run <code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code> to regenerate the schema
file.</p>

<p>INFO: Newly generated Rails apps will already have the migrations folder
included in the git tree, so all you have to do is be sure to add any new
migrations you add and commit them.</p>

<h2 id="active-record-and-referential-integrity">Active Record and Referential Integrity</h2>

<p>The Active Record pattern suggests that intelligence should primarily reside in
your models rather than in the database. Consequently, features like triggers or
constraints, which delegate some of that intelligence back into the database,
are not always favored.</p>

<p>Validations such as <code class="language-plaintext highlighter-rouge">validates :foreign_key, uniqueness: true</code> are one way in
which models can enforce data integrity. The <code class="language-plaintext highlighter-rouge">:dependent</code> option on associations
allows models to automatically destroy child objects when the parent is
destroyed. Like anything which operates at the application level, these cannot
guarantee referential integrity and so some people augment them with <a href="#foreign-keys">foreign
key constraints</a> in the database.</p>

<p>In practice, foreign key constraints and unique indexes are generally considered
safer when enforced at the database level. Although Active Record does not
provide direct support for working with these database-level features, you can
still use the execute method to run arbitrary SQL commands.</p>

<p>It’s worth emphasizing that while the Active Record pattern emphasizes keeping
intelligence within models, neglecting to implement foreign keys and unique
constraints at the database level can potentially lead to integrity issues.
Therefore, it’s advisable to complement the AR pattern with database-level
constraints where appropriate. These constraints should have their counterparts
explicitly defined in your code using associations and validations to ensure
data integrity across both application and database layers.</p>

<h2 id="migrations-and-seed-data">Migrations and Seed Data</h2>

<p>The main purpose of the Rails migration feature is to issue commands that modify
the schema using a consistent process. Migrations can also be used to add or
modify data. This is useful in an existing database that can’t be destroyed and
recreated, such as a production database.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AddInitialProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">up</span>
    <span class="mi">5</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="no">Product</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Product #</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="ss">description: </span><span class="s2">"A product."</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">down</span>
    <span class="no">Product</span><span class="p">.</span><span class="nf">delete_all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To add initial data after a database is created, Rails has a built-in ‘seeds’
feature that speeds up the process. This is especially useful when reloading the
database frequently in development and test environments, or when setting up
initial data for production.</p>

<p>To get started with this feature, open up <code class="language-plaintext highlighter-rouge">db/seeds.rb</code> and add some Ruby code,
then run <code class="language-plaintext highlighter-rouge">bin/rails db:seed</code>.</p>

<p>NOTE: The code here should be idempotent so that it can be executed at any point
in every environment.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"Action"</span><span class="p">,</span> <span class="s2">"Comedy"</span><span class="p">,</span> <span class="s2">"Drama"</span><span class="p">,</span> <span class="s2">"Horror"</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">genre_name</span><span class="o">|</span>
  <span class="no">MovieGenre</span><span class="p">.</span><span class="nf">find_or_create_by!</span><span class="p">(</span><span class="ss">name: </span><span class="n">genre_name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is generally a much cleaner way to set up the database of a blank
application.</p>

<h2 id="old-migrations">Old Migrations</h2>

<p>The <code class="language-plaintext highlighter-rouge">db/schema.rb</code> or <code class="language-plaintext highlighter-rouge">db/structure.sql</code> is a snapshot of the current state of
your database and is the authoritative source for rebuilding that database. This
makes it possible to delete or prune old migration files.</p>

<p>When you delete migration files in the <code class="language-plaintext highlighter-rouge">db/migrate/</code> directory, any environment
where <code class="language-plaintext highlighter-rouge">bin/rails db:migrate</code> was run when those files still existed will hold a
reference to the migration timestamp specific to them inside an internal Rails
database table named <code class="language-plaintext highlighter-rouge">schema_migrations</code>. You can read more about this in the
<a href="#rails-migration-version-control">Rails Migration Version Control section</a>.</p>

<p>If you run the <code class="language-plaintext highlighter-rouge">bin/rails db:migrate:status</code> command, which displays the status
(up or down) of each migration, you should see <code class="language-plaintext highlighter-rouge">********** NO FILE **********</code>
displayed next to any deleted migration file which was once executed on a
specific environment but can no longer be found in the <code class="language-plaintext highlighter-rouge">db/migrate/</code> directory.</p>

<h3 id="migrations-from-engines">Migrations from Engines</h3>

<p>When dealing with migrations from <a href="engines.html">Engines</a>, there’s a caveat to consider.
Rake tasks to install migrations from engines are idempotent, meaning they will
have the same result no matter how many times they are called. Migrations
present in the parent application due to a previous installation are skipped,
and missing ones are copied with a new leading timestamp. If you deleted old
engine migrations and ran the install task again, you’d get new files with new
timestamps, and <code class="language-plaintext highlighter-rouge">db:migrate</code> would attempt to run them again.</p>

<p>Thus, you generally want to preserve migrations coming from engines. They have a
special comment like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This migration comes from blorgh (originally 20210621082949)</span>
</code></pre></div></div>

<h2 id="miscellaneous">Miscellaneous</h2>

<h3 id="using-uuids-instead-of-ids-for-primary-keys">Using UUIDs instead of IDs for Primary Keys</h3>

<p>By default, Rails uses auto-incrementing integers as primary keys for database
records. However, there are scenarios where using Universally Unique Identifiers
(UUIDs) as primary keys can be advantageous, especially in distributed systems
or when integration with external services is necessary. UUIDs provide a
globally unique identifier without relying on a centralized authority for
generating IDs.</p>

<h4 id="enabling-uuids-in-rails">Enabling UUIDs in Rails</h4>

<p>Before using UUIDs in your Rails application, you’ll need to ensure that your
database supports storing them. Additionally, you may need to configure your
database adapter to work with UUIDs.</p>

<p>NOTE: If you are using a version of PostgreSQL prior to 13, you may still need
to enable the pgcrypto extension to access the <code class="language-plaintext highlighter-rouge">gen_random_uuid()</code> function.</p>

<ol>
  <li>
    <p>Rails Configuration</p>

    <p>In your Rails application configuration file (<code class="language-plaintext highlighter-rouge">config/application.rb</code>), add
 the following line to configure Rails to generate UUIDs as primary keys by
 default:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">config</span><span class="p">.</span><span class="nf">generators</span> <span class="k">do</span> <span class="o">|</span><span class="n">g</span><span class="o">|</span>
   <span class="n">g</span><span class="p">.</span><span class="nf">orm</span> <span class="ss">:active_record</span><span class="p">,</span> <span class="ss">primary_key_type: :uuid</span>
 <span class="k">end</span>
</code></pre></div>    </div>

    <p>This setting instructs Rails to use UUIDs as the default primary key type
 for ActiveRecord models.</p>
  </li>
  <li>
    <p>Adding References with UUIDs:</p>

    <p>When creating associations between models using references, ensure that you
 specify the data type as :uuid to maintain consistency with the primary key
 type. For example:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">create_table</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
   <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">type: :uuid</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>
   <span class="c1"># Other columns...</span>
   <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
 <span class="k">end</span>
</code></pre></div>    </div>

    <p>In this example, the <code class="language-plaintext highlighter-rouge">author_id</code> column in the posts table references the
 <code class="language-plaintext highlighter-rouge">id</code> column of the authors table. By explicitly setting the type to <code class="language-plaintext highlighter-rouge">:uuid</code>,
 you ensure that the foreign key column matches the data type of the primary
 key it references. Adjust the syntax accordingly for other associations and
 databases.</p>
  </li>
  <li>
    <p>Migration Changes</p>

    <p>When generating migrations for your models, you’ll notice that it specifies
 the id to be of type <code class="language-plaintext highlighter-rouge">uuid:</code></p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nv">$ </span>bin/rails g migration CreateAuthors
</code></pre></div>    </div>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">class</span> <span class="nc">CreateAuthors</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
   <span class="k">def</span> <span class="nf">change</span>
     <span class="n">create_table</span> <span class="ss">:authors</span><span class="p">,</span> <span class="ss">id: :uuid</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
       <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>    </div>

    <p>which results in the following schema:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">create_table</span> <span class="s2">"authors"</span><span class="p">,</span> <span class="ss">id: :uuid</span><span class="p">,</span> <span class="ss">default: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="s2">"gen_random_uuid()"</span> <span class="p">},</span> <span class="ss">force: :cascade</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
   <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">6</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
   <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">6</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
 <span class="k">end</span>
</code></pre></div>    </div>

    <p>In this migration, the <code class="language-plaintext highlighter-rouge">id</code> column is defined as a UUID primary key with a
 default value generated by the <code class="language-plaintext highlighter-rouge">gen_random_uuid()</code> function.</p>
  </li>
</ol>

<p>UUIDs are guaranteed to be globally unique across different systems, making them
suitable for distributed architectures. They also simplify integration with
external systems or APIs by providing a unique identifier that doesn’t rely on
centralized ID generation, and unlike auto-incrementing integers, UUIDs don’t
expose information about the total number of records in a table, which can be
beneficial for security purposes.</p>

<p>However, UUIDs can also impact performance due to their size and are harder to
index. UUIDs will have worse performance for writes and reads compared with
integer primary keys and foreign keys.</p>

<p>NOTE: Therefore, it’s essential to evaluate the trade-offs and consider the
specific requirements of your application before deciding to use UUIDs as
primary keys.</p>

<h3 id="data-migrations">Data Migrations</h3>

<p>Data migrations involve transforming or moving data within your database. In
Rails, it is generally not advised to perform data migrations using migration
files. Here’s why:</p>

<ul>
  <li><strong>Separation of Concerns</strong>: Schema changes and data changes have different
lifecycles and purposes. Schema changes alter the structure of your database,
while data changes alter the content.</li>
  <li><strong>Rollback Complexity</strong>: Data migrations can be hard to rollback safely and
predictably.</li>
  <li><strong>Performance</strong>: Data migrations can take a long time to run and may lock your
tables, affecting application performance and availability.</li>
</ul>

<p>Instead, consider using the
<a href="https://github.com/Shopify/maintenance_tasks"><code class="language-plaintext highlighter-rouge">maintenance_tasks</code></a> gem. This
gem provides a framework for creating and managing data migrations and other
maintenance tasks in a way that is safe and easy to manage without interfering
with schema migrations.</p>

        </div>

        <footer class="guide-footer">
            <div class="feedback">
                <h3>Geri Bildirim</h3>
                <p>Bu kılavuzun kalitesini artırmamıza yardımcı olmak için geri bildirimlerinizi bekliyoruz.</p>
                <p>Lütfen <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub Issues</a> üzerinden katkıda bulunun.</p>
            </div>
        </footer>
    </article>
</div>

<script>
// İçindekiler tablosunu otomatik oluştur
document.addEventListener('DOMContentLoaded', function() {
    const toc = document.getElementById('toc');
    const headings = document.querySelectorAll('.guide-content h2, .guide-content h3, .guide-content h4');
    
    if (headings.length > 0) {
        const tocList = document.createElement('ul');
        
        headings.forEach(function(heading, index) {
            const id = 'heading-' + index;
            heading.id = id;
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();
            
            li.appendChild(a);
            tocList.appendChild(li);
        });
        
        toc.appendChild(tocList);
    }
});
</script>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Rails Kılavuzları Türkçe Çevirisi. Gönüllüler tarafından hazırlanmıştır.</p>
            <p>Orijinal dokümantasyon <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine aittir.</p>
        </div>
    </footer>

    <script>hljs.highlightAll();</script>
</body>
</html>