<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Support Core Extensions - Rails Dokümantasyonu - Türkçe</title>
    <link rel="stylesheet" href="/rails-tr-TR/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <a href="/rails-tr-TR/">Rails Kılavuzları</a>
                </h1>
                <nav class="nav">
                    <a href="/rails-tr-TR/">Ana Sayfa</a>
                    <a href="https://dilankaya127.github.io">Portföy</a>
                    <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="guide-container">
    <aside class="guide-sidebar">
        <div class="guide-toc">
            <h3>İçindekiler</h3>
            <div id="toc"></div>
        </div>
        
        <div class="guide-nav">
            <h3>Diğer Kılavuzlar</h3>
            <ul>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/getting_started">Rails ile Başlarken</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/en/active_record_basics">Active Record Temelleri</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides//en/action_controller_overview">Action Controller</a></li>
                <li><a href="/rails-tr-TR/rails-tr-TR/guides/tr/action_cable_overview">Action Cable</a></li>
            </ul>
        </div>
    </aside>

    <article class="guide-content">
        <header class="guide-header">
            <h1>Active Support Core Extensions</h1>
            
        </header>

        <div class="guide-body">
            <p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1 id="active-support-core-extensions">Active Support Core Extensions</h1>

<p>Active Support is the Ruby on Rails component responsible for providing Ruby
language extensions and utilities.</p>

<p>It offers a richer bottom-line at the language level, targeted both at the development of Rails applications, and at the development of Ruby on Rails itself.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>What Core Extensions are.</li>
  <li>How to load all extensions.</li>
  <li>How to cherry-pick just the extensions you want.</li>
  <li>What extensions Active Support provides.</li>
</ul>

<hr />

<h2 id="how-to-load-core-extensions">How to Load Core Extensions</h2>

<h3 id="stand-alone-active-support">Stand-Alone Active Support</h3>

<p>In order to have the smallest default footprint possible, Active Support loads the minimum dependencies by default. It is broken in small pieces so that only the desired extensions can be loaded. It also has some convenience entry points to load related extensions in one shot, even everything.</p>

<p>Thus, after a simple require like:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"active_support"</span>
</code></pre></div></div>

<p>only the extensions required by the Active Support framework are loaded.</p>

<h4 id="cherry-picking-a-definition">Cherry-picking a Definition</h4>

<p>This example shows how to load <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-with_indifferent_access"><code class="language-plaintext highlighter-rouge">Hash#with_indifferent_access</code></a>.  This extension enables the conversion of a <code class="language-plaintext highlighter-rouge">Hash</code> into an <a href="https://api.rubyonrails.org/classes/ActiveSupport/HashWithIndifferentAccess.html"><code class="language-plaintext highlighter-rouge">ActiveSupport::HashWithIndifferentAccess</code></a> which permits access to the keys as either strings or symbols.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre></div></div>

<p>For every single method defined as a core extension this guide has a note that says where such a method is defined. In the case of <code class="language-plaintext highlighter-rouge">with_indifferent_access</code> the note reads:</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/indifferent_access.rb</code>.</p>

<p>That means that you can require it like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash/indifferent_access"</span>
</code></pre></div></div>

<p>Active Support has been carefully revised so that cherry-picking a file loads only strictly needed dependencies, if any.</p>

<h4 id="loading-grouped-core-extensions">Loading Grouped Core Extensions</h4>

<p>The next level is to simply load all extensions to <code class="language-plaintext highlighter-rouge">Hash</code>. As a rule of thumb, extensions to <code class="language-plaintext highlighter-rouge">SomeClass</code> are available in one shot by loading <code class="language-plaintext highlighter-rouge">active_support/core_ext/some_class</code>.</p>

<p>Thus, to load all extensions to <code class="language-plaintext highlighter-rouge">Hash</code> (including <code class="language-plaintext highlighter-rouge">with_indifferent_access</code>):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash"</span>
</code></pre></div></div>

<h4 id="loading-all-core-extensions">Loading All Core Extensions</h4>

<p>You may prefer just to load all core extensions, there is a file for that:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext"</span>
</code></pre></div></div>

<h4 id="loading-all-active-support">Loading All Active Support</h4>

<p>And finally, if you want to have all Active Support available just issue:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"active_support/all"</span>
</code></pre></div></div>

<p>That does not even put the entire Active Support in memory upfront indeed, some stuff is configured via <code class="language-plaintext highlighter-rouge">autoload</code>, so it is only loaded if used.</p>

<h3 id="active-support-within-a-ruby-on-rails-application">Active Support Within a Ruby on Rails Application</h3>

<p>A Ruby on Rails application loads all Active Support unless <a href="configuring.html#config-active-support-bare"><code class="language-plaintext highlighter-rouge">config.active_support.bare</code></a> is true. In that case, the application will only load what the framework itself cherry-picks for its own needs, and can still cherry-pick itself at any granularity level, as explained in the previous section.</p>

<h2 id="extensions-to-all-objects">Extensions to All Objects</h2>

<h3 id="blank-and-present"><code class="language-plaintext highlighter-rouge">blank?</code> and <code class="language-plaintext highlighter-rouge">present?</code></h3>

<p>The following values are considered to be blank in a Rails application:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">nil</code> and <code class="language-plaintext highlighter-rouge">false</code>,</p>
  </li>
  <li>
    <p>strings composed only of whitespace (see note below),</p>
  </li>
  <li>
    <p>empty arrays and hashes, and</p>
  </li>
  <li>
    <p>any other object that responds to <code class="language-plaintext highlighter-rouge">empty?</code> and is empty.</p>
  </li>
</ul>

<p>INFO: The predicate for strings uses the Unicode-aware character class <code class="language-plaintext highlighter-rouge">[:space:]</code>, so for example U+2029 (paragraph separator) is considered to be whitespace.</p>

<p>WARNING: Note that numbers are not mentioned. In particular, 0 and 0.0 are <strong>not</strong> blank.</p>

<p>For example, this method from <code class="language-plaintext highlighter-rouge">ActionController::HttpAuthentication::Token::ControllerMethods</code> uses <a href="https://api.rubyonrails.org/classes/Object.html#method-i-blank-3F"><code class="language-plaintext highlighter-rouge">blank?</code></a> for checking whether a token is present:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">login_procedure</span><span class="p">)</span>
  <span class="n">token</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">token_and_options</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="nf">request</span><span class="p">)</span>
  <span class="k">unless</span> <span class="n">token</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="n">login_procedure</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-present-3F"><code class="language-plaintext highlighter-rouge">present?</code></a> is equivalent to <code class="language-plaintext highlighter-rouge">!blank?</code>. This example is taken from <code class="language-plaintext highlighter-rouge">ActionDispatch::Http::Cache::Response</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">set_conditional_cache_control!</span>
  <span class="k">unless</span> <span class="nb">self</span><span class="p">[</span><span class="s2">"Cache-Control"</span><span class="p">].</span><span class="nf">present?</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/blank.rb</code>.</p>

<h3 id="presence"><code class="language-plaintext highlighter-rouge">presence</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/Object.html#method-i-presence"><code class="language-plaintext highlighter-rouge">presence</code></a> method returns its receiver if <code class="language-plaintext highlighter-rouge">present?</code>, and <code class="language-plaintext highlighter-rouge">nil</code> otherwise. It is useful for idioms like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:host</span><span class="p">].</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">"localhost"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/blank.rb</code>.</p>

<h3 id="duplicable"><code class="language-plaintext highlighter-rouge">duplicable?</code></h3>

<p>As of Ruby 2.5, most objects can be duplicated via <code class="language-plaintext highlighter-rouge">dup</code> or <code class="language-plaintext highlighter-rouge">clone</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"foo"</span><span class="p">.</span><span class="nf">dup</span>           <span class="c1"># =&gt; "foo"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">dup</span>              <span class="c1"># =&gt; ""</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">dup</span>     <span class="c1"># =&gt; (1/1)</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">dup</span>      <span class="c1"># =&gt; (0+0i)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">dup</span>    <span class="c1"># =&gt; TypeError (allocator undefined for Method)</span>
</code></pre></div></div>

<p>Active Support provides <a href="https://api.rubyonrails.org/classes/Object.html#method-i-duplicable-3F"><code class="language-plaintext highlighter-rouge">duplicable?</code></a> to query an object about this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"foo"</span><span class="p">.</span><span class="nf">duplicable?</span>           <span class="c1"># =&gt; true</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">duplicable?</span>              <span class="c1"># =&gt; true</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>     <span class="c1"># =&gt; true</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>      <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">duplicable?</span>    <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>WARNING: Any class can disallow duplication by removing <code class="language-plaintext highlighter-rouge">dup</code> and <code class="language-plaintext highlighter-rouge">clone</code> or raising exceptions from them. Thus only <code class="language-plaintext highlighter-rouge">rescue</code> can tell whether a given arbitrary object is duplicable. <code class="language-plaintext highlighter-rouge">duplicable?</code> depends on the hard-coded list above, but it is much faster than <code class="language-plaintext highlighter-rouge">rescue</code>. Use it only if you know the hard-coded list is enough in your use case.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/duplicable.rb</code>.</p>

<h3 id="deep_dup"><code class="language-plaintext highlighter-rouge">deep_dup</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/Object.html#method-i-deep_dup"><code class="language-plaintext highlighter-rouge">deep_dup</code></a> method returns a deep copy of a given object. Normally, when you <code class="language-plaintext highlighter-rouge">dup</code> an object that contains other objects, Ruby does not <code class="language-plaintext highlighter-rouge">dup</code> them, so it creates a shallow copy of the object. If you have an array with a string, for example, it will look like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s2">"string"</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">push</span> <span class="s2">"another-string"</span>

<span class="c1"># the object was duplicated, so the element was added only to the duplicate</span>
<span class="n">array</span>     <span class="c1"># =&gt; ["string"]</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ["string", "another-string"]</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s2">"string"</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>

<span class="c1"># first element was not duplicated, it will be changed in both arrays</span>
<span class="n">array</span>     <span class="c1"># =&gt; ["foo"]</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ["foo, "another-string"]</span>
</code></pre></div></div>

<p>As you can see, after duplicating the <code class="language-plaintext highlighter-rouge">Array</code> instance, we got another object, therefore we can modify it and the original object will stay unchanged. This is not true for array’s elements, however. Since <code class="language-plaintext highlighter-rouge">dup</code> does not make a deep copy, the string inside the array is still the same object.</p>

<p>If you need a deep copy of an object, you should use <code class="language-plaintext highlighter-rouge">deep_dup</code>. Here is an example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s2">"string"</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s2">"string"</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>

<span class="n">array</span>     <span class="c1"># =&gt; ["string"]</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ["foo"]</span>
</code></pre></div></div>

<p>If the object is not duplicable, <code class="language-plaintext highlighter-rouge">deep_dup</code> will just return it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="n">number</span><span class="p">.</span><span class="nf">object_id</span> <span class="o">==</span> <span class="n">duplicate</span><span class="p">.</span><span class="nf">object_id</span>   <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/deep_dup.rb</code>.</p>

<h3 id="try"><code class="language-plaintext highlighter-rouge">try</code></h3>

<p>When you want to call a method on an object only if it is not <code class="language-plaintext highlighter-rouge">nil</code>, the simplest way to achieve it is with conditional statements, adding unnecessary clutter. The alternative is to use <a href="https://api.rubyonrails.org/classes/Object.html#method-i-try"><code class="language-plaintext highlighter-rouge">try</code></a>. <code class="language-plaintext highlighter-rouge">try</code> is like <code class="language-plaintext highlighter-rouge">Object#public_send</code> except that it returns <code class="language-plaintext highlighter-rouge">nil</code> if sent to <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>Here is an example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># without try</span>
<span class="k">unless</span> <span class="vi">@number</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="vi">@number</span><span class="p">.</span><span class="nf">next</span>
<span class="k">end</span>

<span class="c1"># with try</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:next</span><span class="p">)</span>
</code></pre></div></div>

<p>Another example is this code from <code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::AbstractAdapter</code> where <code class="language-plaintext highlighter-rouge">@logger</code> could be <code class="language-plaintext highlighter-rouge">nil</code>. You can see that the code uses <code class="language-plaintext highlighter-rouge">try</code> and avoids an unnecessary check.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@logger</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:debug?</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s2">"%s (%.1fms)"</span> <span class="o">%</span> <span class="p">[</span><span class="nb">name</span> <span class="o">||</span> <span class="s2">"SQL"</span><span class="p">,</span> <span class="n">ms</span><span class="p">]</span>
    <span class="vi">@logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">format_log_entry</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">sql</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="s2">" "</span><span class="p">)))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">try</code> can also be called without arguments but a block, which will only be executed if the object is not nil:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@person</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">last_name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">try</code> will swallow no-method errors, returning nil instead. If you want to protect against typos, use <a href="https://api.rubyonrails.org/classes/Object.html#method-i-try-21"><code class="language-plaintext highlighter-rouge">try!</code></a> instead:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span>  <span class="c1"># =&gt; nil</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try!</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span> <span class="c1"># NoMethodError: undefined method `nest' for 1:Integer</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/try.rb</code>.</p>

<h3 id="class_evalargs-block"><code class="language-plaintext highlighter-rouge">class_eval(*args, &amp;block)</code></h3>

<p>You can evaluate code in the context of any object’s singleton class using <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-class_eval"><code class="language-plaintext highlighter-rouge">class_eval</code></a>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Proc</span>
  <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="n">block</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
    <span class="n">object</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"__bind_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">usec</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">define_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="nb">method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="n">remove_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="nb">method</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/kernel/singleton_class.rb</code>.</p>

<h3 id="acts_likeduck"><code class="language-plaintext highlighter-rouge">acts_like?(duck)</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-acts_like-3F"><code class="language-plaintext highlighter-rouge">acts_like?</code></a> provides a way to check whether some class acts like some other class based on a simple convention: a class that provides the same interface as <code class="language-plaintext highlighter-rouge">String</code> defines</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">acts_like_string?</span>
<span class="k">end</span>
</code></pre></div></div>

<p>which is only a marker, its body or return value are irrelevant. Then, client code can query for duck-type-safeness this way:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">some_klass</span><span class="p">.</span><span class="nf">acts_like?</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
</code></pre></div></div>

<p>Rails has classes that act like <code class="language-plaintext highlighter-rouge">Date</code> or <code class="language-plaintext highlighter-rouge">Time</code> and follow this contract.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/acts_like.rb</code>.</p>

<h3 id="to_param"><code class="language-plaintext highlighter-rouge">to_param</code></h3>

<p>All objects in Rails respond to the method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-to_param"><code class="language-plaintext highlighter-rouge">to_param</code></a>, which is meant to return something that represents them as values in a query string, or as URL fragments.</p>

<p>By default <code class="language-plaintext highlighter-rouge">to_param</code> just calls <code class="language-plaintext highlighter-rouge">to_s</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">7</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "7"</span>
</code></pre></div></div>

<p>The return value of <code class="language-plaintext highlighter-rouge">to_param</code> should <strong>not</strong> be escaped:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Tom &amp; Jerry"</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "Tom &amp; Jerry"</span>
</code></pre></div></div>

<p>Several classes in Rails overwrite this method.</p>

<p>For example <code class="language-plaintext highlighter-rouge">nil</code>, <code class="language-plaintext highlighter-rouge">true</code>, and <code class="language-plaintext highlighter-rouge">false</code> return themselves. <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_param"><code class="language-plaintext highlighter-rouge">Array#to_param</code></a> calls <code class="language-plaintext highlighter-rouge">to_param</code> on the elements and joins the result with “/”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="no">String</span><span class="p">].</span><span class="nf">to_param</span> <span class="c1"># =&gt; "0/true/String"</span>
</code></pre></div></div>

<p>Notably, the Rails routing system calls <code class="language-plaintext highlighter-rouge">to_param</code> on models to get a value for the <code class="language-plaintext highlighter-rouge">:id</code> placeholder. <code class="language-plaintext highlighter-rouge">ActiveRecord::Base#to_param</code> returns the <code class="language-plaintext highlighter-rouge">id</code> of a model, but you can redefine that method in your models. For example, given</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>we get:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user_path</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="c1"># =&gt; "/users/357-john-smith"</span>
</code></pre></div></div>

<p>WARNING. Controllers need to be aware of any redefinition of <code class="language-plaintext highlighter-rouge">to_param</code> because when a request like that comes in “357-john-smith” is the value of <code class="language-plaintext highlighter-rouge">params[:id]</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/to_param.rb</code>.</p>

<h3 id="to_query"><code class="language-plaintext highlighter-rouge">to_query</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/Object.html#method-i-to_query"><code class="language-plaintext highlighter-rouge">to_query</code></a> method constructs a query string that associates a given <code class="language-plaintext highlighter-rouge">key</code> with the return value of <code class="language-plaintext highlighter-rouge">to_param</code>. For example, with the following <code class="language-plaintext highlighter-rouge">to_param</code> definition:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>we get:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">current_user</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s2">"user"</span><span class="p">)</span> <span class="c1"># =&gt; "user=357-john-smith"</span>
</code></pre></div></div>

<p>This method escapes whatever is needed, both for the key and the value:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">account</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s2">"company[name]"</span><span class="p">)</span>
<span class="c1"># =&gt; "company%5Bname%5D=Johnson+%26+Johnson"</span>
</code></pre></div></div>

<p>so its output is ready to be used in a query string.</p>

<p>Arrays return the result of applying <code class="language-plaintext highlighter-rouge">to_query</code> to each element with <code class="language-plaintext highlighter-rouge">key[]</code> as key, and join the result with “&amp;”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.6</span><span class="p">].</span><span class="nf">to_query</span><span class="p">(</span><span class="s2">"sample"</span><span class="p">)</span>
<span class="c1"># =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"</span>
</code></pre></div></div>

<p>Hashes also respond to <code class="language-plaintext highlighter-rouge">to_query</code> but with a different signature. If no argument is passed a call generates a sorted series of key/value assignments calling <code class="language-plaintext highlighter-rouge">to_query(key)</code> on its values. Then it joins the result with “&amp;”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">c: </span><span class="mi">3</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">to_query</span> <span class="c1"># =&gt; "a=1&amp;b=2&amp;c=3"</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_query"><code class="language-plaintext highlighter-rouge">Hash#to_query</code></a> accepts an optional namespace for the keys:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">id: </span><span class="mi">89</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Smith"</span> <span class="p">}.</span><span class="nf">to_query</span><span class="p">(</span><span class="s2">"user"</span><span class="p">)</span>
<span class="c1"># =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/to_query.rb</code>.</p>

<h3 id="with_options"><code class="language-plaintext highlighter-rouge">with_options</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-with_options"><code class="language-plaintext highlighter-rouge">with_options</code></a> provides a way to factor out common options in a series of method calls.</p>

<p>Given a default options hash, <code class="language-plaintext highlighter-rouge">with_options</code> yields a proxy object to a block. Within the block, methods called on the proxy are forwarded to the receiver with their options merged. For example, you get rid of the duplication in:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:customers</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:products</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:invoices</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:expenses</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
<span class="k">end</span>
</code></pre></div></div>

<p>this way:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">dependent: :destroy</span> <span class="k">do</span> <span class="o">|</span><span class="n">assoc</span><span class="o">|</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:customers</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:products</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:invoices</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:expenses</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>That idiom may convey <em>grouping</em> to the reader as well. For example, say you want to send a newsletter whose language depends on the user. Somewhere in the mailer you could group locale-dependent bits like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">I18n</span><span class="p">.</span><span class="nf">with_options</span> <span class="ss">locale: </span><span class="n">user</span><span class="p">.</span><span class="nf">locale</span><span class="p">,</span> <span class="ss">scope: </span><span class="s2">"newsletter"</span> <span class="k">do</span> <span class="o">|</span><span class="n">i18n</span><span class="o">|</span>
  <span class="n">subject</span> <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:subject</span>
  <span class="n">body</span>    <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">user_name: </span><span class="n">user</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre></div></div>

<p>TIP: Since <code class="language-plaintext highlighter-rouge">with_options</code> forwards calls to its receiver they can be nested. Each nesting level will merge inherited defaults in addition to their own.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/with_options.rb</code>.</p>

<h3 id="json-support">JSON Support</h3>

<p>Active Support provides a better implementation of <code class="language-plaintext highlighter-rouge">to_json</code> than the <code class="language-plaintext highlighter-rouge">json</code> gem ordinarily provides for Ruby objects. This is because some classes, like <code class="language-plaintext highlighter-rouge">Hash</code> and <code class="language-plaintext highlighter-rouge">Process::Status</code> need special handling in order to provide a proper JSON representation.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/json.rb</code>.</p>

<h3 id="instance-variables">Instance Variables</h3>

<p>Active Support provides several methods to ease access to instance variables.</p>

<h4 id="instance_values"><code class="language-plaintext highlighter-rouge">instance_values</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-instance_values"><code class="language-plaintext highlighter-rouge">instance_values</code></a> returns a hash that maps instance variable names without “@” to their
corresponding values. Keys are strings:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_values</span> <span class="c1"># =&gt; {"x" =&gt; 0, "y" =&gt; 1}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/instance_variables.rb</code>.</p>

<h4 id="instance_variable_names"><code class="language-plaintext highlighter-rouge">instance_variable_names</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Object.html#method-i-instance_variable_names"><code class="language-plaintext highlighter-rouge">instance_variable_names</code></a> returns an array. Each name includes the “@” sign.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_variable_names</span> <span class="c1"># =&gt; ["@x", "@y"]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/instance_variables.rb</code>.</p>

<h3 id="silencing-warnings-and-exceptions">Silencing Warnings and Exceptions</h3>

<p>The methods <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-silence_warnings"><code class="language-plaintext highlighter-rouge">silence_warnings</code></a> and <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-enable_warnings"><code class="language-plaintext highlighter-rouge">enable_warnings</code></a> change the value of <code class="language-plaintext highlighter-rouge">$VERBOSE</code> accordingly for the duration of their block, and reset it afterwards:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">silence_warnings</span> <span class="p">{</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_set</span> <span class="s2">"RAILS_DEFAULT_LOGGER"</span><span class="p">,</span> <span class="n">logger</span> <span class="p">}</span>
</code></pre></div></div>

<p>Silencing exceptions is also possible with <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-suppress"><code class="language-plaintext highlighter-rouge">suppress</code></a>. This method receives an arbitrary number of exception classes. If an exception is raised during the execution of the block and is <code class="language-plaintext highlighter-rouge">kind_of?</code> any of the arguments, <code class="language-plaintext highlighter-rouge">suppress</code> captures it and returns silently. Otherwise the exception is not captured:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># If the user is locked, the increment is lost, no big deal.</span>
<span class="n">suppress</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">StaleObjectError</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_user</span><span class="p">.</span><span class="nf">increment!</span> <span class="ss">:visits</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/kernel/reporting.rb</code>.</p>

<h3 id="in"><code class="language-plaintext highlighter-rouge">in?</code></h3>

<p>The predicate <a href="https://api.rubyonrails.org/classes/Object.html#method-i-in-3F"><code class="language-plaintext highlighter-rouge">in?</code></a> tests if an object is included in another object. An <code class="language-plaintext highlighter-rouge">ArgumentError</code> exception will be raised if the argument passed does not respond to <code class="language-plaintext highlighter-rouge">include?</code>.</p>

<p>Examples of <code class="language-plaintext highlighter-rouge">in?</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>        <span class="c1"># =&gt; true</span>
<span class="s2">"lo"</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="mi">25</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">30</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span>      <span class="c1"># =&gt; false</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c1"># =&gt; ArgumentError</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/inclusion.rb</code>.</p>

<h2 id="extensions-to-module">Extensions to <code class="language-plaintext highlighter-rouge">Module</code></h2>

<h3 id="attributes">Attributes</h3>

<h4 id="alias_attribute"><code class="language-plaintext highlighter-rouge">alias_attribute</code></h4>

<p>Model attributes have a reader, a writer, and a predicate. You can alias a model attribute having the corresponding three methods all defined for you by using <a href="https://api.rubyonrails.org/classes/Module.html#method-i-alias_attribute"><code class="language-plaintext highlighter-rouge">alias_attribute</code></a>. As in other aliasing methods, the new name is the first argument, and the old name is the second (one mnemonic is that they go in the same order as if you did an assignment):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># You can refer to the email column as "login".</span>
  <span class="c1"># This can be meaningful for authentication code.</span>
  <span class="n">alias_attribute</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/aliasing.rb</code>.</p>

<h4 id="internal-attributes">Internal Attributes</h4>

<p>When you are defining an attribute in a class that is meant to be subclassed, name collisions are a risk. That’s remarkably important for libraries.</p>

<p>Active Support defines the macros <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_reader"><code class="language-plaintext highlighter-rouge">attr_internal_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_writer"><code class="language-plaintext highlighter-rouge">attr_internal_writer</code></a>, and <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_accessor"><code class="language-plaintext highlighter-rouge">attr_internal_accessor</code></a>. They behave like their Ruby built-in <code class="language-plaintext highlighter-rouge">attr_*</code> counterparts, except they name the underlying instance variable in a way that makes collisions less likely.</p>

<p>The macro <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal"><code class="language-plaintext highlighter-rouge">attr_internal</code></a> is a synonym for <code class="language-plaintext highlighter-rouge">attr_internal_accessor</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># library</span>
<span class="k">class</span> <span class="nc">ThirdPartyLibrary::Crawler</span>
  <span class="n">attr_internal</span> <span class="ss">:log_level</span>
<span class="k">end</span>

<span class="c1"># client code</span>
<span class="k">class</span> <span class="nc">MyCrawler</span> <span class="o">&lt;</span> <span class="no">ThirdPartyLibrary</span><span class="o">::</span><span class="no">Crawler</span>
  <span class="nb">attr_accessor</span> <span class="ss">:log_level</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the previous example it could be the case that <code class="language-plaintext highlighter-rouge">:log_level</code> does not belong to the public interface of the library and it is only used for development. The client code, unaware of the potential conflict, subclasses and defines its own <code class="language-plaintext highlighter-rouge">:log_level</code>. Thanks to <code class="language-plaintext highlighter-rouge">attr_internal</code> there’s no collision.</p>

<p>By default the internal instance variable is named with a leading underscore, <code class="language-plaintext highlighter-rouge">@_log_level</code> in the example above. That’s configurable via <code class="language-plaintext highlighter-rouge">Module.attr_internal_naming_format</code> though, you can pass any <code class="language-plaintext highlighter-rouge">sprintf</code>-like format string with a leading <code class="language-plaintext highlighter-rouge">@</code> and a <code class="language-plaintext highlighter-rouge">%s</code> somewhere, which is where the name will be placed. The default is <code class="language-plaintext highlighter-rouge">"@_%s"</code>.</p>

<p>Rails uses internal attributes in a few spots, for examples for views:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">attr_internal</span> <span class="ss">:captures</span>
    <span class="n">attr_internal</span> <span class="ss">:request</span><span class="p">,</span> <span class="ss">:layout</span>
    <span class="n">attr_internal</span> <span class="ss">:controller</span><span class="p">,</span> <span class="ss">:template</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/attr_internal.rb</code>.</p>

<h4 id="module-attributes">Module Attributes</h4>

<p>The macros <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_reader"><code class="language-plaintext highlighter-rouge">mattr_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_writer"><code class="language-plaintext highlighter-rouge">mattr_writer</code></a>, and <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_accessor"><code class="language-plaintext highlighter-rouge">mattr_accessor</code></a> are the same as the <code class="language-plaintext highlighter-rouge">cattr_*</code> macros defined for class. In fact, the <code class="language-plaintext highlighter-rouge">cattr_*</code> macros are just aliases for the <code class="language-plaintext highlighter-rouge">mattr_*</code> macros. Check <a href="#class-attributes">Class Attributes</a>.</p>

<p>For example, the API for the logger of Active Storage is generated with <code class="language-plaintext highlighter-rouge">mattr_accessor</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">ActiveStorage</span>
  <span class="n">mattr_accessor</span> <span class="ss">:logger</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/attribute_accessors.rb</code>.</p>

<h3 id="parents">Parents</h3>

<h4 id="module_parent"><code class="language-plaintext highlighter-rouge">module_parent</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parent"><code class="language-plaintext highlighter-rouge">module_parent</code></a> method on a nested named module returns the module that contains its corresponding constant:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent</span> <span class="c1"># =&gt; X::Y</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent</span>       <span class="c1"># =&gt; X::Y</span>
</code></pre></div></div>

<p>If the module is anonymous or belongs to the top-level, <code class="language-plaintext highlighter-rouge">module_parent</code> returns <code class="language-plaintext highlighter-rouge">Object</code>.</p>

<p>WARNING: Note that in that case <code class="language-plaintext highlighter-rouge">module_parent_name</code> returns <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/introspection.rb</code>.</p>

<h4 id="module_parent_name"><code class="language-plaintext highlighter-rouge">module_parent_name</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parent_name"><code class="language-plaintext highlighter-rouge">module_parent_name</code></a> method on a nested named module returns the fully qualified name of the module that contains its corresponding constant:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent_name</span> <span class="c1"># =&gt; "X::Y"</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent_name</span>       <span class="c1"># =&gt; "X::Y"</span>
</code></pre></div></div>

<p>For top-level or anonymous modules <code class="language-plaintext highlighter-rouge">module_parent_name</code> returns <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>WARNING: Note that in that case <code class="language-plaintext highlighter-rouge">module_parent</code> returns <code class="language-plaintext highlighter-rouge">Object</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/introspection.rb</code>.</p>

<h4 id="module_parents"><code class="language-plaintext highlighter-rouge">module_parents</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parents"><code class="language-plaintext highlighter-rouge">module_parents</code></a> calls <code class="language-plaintext highlighter-rouge">module_parent</code> on the receiver and upwards until <code class="language-plaintext highlighter-rouge">Object</code> is reached. The chain is returned in an array, from bottom to top:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parents</span> <span class="c1"># =&gt; [X::Y, X, Object]</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parents</span>       <span class="c1"># =&gt; [X::Y, X, Object]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/introspection.rb</code>.</p>

<h3 id="anonymous">Anonymous</h3>

<p>A module may or may not have a name:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "M"</span>

<span class="no">N</span> <span class="o">=</span> <span class="no">Module</span><span class="p">.</span><span class="nf">new</span>
<span class="no">N</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "N"</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; nil</span>
</code></pre></div></div>

<p>You can check whether a module has a name with the predicate <a href="https://api.rubyonrails.org/classes/Module.html#method-i-anonymous-3F"><code class="language-plaintext highlighter-rouge">anonymous?</code></a>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>Note that being unreachable does not imply being anonymous:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>

<span class="n">m</span> <span class="o">=</span> <span class="no">Object</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:remove_const</span><span class="p">,</span> <span class="ss">:M</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>though an anonymous module is unreachable by definition.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/anonymous.rb</code>.</p>

<h3 id="method-delegation">Method Delegation</h3>

<h4 id="delegate"><code class="language-plaintext highlighter-rouge">delegate</code></h4>

<p>The macro <a href="https://api.rubyonrails.org/classes/Module.html#method-i-delegate"><code class="language-plaintext highlighter-rouge">delegate</code></a> offers an easy way to forward methods.</p>

<p>Let’s imagine that users in some application have login information in the <code class="language-plaintext highlighter-rouge">User</code> model but name and other data in a separate <code class="language-plaintext highlighter-rouge">Profile</code> model:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre></div></div>

<p>With that configuration you get a user’s name via their profile, <code class="language-plaintext highlighter-rouge">user.profile.name</code>, but it could be handy to still be able to access such attribute directly:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>That is what <code class="language-plaintext highlighter-rouge">delegate</code> does for you:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It is shorter, and the intention more obvious.</p>

<p>The method must be public in the target.</p>

<p>The <code class="language-plaintext highlighter-rouge">delegate</code> macro accepts several methods:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:twitter</span><span class="p">,</span> <span class="ss">to: :profile</span>
</code></pre></div></div>

<p>When interpolated into a string, the <code class="language-plaintext highlighter-rouge">:to</code> option should become an expression that evaluates to the object the method is delegated to. Typically a string or symbol. Such an expression is evaluated in the context of the receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># delegates to the Rails constant</span>
<span class="n">delegate</span> <span class="ss">:logger</span><span class="p">,</span> <span class="ss">to: :Rails</span>

<span class="c1"># delegates to the receiver's class</span>
<span class="n">delegate</span> <span class="ss">:table_name</span><span class="p">,</span> <span class="ss">to: :class</span>
</code></pre></div></div>

<p>WARNING: If the <code class="language-plaintext highlighter-rouge">:prefix</code> option is <code class="language-plaintext highlighter-rouge">true</code> this is less generic, see below.</p>

<p>By default, if the delegation raises <code class="language-plaintext highlighter-rouge">NoMethodError</code> and the target is <code class="language-plaintext highlighter-rouge">nil</code> the exception is propagated. You can ask that <code class="language-plaintext highlighter-rouge">nil</code> is returned instead with the <code class="language-plaintext highlighter-rouge">:allow_nil</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
</code></pre></div></div>

<p>With <code class="language-plaintext highlighter-rouge">:allow_nil</code> the call <code class="language-plaintext highlighter-rouge">user.name</code> returns <code class="language-plaintext highlighter-rouge">nil</code> if the user has no profile.</p>

<p>The option <code class="language-plaintext highlighter-rouge">:prefix</code> adds a prefix to the name of the generated method. This may be handy for example to get a better name:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delegate</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">to: :address</span><span class="p">,</span> <span class="ss">prefix: </span><span class="kp">true</span>
</code></pre></div></div>

<p>The previous example generates <code class="language-plaintext highlighter-rouge">address_street</code> rather than <code class="language-plaintext highlighter-rouge">street</code>.</p>

<p>WARNING: Since in this case the name of the generated method is composed of the target object and target method names, the <code class="language-plaintext highlighter-rouge">:to</code> option must be a method name.</p>

<p>A custom prefix may also be configured:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delegate</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">to: :attachment</span><span class="p">,</span> <span class="ss">prefix: :avatar</span>
</code></pre></div></div>

<p>In the previous example the macro generates <code class="language-plaintext highlighter-rouge">avatar_size</code> rather than <code class="language-plaintext highlighter-rouge">size</code>.</p>

<p>The option <code class="language-plaintext highlighter-rouge">:private</code> changes methods scope:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delegate</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">private: </span><span class="kp">true</span>
</code></pre></div></div>

<p>The delegated methods are public by default. Pass <code class="language-plaintext highlighter-rouge">private: true</code> to change that.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/delegation.rb</code></p>

<h4 id="delegate_missing_to"><code class="language-plaintext highlighter-rouge">delegate_missing_to</code></h4>

<p>Imagine you would like to delegate everything missing from the <code class="language-plaintext highlighter-rouge">User</code> object,
to the <code class="language-plaintext highlighter-rouge">Profile</code> one. The <a href="https://api.rubyonrails.org/classes/Module.html#method-i-delegate_missing_to"><code class="language-plaintext highlighter-rouge">delegate_missing_to</code></a> macro lets you implement this
in a breeze:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate_missing_to</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The target can be anything callable within the object, e.g. instance variables,
methods, constants, etc. Only the public methods of the target are delegated.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/delegation.rb</code>.</p>

<h3 id="redefining-methods">Redefining Methods</h3>

<p>There are cases where you need to define a method with <code class="language-plaintext highlighter-rouge">define_method</code>, but don’t know whether a method with that name already exists. If it does, a warning is issued if they are enabled. No big deal, but not clean either.</p>

<p>The method <a href="https://api.rubyonrails.org/classes/Module.html#method-i-redefine_method"><code class="language-plaintext highlighter-rouge">redefine_method</code></a> prevents such a potential warning, removing the existing method before if needed.</p>

<p>You can also use <a href="https://api.rubyonrails.org/classes/Module.html#method-i-silence_redefinition_of_method"><code class="language-plaintext highlighter-rouge">silence_redefinition_of_method</code></a> if you need to define
the replacement method yourself (because you’re using <code class="language-plaintext highlighter-rouge">delegate</code>, for
example).</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/redefine_method.rb</code>.</p>

<h2 id="extensions-to-class">Extensions to <code class="language-plaintext highlighter-rouge">Class</code></h2>

<h3 id="class-attributes">Class Attributes</h3>

<h4 id="class_attribute"><code class="language-plaintext highlighter-rouge">class_attribute</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Class.html#method-i-class_attribute"><code class="language-plaintext highlighter-rouge">class_attribute</code></a> declares one or more inheritable class attributes that can be overridden at any level down the hierarchy.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">A</span><span class="p">;</span> <span class="k">end</span>

<span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>

<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:b</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>

<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:c</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>
</code></pre></div></div>

<p>For example <code class="language-plaintext highlighter-rouge">ActionMailer::Base</code> defines:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">class_attribute</span> <span class="ss">:default_params</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">default_params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">mime_version: </span><span class="s2">"1.0"</span><span class="p">,</span>
  <span class="ss">charset: </span><span class="s2">"UTF-8"</span><span class="p">,</span>
  <span class="ss">content_type: </span><span class="s2">"text/plain"</span><span class="p">,</span>
  <span class="ss">parts_order: </span><span class="p">[</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"text/enriched"</span><span class="p">,</span> <span class="s2">"text/html"</span> <span class="p">]</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre></div></div>

<p>They can also be accessed and overridden at the instance level.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a1</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">a1</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 1, comes from A</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 2, overridden in a2</span>
</code></pre></div></div>

<p>The generation of the writer instance method can be prevented by setting the option <code class="language-plaintext highlighter-rouge">:instance_writer</code> to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">ActiveRecord</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">class_attribute</span> <span class="ss">:table_name_prefix</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"my"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A model may find that option useful as a way to prevent mass-assignment from setting the attribute.</p>

<p>The generation of the reader instance method can be prevented by setting the option <code class="language-plaintext highlighter-rouge">:instance_reader</code> to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
<span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># NoMethodError</span>
</code></pre></div></div>

<p>For convenience <code class="language-plaintext highlighter-rouge">class_attribute</code> also defines an instance predicate which is the double negation of what the instance reader returns. In the examples above it would be called <code class="language-plaintext highlighter-rouge">x?</code>.</p>

<p>When <code class="language-plaintext highlighter-rouge">:instance_reader</code> is <code class="language-plaintext highlighter-rouge">false</code>, the instance predicate returns a <code class="language-plaintext highlighter-rouge">NoMethodError</code> just like the reader method.</p>

<p>If you do not want the instance predicate, pass <code class="language-plaintext highlighter-rouge">instance_predicate: false</code> and it will not be defined.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/class/attribute.rb</code>.</p>

<h4 id="cattr_reader-cattr_writer-and-cattr_accessor"><code class="language-plaintext highlighter-rouge">cattr_reader</code>, <code class="language-plaintext highlighter-rouge">cattr_writer</code>, and <code class="language-plaintext highlighter-rouge">cattr_accessor</code></h4>

<p>The macros <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_reader"><code class="language-plaintext highlighter-rouge">cattr_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_writer"><code class="language-plaintext highlighter-rouge">cattr_writer</code></a>, and <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_accessor"><code class="language-plaintext highlighter-rouge">cattr_accessor</code></a> are analogous to their <code class="language-plaintext highlighter-rouge">attr_*</code> counterparts but for classes. They initialize a class variable to <code class="language-plaintext highlighter-rouge">nil</code> unless it already exists, and generate the corresponding class methods to access it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Generates class methods to access @@emulate_booleans.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Also, you can pass a block to <code class="language-plaintext highlighter-rouge">cattr_*</code> to set up the attribute with a default value:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Generates class methods to access @@emulate_booleans with default value of true.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Instance methods are created as well for convenience, they are just proxies to the class attribute. So, instances can change the class attribute, but cannot override it as it happens with <code class="language-plaintext highlighter-rouge">class_attribute</code> (see above). For example given</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">cattr_accessor</span> <span class="ss">:field_error_proc</span><span class="p">,</span> <span class="ss">default: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span>
      <span class="c1"># ...</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>we can access <code class="language-plaintext highlighter-rouge">field_error_proc</code> in views.</p>

<p>The generation of the reader instance method can be prevented by setting <code class="language-plaintext highlighter-rouge">:instance_reader</code> to <code class="language-plaintext highlighter-rouge">false</code> and the generation of the writer instance method can be prevented by setting <code class="language-plaintext highlighter-rouge">:instance_writer</code> to <code class="language-plaintext highlighter-rouge">false</code>. Generation of both methods can be prevented by setting <code class="language-plaintext highlighter-rouge">:instance_accessor</code> to <code class="language-plaintext highlighter-rouge">false</code>. In all cases, the value must be exactly <code class="language-plaintext highlighter-rouge">false</code> and not any false value.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">A</span>
  <span class="k">class</span> <span class="nc">B</span>
    <span class="c1"># No first_name instance reader is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
    <span class="c1"># No last_name= instance writer is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span>
    <span class="c1"># No surname instance reader or surname= writer is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:surname</span><span class="p">,</span> <span class="ss">instance_accessor: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A model may find it useful to set <code class="language-plaintext highlighter-rouge">:instance_accessor</code> to <code class="language-plaintext highlighter-rouge">false</code> as a way to prevent mass-assignment from setting the attribute.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/module/attribute_accessors.rb</code>.</p>

<h3 id="subclasses-and-descendants">Subclasses and Descendants</h3>

<h4 id="subclasses"><code class="language-plaintext highlighter-rouge">subclasses</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/Class.html#method-i-subclasses"><code class="language-plaintext highlighter-rouge">subclasses</code></a> method returns the subclasses of the receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B, D]</span>
</code></pre></div></div>

<p>The order in which these classes are returned is unspecified.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/class/subclasses.rb</code>.</p>

<h4 id="descendants"><code class="language-plaintext highlighter-rouge">descendants</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/Class.html#method-i-descendants"><code class="language-plaintext highlighter-rouge">descendants</code></a> method returns all classes that are <code class="language-plaintext highlighter-rouge">&lt;</code> than its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A, D]</span>
</code></pre></div></div>

<p>The order in which these classes are returned is unspecified.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/class/subclasses.rb</code>.</p>

<h2 id="extensions-to-string">Extensions to <code class="language-plaintext highlighter-rouge">String</code></h2>

<h3 id="output-safety">Output Safety</h3>

<h4 id="motivation">Motivation</h4>

<p>Inserting data into HTML templates needs extra care. For example, you can’t just interpolate <code class="language-plaintext highlighter-rouge">@review.title</code> verbatim into an HTML page. For one thing, if the review title is “Flanagan &amp; Matz rules!” the output won’t be well-formed because an ampersand has to be escaped as “&amp;amp;”. What’s more, depending on the application, that may be a big security hole because users can inject malicious HTML setting a hand-crafted review title. Check out the section about cross-site scripting in the <a href="security.html#cross-site-scripting-xss">Security guide</a> for further information about the risks.</p>

<h4 id="safe-strings">Safe Strings</h4>

<p>Active Support has the concept of <em>(html) safe</em> strings. A safe string is one that is marked as being insertable into HTML as is. It is trusted, no matter whether it has been escaped or not.</p>

<p>Strings are considered to be <em>unsafe</em> by default:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>You can obtain a safe string from a given one with the <a href="https://api.rubyonrails.org/classes/String.html#method-i-html_safe"><code class="language-plaintext highlighter-rouge">html_safe</code></a> method:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>It is important to understand that <code class="language-plaintext highlighter-rouge">html_safe</code> performs no escaping whatsoever, it is just an assertion:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="s2">"&lt;script&gt;...&lt;/script&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
<span class="n">s</span>            <span class="c1"># =&gt; "&lt;script&gt;...&lt;/script&gt;"</span>
</code></pre></div></div>

<p>It is your responsibility to ensure calling <code class="language-plaintext highlighter-rouge">html_safe</code> on a particular string is fine.</p>

<p>If you append onto a safe string, either in-place with <code class="language-plaintext highlighter-rouge">concat</code>/<code class="language-plaintext highlighter-rouge">&lt;&lt;</code>, or with <code class="language-plaintext highlighter-rouge">+</code>, the result is a safe string. Unsafe arguments are escaped:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span> <span class="c1"># =&gt; "&amp;lt;"</span>
</code></pre></div></div>

<p>Safe arguments are directly appended:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="c1"># =&gt; "&lt;"</span>
</code></pre></div></div>

<p>These methods should not be used in ordinary views. Unsafe values are automatically escaped:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="vi">@review</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# fine, escaped if needed %&gt;</span>
</code></pre></div></div>

<p>To insert something verbatim use the <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw"><code class="language-plaintext highlighter-rouge">raw</code></a> helper rather than calling <code class="language-plaintext highlighter-rouge">html_safe</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre></div></div>

<p>or, equivalently, use <code class="language-plaintext highlighter-rouge">&lt;%==</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span><span class="o">=</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">raw</code> helper calls <code class="language-plaintext highlighter-rouge">html_safe</code> for you:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="n">stringish</span><span class="p">)</span>
  <span class="n">stringish</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/output_safety.rb</code>.</p>

<h4 id="transformation">Transformation</h4>

<p>As a rule of thumb, except perhaps for concatenation as explained above, any method that may change a string gives you an unsafe string. These are <code class="language-plaintext highlighter-rouge">downcase</code>, <code class="language-plaintext highlighter-rouge">gsub</code>, <code class="language-plaintext highlighter-rouge">strip</code>, <code class="language-plaintext highlighter-rouge">chomp</code>, <code class="language-plaintext highlighter-rouge">underscore</code>, etc.</p>

<p>In the case of in-place transformations like <code class="language-plaintext highlighter-rouge">gsub!</code> the receiver itself becomes unsafe.</p>

<p>INFO: The safety bit is lost always, no matter whether the transformation actually changed something.</p>

<h4 id="conversion-and-coercion">Conversion and Coercion</h4>

<p>Calling <code class="language-plaintext highlighter-rouge">to_s</code> on a safe string returns a safe string, but coercion with <code class="language-plaintext highlighter-rouge">to_str</code> returns an unsafe string.</p>

<h4 id="copying">Copying</h4>

<p>Calling <code class="language-plaintext highlighter-rouge">dup</code> or <code class="language-plaintext highlighter-rouge">clone</code> on safe strings yields safe strings.</p>

<h3 id="remove"><code class="language-plaintext highlighter-rouge">remove</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-remove"><code class="language-plaintext highlighter-rouge">remove</code></a> will remove all occurrences of the pattern:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sr">/Hello /</span><span class="p">)</span> <span class="c1"># =&gt; "World"</span>
</code></pre></div></div>

<p>There’s also the destructive version <code class="language-plaintext highlighter-rouge">String#remove!</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/filters.rb</code>.</p>

<h3 id="squish"><code class="language-plaintext highlighter-rouge">squish</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-squish"><code class="language-plaintext highlighter-rouge">squish</code></a> strips leading and trailing whitespace, and substitutes runs of whitespace with a single space each:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">" </span><span class="se">\n</span><span class="s2">  foo</span><span class="se">\n\r</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> bar </span><span class="se">\n</span><span class="s2">"</span><span class="p">.</span><span class="nf">squish</span> <span class="c1"># =&gt; "foo bar"</span>
</code></pre></div></div>

<p>There’s also the destructive version <code class="language-plaintext highlighter-rouge">String#squish!</code>.</p>

<p>Note that it handles both ASCII and Unicode whitespace.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/filters.rb</code>.</p>

<h3 id="truncate"><code class="language-plaintext highlighter-rouge">truncate</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate"><code class="language-plaintext highlighter-rouge">truncate</code></a> returns a copy of its receiver truncated after a given <code class="language-plaintext highlighter-rouge">length</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre></div></div>

<p>Ellipsis can be customized with the <code class="language-plaintext highlighter-rouge">:omission</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"&amp;hellip;"</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh &amp;hellip;"</span>
</code></pre></div></div>

<p>Note in particular that truncation takes into account the length of the omission string.</p>

<p>Pass a <code class="language-plaintext highlighter-rouge">:separator</code> to truncate the string at a natural break:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dea..."</span>
<span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">" "</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre></div></div>

<p>The option <code class="language-plaintext highlighter-rouge">:separator</code> can be a regexp:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre></div></div>

<p>In above examples “dear” gets cut first, but then <code class="language-plaintext highlighter-rouge">:separator</code> prevents it.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/filters.rb</code>.</p>

<h3 id="truncate_bytes"><code class="language-plaintext highlighter-rouge">truncate_bytes</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate_bytes"><code class="language-plaintext highlighter-rouge">truncate_bytes</code></a> returns a copy of its receiver truncated to at most <code class="language-plaintext highlighter-rouge">bytesize</code> bytes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍👍…"</span>
</code></pre></div></div>

<p>Ellipsis can be customized with the <code class="language-plaintext highlighter-rouge">:omission</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"🖖"</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍🖖"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/filters.rb</code>.</p>

<h3 id="truncate_words"><code class="language-plaintext highlighter-rouge">truncate_words</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate_words"><code class="language-plaintext highlighter-rouge">truncate_words</code></a> returns a copy of its receiver truncated after a given number of words:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre></div></div>

<p>Ellipsis can be customized with the <code class="language-plaintext highlighter-rouge">:omission</code> option:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"&amp;hellip;"</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!&amp;hellip;"</span>
</code></pre></div></div>

<p>Pass a <code class="language-plaintext highlighter-rouge">:separator</code> to truncate the string at a natural break:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">"!"</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear! I shall be late..."</span>
</code></pre></div></div>

<p>The option <code class="language-plaintext highlighter-rouge">:separator</code> can be a regexp:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/filters.rb</code>.</p>

<h3 id="inquiry"><code class="language-plaintext highlighter-rouge">inquiry</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-inquiry"><code class="language-plaintext highlighter-rouge">inquiry</code></a> method converts a string into a <code class="language-plaintext highlighter-rouge">StringInquirer</code> object making equality checks prettier.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"production"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">production?</span> <span class="c1"># =&gt; true</span>
<span class="s2">"active"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">inactive?</span>       <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inquiry.rb</code>.</p>

<h3 id="starts_with-and-ends_with"><code class="language-plaintext highlighter-rouge">starts_with?</code> and <code class="language-plaintext highlighter-rouge">ends_with?</code></h3>

<p>Active Support defines 3rd person aliases of <code class="language-plaintext highlighter-rouge">String#start_with?</code> and <code class="language-plaintext highlighter-rouge">String#end_with?</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"foo"</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/starts_ends_with.rb</code>.</p>

<h3 id="strip_heredoc"><code class="language-plaintext highlighter-rouge">strip_heredoc</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-strip_heredoc"><code class="language-plaintext highlighter-rouge">strip_heredoc</code></a> strips indentation in heredocs.</p>

<p>For example in</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:usage</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="p">.</span><span class="nf">strip_heredoc</span><span class="sh">
    This command does such and such.

    Supported options are:
      -h         This message
      ...
</span><span class="no">  USAGE</span>
<span class="k">end</span>
</code></pre></div></div>

<p>the user would see the usage message aligned against the left margin.</p>

<p>Technically, it looks for the least indented line in the whole string, and removes
that amount of leading whitespace.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/strip.rb</code>.</p>

<h3 id="indent"><code class="language-plaintext highlighter-rouge">indent</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-indent"><code class="language-plaintext highlighter-rouge">indent</code></a> method indents the lines in the receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;&lt;</span><span class="no">EOS</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="sh">
def some_method
  some_code
end
</span><span class="no">EOS</span>
<span class="c1"># =&gt;</span>
  <span class="k">def</span> <span class="nf">some_method</span>
    <span class="n">some_code</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>The second argument, <code class="language-plaintext highlighter-rouge">indent_string</code>, specifies which indent string to use. The default is <code class="language-plaintext highlighter-rouge">nil</code>, which tells the method to make an educated guess peeking at the first indented line, and fallback to a space if there is none.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"  foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>        <span class="c1"># =&gt; "    foo"</span>
<span class="s2">"foo</span><span class="se">\n\t\t</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "\t\tfoo\n\t\t\t\tbar"</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>    <span class="c1"># =&gt; "\t\tfoo"</span>
</code></pre></div></div>

<p>While <code class="language-plaintext highlighter-rouge">indent_string</code> is typically one space or tab, it may be any string.</p>

<p>The third argument, <code class="language-plaintext highlighter-rouge">indent_empty_lines</code>, is a flag that says whether empty lines should be indented. Default is false.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>            <span class="c1"># =&gt; "  foo\n\n  bar"</span>
<span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "  foo\n  \n  bar"</span>
</code></pre></div></div>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-indent-21"><code class="language-plaintext highlighter-rouge">indent!</code></a> method performs indentation in-place.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/indent.rb</code>.</p>

<h3 id="access">Access</h3>

<h4 id="atposition"><code class="language-plaintext highlighter-rouge">at(position)</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-at"><code class="language-plaintext highlighter-rouge">at</code></a> method returns the character of the string at position <code class="language-plaintext highlighter-rouge">position</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/access.rb</code>.</p>

<h4 id="fromposition"><code class="language-plaintext highlighter-rouge">from(position)</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-from"><code class="language-plaintext highlighter-rouge">from</code></a> method returns the substring of the string starting at position <code class="language-plaintext highlighter-rouge">position</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "hello"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "llo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "lo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/access.rb</code>.</p>

<h4 id="toposition"><code class="language-plaintext highlighter-rouge">to(position)</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-to"><code class="language-plaintext highlighter-rouge">to</code></a> method returns the substring of the string up to position <code class="language-plaintext highlighter-rouge">position</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "hel"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "hell"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; "hello"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/access.rb</code>.</p>

<h4 id="firstlimit--1"><code class="language-plaintext highlighter-rouge">first(limit = 1)</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-first"><code class="language-plaintext highlighter-rouge">first</code></a> method returns a substring containing the first <code class="language-plaintext highlighter-rouge">limit</code> characters of the string.</p>

<p>The call <code class="language-plaintext highlighter-rouge">str.first(n)</code> is equivalent to <code class="language-plaintext highlighter-rouge">str.to(n-1)</code> if <code class="language-plaintext highlighter-rouge">n</code> &gt; 0, and returns an empty string for <code class="language-plaintext highlighter-rouge">n</code> == 0.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/access.rb</code>.</p>

<h4 id="lastlimit--1"><code class="language-plaintext highlighter-rouge">last(limit = 1)</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-last"><code class="language-plaintext highlighter-rouge">last</code></a> method returns a substring containing the last <code class="language-plaintext highlighter-rouge">limit</code> characters of the string.</p>

<p>The call <code class="language-plaintext highlighter-rouge">str.last(n)</code> is equivalent to <code class="language-plaintext highlighter-rouge">str.from(-n)</code> if <code class="language-plaintext highlighter-rouge">n</code> &gt; 0, and returns an empty string for <code class="language-plaintext highlighter-rouge">n</code> == 0.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/access.rb</code>.</p>

<h3 id="inflections">Inflections</h3>

<h4 id="pluralize"><code class="language-plaintext highlighter-rouge">pluralize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-pluralize"><code class="language-plaintext highlighter-rouge">pluralize</code></a> returns the plural of its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"table"</span><span class="p">.</span><span class="nf">pluralize</span>     <span class="c1"># =&gt; "tables"</span>
<span class="s2">"ruby"</span><span class="p">.</span><span class="nf">pluralize</span>      <span class="c1"># =&gt; "rubies"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">pluralize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre></div></div>

<p>As the previous example shows, Active Support knows some irregular plurals and uncountable nouns. Built-in rules can be extended in <code class="language-plaintext highlighter-rouge">config/initializers/inflections.rb</code>. This file is generated by default, by the <code class="language-plaintext highlighter-rouge">rails new</code> command and has instructions in comments.</p>

<p><code class="language-plaintext highlighter-rouge">pluralize</code> can also take an optional <code class="language-plaintext highlighter-rouge">count</code> parameter. If <code class="language-plaintext highlighter-rouge">count == 1</code> the singular form will be returned. For any other value of <code class="language-plaintext highlighter-rouge">count</code> the plural form will be returned:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "dude"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
</code></pre></div></div>

<p>Active Record uses this method to compute the default table name that corresponds to a model:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># active_record/model_schema.rb</span>
<span class="k">def</span> <span class="nf">undecorated_table_name</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
  <span class="n">table_name</span> <span class="o">=</span> <span class="n">model_name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">pluralize_table_names</span> <span class="p">?</span> <span class="n">table_name</span><span class="p">.</span><span class="nf">pluralize</span> <span class="p">:</span> <span class="n">table_name</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="singularize"><code class="language-plaintext highlighter-rouge">singularize</code></h4>

<p>The <a href="https://api.rubyonrails.org/classes/String.html#method-i-singularize"><code class="language-plaintext highlighter-rouge">singularize</code></a> method is the inverse of <code class="language-plaintext highlighter-rouge">pluralize</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"tables"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "table"</span>
<span class="s2">"rubies"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "ruby"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">singularize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre></div></div>

<p>Associations compute the name of the corresponding default associated class using this method:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">derive_class_name</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">.</span><span class="nf">singularize</span> <span class="k">if</span> <span class="n">collection?</span>
  <span class="n">class_name</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="camelize"><code class="language-plaintext highlighter-rouge">camelize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-camelize"><code class="language-plaintext highlighter-rouge">camelize</code></a> returns its receiver in camel case:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"product"</span><span class="p">.</span><span class="nf">camelize</span>    <span class="c1"># =&gt; "Product"</span>
<span class="s2">"admin_user"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "AdminUser"</span>
</code></pre></div></div>

<p>As a rule of thumb you can think of this method as the one that transforms paths into Ruby class or module names, where slashes separate namespaces:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"backoffice/session"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "Backoffice::Session"</span>
</code></pre></div></div>

<p>For example, Action Pack uses this method to load the class that provides a certain session store:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># action_controller/metal/session_management.rb</span>
<span class="k">def</span> <span class="nf">session_store</span><span class="o">=</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
  <span class="vc">@@session_store</span> <span class="o">=</span> <span class="n">store</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span>
    <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">Session</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">store</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">camelize</code> accepts an optional argument, it can be <code class="language-plaintext highlighter-rouge">:upper</code> (default), or <code class="language-plaintext highlighter-rouge">:lower</code>. With the latter the first letter becomes lowercase:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"visual_effect"</span><span class="p">.</span><span class="nf">camelize</span><span class="p">(</span><span class="ss">:lower</span><span class="p">)</span> <span class="c1"># =&gt; "visualEffect"</span>
</code></pre></div></div>

<p>That may be handy to compute method names in a language that follows that convention, for example JavaScript.</p>

<p>INFO: As a rule of thumb you can think of <code class="language-plaintext highlighter-rouge">camelize</code> as the inverse of <code class="language-plaintext highlighter-rouge">underscore</code>, though there are cases where that does not hold: <code class="language-plaintext highlighter-rouge">"SSLError".underscore.camelize</code> gives back <code class="language-plaintext highlighter-rouge">"SslError"</code>. To support cases such as this, Active Support allows you to specify acronyms in <code class="language-plaintext highlighter-rouge">config/initializers/inflections.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="p">.</span><span class="nf">acronym</span> <span class="s2">"SSL"</span>
<span class="k">end</span>

<span class="s2">"SSLError"</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "SSLError"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">camelize</code> is aliased to <a href="https://api.rubyonrails.org/classes/String.html#method-i-camelcase"><code class="language-plaintext highlighter-rouge">camelcase</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="underscore"><code class="language-plaintext highlighter-rouge">underscore</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-underscore"><code class="language-plaintext highlighter-rouge">underscore</code></a> goes the other way around, from camel case to paths:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Product"</span><span class="p">.</span><span class="nf">underscore</span>   <span class="c1"># =&gt; "product"</span>
<span class="s2">"AdminUser"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "admin_user"</span>
</code></pre></div></div>

<p>Also converts “::” back to “/”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Backoffice::Session"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "backoffice/session"</span>
</code></pre></div></div>

<p>and understands strings that start with lowercase:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"visualEffect"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "visual_effect"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">underscore</code> accepts no argument though.</p>

<p>Rails uses <code class="language-plaintext highlighter-rouge">underscore</code> to get a lowercased name for controller classes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># actionpack/lib/abstract_controller/base.rb</span>
<span class="k">def</span> <span class="nf">controller_path</span>
  <span class="vi">@controller_path</span> <span class="o">||=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">).</span><span class="nf">underscore</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For example, that value is the one you get in <code class="language-plaintext highlighter-rouge">params[:controller]</code>.</p>

<p>INFO: As a rule of thumb you can think of <code class="language-plaintext highlighter-rouge">underscore</code> as the inverse of <code class="language-plaintext highlighter-rouge">camelize</code>, though there are cases where that does not hold. For example, <code class="language-plaintext highlighter-rouge">"SSLError".underscore.camelize</code> gives back <code class="language-plaintext highlighter-rouge">"SslError"</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="titleize"><code class="language-plaintext highlighter-rouge">titleize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-titleize"><code class="language-plaintext highlighter-rouge">titleize</code></a> capitalizes the words in the receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"alice in wonderland"</span><span class="p">.</span><span class="nf">titleize</span> <span class="c1"># =&gt; "Alice In Wonderland"</span>
<span class="s2">"fermat's enigma"</span><span class="p">.</span><span class="nf">titleize</span>     <span class="c1"># =&gt; "Fermat's Enigma"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">titleize</code> is aliased to <a href="https://api.rubyonrails.org/classes/String.html#method-i-titlecase"><code class="language-plaintext highlighter-rouge">titlecase</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="dasherize"><code class="language-plaintext highlighter-rouge">dasherize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-dasherize"><code class="language-plaintext highlighter-rouge">dasherize</code></a> replaces the underscores in the receiver with dashes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"name"</span><span class="p">.</span><span class="nf">dasherize</span>         <span class="c1"># =&gt; "name"</span>
<span class="s2">"contact_data"</span><span class="p">.</span><span class="nf">dasherize</span> <span class="c1"># =&gt; "contact-data"</span>
</code></pre></div></div>

<p>The XML serializer of models uses this method to dasherize node names:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># active_model/serializers/xml.rb</span>
<span class="k">def</span> <span class="nf">reformat_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">camelize</span> <span class="k">if</span> <span class="n">camelize?</span>
  <span class="n">dasherize?</span> <span class="p">?</span> <span class="nb">name</span><span class="p">.</span><span class="nf">dasherize</span> <span class="p">:</span> <span class="nb">name</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="demodulize"><code class="language-plaintext highlighter-rouge">demodulize</code></h4>

<p>Given a string with a qualified constant name, <a href="https://api.rubyonrails.org/classes/String.html#method-i-demodulize"><code class="language-plaintext highlighter-rouge">demodulize</code></a> returns the very constant name, that is, the rightmost part of it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Product"</span><span class="p">.</span><span class="nf">demodulize</span>                        <span class="c1"># =&gt; "Product"</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">demodulize</span>    <span class="c1"># =&gt; "UsersController"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">demodulize</span> <span class="c1"># =&gt; "ReservationUtils"</span>
<span class="s2">"::Inflections"</span><span class="p">.</span><span class="nf">demodulize</span>                  <span class="c1"># =&gt; "Inflections"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">demodulize</span>                               <span class="c1"># =&gt; ""</span>
</code></pre></div></div>

<p>Active Record for example uses this method to compute the name of a counter cache column:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">counter_cache_column</span>
  <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">_count"</span>
  <span class="k">elsif</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="deconstantize"><code class="language-plaintext highlighter-rouge">deconstantize</code></h4>

<p>Given a string with a qualified constant reference expression, <a href="https://api.rubyonrails.org/classes/String.html#method-i-deconstantize"><code class="language-plaintext highlighter-rouge">deconstantize</code></a> removes the rightmost segment, generally leaving the name of the constant’s container:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Product"</span><span class="p">.</span><span class="nf">deconstantize</span>                        <span class="c1"># =&gt; ""</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">deconstantize</span>    <span class="c1"># =&gt; "Backoffice"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">deconstantize</span> <span class="c1"># =&gt; "Admin::Hotel"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="parameterize"><code class="language-plaintext highlighter-rouge">parameterize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-parameterize"><code class="language-plaintext highlighter-rouge">parameterize</code></a> normalizes its receiver in a way that can be used in pretty URLs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "john-smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "kurt-godel"</span>
</code></pre></div></div>

<p>To preserve the case of the string, set the <code class="language-plaintext highlighter-rouge">preserve_case</code> argument to true. By default, <code class="language-plaintext highlighter-rouge">preserve_case</code> is set to false.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "John-Smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "Kurt-Godel"</span>
</code></pre></div></div>

<p>To use a custom separator, override the <code class="language-plaintext highlighter-rouge">separator</code> argument.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "john_smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "kurt_godel"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="tableize"><code class="language-plaintext highlighter-rouge">tableize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-tableize"><code class="language-plaintext highlighter-rouge">tableize</code></a> is <code class="language-plaintext highlighter-rouge">underscore</code> followed by <code class="language-plaintext highlighter-rouge">pluralize</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Person"</span><span class="p">.</span><span class="nf">tableize</span>      <span class="c1"># =&gt; "people"</span>
<span class="s2">"Invoice"</span><span class="p">.</span><span class="nf">tableize</span>     <span class="c1"># =&gt; "invoices"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">tableize</span> <span class="c1"># =&gt; "invoice_lines"</span>
</code></pre></div></div>

<p>As a rule of thumb, <code class="language-plaintext highlighter-rouge">tableize</code> returns the table name that corresponds to a given model for simple cases. The actual implementation in Active Record is not straight <code class="language-plaintext highlighter-rouge">tableize</code> indeed, because it also demodulizes the class name and checks a few options that may affect the returned string.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="classify"><code class="language-plaintext highlighter-rouge">classify</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-classify"><code class="language-plaintext highlighter-rouge">classify</code></a> is the inverse of <code class="language-plaintext highlighter-rouge">tableize</code>. It gives you the class name corresponding to a table name:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"people"</span><span class="p">.</span><span class="nf">classify</span>        <span class="c1"># =&gt; "Person"</span>
<span class="s2">"invoices"</span><span class="p">.</span><span class="nf">classify</span>      <span class="c1"># =&gt; "Invoice"</span>
<span class="s2">"invoice_lines"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "InvoiceLine"</span>
</code></pre></div></div>

<p>The method understands qualified table names:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"highrise_production.companies"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "Company"</span>
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">classify</code> returns a class name as a string. You can get the actual class object by invoking <code class="language-plaintext highlighter-rouge">constantize</code> on it, explained next.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="constantize"><code class="language-plaintext highlighter-rouge">constantize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-constantize"><code class="language-plaintext highlighter-rouge">constantize</code></a> resolves the constant reference expression in its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Integer"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; Integer</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
<span class="s2">"M::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; 1</span>
</code></pre></div></div>

<p>If the string evaluates to no known constant, or its content is not even a valid constant name, <code class="language-plaintext highlighter-rouge">constantize</code> raises <code class="language-plaintext highlighter-rouge">NameError</code>.</p>

<p>Constant name resolution by <code class="language-plaintext highlighter-rouge">constantize</code> starts always at the top-level <code class="language-plaintext highlighter-rouge">Object</code> even if there is no leading “::”.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">X</span> <span class="o">=</span> <span class="ss">:in_Object</span>
<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="ss">:in_M</span>

  <span class="no">X</span>                 <span class="c1"># =&gt; :in_M</span>
  <span class="s2">"::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; :in_Object</span>
  <span class="s2">"X"</span><span class="p">.</span><span class="nf">constantize</span>   <span class="c1"># =&gt; :in_Object (!)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>So, it is in general not equivalent to what Ruby would do in the same spot, had a real constant be evaluated.</p>

<p>Mailer test cases obtain the mailer being tested from the name of the test class using <code class="language-plaintext highlighter-rouge">constantize</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># action_mailer/test_case.rb</span>
<span class="k">def</span> <span class="nf">determine_default_mailer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Test"</span><span class="p">).</span><span class="nf">constantize</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="no">NonInferrableMailerError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="humanize"><code class="language-plaintext highlighter-rouge">humanize</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-humanize"><code class="language-plaintext highlighter-rouge">humanize</code></a> tweaks an attribute name for display to end users.</p>

<p>Specifically, it performs these transformations:</p>

<ul>
  <li>Applies human inflection rules to the argument.</li>
  <li>Deletes leading underscores, if any.</li>
  <li>Removes a “_id” suffix if present.</li>
  <li>Replaces underscores with spaces, if any.</li>
  <li>Downcases all words except acronyms.</li>
  <li>Capitalizes the first word.</li>
</ul>

<p>The capitalization of the first word can be turned off by setting the
<code class="language-plaintext highlighter-rouge">:capitalize</code> option to false (default is true).</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"name"</span><span class="p">.</span><span class="nf">humanize</span>                         <span class="c1"># =&gt; "Name"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span>                    <span class="c1"># =&gt; "Author"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span><span class="p">(</span><span class="ss">capitalize: </span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "author"</span>
<span class="s2">"comments_count"</span><span class="p">.</span><span class="nf">humanize</span>               <span class="c1"># =&gt; "Comments count"</span>
<span class="s2">"_id"</span><span class="p">.</span><span class="nf">humanize</span>                          <span class="c1"># =&gt; "Id"</span>
</code></pre></div></div>

<p>If “SSL” was defined to be an acronym:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"ssl_error"</span><span class="p">.</span><span class="nf">humanize</span> <span class="c1"># =&gt; "SSL error"</span>
</code></pre></div></div>

<p>The helper method <code class="language-plaintext highlighter-rouge">full_messages</code> uses <code class="language-plaintext highlighter-rouge">humanize</code> as a fallback to include
attribute names:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">full_messages</span>
  <span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="n">full_message</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">full_message</span>
  <span class="c1"># ...</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">).</span><span class="nf">humanize</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="vi">@base</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">default: </span><span class="n">attr_name</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="foreign_key"><code class="language-plaintext highlighter-rouge">foreign_key</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-foreign_key"><code class="language-plaintext highlighter-rouge">foreign_key</code></a> gives a foreign key column name from a class name. To do so it demodulizes, underscores, and adds “_id”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span>           <span class="c1"># =&gt; "user_id"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">foreign_key</span>    <span class="c1"># =&gt; "invoice_line_id"</span>
<span class="s2">"Admin::Session"</span><span class="p">.</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; "session_id"</span>
</code></pre></div></div>

<p>Pass a false argument if you do not want the underscore in “_id”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "userid"</span>
</code></pre></div></div>

<p>Associations use this method to infer foreign keys, for example <code class="language-plaintext highlighter-rouge">has_one</code> and <code class="language-plaintext highlighter-rouge">has_many</code> do this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># active_record/associations.rb</span>
<span class="n">foreign_key</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:foreign_key</span><span class="p">]</span> <span class="o">||</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">foreign_key</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="upcase_first"><code class="language-plaintext highlighter-rouge">upcase_first</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-upcase_first"><code class="language-plaintext highlighter-rouge">upcase_first</code></a> capitalizes the first letter of the receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"employee salary"</span><span class="p">.</span><span class="nf">upcase_first</span> <span class="c1"># =&gt; "Employee salary"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">upcase_first</span>                <span class="c1"># =&gt; ""</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h4 id="downcase_first"><code class="language-plaintext highlighter-rouge">downcase_first</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/String.html#method-i-downcase_first"><code class="language-plaintext highlighter-rouge">downcase_first</code></a> converts the first letter of the receiver to lowercase:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"If I had read Alice in Wonderland"</span><span class="p">.</span><span class="nf">downcase_first</span> <span class="c1"># =&gt; "if I had read Alice in Wonderland"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">downcase_first</span>                                  <span class="c1"># =&gt; ""</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/inflections.rb</code>.</p>

<h3 id="conversions">Conversions</h3>

<h4 id="to_date-to_time-to_datetime"><code class="language-plaintext highlighter-rouge">to_date</code>, <code class="language-plaintext highlighter-rouge">to_time</code>, <code class="language-plaintext highlighter-rouge">to_datetime</code></h4>

<p>The methods <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_date"><code class="language-plaintext highlighter-rouge">to_date</code></a>, <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_time"><code class="language-plaintext highlighter-rouge">to_time</code></a>, and <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_datetime"><code class="language-plaintext highlighter-rouge">to_datetime</code></a> are basically convenience wrappers around <code class="language-plaintext highlighter-rouge">Date._parse</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"2010-07-27"</span><span class="p">.</span><span class="nf">to_date</span>              <span class="c1"># =&gt; Tue, 27 Jul 2010</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_time</span>     <span class="c1"># =&gt; 2010-07-27 23:37:00 +0200</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_datetime</span> <span class="c1"># =&gt; Tue, 27 Jul 2010 23:37:00 +0000</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">to_time</code> receives an optional argument <code class="language-plaintext highlighter-rouge">:utc</code> or <code class="language-plaintext highlighter-rouge">:local</code>, to indicate which time zone you want the time in:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:utc</span><span class="p">)</span>   <span class="c1"># =&gt; 2010-07-27 23:42:00 UTC</span>
<span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:local</span><span class="p">)</span> <span class="c1"># =&gt; 2010-07-27 23:42:00 +0200</span>
</code></pre></div></div>

<p>Default is <code class="language-plaintext highlighter-rouge">:local</code>.</p>

<p>Please refer to the documentation of <code class="language-plaintext highlighter-rouge">Date._parse</code> for further details.</p>

<p>INFO: The three of them return <code class="language-plaintext highlighter-rouge">nil</code> for blank receivers.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/string/conversions.rb</code>.</p>

<h2 id="extensions-to-symbol">Extensions to <code class="language-plaintext highlighter-rouge">Symbol</code></h2>

<h3 id="starts_with-and-ends_with-1"><code class="language-plaintext highlighter-rouge">starts_with?</code> and <code class="language-plaintext highlighter-rouge">ends_with?</code></h3>

<p>Active Support defines 3rd person aliases of <code class="language-plaintext highlighter-rouge">Symbol#start_with?</code> and <code class="language-plaintext highlighter-rouge">Symbol#end_with?</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">:foo</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="ss">:foo</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/symbol/starts_ends_with.rb</code>.</p>

<h2 id="extensions-to-numeric">Extensions to <code class="language-plaintext highlighter-rouge">Numeric</code></h2>

<h3 id="bytes">Bytes</h3>

<p>All numbers respond to these methods:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-bytes"><code class="language-plaintext highlighter-rouge">bytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-kilobytes"><code class="language-plaintext highlighter-rouge">kilobytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-megabytes"><code class="language-plaintext highlighter-rouge">megabytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-gigabytes"><code class="language-plaintext highlighter-rouge">gigabytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-terabytes"><code class="language-plaintext highlighter-rouge">terabytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-petabytes"><code class="language-plaintext highlighter-rouge">petabytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-exabytes"><code class="language-plaintext highlighter-rouge">exabytes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-zettabytes"><code class="language-plaintext highlighter-rouge">zettabytes</code></a></li>
</ul>

<p>They return the corresponding amount of bytes, using a conversion factor of 1024:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span><span class="p">.</span><span class="nf">kilobytes</span>   <span class="c1"># =&gt; 2048</span>
<span class="mi">3</span><span class="p">.</span><span class="nf">megabytes</span>   <span class="c1"># =&gt; 3145728</span>
<span class="mf">3.5</span><span class="p">.</span><span class="nf">gigabytes</span> <span class="c1"># =&gt; 3758096384.0</span>
<span class="o">-</span><span class="mi">4</span><span class="p">.</span><span class="nf">exabytes</span>   <span class="c1"># =&gt; -4611686018427387904</span>
</code></pre></div></div>

<p>Singular forms are aliased so you are able to say:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span><span class="nf">megabyte</span> <span class="c1"># =&gt; 1048576</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/numeric/bytes.rb</code>.</p>

<h3 id="time">Time</h3>

<p>The following methods:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-seconds"><code class="language-plaintext highlighter-rouge">seconds</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-minutes"><code class="language-plaintext highlighter-rouge">minutes</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-hours"><code class="language-plaintext highlighter-rouge">hours</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-days"><code class="language-plaintext highlighter-rouge">days</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-weeks"><code class="language-plaintext highlighter-rouge">weeks</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-fortnights"><code class="language-plaintext highlighter-rouge">fortnights</code></a></li>
</ul>

<p>enable time declarations and calculations, like <code class="language-plaintext highlighter-rouge">45.minutes + 2.hours + 4.weeks</code>. Their return values can also be added to or subtracted from Time objects.</p>

<p>These methods can be combined with <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-from_now"><code class="language-plaintext highlighter-rouge">from_now</code></a>, <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-ago"><code class="language-plaintext highlighter-rouge">ago</code></a>, etc, for precise date calculations. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># equivalent to Time.current.advance(days: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(weeks: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">weeks</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(days: 4, weeks: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">days</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">weeks</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre></div></div>

<p>WARNING. For other durations please refer to the time extensions to <code class="language-plaintext highlighter-rouge">Integer</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/numeric/time.rb</code>.</p>

<h3 id="formatting">Formatting</h3>

<p>Enables the formatting of numbers in a variety of ways.</p>

<p>Produce a string representation of a number as a telephone number:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">5551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 123-555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">" "</span><span class="p">)</span>
<span class="c1"># =&gt; 123 555 1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">extension: </span><span class="mi">555</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234 x 555</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">country_code: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; +1-123-555-1234</span>
</code></pre></div></div>

<p>Produce a string representation of a number as currency:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">1234567890.50</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                 <span class="c1"># =&gt; $1,234,567,890.50</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                <span class="c1"># =&gt; $1,234,567,890.51</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># =&gt; $1,234,567,890.506</span>
</code></pre></div></div>

<p>Produce a string representation of a number as a percentage:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">100</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">)</span>
<span class="c1"># =&gt; 100.000%</span>
<span class="mi">100</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 100%</span>
<span class="mi">1000</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">"."</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">","</span><span class="p">)</span>
<span class="c1"># =&gt; 1.000,000%</span>
<span class="mf">302.24398923423</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># =&gt; 302.24399%</span>
</code></pre></div></div>

<p>Produce a string representation of a number in delimited form:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                  <span class="c1"># =&gt; 12,345,678.05</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">"."</span><span class="p">)</span>     <span class="c1"># =&gt; 12.345.678</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">","</span><span class="p">)</span>     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">" "</span><span class="p">)</span>  <span class="c1"># =&gt; 12,345,678 05</span>
</code></pre></div></div>

<p>Produce a string representation of a number rounded to a precision:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">)</span>                     <span class="c1"># =&gt; 111.235</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># =&gt; 111.23</span>
<span class="mi">13</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>             <span class="c1"># =&gt; 13.00000</span>
<span class="mf">389.32314</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># =&gt; 389</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">significant: </span><span class="kp">true</span><span class="p">)</span>  <span class="c1"># =&gt; 111</span>
</code></pre></div></div>

<p>Produce a string representation of a number as a human-readable number of bytes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                  <span class="c1"># =&gt; 123 Bytes</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                 <span class="c1"># =&gt; 1.21 KB</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                <span class="c1"># =&gt; 12.1 KB</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>              <span class="c1"># =&gt; 1.18 MB</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>           <span class="c1"># =&gt; 1.15 GB</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>        <span class="c1"># =&gt; 1.12 TB</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>     <span class="c1"># =&gt; 1.1 PB</span>
<span class="mi">1234567890123456789</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>  <span class="c1"># =&gt; 1.07 EB</span>
</code></pre></div></div>

<p>Produce a string representation of a number in human-readable words:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>               <span class="c1"># =&gt; "123"</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>              <span class="c1"># =&gt; "1.23 Thousand"</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>             <span class="c1"># =&gt; "12.3 Thousand"</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>           <span class="c1"># =&gt; "1.23 Million"</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>        <span class="c1"># =&gt; "1.23 Billion"</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>     <span class="c1"># =&gt; "1.23 Trillion"</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>  <span class="c1"># =&gt; "1.23 Quadrillion"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/numeric/conversions.rb</code>.</p>

<h2 id="extensions-to-integer">Extensions to <code class="language-plaintext highlighter-rouge">Integer</code></h2>

<h3 id="multiple_of"><code class="language-plaintext highlighter-rouge">multiple_of?</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-multiple_of-3F"><code class="language-plaintext highlighter-rouge">multiple_of?</code></a> tests whether an integer is multiple of the argument:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/integer/multiple.rb</code>.</p>

<h3 id="ordinal"><code class="language-plaintext highlighter-rouge">ordinal</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-ordinal"><code class="language-plaintext highlighter-rouge">ordinal</code></a> returns the ordinal suffix string corresponding to the receiver integer:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinal</span>   <span class="c1"># =&gt; "rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinal</span>  <span class="c1"># =&gt; "st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/integer/inflections.rb</code>.</p>

<h3 id="ordinalize"><code class="language-plaintext highlighter-rouge">ordinalize</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-ordinalize"><code class="language-plaintext highlighter-rouge">ordinalize</code></a> returns the ordinal string corresponding to the receiver integer. In comparison, note that the <code class="language-plaintext highlighter-rouge">ordinal</code> method returns <strong>only</strong> the suffix string.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "1st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "2nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinalize</span>   <span class="c1"># =&gt; "53rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "2009th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinalize</span>  <span class="c1"># =&gt; "-21st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "-134th"</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/integer/inflections.rb</code>.</p>

<h3 id="time-1">Time</h3>

<p>The following methods:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/Integer.html#method-i-months"><code class="language-plaintext highlighter-rouge">months</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/Integer.html#method-i-years"><code class="language-plaintext highlighter-rouge">years</code></a></li>
</ul>

<p>enable time declarations and calculations, like <code class="language-plaintext highlighter-rouge">4.months + 5.years</code>. Their return values can also be added to or subtracted from Time objects.</p>

<p>These methods can be combined with <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-from_now"><code class="language-plaintext highlighter-rouge">from_now</code></a>, <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-ago"><code class="language-plaintext highlighter-rouge">ago</code></a>, etc, for precise date calculations. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># equivalent to Time.current.advance(months: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">month</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(years: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">years</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(months: 4, years: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">months</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">years</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre></div></div>

<p>WARNING. For other durations please refer to the time extensions to <code class="language-plaintext highlighter-rouge">Numeric</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/integer/time.rb</code>.</p>

<h2 id="extensions-to-bigdecimal">Extensions to <code class="language-plaintext highlighter-rouge">BigDecimal</code></h2>

<h3 id="to_s"><code class="language-plaintext highlighter-rouge">to_s</code></h3>

<p>The method <code class="language-plaintext highlighter-rouge">to_s</code> provides a default specifier of “F”. This means that a simple call to <code class="language-plaintext highlighter-rouge">to_s</code> will result in floating-point representation instead of engineering notation:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span>       <span class="c1"># =&gt; "5.0"</span>
</code></pre></div></div>

<p>Engineering notation is still supported:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>  <span class="c1"># =&gt; "0.5E1"</span>
</code></pre></div></div>

<h2 id="extensions-to-enumerable">Extensions to <code class="language-plaintext highlighter-rouge">Enumerable</code></h2>

<h3 id="index_by"><code class="language-plaintext highlighter-rouge">index_by</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-index_by"><code class="language-plaintext highlighter-rouge">index_by</code></a> generates a hash with the elements of an enumerable indexed by some key.</p>

<p>It iterates through the collection and passes each element to a block. The element will be keyed by the value returned by the block:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">invoices</span><span class="p">.</span><span class="nf">index_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:number</span><span class="p">)</span>
<span class="c1"># =&gt; {"2009-032" =&gt; &lt;Invoice ...&gt;, "2009-008" =&gt; &lt;Invoice ...&gt;, ...}</span>
</code></pre></div></div>

<p>WARNING. Keys should normally be unique. If the block returns the same value for different elements no collection is built for that key. The last item will win.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="index_with"><code class="language-plaintext highlighter-rouge">index_with</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-index_with"><code class="language-plaintext highlighter-rouge">index_with</code></a> generates a hash with the elements of an enumerable as keys. The value
is either a passed default or returned in a block.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"hey there"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"what's up?"</span><span class="p">)</span>

<span class="sx">%i( title body )</span><span class="p">.</span><span class="nf">index_with</span> <span class="p">{</span> <span class="o">|</span><span class="n">attr_name</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; { title: "hey there", body: "what's up?" }</span>

<span class="no">WEEKDAYS</span><span class="p">.</span><span class="nf">index_with</span><span class="p">(</span><span class="no">Interval</span><span class="p">.</span><span class="nf">all_day</span><span class="p">)</span>
<span class="c1"># =&gt; { monday: [ 0, 1440 ], … }</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="many"><code class="language-plaintext highlighter-rouge">many?</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-many-3F"><code class="language-plaintext highlighter-rouge">many?</code></a> is shorthand for <code class="language-plaintext highlighter-rouge">collection.size &gt; 1</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">pages</span><span class="p">.</span><span class="nf">many?</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">pagination_links</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>If an optional block is given, <code class="language-plaintext highlighter-rouge">many?</code> only takes into account those elements that return true:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@see_more</span> <span class="o">=</span> <span class="n">videos</span><span class="p">.</span><span class="nf">many?</span> <span class="p">{</span> <span class="o">|</span><span class="n">video</span><span class="o">|</span> <span class="n">video</span><span class="p">.</span><span class="nf">category</span> <span class="o">==</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="exclude"><code class="language-plaintext highlighter-rouge">exclude?</code></h3>

<p>The predicate <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-exclude-3F"><code class="language-plaintext highlighter-rouge">exclude?</code></a> tests whether a given object does <strong>not</strong> belong to the collection. It is the negation of the built-in <code class="language-plaintext highlighter-rouge">include?</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">to_visit</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">visited</span><span class="p">.</span><span class="nf">exclude?</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="including"><code class="language-plaintext highlighter-rouge">including</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-including"><code class="language-plaintext highlighter-rouge">including</code></a> returns a new enumerable that includes the passed elements:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>                    <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">].</span><span class="nf">including</span> <span class="sx">%w[ Aaron Todd ]</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron", "Todd"]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="excluding"><code class="language-plaintext highlighter-rouge">excluding</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-excluding"><code class="language-plaintext highlighter-rouge">excluding</code></a> returns a copy of an enumerable with the specified elements
removed:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">excluding</code> is aliased to <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-without"><code class="language-plaintext highlighter-rouge">without</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="pluck"><code class="language-plaintext highlighter-rouge">pluck</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-pluck"><code class="language-plaintext highlighter-rouge">pluck</code></a> extracts the given key from each element:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron"]</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [[1, "David"], [2, "Rafael"]]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h3 id="pick"><code class="language-plaintext highlighter-rouge">pick</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-pick"><code class="language-plaintext highlighter-rouge">pick</code></a> extracts the given key from the first element:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; "David"</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [1, "David"]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/enumerable.rb</code>.</p>

<h2 id="extensions-to-array">Extensions to <code class="language-plaintext highlighter-rouge">Array</code></h2>

<h3 id="accessing">Accessing</h3>

<p>Active Support augments the API of arrays to ease certain ways of accessing them. For example, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to"><code class="language-plaintext highlighter-rouge">to</code></a> returns the subarray of elements up to the one at the passed index:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; ["a", "b", "c"]</span>
<span class="p">[].</span><span class="nf">to</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>          <span class="c1"># =&gt; []</span>
</code></pre></div></div>

<p>Similarly, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-from"><code class="language-plaintext highlighter-rouge">from</code></a> returns the tail from the element at the passed index to the end. If the index is greater than the length of the array, it returns an empty array.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; ["c", "d"]</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; []</span>
<span class="p">[].</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           <span class="c1"># =&gt; []</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-including"><code class="language-plaintext highlighter-rouge">including</code></a> returns a new array that includes the passed elements:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>          <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">].</span><span class="nf">including</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span> <span class="c1"># =&gt; [ [ 0, 1 ], [ 1, 0 ] ]</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-excluding"><code class="language-plaintext highlighter-rouge">excluding</code></a> returns a copy of the Array excluding the specified elements.
This is an optimization of <code class="language-plaintext highlighter-rouge">Enumerable#excluding</code> that uses <code class="language-plaintext highlighter-rouge">Array#-</code>
instead of <code class="language-plaintext highlighter-rouge">Array#reject</code> for performance reasons.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">].</span><span class="nf">excluding</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span>                  <span class="c1"># =&gt; [ [ 0, 1 ] ]</span>
</code></pre></div></div>

<p>The methods <a href="https://api.rubyonrails.org/classes/Array.html#method-i-second"><code class="language-plaintext highlighter-rouge">second</code></a>, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-third"><code class="language-plaintext highlighter-rouge">third</code></a>, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-fourth"><code class="language-plaintext highlighter-rouge">fourth</code></a>, and <a href="https://api.rubyonrails.org/classes/Array.html#method-i-fifth"><code class="language-plaintext highlighter-rouge">fifth</code></a> return the corresponding element, as do <a href="https://api.rubyonrails.org/classes/Array.html#method-i-second_to_last"><code class="language-plaintext highlighter-rouge">second_to_last</code></a> and <a href="https://api.rubyonrails.org/classes/Array.html#method-i-third_to_last"><code class="language-plaintext highlighter-rouge">third_to_last</code></a> (<code class="language-plaintext highlighter-rouge">first</code> and <code class="language-plaintext highlighter-rouge">last</code> are built-in). Thanks to social wisdom and positive constructiveness all around, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-forty_two"><code class="language-plaintext highlighter-rouge">forty_two</code></a> is also available.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">third</span> <span class="c1"># =&gt; "c"</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">fifth</span> <span class="c1"># =&gt; nil</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/access.rb</code>.</p>

<h3 id="extracting">Extracting</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-extract-21"><code class="language-plaintext highlighter-rouge">extract!</code></a> removes and returns the elements for which the block returns a true value.
If no block is given, an Enumerator is returned instead.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">odd_numbers</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">extract!</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span><span class="p">.</span><span class="nf">odd?</span> <span class="p">}</span> <span class="c1"># =&gt; [1, 3, 5, 7, 9]</span>
<span class="n">numbers</span> <span class="c1"># =&gt; [0, 2, 4, 6, 8]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/extract.rb</code>.</p>

<h3 id="options-extraction">Options Extraction</h3>

<p>When the last argument in a method call is a hash, except perhaps for a <code class="language-plaintext highlighter-rouge">&amp;block</code> argument, Ruby allows you to omit the brackets:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">])</span>
</code></pre></div></div>

<p>That syntactic sugar is used a lot in Rails to avoid positional arguments where there would be too many, offering instead interfaces that emulate named parameters. In particular it is very idiomatic to use a trailing hash for options.</p>

<p>If a method expects a variable number of arguments and uses <code class="language-plaintext highlighter-rouge">*</code> in its declaration, however, such an options hash ends up being an item of the array of arguments, where it loses its role.</p>

<p>In those cases, you may give an options hash a distinguished treatment with <a href="https://api.rubyonrails.org/classes/Array.html#method-i-extract_options-21"><code class="language-plaintext highlighter-rouge">extract_options!</code></a>. This method checks the type of the last item of an array. If it is a hash it pops it and returns it, otherwise it returns an empty hash.</p>

<p>Let’s see for example the definition of the <code class="language-plaintext highlighter-rouge">caches_action</code> controller macro:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">caches_action</span><span class="p">(</span><span class="o">*</span><span class="n">actions</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="n">cache_configured?</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">actions</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This method receives an arbitrary number of action names, and an optional hash of options as last argument. With the call to <code class="language-plaintext highlighter-rouge">extract_options!</code> you obtain the options hash and remove it from <code class="language-plaintext highlighter-rouge">actions</code> in a simple and explicit way.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/extract_options.rb</code>.</p>

<h3 id="conversions-1">Conversions</h3>

<h4 id="to_sentence"><code class="language-plaintext highlighter-rouge">to_sentence</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_sentence"><code class="language-plaintext highlighter-rouge">to_sentence</code></a> turns an array into a string containing a sentence that enumerates its items:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w()</span><span class="p">.</span><span class="nf">to_sentence</span>                <span class="c1"># =&gt; ""</span>
<span class="sx">%w(Earth)</span><span class="p">.</span><span class="nf">to_sentence</span>           <span class="c1"># =&gt; "Earth"</span>
<span class="sx">%w(Earth Wind)</span><span class="p">.</span><span class="nf">to_sentence</span>      <span class="c1"># =&gt; "Earth and Wind"</span>
<span class="sx">%w(Earth Wind Fire)</span><span class="p">.</span><span class="nf">to_sentence</span> <span class="c1"># =&gt; "Earth, Wind, and Fire"</span>
</code></pre></div></div>

<p>This method accepts three options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">:two_words_connector</code>: What is used for arrays of length 2. Default is “ and “.</li>
  <li><code class="language-plaintext highlighter-rouge">:words_connector</code>: What is used to join the elements of arrays with 3 or more elements, except for the last two. Default is “, “.</li>
  <li><code class="language-plaintext highlighter-rouge">:last_word_connector</code>: What is used to join the last items of an array with 3 or more elements. Default is “, and “.</li>
</ul>

<p>The defaults for these options can be localized, their keys are:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>I18n key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:two_words_connector</code></td>
      <td><code class="language-plaintext highlighter-rouge">support.array.two_words_connector</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:words_connector</code></td>
      <td><code class="language-plaintext highlighter-rouge">support.array.words_connector</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">:last_word_connector</code></td>
      <td><code class="language-plaintext highlighter-rouge">support.array.last_word_connector</code></td>
    </tr>
  </tbody>
</table>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/conversions.rb</code>.</p>

<h4 id="to_fs"><code class="language-plaintext highlighter-rouge">to_fs</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_fs"><code class="language-plaintext highlighter-rouge">to_fs</code></a> acts like <code class="language-plaintext highlighter-rouge">to_s</code> by default.</p>

<p>If the array contains items that respond to <code class="language-plaintext highlighter-rouge">id</code>, however, the symbol
<code class="language-plaintext highlighter-rouge">:db</code> may be passed as argument. That’s typically used with
collections of Active Record objects. Returned strings are:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[].</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>            <span class="c1"># =&gt; "null"</span>
<span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>        <span class="c1"># =&gt; "8456"</span>
<span class="n">invoice</span><span class="p">.</span><span class="nf">lines</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span> <span class="c1"># =&gt; "23,567,556,12"</span>
</code></pre></div></div>

<p>Integers in the example above are supposed to come from the respective calls to <code class="language-plaintext highlighter-rouge">id</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/conversions.rb</code>.</p>

<h4 id="to_xml"><code class="language-plaintext highlighter-rouge">to_xml</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_xml"><code class="language-plaintext highlighter-rouge">to_xml</code></a> returns a string containing an XML representation of its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors type="array"&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre></div></div>

<p>To do so it sends <code class="language-plaintext highlighter-rouge">to_xml</code> to every item in turn, and collects the results under a root node. All items must respond to <code class="language-plaintext highlighter-rouge">to_xml</code>, an exception is raised otherwise.</p>

<p>By default, the name of the root element is the underscored and dasherized plural of the name of the class of the first item, provided the rest of elements belong to that type (checked with <code class="language-plaintext highlighter-rouge">is_a?</code>) and they are not hashes. In the example above that’s “contributors”.</p>

<p>If there’s any element that does not belong to the type of the first one the root node becomes “objects”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="no">Contributor</span><span class="p">.</span><span class="nf">first</span><span class="p">,</span> <span class="no">Commit</span><span class="p">.</span><span class="nf">first</span><span class="p">].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4583&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Aaron Batalion&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;53&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;author&gt;Joshua Peek&lt;/author&gt;</span>
<span class="c1">#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;</span>
<span class="c1">#     &lt;branch&gt;origin/master&lt;/branch&gt;</span>
<span class="c1">#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;</span>
<span class="c1">#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;</span>
<span class="c1">#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;190316&lt;/id&gt;</span>
<span class="c1">#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;</span>
<span class="c1">#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;</span>
<span class="c1">#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre></div></div>

<p>If the receiver is an array of hashes the root element is by default also “objects”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">c: </span><span class="mi">3</span> <span class="p">}].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;b type="integer"&gt;2&lt;/b&gt;</span>
<span class="c1">#     &lt;a type="integer"&gt;1&lt;/a&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;c type="integer"&gt;3&lt;/c&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre></div></div>

<p>WARNING. If the collection is empty the root element is by default “nil-classes”. That’s a gotcha, for example the root element of the list of contributors above would not be “contributors” if the collection was empty, but “nil-classes”. You may use the <code class="language-plaintext highlighter-rouge">:root</code> option to ensure a consistent root element.</p>

<p>The name of children nodes is by default the name of the root node singularized. In the examples above we’ve seen “contributor” and “object”. The option <code class="language-plaintext highlighter-rouge">:children</code> allows you to set these node names.</p>

<p>The default XML builder is a fresh instance of <code class="language-plaintext highlighter-rouge">Builder::XmlMarkup</code>. You can configure your own builder via the <code class="language-plaintext highlighter-rouge">:builder</code> option. The method also accepts options like <code class="language-plaintext highlighter-rouge">:dasherize</code> and friends, they are forwarded to the builder:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span><span class="p">(</span><span class="ss">skip_types: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/conversions.rb</code>.</p>

<h3 id="wrapping">Wrapping</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-c-wrap"><code class="language-plaintext highlighter-rouge">Array.wrap</code></a> wraps its argument in an array unless it is already an array (or array-like).</p>

<p>Specifically:</p>

<ul>
  <li>If the argument is <code class="language-plaintext highlighter-rouge">nil</code> an empty array is returned.</li>
  <li>Otherwise, if the argument responds to <code class="language-plaintext highlighter-rouge">to_ary</code> it is invoked, and if the value of <code class="language-plaintext highlighter-rouge">to_ary</code> is not <code class="language-plaintext highlighter-rouge">nil</code>, it is returned.</li>
  <li>Otherwise, an array with the argument as its single element is returned.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>       <span class="c1"># =&gt; []</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># =&gt; [1, 2, 3]</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>         <span class="c1"># =&gt; [0]</span>
</code></pre></div></div>

<p>This method is similar in purpose to <code class="language-plaintext highlighter-rouge">Kernel#Array</code>, but there are some differences:</p>

<ul>
  <li>If the argument responds to <code class="language-plaintext highlighter-rouge">to_ary</code> the method is invoked. <code class="language-plaintext highlighter-rouge">Kernel#Array</code> moves on to try <code class="language-plaintext highlighter-rouge">to_a</code> if the returned value is <code class="language-plaintext highlighter-rouge">nil</code>, but <code class="language-plaintext highlighter-rouge">Array.wrap</code> returns an array with the argument as its single element right away.</li>
  <li>If the returned value from <code class="language-plaintext highlighter-rouge">to_ary</code> is neither <code class="language-plaintext highlighter-rouge">nil</code> nor an <code class="language-plaintext highlighter-rouge">Array</code> object, <code class="language-plaintext highlighter-rouge">Kernel#Array</code> raises an exception, while <code class="language-plaintext highlighter-rouge">Array.wrap</code> does not, it just returns the value.</li>
  <li>It does not call <code class="language-plaintext highlighter-rouge">to_a</code> on the argument, if the argument does not respond to <code class="language-plaintext highlighter-rouge">to_ary</code> it returns an array with the argument as its single element.</li>
</ul>

<p>The last point is particularly worth comparing for some enumerables:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span> <span class="c1"># =&gt; [{:foo=&gt;:bar}]</span>
<span class="no">Array</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span>      <span class="c1"># =&gt; [[:foo, :bar]]</span>
</code></pre></div></div>

<p>There’s also a related idiom that uses the splat operator:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="o">*</span><span class="n">object</span><span class="p">]</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/wrap.rb</code>.</p>

<h3 id="duplicating">Duplicating</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-deep_dup"><code class="language-plaintext highlighter-rouge">Array#deep_dup</code></a> duplicates itself and all objects inside
recursively with the Active Support method <code class="language-plaintext highlighter-rouge">Object#deep_dup</code>. It works like <code class="language-plaintext highlighter-rouge">Array#map</code>, sending <code class="language-plaintext highlighter-rouge">deep_dup</code> method to each object inside.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="nb">dup</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>   <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/deep_dup.rb</code>.</p>

<h3 id="grouping">Grouping</h3>

<h4 id="in_groups_ofnumber-fill_with--nil"><code class="language-plaintext highlighter-rouge">in_groups_of(number, fill_with = nil)</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-in_groups_of"><code class="language-plaintext highlighter-rouge">in_groups_of</code></a> splits an array into consecutive groups of a certain size. It returns an array with the groups:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, nil]]</span>
</code></pre></div></div>

<p>or yields them in turn if a block is passed:</p>

<pre><code class="language-html+erb">&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
</code></pre>

<p>The first example shows how <code class="language-plaintext highlighter-rouge">in_groups_of</code> fills the last group with as many <code class="language-plaintext highlighter-rouge">nil</code> elements as needed to have the requested size. You can change this padding value using the second optional argument:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, 0]]</span>
</code></pre></div></div>

<p>And you can tell the method not to fill the last group by passing <code class="language-plaintext highlighter-rouge">false</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3]]</span>
</code></pre></div></div>

<p>As a consequence <code class="language-plaintext highlighter-rouge">false</code> can’t be used as a padding value.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/grouping.rb</code>.</p>

<h4 id="in_groupsnumber-fill_with--nil"><code class="language-plaintext highlighter-rouge">in_groups(number, fill_with = nil)</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-in_groups"><code class="language-plaintext highlighter-rouge">in_groups</code></a> splits an array into a certain number of groups. The method returns an array with the groups:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]</span>
</code></pre></div></div>

<p>or yields them in turn if a block is passed:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">group</span><span class="o">|</span> <span class="nb">p</span> <span class="n">group</span> <span class="p">}</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
</code></pre></div></div>

<p>The examples above show that <code class="language-plaintext highlighter-rouge">in_groups</code> fills some groups with a trailing <code class="language-plaintext highlighter-rouge">nil</code> element as needed. A group can get at most one of these extra elements, the rightmost one if any. And the groups that have them are always the last ones.</p>

<p>You can change this padding value using the second optional argument:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]</span>
</code></pre></div></div>

<p>And you can tell the method not to fill the smaller groups by passing <code class="language-plaintext highlighter-rouge">false</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]</span>
</code></pre></div></div>

<p>As a consequence <code class="language-plaintext highlighter-rouge">false</code> can’t be used as a padding value.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/grouping.rb</code>.</p>

<h4 id="splitvalue--nil"><code class="language-plaintext highlighter-rouge">split(value = nil)</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Array.html#method-i-split"><code class="language-plaintext highlighter-rouge">split</code></a> divides an array by a separator and returns the resulting chunks.</p>

<p>If a block is passed the separators are those elements of the array for which the block returns true:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">split</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]</span>
</code></pre></div></div>

<p>Otherwise, the value received as argument, which defaults to <code class="language-plaintext highlighter-rouge">nil</code>, is the separator:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; [[0], [-5], [], ["foo", "bar"]]</span>
</code></pre></div></div>

<p>TIP: Observe in the previous example that consecutive separators result in empty arrays.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/array/grouping.rb</code>.</p>

<h2 id="extensions-to-hash">Extensions to <code class="language-plaintext highlighter-rouge">Hash</code></h2>

<h3 id="conversions-2">Conversions</h3>

<h4 id="to_xml-1"><code class="language-plaintext highlighter-rouge">to_xml</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_xml"><code class="language-plaintext highlighter-rouge">to_xml</code></a> returns a string containing an XML representation of its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">foo: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">bar: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;hash&gt;</span>
<span class="c1">#   &lt;foo type="integer"&gt;1&lt;/foo&gt;</span>
<span class="c1">#   &lt;bar type="integer"&gt;2&lt;/bar&gt;</span>
<span class="c1"># &lt;/hash&gt;</span>
</code></pre></div></div>

<p>To do so, the method loops over the pairs and builds nodes that depend on the <em>values</em>. Given a pair <code class="language-plaintext highlighter-rouge">key</code>, <code class="language-plaintext highlighter-rouge">value</code>:</p>

<ul>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">value</code> is a hash there’s a recursive call with <code class="language-plaintext highlighter-rouge">key</code> as <code class="language-plaintext highlighter-rouge">:root</code>.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">value</code> is an array there’s a recursive call with <code class="language-plaintext highlighter-rouge">key</code> as <code class="language-plaintext highlighter-rouge">:root</code>, and <code class="language-plaintext highlighter-rouge">key</code> singularized as <code class="language-plaintext highlighter-rouge">:children</code>.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">value</code> is a callable object it must expect one or two arguments. Depending on the arity, the callable is invoked with the <code class="language-plaintext highlighter-rouge">options</code> hash as first argument with <code class="language-plaintext highlighter-rouge">key</code> as <code class="language-plaintext highlighter-rouge">:root</code>, and <code class="language-plaintext highlighter-rouge">key</code> singularized as second argument. Its return value becomes a new node.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">value</code> responds to <code class="language-plaintext highlighter-rouge">to_xml</code> the method is invoked with <code class="language-plaintext highlighter-rouge">key</code> as <code class="language-plaintext highlighter-rouge">:root</code>.</p>
  </li>
  <li>
    <p>Otherwise, a node with <code class="language-plaintext highlighter-rouge">key</code> as tag is created with a string representation of <code class="language-plaintext highlighter-rouge">value</code> as text node. If <code class="language-plaintext highlighter-rouge">value</code> is <code class="language-plaintext highlighter-rouge">nil</code> an attribute “nil” set to “true” is added. Unless the option <code class="language-plaintext highlighter-rouge">:skip_types</code> exists and is true, an attribute “type” is added as well according to the following mapping:</p>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">XML_TYPE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Symbol"</span>     <span class="o">=&gt;</span> <span class="s2">"symbol"</span><span class="p">,</span>
  <span class="s2">"Integer"</span>    <span class="o">=&gt;</span> <span class="s2">"integer"</span><span class="p">,</span>
  <span class="s2">"BigDecimal"</span> <span class="o">=&gt;</span> <span class="s2">"decimal"</span><span class="p">,</span>
  <span class="s2">"Float"</span>      <span class="o">=&gt;</span> <span class="s2">"float"</span><span class="p">,</span>
  <span class="s2">"TrueClass"</span>  <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"FalseClass"</span> <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"Date"</span>       <span class="o">=&gt;</span> <span class="s2">"date"</span><span class="p">,</span>
  <span class="s2">"DateTime"</span>   <span class="o">=&gt;</span> <span class="s2">"datetime"</span><span class="p">,</span>
  <span class="s2">"Time"</span>       <span class="o">=&gt;</span> <span class="s2">"datetime"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By default the root node is “hash”, but that’s configurable via the <code class="language-plaintext highlighter-rouge">:root</code> option.</p>

<p>The default XML builder is a fresh instance of <code class="language-plaintext highlighter-rouge">Builder::XmlMarkup</code>. You can configure your own builder with the <code class="language-plaintext highlighter-rouge">:builder</code> option. The method also accepts options like <code class="language-plaintext highlighter-rouge">:dasherize</code> and friends, they are forwarded to the builder.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/conversions.rb</code>.</p>

<h3 id="merging">Merging</h3>

<p>Ruby has a built-in method <code class="language-plaintext highlighter-rouge">Hash#merge</code> that merges two hashes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">a: </span><span class="mi">0</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}</span>
</code></pre></div></div>

<p>Active Support defines a few more ways of merging hashes that may be convenient.</p>

<h4 id="reverse_merge-and-reverse_merge"><code class="language-plaintext highlighter-rouge">reverse_merge</code> and <code class="language-plaintext highlighter-rouge">reverse_merge!</code></h4>

<p>In case of collision the key in the hash of the argument wins in <code class="language-plaintext highlighter-rouge">merge</code>. You can support option hashes with default values in a compact way with this idiom:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span> <span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</code></pre></div></div>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_merge"><code class="language-plaintext highlighter-rouge">reverse_merge</code></a> in case you prefer this alternative notation:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre></div></div>

<p>And a bang version <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_merge-21"><code class="language-plaintext highlighter-rouge">reverse_merge!</code></a> that performs the merge in place:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge!</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre></div></div>

<p>WARNING. Take into account that <code class="language-plaintext highlighter-rouge">reverse_merge!</code> may change the hash in the caller, which may or may not be a good idea.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/reverse_merge.rb</code>.</p>

<h4 id="reverse_update"><code class="language-plaintext highlighter-rouge">reverse_update</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_update"><code class="language-plaintext highlighter-rouge">reverse_update</code></a> is an alias for <code class="language-plaintext highlighter-rouge">reverse_merge!</code>, explained above.</p>

<p>WARNING. Note that <code class="language-plaintext highlighter-rouge">reverse_update</code> has no bang.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/reverse_merge.rb</code>.</p>

<h4 id="deep_merge-and-deep_merge"><code class="language-plaintext highlighter-rouge">deep_merge</code> and <code class="language-plaintext highlighter-rouge">deep_merge!</code></h4>

<p>As you can see in the previous example if a key is found in both hashes the value in the one in the argument wins.</p>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_merge"><code class="language-plaintext highlighter-rouge">Hash#deep_merge</code></a>. In a deep merge, if a key is found in both hashes and their values are hashes in turn, then their <em>merge</em> becomes the value in the resulting hash:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="p">{</span> <span class="ss">b: </span><span class="mi">1</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">deep_merge</span><span class="p">(</span><span class="ss">a: </span><span class="p">{</span> <span class="ss">c: </span><span class="mi">2</span> <span class="p">})</span>
<span class="c1"># =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_merge-21"><code class="language-plaintext highlighter-rouge">deep_merge!</code></a> performs a deep merge in place.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/deep_merge.rb</code>.</p>

<h3 id="deep-duplicating">Deep Duplicating</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_dup"><code class="language-plaintext highlighter-rouge">Hash#deep_dup</code></a> duplicates itself and all keys and values
inside recursively with Active Support method <code class="language-plaintext highlighter-rouge">Object#deep_dup</code>. It works like <code class="language-plaintext highlighter-rouge">Enumerator#each_with_object</code> with sending <code class="language-plaintext highlighter-rouge">deep_dup</code> method to each pair inside.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="p">{</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">d: </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">dup</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>

<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>      <span class="c1"># =&gt; true</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>   <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/object/deep_dup.rb</code>.</p>

<h3 id="working-with-keys">Working with Keys</h3>

<h4 id="except"><code class="language-plaintext highlighter-rouge">except!</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-except-21"><code class="language-plaintext highlighter-rouge">except!</code></a> is identical to the built-in <code class="language-plaintext highlighter-rouge">except</code> method but removes keys in place, returning <code class="language-plaintext highlighter-rouge">self</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">except!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
<span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">except!</span><span class="p">(</span><span class="ss">:c</span><span class="p">)</span> <span class="c1"># =&gt; {:a=&gt;1, :b=&gt;2}</span>
</code></pre></div></div>

<p>If the receiver responds to <code class="language-plaintext highlighter-rouge">convert_key</code>, the method is called on each of the arguments. This allows <code class="language-plaintext highlighter-rouge">except!</code> (and <code class="language-plaintext highlighter-rouge">except</code>) to play nice with hashes with indifferent access for instance:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># =&gt; {}</span>
<span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except!</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># =&gt; {}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/except.rb</code>.</p>

<h4 id="stringify_keys-and-stringify_keys"><code class="language-plaintext highlighter-rouge">stringify_keys</code> and <code class="language-plaintext highlighter-rouge">stringify_keys!</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-stringify_keys"><code class="language-plaintext highlighter-rouge">stringify_keys</code></a> returns a hash that has a stringified version of the keys in the receiver. It does so by sending <code class="language-plaintext highlighter-rouge">to_s</code> to them:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: :a</span> <span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}</span>
</code></pre></div></div>

<p>In case of key collision, the value will be the one most recently inserted into the hash:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># The result will be</span>
<span class="c1"># =&gt; {"a"=&gt;2}</span>
</code></pre></div></div>

<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <code class="language-plaintext highlighter-rouge">ActionView::Helpers::FormHelper</code> defines:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_checkbox_tag</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">checked_value</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">unchecked_value</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">stringify_keys</span>
  <span class="n">options</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"checkbox"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The second line can safely access the “type” key, and let the user to pass either <code class="language-plaintext highlighter-rouge">:type</code> or “type”.</p>

<p>There’s also the bang variant <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-stringify_keys-21"><code class="language-plaintext highlighter-rouge">stringify_keys!</code></a> that stringifies keys in place.</p>

<p>Besides that, one can use <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_stringify_keys"><code class="language-plaintext highlighter-rouge">deep_stringify_keys</code></a> and <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_stringify_keys-21"><code class="language-plaintext highlighter-rouge">deep_stringify_keys!</code></a> to stringify all the keys in the given hash and all the hashes nested in it. An example of the result is:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">nested: </span><span class="p">{</span> <span class="ss">a: </span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">deep_stringify_keys</span>
<span class="c1"># =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/keys.rb</code>.</p>

<h4 id="symbolize_keys-and-symbolize_keys"><code class="language-plaintext highlighter-rouge">symbolize_keys</code> and <code class="language-plaintext highlighter-rouge">symbolize_keys!</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-symbolize_keys"><code class="language-plaintext highlighter-rouge">symbolize_keys</code></a> returns a hash that has a symbolized version of the keys in the receiver, where possible. It does so by sending <code class="language-plaintext highlighter-rouge">to_sym</code> to them:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"a"</span> <span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}</span>
</code></pre></div></div>

<p>WARNING. Note in the previous example only one key was symbolized.</p>

<p>In case of key collision, the value will be the one most recently inserted into the hash:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {:a=&gt;2}</span>
</code></pre></div></div>

<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <code class="language-plaintext highlighter-rouge">ActionText::TagHelper</code> defines</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rich_textarea_tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">symbolize_keys</span>

  <span class="n">options</span><span class="p">[</span><span class="ss">:input</span><span class="p">]</span> <span class="o">||=</span> <span class="s2">"trix_input_</span><span class="si">#{</span><span class="no">ActionText</span><span class="o">::</span><span class="no">TagHelper</span><span class="p">.</span><span class="nf">id</span> <span class="o">+=</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The third line can safely access the <code class="language-plaintext highlighter-rouge">:input</code> key, and let the user to pass either <code class="language-plaintext highlighter-rouge">:input</code> or “input”.</p>

<p>There’s also the bang variant <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-symbolize_keys-21"><code class="language-plaintext highlighter-rouge">symbolize_keys!</code></a> that symbolizes keys in place.</p>

<p>Besides that, one can use <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_symbolize_keys"><code class="language-plaintext highlighter-rouge">deep_symbolize_keys</code></a> and <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_symbolize_keys-21"><code class="language-plaintext highlighter-rouge">deep_symbolize_keys!</code></a> to symbolize all the keys in the given hash and all the hashes nested in it. An example of the result is:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nested"</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">deep_symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/keys.rb</code>.</p>

<h4 id="to_options-and-to_options"><code class="language-plaintext highlighter-rouge">to_options</code> and <code class="language-plaintext highlighter-rouge">to_options!</code></h4>

<p>The methods <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_options"><code class="language-plaintext highlighter-rouge">to_options</code></a> and <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_options-21"><code class="language-plaintext highlighter-rouge">to_options!</code></a> are aliases of <code class="language-plaintext highlighter-rouge">symbolize_keys</code> and <code class="language-plaintext highlighter-rouge">symbolize_keys!</code>, respectively.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/keys.rb</code>.</p>

<h4 id="assert_valid_keys"><code class="language-plaintext highlighter-rouge">assert_valid_keys</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-assert_valid_keys"><code class="language-plaintext highlighter-rouge">assert_valid_keys</code></a> receives an arbitrary number of arguments, and checks whether the receiver has any key outside that list. If it does <code class="language-plaintext highlighter-rouge">ArgumentError</code> is raised.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># passes</span>
<span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># ArgumentError</span>
</code></pre></div></div>

<p>Active Record does not accept unknown options when building associations, for example. It implements that control via <code class="language-plaintext highlighter-rouge">assert_valid_keys</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/keys.rb</code>.</p>

<h3 id="working-with-values">Working with Values</h3>

<h4 id="deep_transform_values-and-deep_transform_values"><code class="language-plaintext highlighter-rouge">deep_transform_values</code> and <code class="language-plaintext highlighter-rouge">deep_transform_values!</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_transform_values"><code class="language-plaintext highlighter-rouge">deep_transform_values</code></a> returns a new hash with all values converted by the block operation. This includes the values from the root hash and from all nested hashes and arrays.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">person: </span><span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rob"</span><span class="p">,</span> <span class="ss">age: </span><span class="s2">"28"</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">hash</span><span class="p">.</span><span class="nf">deep_transform_values</span> <span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">value</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">upcase</span> <span class="p">}</span>
<span class="c1"># =&gt; {person: {name: "ROB", age: "28"}}</span>
</code></pre></div></div>

<p>There’s also the bang variant <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_transform_values-21"><code class="language-plaintext highlighter-rouge">deep_transform_values!</code></a> that destructively converts all values by using the block operation.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/deep_transform_values.rb</code>.</p>

<h3 id="slicing">Slicing</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-slice-21"><code class="language-plaintext highlighter-rouge">slice!</code></a> replaces the hash with only the given keys and returns a hash containing the removed key/value pairs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">slice!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
<span class="nb">hash</span>                   <span class="c1"># =&gt; {:a=&gt;1}</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/slice.rb</code>.</p>

<h3 id="extracting-1">Extracting</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-extract-21"><code class="language-plaintext highlighter-rouge">extract!</code></a> removes and returns the key/value pairs matching the given keys.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:a=&gt;1}</span>
<span class="nb">hash</span>                     <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre></div></div>

<p>The method <code class="language-plaintext highlighter-rouge">extract!</code> returns the same subclass of Hash that the receiver is.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}.</span><span class="nf">with_indifferent_access</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">).</span><span class="nf">class</span>
<span class="c1"># =&gt; ActiveSupport::HashWithIndifferentAccess</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/slice.rb</code>.</p>

<h3 id="indifferent-access">Indifferent Access</h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-with_indifferent_access"><code class="language-plaintext highlighter-rouge">with_indifferent_access</code></a> returns an <a href="https://api.rubyonrails.org/classes/ActiveSupport/HashWithIndifferentAccess.html"><code class="language-plaintext highlighter-rouge">ActiveSupport::HashWithIndifferentAccess</code></a> out of its receiver:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/hash/indifferent_access.rb</code>.</p>

<h2 id="extensions-to-regexp">Extensions to <code class="language-plaintext highlighter-rouge">Regexp</code></h2>

<h3 id="multiline"><code class="language-plaintext highlighter-rouge">multiline?</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Regexp.html#method-i-multiline-3F"><code class="language-plaintext highlighter-rouge">multiline?</code></a> says whether a regexp has the <code class="language-plaintext highlighter-rouge">/m</code> flag set, that is, whether the dot matches newlines.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">%r{.}</span><span class="p">.</span><span class="nf">multiline?</span>  <span class="c1"># =&gt; false</span>
<span class="sr">%r{.}m</span><span class="p">.</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>

<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"."</span><span class="p">).</span><span class="nf">multiline?</span>                    <span class="c1"># =&gt; false</span>
<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="no">Regexp</span><span class="o">::</span><span class="no">MULTILINE</span><span class="p">).</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>Rails uses this method in a single place, also in the routing code. Multiline regexps are disallowed for route requirements and this flag eases enforcing that constraint.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">verify_regexp_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">if</span> <span class="n">requirement</span><span class="p">.</span><span class="nf">multiline?</span>
    <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"Regexp multiline option is not allowed in routing requirements: </span><span class="si">#{</span><span class="n">requirement</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/regexp.rb</code>.</p>

<h2 id="extensions-to-range">Extensions to <code class="language-plaintext highlighter-rouge">Range</code></h2>

<h3 id="to_fs-1"><code class="language-plaintext highlighter-rouge">to_fs</code></h3>

<p>Active Support defines <code class="language-plaintext highlighter-rouge">Range#to_fs</code> as an alternative to <code class="language-plaintext highlighter-rouge">to_s</code> that understands an optional format argument. As of this writing the only supported non-default format is <code class="language-plaintext highlighter-rouge">:db</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_fs</span>
<span class="c1"># =&gt; "2009-10-25..2009-10-26"</span>

<span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
<span class="c1"># =&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"</span>
</code></pre></div></div>

<p>As the example depicts, the <code class="language-plaintext highlighter-rouge">:db</code> format generates a <code class="language-plaintext highlighter-rouge">BETWEEN</code> SQL clause. That is used by Active Record in its support for range values in conditions.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/range/conversions.rb</code>.</p>

<h3 id="-and-include"><code class="language-plaintext highlighter-rouge">===</code> and <code class="language-plaintext highlighter-rouge">include?</code></h3>

<p>The methods <code class="language-plaintext highlighter-rouge">Range#===</code> and <code class="language-plaintext highlighter-rouge">Range#include?</code> say whether some value falls between the ends of a given instance:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="no">Math</span><span class="o">::</span><span class="no">E</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>Active Support extends these methods so that the argument may be another range in turn. In that case we test whether the ends of the argument range belong to the receiver themselves:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/range/compare_range.rb</code>.</p>

<h3 id="overlap"><code class="language-plaintext highlighter-rouge">overlap?</code></h3>

<p>The method <a href="https://api.rubyonrails.org/classes/Range.html#method-i-overlaps-3F"><code class="language-plaintext highlighter-rouge">Range#overlap?</code></a> says whether any two given ranges have non-void intersection:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlap?</span><span class="p">(</span><span class="mi">7</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlap?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlap?</span><span class="p">(</span><span class="mi">11</span><span class="o">..</span><span class="mi">27</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/range/overlap.rb</code>.</p>

<h2 id="extensions-to-date">Extensions to <code class="language-plaintext highlighter-rouge">Date</code></h2>

<h3 id="calculations">Calculations</h3>

<p>INFO: The following calculation methods have edge cases in October 1582, since days 5..14 just do not exist. This guide does not document their behavior around those days for brevity, but it is enough to say that they do what you would expect. That is, <code class="language-plaintext highlighter-rouge">Date.new(1582, 10, 4).tomorrow</code> returns <code class="language-plaintext highlighter-rouge">Date.new(1582, 10, 15)</code> and so on. Please check <code class="language-plaintext highlighter-rouge">test/core_ext/date_ext_test.rb</code> in the Active Support test suite for expected behavior.</p>

<h4 id="datecurrent"><code class="language-plaintext highlighter-rouge">Date.current</code></h4>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/Date.html#method-c-current"><code class="language-plaintext highlighter-rouge">Date.current</code></a> to be today in the current time zone. That’s like <code class="language-plaintext highlighter-rouge">Date.today</code>, except that it honors the user time zone, if defined. It also defines <a href="https://api.rubyonrails.org/classes/Date.html#method-c-yesterday"><code class="language-plaintext highlighter-rouge">Date.yesterday</code></a> and <a href="https://api.rubyonrails.org/classes/Date.html#method-c-tomorrow"><code class="language-plaintext highlighter-rouge">Date.tomorrow</code></a>, and the instance predicates <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code class="language-plaintext highlighter-rouge">past?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-today-3F"><code class="language-plaintext highlighter-rouge">today?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code class="language-plaintext highlighter-rouge">tomorrow?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code class="language-plaintext highlighter-rouge">next_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code class="language-plaintext highlighter-rouge">yesterday?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code class="language-plaintext highlighter-rouge">prev_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code class="language-plaintext highlighter-rouge">future?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-on_weekday-3F"><code class="language-plaintext highlighter-rouge">on_weekday?</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-on_weekend-3F"><code class="language-plaintext highlighter-rouge">on_weekend?</code></a>, all of them relative to <code class="language-plaintext highlighter-rouge">Date.current</code>.</p>

<p>When making Date comparisons using methods which honor the user time zone, make sure to use <code class="language-plaintext highlighter-rouge">Date.current</code> and not <code class="language-plaintext highlighter-rouge">Date.today</code>. There are cases where the user time zone might be in the future compared to the system time zone, which <code class="language-plaintext highlighter-rouge">Date.today</code> uses by default. This means <code class="language-plaintext highlighter-rouge">Date.today</code> may equal <code class="language-plaintext highlighter-rouge">Date.yesterday</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code>.</p>

<h4 id="named-dates">Named Dates</h4>

<h5 id="beginning_of_week-end_of_week"><code class="language-plaintext highlighter-rouge">beginning_of_week</code>, <code class="language-plaintext highlighter-rouge">end_of_week</code></h5>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_week"><code class="language-plaintext highlighter-rouge">beginning_of_week</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_week"><code class="language-plaintext highlighter-rouge">end_of_week</code></a> return the dates for the
beginning and end of the week, respectively. Weeks are assumed to start on
Monday, but that can be changed passing an argument, setting thread local
<code class="language-plaintext highlighter-rouge">Date.beginning_of_week</code> or <a href="configuring.html#config-beginning-of-week"><code class="language-plaintext highlighter-rouge">config.beginning_of_week</code></a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span>          <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 02 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span>                <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>       <span class="c1"># =&gt; Sat, 08 May 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_week</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_week"><code class="language-plaintext highlighter-rouge">at_beginning_of_week</code></a> and <code class="language-plaintext highlighter-rouge">end_of_week</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_week"><code class="language-plaintext highlighter-rouge">at_end_of_week</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="monday-sunday"><code class="language-plaintext highlighter-rouge">monday</code>, <code class="language-plaintext highlighter-rouge">sunday</code></h5>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-monday"><code class="language-plaintext highlighter-rouge">monday</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-sunday"><code class="language-plaintext highlighter-rouge">sunday</code></a> return the dates for the previous Monday and
next Sunday, respectively.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 09 May 2010</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 10 Sep 2012</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="prev_week-next_week"><code class="language-plaintext highlighter-rouge">prev_week</code>, <code class="language-plaintext highlighter-rouge">next_week</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_week"><code class="language-plaintext highlighter-rouge">next_week</code></a> receives a symbol with a day name in English (default is the thread local <a href="https://api.rubyonrails.org/classes/Date.html#method-c-beginning_of_week"><code class="language-plaintext highlighter-rouge">Date.beginning_of_week</code></a>, or <a href="configuring.html#config-beginning-of-week"><code class="language-plaintext highlighter-rouge">config.beginning_of_week</code></a>, or <code class="language-plaintext highlighter-rouge">:monday</code>) and it returns the date corresponding to that day.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span>              <span class="c1"># =&gt; Mon, 10 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 15 May 2010</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_week"><code class="language-plaintext highlighter-rouge">prev_week</code></a> is analogous:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span>              <span class="c1"># =&gt; Mon, 26 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:friday</span><span class="p">)</span>     <span class="c1"># =&gt; Fri, 30 Apr 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">prev_week</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_week"><code class="language-plaintext highlighter-rouge">last_week</code></a>.</p>

<p>Both <code class="language-plaintext highlighter-rouge">next_week</code> and <code class="language-plaintext highlighter-rouge">prev_week</code> work as expected when <code class="language-plaintext highlighter-rouge">Date.beginning_of_week</code> or <code class="language-plaintext highlighter-rouge">config.beginning_of_week</code> are set.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="beginning_of_month-end_of_month"><code class="language-plaintext highlighter-rouge">beginning_of_month</code>, <code class="language-plaintext highlighter-rouge">end_of_month</code></h5>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_month"><code class="language-plaintext highlighter-rouge">beginning_of_month</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_month"><code class="language-plaintext highlighter-rouge">end_of_month</code></a> return the dates for the beginning and end of the month:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_month</span>     <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_month</span>           <span class="c1"># =&gt; Mon, 31 May 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_month</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_month"><code class="language-plaintext highlighter-rouge">at_beginning_of_month</code></a>, and <code class="language-plaintext highlighter-rouge">end_of_month</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_month"><code class="language-plaintext highlighter-rouge">at_end_of_month</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="quarter-beginning_of_quarter-end_of_quarter"><code class="language-plaintext highlighter-rouge">quarter</code>, <code class="language-plaintext highlighter-rouge">beginning_of_quarter</code>, <code class="language-plaintext highlighter-rouge">end_of_quarter</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-quarter"><code class="language-plaintext highlighter-rouge">quarter</code></a> returns the quarter of the receiver’s calendar year:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">quarter</span>                <span class="c1"># =&gt; 2</span>
</code></pre></div></div>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_quarter"><code class="language-plaintext highlighter-rouge">beginning_of_quarter</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_quarter"><code class="language-plaintext highlighter-rouge">end_of_quarter</code></a> return the dates for the beginning and end of the quarter of the receiver’s calendar year:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_quarter</span>   <span class="c1"># =&gt; Thu, 01 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_quarter</span>         <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_quarter</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_quarter"><code class="language-plaintext highlighter-rouge">at_beginning_of_quarter</code></a>, and <code class="language-plaintext highlighter-rouge">end_of_quarter</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_quarter"><code class="language-plaintext highlighter-rouge">at_end_of_quarter</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="beginning_of_year-end_of_year"><code class="language-plaintext highlighter-rouge">beginning_of_year</code>, <code class="language-plaintext highlighter-rouge">end_of_year</code></h5>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_year"><code class="language-plaintext highlighter-rouge">beginning_of_year</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_year"><code class="language-plaintext highlighter-rouge">end_of_year</code></a> return the dates for the beginning and end of the year:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_year</span>      <span class="c1"># =&gt; Fri, 01 Jan 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_year</span>            <span class="c1"># =&gt; Fri, 31 Dec 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_year</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_year"><code class="language-plaintext highlighter-rouge">at_beginning_of_year</code></a>, and <code class="language-plaintext highlighter-rouge">end_of_year</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_year"><code class="language-plaintext highlighter-rouge">at_end_of_year</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h4 id="other-date-computations">Other Date Computations</h4>

<h5 id="years_ago-years_since"><code class="language-plaintext highlighter-rouge">years_ago</code>, <code class="language-plaintext highlighter-rouge">years_since</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-years_ago"><code class="language-plaintext highlighter-rouge">years_ago</code></a> receives a number of years and returns the same date those many years ago:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 07 Jun 2000</span>
</code></pre></div></div>

<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-years_since"><code class="language-plaintext highlighter-rouge">years_since</code></a> moves forward in time:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 07 Jun 2020</span>
</code></pre></div></div>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 28 Feb 2009</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 28 Feb 2015</span>
</code></pre></div></div>

<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_year"><code class="language-plaintext highlighter-rouge">last_year</code></a> is short-hand for <code class="language-plaintext highlighter-rouge">#years_ago(1)</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="months_ago-months_since"><code class="language-plaintext highlighter-rouge">months_ago</code>, <code class="language-plaintext highlighter-rouge">months_since</code></h5>

<p>The methods <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-months_ago"><code class="language-plaintext highlighter-rouge">months_ago</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-months_since"><code class="language-plaintext highlighter-rouge">months_since</code></a> work analogously for months:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre></div></div>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
</code></pre></div></div>

<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_month"><code class="language-plaintext highlighter-rouge">last_month</code></a> is short-hand for <code class="language-plaintext highlighter-rouge">#months_ago(1)</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="weeks_ago-weeks_since"><code class="language-plaintext highlighter-rouge">weeks_ago</code>, <code class="language-plaintext highlighter-rouge">weeks_since</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-weeks_ago"><code class="language-plaintext highlighter-rouge">weeks_ago</code></a> and [<code class="language-plaintext highlighter-rouge">weeks_since</code>][DateAndTime::Calculations#week_since] work analogously for weeks:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># =&gt; Mon, 17 May 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Mon, 07 Jun 2010</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h5 id="advance"><code class="language-plaintext highlighter-rouge">advance</code></h5>

<p>The most generic way to jump to other days is <a href="https://api.rubyonrails.org/classes/Date.html#method-i-advance"><code class="language-plaintext highlighter-rouge">advance</code></a>. This method receives a hash with keys <code class="language-plaintext highlighter-rouge">:years</code>, <code class="language-plaintext highlighter-rouge">:months</code>, <code class="language-plaintext highlighter-rouge">:weeks</code>, <code class="language-plaintext highlighter-rouge">:days</code>, and returns a date advanced as much as the present keys indicate:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">weeks: </span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; Mon, 20 Jun 2011</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">days: </span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 04 Aug 2010</span>
</code></pre></div></div>

<p>Note in the previous example that increments may be negative.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code>.</p>

<h4 id="changing-components">Changing Components</h4>

<p>The method <a href="https://api.rubyonrails.org/classes/Date.html#method-i-change"><code class="language-plaintext highlighter-rouge">change</code></a> allows you to get a new date which is the same as the receiver except for the given year, month, or day:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">month: </span><span class="mi">11</span><span class="p">)</span>
<span class="c1"># =&gt; Wed, 23 Nov 2011</span>
</code></pre></div></div>

<p>This method is not tolerant to non-existing dates, if the change is invalid <code class="language-plaintext highlighter-rouge">ArgumentError</code> is raised:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code>.</p>

<h4 id="durations">Durations</h4>

<p><a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code class="language-plaintext highlighter-rouge">Duration</code></a> objects can be added to and subtracted from dates:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010</span>
<span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011</span>
<span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="c1"># =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00</span>
</code></pre></div></div>

<p>They translate to calls to <code class="language-plaintext highlighter-rouge">since</code> or <code class="language-plaintext highlighter-rouge">advance</code>. For example here we get the correct jump in the calendar reform:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582</span>
</code></pre></div></div>

<h4 id="timestamps">Timestamps</h4>

<p>INFO: The following methods return a <code class="language-plaintext highlighter-rouge">Time</code> object if possible, otherwise a <code class="language-plaintext highlighter-rouge">DateTime</code>. If set, they honor the user time zone.</p>

<h5 id="beginning_of_day-end_of_day"><code class="language-plaintext highlighter-rouge">beginning_of_day</code>, <code class="language-plaintext highlighter-rouge">end_of_day</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/Date.html#method-i-beginning_of_day"><code class="language-plaintext highlighter-rouge">beginning_of_day</code></a> returns a timestamp at the beginning of the day (00:00:00):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_day</span> <span class="c1"># =&gt; Mon Jun 07 00:00:00 +0200 2010</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/Date.html#method-i-end_of_day"><code class="language-plaintext highlighter-rouge">end_of_day</code></a> returns a timestamp at the end of the day (23:59:59):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_day</span> <span class="c1"># =&gt; Mon Jun 07 23:59:59 +0200 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_day</code> is aliased to <a href="https://api.rubyonrails.org/classes/Date.html#method-i-at_beginning_of_day"><code class="language-plaintext highlighter-rouge">at_beginning_of_day</code></a>, <a href="https://api.rubyonrails.org/classes/Date.html#method-i-midnight"><code class="language-plaintext highlighter-rouge">midnight</code></a>, <a href="https://api.rubyonrails.org/classes/Date.html#method-i-at_midnight"><code class="language-plaintext highlighter-rouge">at_midnight</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code>.</p>

<h5 id="beginning_of_hour-end_of_hour"><code class="language-plaintext highlighter-rouge">beginning_of_hour</code>, <code class="language-plaintext highlighter-rouge">end_of_hour</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_hour"><code class="language-plaintext highlighter-rouge">beginning_of_hour</code></a> returns a timestamp at the beginning of the hour (hh:00:00):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:00:00 +0200 2010</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_hour"><code class="language-plaintext highlighter-rouge">end_of_hour</code></a> returns a timestamp at the end of the hour (hh:59:59):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:59:59 +0200 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_hour</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_hour"><code class="language-plaintext highlighter-rouge">at_beginning_of_hour</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h5 id="beginning_of_minute-end_of_minute"><code class="language-plaintext highlighter-rouge">beginning_of_minute</code>, <code class="language-plaintext highlighter-rouge">end_of_minute</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_minute"><code class="language-plaintext highlighter-rouge">beginning_of_minute</code></a> returns a timestamp at the beginning of the minute (hh:mm:00):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:00 +0200 2010</span>
</code></pre></div></div>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_minute"><code class="language-plaintext highlighter-rouge">end_of_minute</code></a> returns a timestamp at the end of the minute (hh:mm:59):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:59 +0200 2010</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">beginning_of_minute</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_minute"><code class="language-plaintext highlighter-rouge">at_beginning_of_minute</code></a>.</p>

<p>INFO: <code class="language-plaintext highlighter-rouge">beginning_of_hour</code>, <code class="language-plaintext highlighter-rouge">end_of_hour</code>, <code class="language-plaintext highlighter-rouge">beginning_of_minute</code>, and <code class="language-plaintext highlighter-rouge">end_of_minute</code> are implemented for <code class="language-plaintext highlighter-rouge">Time</code> and <code class="language-plaintext highlighter-rouge">DateTime</code> but <strong>not</strong> <code class="language-plaintext highlighter-rouge">Date</code> as it does not make sense to request the beginning or end of an hour or minute on a <code class="language-plaintext highlighter-rouge">Date</code> instance.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h5 id="ago-since"><code class="language-plaintext highlighter-rouge">ago</code>, <code class="language-plaintext highlighter-rouge">since</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/Date.html#method-i-ago"><code class="language-plaintext highlighter-rouge">ago</code></a> receives a number of seconds as argument and returns a timestamp those many seconds ago from midnight:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00</span>
</code></pre></div></div>

<p>Similarly, <a href="https://api.rubyonrails.org/classes/Date.html#method-i-since"><code class="language-plaintext highlighter-rouge">since</code></a> moves forward:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">since</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code>.</p>

<h2 id="extensions-to-datetime">Extensions to <code class="language-plaintext highlighter-rouge">DateTime</code></h2>

<p>WARNING: <code class="language-plaintext highlighter-rouge">DateTime</code> is not aware of DST rules and so some of these methods have edge cases when a DST change is going on. For example <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-seconds_since_midnight"><code class="language-plaintext highlighter-rouge">seconds_since_midnight</code></a> might not return the real amount in such a day.</p>

<h3 id="calculations-1">Calculations</h3>

<p>The class <code class="language-plaintext highlighter-rouge">DateTime</code> is a subclass of <code class="language-plaintext highlighter-rouge">Date</code> so by loading <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code> you inherit these methods and their aliases, except that they will always return datetimes.</p>

<p>The following methods are reimplemented so you do <strong>not</strong> need to load <code class="language-plaintext highlighter-rouge">active_support/core_ext/date/calculations.rb</code> for these ones:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_day"><code class="language-plaintext highlighter-rouge">beginning_of_day</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-midnight"><code class="language-plaintext highlighter-rouge">midnight</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_midnight"><code class="language-plaintext highlighter-rouge">at_midnight</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_day"><code class="language-plaintext highlighter-rouge">at_beginning_of_day</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_day"><code class="language-plaintext highlighter-rouge">end_of_day</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-ago"><code class="language-plaintext highlighter-rouge">ago</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-since"><code class="language-plaintext highlighter-rouge">since</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-in"><code class="language-plaintext highlighter-rouge">in</code></a></li>
</ul>

<p>On the other hand, <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-advance"><code class="language-plaintext highlighter-rouge">advance</code></a> and <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-change"><code class="language-plaintext highlighter-rouge">change</code></a> are also defined and support more options, they are documented below.</p>

<p>The following methods are only implemented in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code> as they only make sense when used with a <code class="language-plaintext highlighter-rouge">DateTime</code> instance:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_hour"><code class="language-plaintext highlighter-rouge">beginning_of_hour</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_hour"><code class="language-plaintext highlighter-rouge">at_beginning_of_hour</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_hour"><code class="language-plaintext highlighter-rouge">end_of_hour</code></a></li>
</ul>

<h4 id="named-datetimes">Named Datetimes</h4>

<h5 id="datetimecurrent"><code class="language-plaintext highlighter-rouge">DateTime.current</code></h5>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/DateTime.html#method-c-current"><code class="language-plaintext highlighter-rouge">DateTime.current</code></a> to be like <code class="language-plaintext highlighter-rouge">Time.now.to_datetime</code>, except that it honors the user time zone, if defined. The instance predicates <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code class="language-plaintext highlighter-rouge">past?</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code class="language-plaintext highlighter-rouge">future?</code></a> are defined relative to <code class="language-plaintext highlighter-rouge">DateTime.current</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h4 id="other-extensions">Other Extensions</h4>

<h5 id="seconds_since_midnight"><code class="language-plaintext highlighter-rouge">seconds_since_midnight</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-seconds_since_midnight"><code class="language-plaintext highlighter-rouge">seconds_since_midnight</code></a> returns the number of seconds since midnight:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>     <span class="c1"># =&gt; Mon, 07 Jun 2010 20:26:36 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">seconds_since_midnight</span> <span class="c1"># =&gt; 73596</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h5 id="utc"><code class="language-plaintext highlighter-rouge">utc</code></h5>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-utc"><code class="language-plaintext highlighter-rouge">utc</code></a> gives you the same datetime in the receiver expressed in UTC.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:27:52 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span>                <span class="c1"># =&gt; Mon, 07 Jun 2010 23:27:52 +0000</span>
</code></pre></div></div>

<p>This method is also aliased as <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-getutc"><code class="language-plaintext highlighter-rouge">getutc</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h5 id="utc-1"><code class="language-plaintext highlighter-rouge">utc?</code></h5>

<p>The predicate <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-utc-3F"><code class="language-plaintext highlighter-rouge">utc?</code></a> says whether the receiver has UTC as its time zone:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">now</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:30:47 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc?</span>           <span class="c1"># =&gt; false</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span><span class="p">.</span><span class="nf">utc?</span>       <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h5 id="advance-1"><code class="language-plaintext highlighter-rouge">advance</code></h5>

<p>The most generic way to jump to another datetime is <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-advance"><code class="language-plaintext highlighter-rouge">advance</code></a>. This method receives a hash with keys <code class="language-plaintext highlighter-rouge">:years</code>, <code class="language-plaintext highlighter-rouge">:months</code>, <code class="language-plaintext highlighter-rouge">:weeks</code>, <code class="language-plaintext highlighter-rouge">:days</code>, <code class="language-plaintext highlighter-rouge">:hours</code>, <code class="language-plaintext highlighter-rouge">:minutes</code>, and <code class="language-plaintext highlighter-rouge">:seconds</code>, and returns a datetime advanced as much as the present keys indicate.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Thu, 05 Aug 2010 11:33:31 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">hours: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">minutes: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 06 Sep 2011 12:34:32 +0000</span>
</code></pre></div></div>

<p>This method first computes the destination date passing <code class="language-plaintext highlighter-rouge">:years</code>, <code class="language-plaintext highlighter-rouge">:months</code>, <code class="language-plaintext highlighter-rouge">:weeks</code>, and <code class="language-plaintext highlighter-rouge">:days</code> to <code class="language-plaintext highlighter-rouge">Date#advance</code> documented above. After that, it adjusts the time calling <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-since"><code class="language-plaintext highlighter-rouge">since</code></a> with the number of seconds to advance. This order is relevant, a different ordering would give different datetimes in some edge-cases. The example in <code class="language-plaintext highlighter-rouge">Date#advance</code> applies, and we can extend it to show order relevance related to the time bits.</p>

<p>If we first move the date bits (that have also a relative order of processing, as documented before), and then the time bits we get for example the following computation:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 28 Feb 2010 23:59:59 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Mon, 29 Mar 2010 00:00:00 +0000</span>
</code></pre></div></div>

<p>but if we computed them the other way around, the result would be different:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Thu, 01 Apr 2010 00:00:00 +0000</span>
</code></pre></div></div>

<p>WARNING: Since <code class="language-plaintext highlighter-rouge">DateTime</code> is not DST-aware you can end up in a non-existing point in time with no warning or error telling you so.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h4 id="changing-components-1">Changing Components</h4>

<p>The method <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-change"><code class="language-plaintext highlighter-rouge">change</code></a> allows you to get a new datetime which is the same as the receiver except for the given options, which may include <code class="language-plaintext highlighter-rouge">:year</code>, <code class="language-plaintext highlighter-rouge">:month</code>, <code class="language-plaintext highlighter-rouge">:day</code>, <code class="language-plaintext highlighter-rouge">:hour</code>, <code class="language-plaintext highlighter-rouge">:min</code>, <code class="language-plaintext highlighter-rouge">:sec</code>, <code class="language-plaintext highlighter-rouge">:offset</code>, <code class="language-plaintext highlighter-rouge">:start</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:56:22 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">offset: </span><span class="no">Rational</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="c1"># =&gt; Wed, 08 Jun 2011 01:56:22 -0600</span>
</code></pre></div></div>

<p>If hours are zeroed, then minutes and seconds are too (unless they have given values):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">hour: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 00:00:00 +0000</span>
</code></pre></div></div>

<p>Similarly, if minutes are zeroed, then seconds are too (unless it has given a value):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">min: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:00:00 +0000</span>
</code></pre></div></div>

<p>This method is not tolerant to non-existing dates, if the change is invalid <code class="language-plaintext highlighter-rouge">ArgumentError</code> is raised:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">day: </span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_time/calculations.rb</code>.</p>

<h4 id="durations-1">Durations</h4>

<p><a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code class="language-plaintext highlighter-rouge">Duration</code></a> objects can be added to and subtracted from datetimes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:15:17 +0000</span>
</code></pre></div></div>

<p>They translate to calls to <code class="language-plaintext highlighter-rouge">since</code> or <code class="language-plaintext highlighter-rouge">advance</code>. For example here we get the correct jump in the calendar reform:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582 00:00:00 +0000</span>
</code></pre></div></div>

<h2 id="extensions-to-time">Extensions to <code class="language-plaintext highlighter-rouge">Time</code></h2>

<h3 id="calculations-2">Calculations</h3>

<p>They are analogous. Please refer to their documentation above and take into account the following differences:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/Time.html#method-i-change"><code class="language-plaintext highlighter-rouge">change</code></a> accepts an additional <code class="language-plaintext highlighter-rouge">:usec</code> option.</li>
  <li><code class="language-plaintext highlighter-rouge">Time</code> understands DST, so you get correct DST calculations as in</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>

<span class="c1"># In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.</span>
<span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 01:59:59 +0100 2010</span>
<span class="n">t</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 03:00:00 +0200 2010</span>
</code></pre></div></div>

<ul>
  <li>If <a href="https://api.rubyonrails.org/classes/Time.html#method-i-since"><code class="language-plaintext highlighter-rouge">since</code></a> or <a href="https://api.rubyonrails.org/classes/Time.html#method-i-ago"><code class="language-plaintext highlighter-rouge">ago</code></a> jumps to a time that can’t be expressed with <code class="language-plaintext highlighter-rouge">Time</code> a <code class="language-plaintext highlighter-rouge">DateTime</code> object is returned instead.</li>
</ul>

<h4 id="timecurrent"><code class="language-plaintext highlighter-rouge">Time.current</code></h4>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/Time.html#method-c-current"><code class="language-plaintext highlighter-rouge">Time.current</code></a> to be today in the current time zone. That’s like <code class="language-plaintext highlighter-rouge">Time.now</code>, except that it honors the user time zone, if defined. It also defines the instance predicates <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code class="language-plaintext highlighter-rouge">past?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-today-3F"><code class="language-plaintext highlighter-rouge">today?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code class="language-plaintext highlighter-rouge">tomorrow?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code class="language-plaintext highlighter-rouge">next_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code class="language-plaintext highlighter-rouge">yesterday?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code class="language-plaintext highlighter-rouge">prev_day?</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code class="language-plaintext highlighter-rouge">future?</code></a>, all of them relative to <code class="language-plaintext highlighter-rouge">Time.current</code>.</p>

<p>When making Time comparisons using methods which honor the user time zone, make sure to use <code class="language-plaintext highlighter-rouge">Time.current</code> instead of <code class="language-plaintext highlighter-rouge">Time.now</code>. There are cases where the user time zone might be in the future compared to the system time zone, which <code class="language-plaintext highlighter-rouge">Time.now</code> uses by default. This means <code class="language-plaintext highlighter-rouge">Time.now.to_date</code> may equal <code class="language-plaintext highlighter-rouge">Date.yesterday</code>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/time/calculations.rb</code>.</p>

<h4 id="all_day-all_week-all_month-all_quarter-and-all_year"><code class="language-plaintext highlighter-rouge">all_day</code>, <code class="language-plaintext highlighter-rouge">all_week</code>, <code class="language-plaintext highlighter-rouge">all_month</code>, <code class="language-plaintext highlighter-rouge">all_quarter</code>, and <code class="language-plaintext highlighter-rouge">all_year</code></h4>

<p>The method <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_day"><code class="language-plaintext highlighter-rouge">all_day</code></a> returns a range representing the whole day of the current time.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_day</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00</span>
</code></pre></div></div>

<p>Analogously, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_week"><code class="language-plaintext highlighter-rouge">all_week</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_month"><code class="language-plaintext highlighter-rouge">all_month</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_quarter"><code class="language-plaintext highlighter-rouge">all_quarter</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_year"><code class="language-plaintext highlighter-rouge">all_year</code></a> all serve the purpose of generating time ranges.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_month</span>
<span class="c1"># =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_quarter</span>
<span class="c1"># =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_year</span>
<span class="c1"># =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h4 id="prev_day-next_day"><code class="language-plaintext highlighter-rouge">prev_day</code>, <code class="language-plaintext highlighter-rouge">next_day</code></h4>

<p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_day"><code class="language-plaintext highlighter-rouge">prev_day</code></a> and <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_day"><code class="language-plaintext highlighter-rouge">next_day</code></a> return the time in the last or next day:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_day</span>               <span class="c1"># =&gt; 2010-05-07 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_day</span>               <span class="c1"># =&gt; 2010-05-09 00:00:00 +0900</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/time/calculations.rb</code>.</p>

<h4 id="prev_month-next_month"><code class="language-plaintext highlighter-rouge">prev_month</code>, <code class="language-plaintext highlighter-rouge">next_month</code></h4>

<p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_month"><code class="language-plaintext highlighter-rouge">prev_month</code></a> and <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_month"><code class="language-plaintext highlighter-rouge">next_month</code></a> return the time with the same day in the last or next month:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_month</span>             <span class="c1"># =&gt; 2010-04-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_month</span>             <span class="c1"># =&gt; 2010-06-08 00:00:00 +0900</span>
</code></pre></div></div>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-04-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-06-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/time/calculations.rb</code>.</p>

<h4 id="prev_year-next_year"><code class="language-plaintext highlighter-rouge">prev_year</code>, <code class="language-plaintext highlighter-rouge">next_year</code></h4>

<p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_year"><code class="language-plaintext highlighter-rouge">prev_year</code></a> and <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_year"><code class="language-plaintext highlighter-rouge">next_year</code></a> return a time with the same day/month in the last or next year:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>              <span class="c1"># =&gt; 2009-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>              <span class="c1"># =&gt; 2011-05-08 00:00:00 +0900</span>
</code></pre></div></div>

<p>If date is the 29th of February of a leap year, you obtain the 28th:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>               <span class="c1"># =&gt; 1999-02-28 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>               <span class="c1"># =&gt; 2001-02-28 00:00:00 +0900</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/time/calculations.rb</code>.</p>

<h4 id="prev_quarter-next_quarter"><code class="language-plaintext highlighter-rouge">prev_quarter</code>, <code class="language-plaintext highlighter-rouge">next_quarter</code></h4>

<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_quarter"><code class="language-plaintext highlighter-rouge">prev_quarter</code></a> and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_quarter"><code class="language-plaintext highlighter-rouge">next_quarter</code></a> return the date with the same day in the previous or next quarter:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0300</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_quarter</span>             <span class="c1"># =&gt; 2010-02-08 00:00:00 +0200</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_quarter</span>             <span class="c1"># =&gt; 2010-08-08 00:00:00 +0300</span>
</code></pre></div></div>

<p>If such a day does not exist, the last day of the corresponding month is returned:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-04-30 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-02-29 00:00:00 +0200</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span> <span class="c1"># =&gt; 2000-07-31 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_quarter</span> <span class="c1"># =&gt; 2001-03-01 00:00:00 +0200</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">prev_quarter</code> is aliased to <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_quarter"><code class="language-plaintext highlighter-rouge">last_quarter</code></a>.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/date_and_time/calculations.rb</code>.</p>

<h3 id="time-constructors">Time Constructors</h3>

<p>Active Support defines <a href="https://api.rubyonrails.org/classes/Time.html#method-c-current"><code class="language-plaintext highlighter-rouge">Time.current</code></a> to be <code class="language-plaintext highlighter-rouge">Time.zone.now</code> if there’s a user time zone defined, with fallback to <code class="language-plaintext highlighter-rouge">Time.now</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00</span>
</code></pre></div></div>

<p>Analogously to <code class="language-plaintext highlighter-rouge">DateTime</code>, the predicates <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code class="language-plaintext highlighter-rouge">past?</code></a>, and <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code class="language-plaintext highlighter-rouge">future?</code></a> are relative to <code class="language-plaintext highlighter-rouge">Time.current</code>.</p>

<p>If the time to be constructed lies beyond the range supported by <code class="language-plaintext highlighter-rouge">Time</code> in the runtime platform, usecs are discarded and a <code class="language-plaintext highlighter-rouge">DateTime</code> object is returned instead.</p>

<h4 id="durations-2">Durations</h4>

<p><a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code class="language-plaintext highlighter-rouge">Duration</code></a> objects can be added to and subtracted from time objects:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00</span>
</code></pre></div></div>

<p>They translate to calls to <code class="language-plaintext highlighter-rouge">since</code> or <code class="language-plaintext highlighter-rouge">advance</code>. For example here we get the correct jump in the calendar reform:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">utc</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">days</span>
<span class="c1"># =&gt; Mon Oct 18 00:00:00 UTC 1582</span>
</code></pre></div></div>

<h2 id="extensions-to-file">Extensions to <code class="language-plaintext highlighter-rouge">File</code></h2>

<h3 id="atomic_write"><code class="language-plaintext highlighter-rouge">atomic_write</code></h3>

<p>With the class method <a href="https://api.rubyonrails.org/classes/File.html#method-c-atomic_write"><code class="language-plaintext highlighter-rouge">File.atomic_write</code></a> you can write to a file in a way that will prevent any reader from seeing half-written content.</p>

<p>The name of the file is passed as an argument, and the method yields a file handle opened for writing. Once the block is done <code class="language-plaintext highlighter-rouge">atomic_write</code> closes the file handle and completes its job.</p>

<p>For example, Action Pack uses this method to write asset cache files like <code class="language-plaintext highlighter-rouge">all.css</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">atomic_write</span><span class="p">(</span><span class="n">joined_asset_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">cache</span><span class="o">|</span>
  <span class="n">cache</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">join_asset_file_contents</span><span class="p">(</span><span class="n">asset_paths</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To accomplish this <code class="language-plaintext highlighter-rouge">atomic_write</code> creates a temporary file. That’s the file the code in the block actually writes to. On completion, the temporary file is renamed, which is an atomic operation on POSIX systems. If the target file exists <code class="language-plaintext highlighter-rouge">atomic_write</code> overwrites it and keeps owners and permissions. However there are a few cases where <code class="language-plaintext highlighter-rouge">atomic_write</code> cannot change the file ownership or permissions, this error is caught and skipped over trusting in the user/filesystem to ensure the file is accessible to the processes that need it.</p>

<p>NOTE. Due to the chmod operation <code class="language-plaintext highlighter-rouge">atomic_write</code> performs, if the target file has an ACL set on it this ACL will be recalculated/modified.</p>

<p>WARNING. Note you can’t append with <code class="language-plaintext highlighter-rouge">atomic_write</code>.</p>

<p>The auxiliary file is written in a standard directory for temporary files, but you can pass a directory of your choice as second argument.</p>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/file/atomic.rb</code>.</p>

<h2 id="extensions-to-nameerror">Extensions to <code class="language-plaintext highlighter-rouge">NameError</code></h2>

<p>Active Support adds <a href="https://api.rubyonrails.org/classes/NameError.html#method-i-missing_name-3F"><code class="language-plaintext highlighter-rouge">missing_name?</code></a> to <code class="language-plaintext highlighter-rouge">NameError</code>, which tests whether the exception was raised because of the name passed as argument.</p>

<p>The name may be given as a symbol or string. A symbol is tested against the bare constant name, a string is against the fully qualified constant name.</p>

<p>TIP: A symbol can represent a fully qualified constant name as in <code class="language-plaintext highlighter-rouge">:"ActiveRecord::Base"</code>, so the behavior for symbols is defined for convenience, not because it has to be that way technically.</p>

<p>For example, when an action of <code class="language-plaintext highlighter-rouge">ArticlesController</code> is called Rails tries optimistically to use <code class="language-plaintext highlighter-rouge">ArticlesHelper</code>. It is OK that the helper module does not exist, so if an exception for that constant name is raised it should be silenced. But it could be the case that <code class="language-plaintext highlighter-rouge">articles_helper.rb</code> raises a <code class="language-plaintext highlighter-rouge">NameError</code> due to an actual unknown constant. That should be reraised. The method <code class="language-plaintext highlighter-rouge">missing_name?</code> provides a way to distinguish both cases:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/name_error.rb</code>.</p>

<h2 id="extensions-to-loaderror">Extensions to <code class="language-plaintext highlighter-rouge">LoadError</code></h2>

<p>Active Support adds <a href="https://api.rubyonrails.org/classes/LoadError.html#method-i-is_missing-3F"><code class="language-plaintext highlighter-rouge">is_missing?</code></a> to <code class="language-plaintext highlighter-rouge">LoadError</code>.</p>

<p>Given a path name <code class="language-plaintext highlighter-rouge">is_missing?</code> tests whether the exception was raised due to that particular file (except perhaps for the “.rb” extension).</p>

<p>For example, when an action of <code class="language-plaintext highlighter-rouge">ArticlesController</code> is called Rails tries to load <code class="language-plaintext highlighter-rouge">articles_helper.rb</code>, but that file may not exist. That’s fine, the helper module is not mandatory so Rails silences a load error. But it could be the case that the helper module does exist and in turn requires another library that is missing. In that case Rails must reraise the exception. The method <code class="language-plaintext highlighter-rouge">is_missing?</code> provides a way to distinguish both cases:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/load_error.rb</code>.</p>

<h2 id="extensions-to-pathname">Extensions to Pathname</h2>

<h3 id="existence"><code class="language-plaintext highlighter-rouge">existence</code></h3>

<p>The <a href="https://api.rubyonrails.org/classes/Pathname.html#method-i-existence"><code class="language-plaintext highlighter-rouge">existence</code></a> method returns the receiver if the named file exists otherwise returns <code class="language-plaintext highlighter-rouge">nil</code>. It is useful for idioms like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">content</span> <span class="o">=</span> <span class="no">Pathname</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"file"</span><span class="p">).</span><span class="nf">existence</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">read</span>
</code></pre></div></div>

<p>NOTE: Defined in <code class="language-plaintext highlighter-rouge">active_support/core_ext/pathname/existence.rb</code>.</p>


        </div>

        <footer class="guide-footer">
            <div class="feedback">
                <h3>Geri Bildirim</h3>
                <p>Bu kılavuzun kalitesini artırmamıza yardımcı olmak için geri bildirimlerinizi bekliyoruz.</p>
                <p>Lütfen <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub Issues</a> üzerinden katkıda bulunun.</p>
            </div>
        </footer>
    </article>
</div>

<script>
// İçindekiler tablosunu otomatik oluştur
document.addEventListener('DOMContentLoaded', function() {
    const toc = document.getElementById('toc');
    const headings = document.querySelectorAll('.guide-content h2, .guide-content h3, .guide-content h4');
    
    if (headings.length > 0) {
        const tocList = document.createElement('ul');
        
        headings.forEach(function(heading, index) {
            const id = 'heading-' + index;
            heading.id = id;
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();
            
            li.appendChild(a);
            tocList.appendChild(li);
        });
        
        toc.appendChild(tocList);
    }
});
</script>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Rails Kılavuzları Türkçe Çevirisi. Gönüllüler tarafından hazırlanmıştır.</p>
            <p>Orijinal dokümantasyon <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine aittir.</p>
        </div>
    </footer>

    <script>hljs.highlightAll();</script>
</body>
</html>