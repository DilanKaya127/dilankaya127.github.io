<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Rails ile Başlarken - Rails Dokümantasyonu - Türkçe
    </title>
    <link
      rel="stylesheet"
      href="/assets/css/rails.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css"
    />

    <link
      rel="icon"
      type="image/svg"
      href="/assets/images/rails/logo_rails-circle.svg"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-Y6Q8S53SSQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-Y6Q8S53SSQ");
    </script>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <h1 class="logo">
            <a href="/rails/">
              <img
                src="/assets/images/rails/logo_rails-circle.svg"
                alt="Rails Logo"
                class="logo-image"
              />
            </a>
          </h1>
          <nav class="nav">
            <a href="/">Ana Sayfa</a>
            <!-- <a href="https://dilankaya127.github.io">Portföy</a> -->

            <div class="dropdown">
              <a class="dropbtn">Kılavuzlar</a>
              <div class="dropdown-content multi-column">
                 
                <div class="dropdown-column">
                  <h4>Buradan Başlayın</h4>
                  
                  <a href="/rails/guides/getting_started">Rails ile Başlarken</a>
                  
                  <a href="/rails/guides/install_ruby_on_rails">Ruby on Rails İndirme Kılavuzu</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Model</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Migration</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Doğrulamaları</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Callback</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record İlişkileri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Sorgu Arayüzü</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Model Temelleri</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>View</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Overview</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Layout ve Rendering</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Helper</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Form Helper</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Controller</h4>
                  
                  <a href="/rails/guides/action_controller_overview">Action Controller</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Controller İleri Konular</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Dışarıdan İçeriye Routing</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Diğer Bileşenler</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Support Core Uzantılar</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Mailer Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Mailbox Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Text</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Job Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Storage</a>
                  
                  <a href="/rails/guides/action_cable_overview">Action Cable</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Daha Derin Konular</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uluslararasılaştırma API</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarını Test Etme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarında Hata Ayıklama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarını Yapılandırma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Komut Satırı</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Asset Pipeline</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails'te JavaScript ile Çalışma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Başlatma Süreci</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Otomatik Yükleme ve Yeniden Yükleme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Support Instrumentation</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">API Özel Uygulamalar için Rails Kullanımı</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Ürün Çıkarmak</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Dağıtım için Performans Ayarlama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails ile Önbelleğe Alma: Genel Bakış</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarının Güvenliğini Sağlama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarında Hata Bildirim</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>İleri Seviye Active Record</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record ve PostgreSQL</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Çoklu Veritabanı</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Şifreleme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Bileşik Birincil Anahtarlar</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Rails Uygulamalarını Büyütelim</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Eklentileri Oluşturmanın Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rack'te Rails</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Generator ve Şablonları Oluşturma ve Özelleştirme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Engine ile Çalışmaya Başlarken</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulama Şablonları</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails'te İş Parçacığı Oluşturma ve Kod Yürütme</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Katkıda Bulunun</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Ruby on Rails'e Katkıda Bulunma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">API Dokümantasyon Yönergeleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Kılavuz Yönergeleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Core Geliştirme Bağımlılıklarını Yükleme</a>
                  
                </div>
                     
              </div>
            </div>
            <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="container">
        <div class="guide-container">
  <button id="toc-toggle" class="toc-toggle">☰ İçindekiler</button>

  <aside class="guide-sidebar">
    <div class="guide-toc">
      <div id="toc"></div>
      <button class="toc-close" aria-label="İçindekileri Kapat">✕</button>
    </div>
  </aside>

  <article class="guide-content">
    <div class="guide-body"><p><strong>RESMİ KILAVUZA BU ADRES ÜZERİNDEN ULAŞABİLİRSİNİZ: <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a></strong></p>

<hr />

<h1 id="rails-ile-başlarken">Rails ile Başlarken</h1>

<p>Bu kılavuz Ruby on Rails’i nasıl kurup çalıştıracağınızı anlatmaktadır.</p>

<p>Bu kılavuzu okuduktan sonra şunları öğreneceksiniz:</p>

<ul>
  <li>Rails’i nasıl kuracağınızı, yeni bir Rails uygulaması nasıl oluşturacağınızı ve uygulamanızı bir veritabanına nasıl bağlayacağınızı</li>
  <li>Rails uygulamasının genel yapısını</li>
  <li>MVC (Model, View, Controller) ve RESTful tasarımının temel ilkelerini</li>
  <li>Rails uygulamasının başlangıç parçalarını hızlı bir şekilde nasıl oluşturacağınızı</li>
  <li>Kamal kullanarak uygulamanızı üretim ortamına nasıl dağıtacağınızı (deploy edeceğinizi)</li>
</ul>

<h2 id="giriş">Giriş</h2>

<p>Ruby on Rails’e hoş geldiniz! Bu kılavuzda, Rails ile web uygulamaları geliştirmenin temel konularını ele alacağız. Bu kılavuzu takip etmek için Rails’te herhangi bir deneyime ihtiyacınız yok.</p>

<p>Rails, Ruby programlama dili için geliştirilmiş bir web framework’üdür. Rails, Ruby’nin birçok özelliğinin avantajını barındırmaktadır, bu yüzden sizlere Ruby’nin temellerini öğrenmenizi <em>şiddetle</em> öneririz. Böylece bu kılavuzda karşılacağınız bazı temel terimleri ve kelimeleri anlıyor olacaksınız.</p>

<ul>
  <li><a href="https://www.ruby-lang.org/en/documentation/">Resmi Ruby Websitesi</a></li>
  <li><a href="https://github.com/EbookFoundation/free-programming-books/blob/main/books/free-programming-books-langs.md#ruby">Ücretsiz Programlama Kitaplarını İçeren Liste</a></li>
</ul>

<h2 id="railsin-felsefesi">Rails’in Felsefesi</h2>

<p>Rails, Ruby programlama dilinde yazılmış bir web uygulaması geliştirme framework’üdür. Her geliştiricinin başlangıç için ihtiyaç duyduğu şeyleri varsayarak web uygulamalarını programlamayı kolaylaştırmak için tasarlanmıştır. Diğer birçok dil ve framework’e göre daha az kod yazarak daha fazlasını başarmanızı sağlar. Deneyimli Rails geliştiricileri, web uygulaması geliştirmeyi daha eğlenceli hale getirdiğini de belirtmektedir.</p>

<p>Rails, inatçı bir yazılımdır. İşleri yapmanın “en iyi” bir yolu olduğu varsayımından hareket eder ve bu yolu teşvik etmek için tasarlanmıştır -ve bazı durumlarda alternatiflerden caydırır-. “Rails Yöntemi”ni öğrenirseniz, muhtemelen üretkenliğinizde muazzam bir artış göreceksiniz. Diğer dillerden edindiğiniz eski alışkanlıkları Rails geliştirirken ısrarla sürdürür ve başka yerlerde öğrendiğiniz kalıpları kullanmaya çalışırsanız, daha az mutlu bir deneyim yaşayabilirsiniz.</p>

<p>Rails felsefesi iki ana kılavuz ilke içerir:</p>

<ul>
  <li><strong>Kendini Tekrar Etme:</strong> DRY (Don’t Repeat Yourself), yazılım geliştirmenin bir ilkesidir ve “Her bilgi parçası; sistem içinde tek, açık ve kesin bir şekilde temsil edilmelidir” der. Aynı bilgiyi tekrar tekrar yazmayarak kodumuz daha kolay bakımı yapılabilir, daha genişletilebilir ve daha az hata içerir hale gelir.</li>
  <li><strong>Yapılandırma Üzerine Kurallar:</strong> Rails, bir web uygulamasında birçok şeyin en iyi şekilde nasıl yapılacağına dair fikirlere sahiptir ve bunları sonsuz yapılandırma dosyaları aracılığıyla kendiniz tanımlamanızı gerektirmek yerine, varsayılan olarak bu kurallar kümesini kullanır.</li>
</ul>

<h2 id="yeni-bir-rails-uygulaması-geliştirme">Yeni Bir Rails Uygulaması Geliştirme</h2>

<p><code class="language-plaintext highlighter-rouge">store</code> adında bir proje geliştireceğiz, Rails’in yerleşik özelliklerinden birkaçını gösteren basit bir e-ticaret sitesi olacak.</p>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Dolar işareti <code>$</code> ile başlayan tüm komutlar terminalde çalıştırılmalıdır.
  </div>
</div>

<h3 id="ön-koşullar">Ön Koşullar</h3>

<p>Bu proje için şunlar gerekli:</p>

<ul>
  <li>Ruby 3.2 veya daha üst sürümü</li>
  <li>Rails 8.1.0 veya daha üst sürümü</li>
  <li>Bir kod editörü</li>
</ul>

<p>Ruby ve/veya Rails’i indirmeniz gerekiyorsa, bu tutorialı takip edin: <a href="../install_ruby_on_rails/">Ruby on Rails İndirme Kılavuzu</a></p>

<p>Rails’in doğru sürümünün yüklü olduğunu doğrulayalım. Mevcut sürümü görüntülemek için bir terminal açın ve aşağıdakileri çalıştırın. Bir sürüm numarası görmelisiniz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails <span class="nt">--version</span>
Rails 8.1.0
</code></pre></div></div>

<p>Rails 8.1.0 veya daha yüksek bir sürüm olmalı.</p>

<h3 id="i̇lk-rails-uygulamanızı-oluşturma">İlk Rails Uygulamanızı Oluşturma</h3>

<p>Rails, hayatınızı kolaylaştırmak için çeşitli komutlar sunar. Tüm komutları görmek için <code class="language-plaintext highlighter-rouge">rails --help</code> komutunu çalıştırın.</p>

<p><code class="language-plaintext highlighter-rouge">rails new</code> komutu, yeni bir Rails uygulamasının temelini oluşturur, bu yüzden buradan başlayalım.</p>

<p><code class="language-plaintext highlighter-rouge">store</code> uygulamamızı oluşturmak için terminalinizde aşağıdaki komutu çalıştırın:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails new store
</code></pre></div></div>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Rails'in oluşturduğu uygulamayı flag kullanarak özelleştirebilirsiniz.
Bu seçenekleri görmek için <code>rails new --help</code> komutunu çalıştırın.
  </div>
</div>

<p>Yeni uygulamanız oluşturulduktan sonra, uygulama dizinine geçin:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>store
</code></pre></div></div>

<h3 id="dizin-yapısı">Dizin Yapısı</h3>

<p>Yeni bir Rails uygulamasında yer alan dosya ve dizinlere hızlıca bir göz atalım. Dosyaları ve dizinleri görmek için bu klasörü kod editörünüzde açabilir veya terminalinizde <code class="language-plaintext highlighter-rouge">ls -la</code> komutunu çalıştırabilirsiniz.</p>

<table>
  <thead>
    <tr>
      <th>Dosya/Klasör</th>
      <th>Amacı</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>app/</td>
      <td>Uygulamanız için controllers, models, views, helpers, mailer, jobs ve assets içerir. <strong>Bu kılavuzun geri kalanında çoğunlukla bu klasöre odaklanacaksınız.</strong></td>
    </tr>
    <tr>
      <td>bin/</td>
      <td>Uygulamanızı başlatan <code class="language-plaintext highlighter-rouge">rails</code> betiğini (scriptini) içerir ve uygulamanızı kurmak, güncellemek, dağıtmak veya çalıştırmak için kullandığınız diğer betikleri de içerebilir.</td>
    </tr>
    <tr>
      <td>config/</td>
      <td>Uygulamanızın yönlendirmeleri (route), veritabanı ve daha fazlası için yapılandırma içerir. Bu konu <a href="../configuring/">Rails Uygulamalarının Yapılandırılması</a> bölümünde daha ayrıntılı olarak ele alınmıştır.</td>
    </tr>
    <tr>
      <td>db/</td>
      <td>Mevcut veritabanı şemanızın yanı sıra veritabanı değişikliklerini (migrations) de içerir.</td>
    </tr>
    <tr>
      <td>Dockerfile</td>
      <td>Docker için yapılandırma dosyasıdır.</td>
    </tr>
    <tr>
      <td>Gemfile<br />Gemfile.lock</td>
      <td>Bu dosyalar, Rails uygulamanız için hangi gem bağımlılıklarının gerekli olduğunu belirtmenizi sağlar. Bu dosyalar <a href="https://bundler.io">Bundler</a> gem’i tarafından kullanılır.</td>
    </tr>
    <tr>
      <td>lib/</td>
      <td>Uygulamanız için genişletilmiş modüller.</td>
    </tr>
    <tr>
      <td>log/</td>
      <td>Uygulama log dosyaları.</td>
    </tr>
    <tr>
      <td>public/</td>
      <td>Statik dosyaları ve derlenmiş assetleri içerir. Uygulamanız çalışırken, bu dizin olduğu gibi gösterilecektir.</td>
    </tr>
    <tr>
      <td>Rakefile</td>
      <td>Bu dosya komut satırından çalıştırılabilecek görevleri bulur ve yükler. Görev tanımları Rails’in bileşenleri boyunca tanımlanmıştır. <code class="language-plaintext highlighter-rouge">Rakefile</code>‘ı değiştirmek yerine, uygulamanızın <code class="language-plaintext highlighter-rouge">lib/tasks</code> dizinine dosyalar ekleyerek kendi görevlerinizi eklemelisiniz.</td>
    </tr>
    <tr>
      <td>README.md</td>
      <td>Bu, uygulamanız için kısa bir kullanım kılavuzudur. Uygulamanızın ne yaptığını, nasıl kurulacağını vb. başkalarına anlatmak için bu dosyayı düzenlemelisiniz.</td>
    </tr>
    <tr>
      <td>script/</td>
      <td>Tek seferlik veya genel amaçlı <a href="https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/script/USAGE">script</a> ve <a href="https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/benchmark/USAGE">benchmark</a>  içerir.</td>
    </tr>
    <tr>
      <td>storage/</td>
      <td>Disk Hizmeti (Disk Service) için SQLite veritabanlarını ve Active Storage dosyalarını içerir. Bu konu <a href="../active_storage_overview/">Active Storage</a> bölümünde ele alınmıştır.</td>
    </tr>
    <tr>
      <td>test/</td>
      <td>Birim testleri (unit test), fikstürler ve diğer test aparatları. Bunlar <a href="../testing/">Rails Uygulamalarını Test Etme</a> bölümünde ele alınmıştır.</td>
    </tr>
    <tr>
      <td>tmp/</td>
      <td>Geçici dosyalar (önbellek ve pid dosyaları gibi).</td>
    </tr>
    <tr>
      <td>vendor/</td>
      <td>Tüm üçüncü taraf kodları için bir alan. Tipik bir Rails uygulamasında bu, üçüncü taraf kodlar arasında özel olarak eklenen (vendored) gem’ler içerir.</td>
    </tr>
    <tr>
      <td>.dockerignore</td>
      <td>Bu dosya Docker’a hangi dosyaları konteynere kopyalamaması gerektiğini söyler.</td>
    </tr>
    <tr>
      <td>.gitattributes</td>
      <td>Bu dosya, bir Git deposundaki belirli yollar için meta verileri tanımlar. Bu meta veriler Git ve diğer araçlar tarafından davranışlarını geliştirmek için kullanılabilir. Daha fazla bilgi için <a href="https://git-scm.com/docs/gitattributes">gitattributes belgelerine</a> bakın.</td>
    </tr>
    <tr>
      <td>.git/</td>
      <td>Git deposu dosyalarını içerir.</td>
    </tr>
    <tr>
      <td>.github/</td>
      <td>GitHub’a özgü dosyaları içerir.</td>
    </tr>
    <tr>
      <td>.gitignore</td>
      <td>Bu dosya Git’e hangi dosyaları veya kalıpları (pattern) yok sayması gerektiğini söyler. Dosyaları yok sayma hakkında daha fazla bilgi için <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> adresine bakın.</td>
    </tr>
    <tr>
      <td>.kamal/</td>
      <td>Kamal’ın gizli/önemli verilerini ve dağıtım betiklerini (hook) içerir.</td>
    </tr>
    <tr>
      <td>.rubocop.yml</td>
      <td>Bu dosya RuboCop için yapılandırmayı içerir.</td>
    </tr>
    <tr>
      <td>.ruby-version</td>
      <td>Bu dosya varsayılan Ruby sürümünü içerir.</td>
    </tr>
  </tbody>
</table>

<h3 id="model-view-controller-temelleri">Model-View-Controller Temelleri</h3>

<p>Rails kodu Model-View-Controller (MVC) mimarisi kullanılarak düzenlenmiştir. MVC ile, kodlarımızın çoğunun içinde çalıştığı üç ana yapı vardır:</p>

<ul>
  <li>Model - Uygulamanızdaki verileri yönetir. Tipik olarak, veritabanı tablolarınızdır.</li>
  <li>View - Yanıtları (response) HTML, JSON, XML gibi farklı biçimlerde göstermeyi (render) yönetir.</li>
  <li>Controller - Her istek için kullanıcı etkileşimlerini ve  mantığı (logic) işler.</li>
</ul>

<picture class="flowdiagram">
  <source srcset="/assets/images/rails/getting_started/mvc_architecture_dark.jpg" media="(prefers-color-scheme:dark)" />
  <img src="/assets/images/rails/getting_started/mvc_architecture_light.jpg" />
</picture>

<p>Şimdi MVC hakkında temel bir anlayışa sahip olduğumuza göre, Rails’te bunun nasıl kullanıldığını görelim.</p>

<h2 id="merhaba-rails">Merhaba, Rails!</h2>

<p>Uygulamamızın veritabanını oluşturarak ve Rails sunucumuzu ilk kez başlatarak kolay bir başlangıç yapalım.</p>

<p>Terminalinizde, <code class="language-plaintext highlighter-rouge">store</code> dizininde aşağıdaki komutları çalıştırın:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:create
</code></pre></div></div>

<p>Bu, başlangıçta uygulamanın veritabanını oluşturacaktır.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails server
</code></pre></div></div>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Komutları bir uygulama dizini içinde çalıştırdığımızda <code>bin/rails</code> kullanmalıyız. Bu, uygulamanın Rails sürümünün kullanıldığından emin olunmasını sağlar.
  </div>
</div>

<p>Bu, statik dosyaları ve Rails uygulamanızı sunacak olan Puma adlı bir web sunucusunu başlatacaktır:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">=&gt;</span> Booting Puma
<span class="o">=&gt;</span> Rails 8.1.0 application starting <span class="k">in </span>development
<span class="o">=&gt;</span> Run <span class="sb">`</span>bin/rails server <span class="nt">--help</span><span class="sb">`</span> <span class="k">for </span>more startup options
Puma starting <span class="k">in </span>single mode...
<span class="k">*</span> Puma version: 6.4.3 <span class="o">(</span>ruby 3.3.5-p100<span class="o">)</span> <span class="o">(</span><span class="s2">"The Eagle of Durango"</span><span class="o">)</span>
<span class="k">*</span>  Min threads: 3
<span class="k">*</span>  Max threads: 3
<span class="k">*</span>  Environment: development
<span class="k">*</span>          PID: 12345
<span class="k">*</span> Listening on http://127.0.0.1:3000
<span class="k">*</span> Listening on http://[::1]:3000
Use Ctrl-C to stop
</code></pre></div></div>

<p>Rails uygulamanızı görmek için tarayıcınızda http://localhost:3000 adresini açın. Varsayılan Rails karşılama sayfasını göreceksiniz:</p>

<p><img src="/assets/images/rails/getting_started/rails_welcome.png" alt="Rails welcome page" /></p>

<p>İşe yarıyor!</p>

<p>Bu sayfa, yeni bir Rails uygulaması için <em>smoke test</em> olup, bir sayfayı sunmak için perde arkasında her şeyin çalıştığından emin olunmasını sağlar.</p>

<p>Rails sunucusunu istediğiniz zaman durdurmak için terminalinizde <code class="language-plaintext highlighter-rouge">Ctrl-C</code> tuşuna basın.</p>

<h3 id="geliştirme-aşamasında-otomatik-yükleme">Geliştirme Aşamasında Otomatik Yükleme</h3>

<p>Geliştiricinin mutluluğu Rails’in temel felsefelerinden biridir ve bunu sağlamanın bir yolu da geliştirme sırasında kodun otomatik yeniden yüklenmesidir (reload).</p>

<p>Rails sunucusunu başlattığınızda, yeni dosyalar veya mevcut dosyalardaki değişiklikler algılanır ve otomatik olarak yüklenir veya gerektiğinde yeniden yüklenir. Bu, her değişiklikten sonra Rails sunucunuzu yeniden başlatmak zorunda kalmadan kodlamaya odaklanmanızı sağlar.</p>

<p>Rails uygulamalarının diğer programlama dillerinde gördüğünüz <code class="language-plaintext highlighter-rouge">require</code> deyimlerini (statement) nadiren kullandığını da fark edebilirsiniz. Rails, uygulama kodunuzu yazmaya odaklanabilmeniz için dosyaları otomatik olarak istemek üzere adlandırma kurallarını kullanır.</p>

<p>Daha fazla ayrıntı için <a href="../autoloading_and_reloading_constants/">Otomatik Yükleme ve Yeniden Yükleme Sabitleri</a> bölümüne bakın.</p>

<h2 id="veritabanı-modeli-oluşturma">Veritabanı Modeli Oluşturma</h2>

<p>Active Record, ilişkisel veritabanlarını Ruby koduna eşleyen bir Rails özelliğidir.
Tablo ve kayıt oluşturma, güncelleme ve silme gibi veritabanı ile etkileşim için yapılandırılmış sorgu dilinin (SQL) oluşturulmasına yardımcı olur. Uygulamamız Rails için varsayılan olan SQLite kullanmaktadır.</p>

<p>Basit e-ticaret mağazamıza ürün eklemek için Rails uygulamamıza bir veritabanı tablosu ekleyerek başlayalım.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate model Product name:string
</code></pre></div></div>

<p>Bu komut Rails’e veritabanında <code class="language-plaintext highlighter-rouge">name</code> sütunu ve türü <code class="language-plaintext highlighter-rouge">string</code> olan <code class="language-plaintext highlighter-rouge">Product</code> adında bir model oluşturmasını söyler. Diğer sütun türlerini nasıl ekleyeceğinizi daha sonra öğreneceksiniz.</p>

<p>Terminalinizde aşağıdakileri göreceksiniz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      invoke  active_record
      create    db/migrate/20240426151900_create_products.rb
      create    app/models/product.rb
      invoke    test_unit
      create      <span class="nb">test</span>/models/product_test.rb
      create      <span class="nb">test</span>/fixtures/products.yml
</code></pre></div></div>

<p>Bu komut birkaç şey yaparak şunları oluşturur:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">db/migrate</code> klasöründe bir şema değişikliği (migration).</li>
  <li><code class="language-plaintext highlighter-rouge">app/models/product.rb</code> içinde bir Active Record modeli.</li>
  <li>Bu model için testler ve test fikstürleri.</li>
</ol>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Model adları <b>tekildir</b>, çünkü örneklenen bir model veritabanındaki tek bir kaydı temsil eder (yani, veritabanına eklemek için bir <i>product</i> oluşturuyorsunuz).
  </div>
</div>

<h3 id="veritabanı-değişiklikleri">Veritabanı Değişiklikleri</h3>

<p>Bir <em>migration</em> veritabanımızda yapmak istediğimiz bir değişikliktir.</p>

<p>Migration’ları tanımlayarak, Rails’e veritabanındaki tabloları, sütunları veya diğer öznitelikleri eklemek, değiştirmek veya kaldırmak için veritabanını nasıl değiştireceğini söylüyoruz. Bu, geliştirme aşamasında (sadece bizim bilgisayarımızda) yaptığımız değişiklikleri takip etmemize yardımcı olur, böylece üretim ortamına (canlıda/çevrimiçiyken!) güvenli bir şekilde dağıtılabilirler.</p>

<p>Kod editörünüzde Rails’in bizim için oluşturduğu migration’ı açın, böylece migration’ın ne yaptığını görebiliriz. <code class="language-plaintext highlighter-rouge">db/migrate/&lt;timestamp&gt;_create_products.rb</code> şeklinde bir dosyada bulunur:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">8.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:name</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bu migration Rails’e <code class="language-plaintext highlighter-rouge">products</code> adında yeni bir veritabanı tablosu oluşturmasını söylüyor.</p>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Yukarıdaki modelin aksine, Rails veritabanı tablo adlarını <b>çoğul</b> yapar, çünkü veritabanı her modelin tüm örneklerini tutar (yani, <i>products</i> veritabanı oluşturuyorsunuz).
  </div>
</div>

<p>Daha sonra <code class="language-plaintext highlighter-rouge">create_table</code> bloğu bu veritabanı tablosunda hangi sütunların ve türlerin tanımlanması gerektiğini belirler.</p>

<p><code class="language-plaintext highlighter-rouge">t.string :name</code> Rails’e <code class="language-plaintext highlighter-rouge">products</code> tablosunda <code class="language-plaintext highlighter-rouge">name</code> adında bir sütun oluşturmasını ve türünü <code class="language-plaintext highlighter-rouge">string</code> olarak ayarlamasını söyler.</p>

<p><code class="language-plaintext highlighter-rouge">t.timestamps</code>, modellerinizde <code class="language-plaintext highlighter-rouge">created_at:datetime</code> ve <code class="language-plaintext highlighter-rouge">updated_at:datetime</code> adında iki sütun tanımlamak için bir kısayoldur. Bu sütunları Rails’teki çoğu Active Record modelinde görürsünüz ve kayıtlar oluşturulurken veya güncellenirken Active Record tarafından otomatik olarak ayarlanırlar.</p>

<h3 id="değişiklikleri-çalıştırma">Değişiklikleri Çalıştırma</h3>

<p>Artık veritabanında hangi değişikliklerin yapılacağını belirlediğinize göre, migration’ları çalıştırmak için aşağıdaki komutu kullanın:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p>Bu komut yeni migration’ları kontrol eder ve bunları veritabanınıza uygular. Çıktısı şu şekilde görünür:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==</span> 20240426151900 CreateProducts: migrating <span class="o">===================================</span>
<span class="nt">--</span> create_table<span class="o">(</span>:products<span class="o">)</span>
   -&gt; 0.0030s
<span class="o">==</span> 20240426151900 CreateProducts: migrated <span class="o">(</span>0.0031s<span class="o">)</span> <span class="o">==========================</span>
</code></pre></div></div>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Eğer bir hata yaparsanız, son migration'ı geri almak için <code>bin/rails db:rollback</code> komutunu çalıştırabilirsiniz.
  </div>
</div>

<h2 id="rails-konsolu">Rails Konsolu</h2>

<p>Artık products tablomuzu oluşturduğumuza göre, Rails’te onunla etkileşime geçebiliriz. Hadi deneyelim.</p>

<p>Bunun için <em>console</em> adı verilen bir Rails özelliğini kullanacağız. Konsol, Rails uygulamamızdaki kodumuzu test etmek için yararlı, etkileşimli bir araçtır.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails console
</code></pre></div></div>

<p>Aşağıdaki gibi bir komut istemi ile karşılaşacaksınız:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Loading development environment (Rails 8.1.0)
store(dev)&gt;
</span></code></pre></div></div>

<p>Burada <code class="language-plaintext highlighter-rouge">Enter</code> tuşuna bastığımızda çalıştırılacak kodu yazabiliriz. Rails sürümünü yazdırmayı deneyelim:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Rails.version
</span><span class="p">=&gt;</span> <span class="s2">"8.1.0"</span>
</code></pre></div></div>

<p>İşe yarıyor!</p>

<h2 id="active-record-model-temelleri">Active Record Model Temelleri</h2>

<p>Rails model oluşturucusunu <code class="language-plaintext highlighter-rouge">Product</code> modelini oluşturmak için çalıştırdığımızda, <code class="language-plaintext highlighter-rouge">app/models/product.rb</code> adresinde bir dosya oluşturdu. Bu dosya, <code class="language-plaintext highlighter-rouge">products</code> veritabanı tablomuzla etkileşim için Active Record kullanan bir sınıf oluşturur.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bu sınıfta hiç kod olmaması sizi şaşırtabilir. Rails bu modeli neyin tanımladığını nasıl biliyor?</p>

<p><code class="language-plaintext highlighter-rouge">Product</code> modeli kullanıldığında, Rails sütun adları ve türleri için veritabanı tablosunu sorgulayacak ve bu öznitelikler (attribute) için otomatik olarak kod oluşturacaktır. Rails bizi bu şablon kodu yazmaktan kurtarır ve bunun yerine uygulama mantığımıza odaklanabilmemiz için bu işi bizim yerimize perde arkasında halleder.</p>

<p>Rails’in Product modeli için hangi sütunları algıladığını görmek için Rails konsolunu kullanalım.</p>

<p>Çalıştırın:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.column_names
</span></code></pre></div></div>

<p>Bunu görmelisiniz:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="s2">"updated_at"</span><span class="p">]</span>
</code></pre></div></div>

<p>Rails, veritabanından yukarıdaki sütun bilgilerini istedi ve bu bilgileri `Product’ sınıfındaki öznitelikleri dinamik olarak tanımlamak için kullandı, böylece her birini manuel olarak sizin tanımlamanız gerekmez. Bu, Rails’in geliştirmeyi nasıl kolaylaştırdığının bir örneğidir.</p>

<h3 id="kayıtları-oluşturma">Kayıtları Oluşturma</h3>

<p>Aşağıdaki kod ile yeni bir Product kaydı oluşturabiliriz:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product = Product.new(name: "T-Shirt")
</span><span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Product</span><span class="p">:</span><span class="mh">0x000000012e616c30</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"T-Shirt"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="kp">nil</span><span class="kt">&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">product</code> değişkeni <code class="language-plaintext highlighter-rouge">Product</code>‘ın bir örneklemesidir. Veritabanına kaydedilmemiştir ve bu nedenle bir ID, created_at veya updated_at gibi zaman damgaları yoktur.</p>

<p>Kaydı veritabanına yazmak için <code class="language-plaintext highlighter-rouge">save</code> çağrısı yapabiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product.save
  TRANSACTION (0.1ms)  BEGIN immediate TRANSACTION /*application='Store'*/
  Product Create (0.9ms)  INSERT INTO "products" ("name", "created_at", "updated_at") VALUES ('T-Shirt', '2024-11-09 16:35:01.117836', '2024-11-09 16:35:01.117836') RETURNING "id" /*application='Store'*/
  TRANSACTION (0.9ms)  COMMIT TRANSACTION /*application='Store'*/
</span><span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">save</code> çağrıldığında, Rails bellekteki öznitelikleri alır ve bu kaydı veritabanına eklemek için bir <code class="language-plaintext highlighter-rouge">INSERT</code> SQL sorgusu oluşturur.</p>

<p>Rails ayrıca bellekteki nesneyi <code class="language-plaintext highlighter-rouge">created_at</code> ve <code class="language-plaintext highlighter-rouge">updated_at</code> zaman damgalarıyla birlikte veritabanı kaydı <code class="language-plaintext highlighter-rouge">id</code> ile günceller. Bunu <code class="language-plaintext highlighter-rouge">product</code> değişkenini yazdırarak görebiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product
</span><span class="gp">=&gt; #&lt;Product:0x00000001221f6260 id: 1, name: "T-Shirt", created_at: "2024-11-09 16:35:01.117836000 +0000", updated_at: "2024-11-09 16:35:01.117836000 +0000"&gt;</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">save</code>‘e benzer şekilde, bir Active Record nesnesini tek bir çağrıda oluşturmak ve kaydetmek için <code class="language-plaintext highlighter-rouge">create</code> kullanabiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.create(name: "Pants")
  TRANSACTION (0.1ms)  BEGIN immediate TRANSACTION /*application='Store'*/
  Product Create (0.4ms)  INSERT INTO "products" ("name", "created_at", "updated_at") VALUES ('Pants', '2024-11-09 16:36:01.856751', '2024-11-09 16:36:01.856751') RETURNING "id" /*application='Store'*/
  TRANSACTION (0.1ms)  COMMIT TRANSACTION /*application='Store'*/
</span><span class="gp">=&gt; #&lt;Product:0x0000000120485c80 id: 2, name: "Pants", created_at: "2024-11-09 16:36:01.856751000 +0000", updated_at: "2024-11-09 16:36:01.856751000 +0000"&gt;</span><span class="w">
</span></code></pre></div></div>

<h3 id="kayıtları-sorgulama">Kayıtları Sorgulama</h3>

<p>Active Record modelimizi kullanarak veritabanındaki kayıtlara da bakabiliriz.</p>

<p>Veritabanındaki tüm Product kayıtlarını bulmak için <code class="language-plaintext highlighter-rouge">all</code> metodunu kullanabiliriz.
Bu bir <em>sınıf</em> metodudur, bu yüzden Product üzerinde kullanabiliriz (yukarıdaki <code class="language-plaintext highlighter-rouge">save</code> gibi product örneklemesi üzerinde çağıracağımız bir örnekleme metoduna karşılık gelir).</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.all
  Product Load (0.1ms)  SELECT "products".* FROM "products" /* loading for pp */ LIMIT 11 /*application='Store'*/
</span><span class="gp">=&gt; [#&lt;Product:0x0000000121845158 id: 1, name: "T-Shirt", created_at: "2024-11-09 16:35:01.117836000 +0000", updated_at: "2024-11-09 16:35:01.117836000 +0000"&gt;</span><span class="p">,</span>
<span class="gp"> #&lt;Product:0x0000000121845018 id: 2, name: "Pants", created_at: "2024-11-09 16:36:01.856751000 +0000", updated_at: "2024-11-09 16:36:01.856751000 +0000"&gt;</span><span class="p">]</span>
</code></pre></div></div>

<p>Bu, <code class="language-plaintext highlighter-rouge">products</code> tablosundaki tüm kayıtları yüklemek için bir <code class="language-plaintext highlighter-rouge">SELECT</code> SQL sorgusu oluşturur. Her kayıt otomatik olarak Product Active Record modelimizin bir örneğine dönüştürülür, böylece Ruby’den onlarla kolayca çalışabiliriz.</p>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    <code>all</code> metodu; filtreleme, sıralama ve diğer veritabanı işlemlerini yürütme özelliklerine sahip veritabanı kayıtlarının Array benzeri bir koleksiyonu olan bir <code>ActiveRecord::Relation</code> nesnesini döndürür.
  </div>
</div>

<h3 id="kayıtları-filtreleme-ve-sıralama">Kayıtları Filtreleme ve Sıralama</h3>

<p>Veritabanımızdaki sonuçları filtrelemek istersek ne olur? Kayıtları bir sütuna göre filtrelemek için <code class="language-plaintext highlighter-rouge">where</code> kullanabiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.where(name: "Pants")
  Product Load (1.5ms)  SELECT "products".* FROM "products" WHERE "products"."name" = 'Pants' /* loading for pp */ LIMIT 11 /*application='Store'*/
</span><span class="gp">=&gt; [#&lt;Product:0x000000012184d858 id: 2, name: "Pants", created_at: "2024-11-09 16:36:01.856751000 +0000", updated_at: "2024-11-09 16:36:01.856751000 +0000"&gt;</span><span class="p">]</span>
</code></pre></div></div>

<p>Bu bir <code class="language-plaintext highlighter-rouge">SELECT</code> SQL sorgusu oluşturur, ancak <code class="language-plaintext highlighter-rouge">"Pants"</code> ile eşleşen bir <code class="language-plaintext highlighter-rouge">name</code>‘e sahip kayıtları filtrelemek için bir <code class="language-plaintext highlighter-rouge">WHERE</code> cümleciği de ekler. Bu aynı zamanda bir <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation</code> döndürür çünkü birden fazla kayıt aynı isme sahip olabilir.</p>

<p>Kayıtları isme göre artan alfabetik sırada sıralamak için <code class="language-plaintext highlighter-rouge">order(name: :asc)</code> kullanabiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.order(name: :asc)
  Product Load (0.3ms)  SELECT "products".* FROM "products" /* loading for pp */ ORDER BY "products"."name" ASC LIMIT 11 /*application='Store'*/
</span><span class="gp">=&gt; [#&lt;Product:0x0000000120e02a88 id: 2, name: "Pants", created_at: "2024-11-09 16:36:01.856751000 +0000", updated_at: "2024-11-09 16:36:01.856751000 +0000"&gt;</span><span class="p">,</span>
<span class="gp"> #&lt;Product:0x0000000120e02948 id: 1, name: "T-Shirt", created_at: "2024-11-09 16:35:01.117836000 +0000", updated_at: "2024-11-09 16:35:01.117836000 +0000"&gt;</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="kayıtları-bulma">Kayıtları Bulma</h3>

<p>Peki ya belirli bir kaydı bulmak istiyorsak?</p>

<p>Bunu, tek bir kaydı ID’ye göre aramak için <code class="language-plaintext highlighter-rouge">find</code> sınıf metodunu kullanarak yapabiliriz. Aşağıdaki kodu kullanarak metodu çağırın ve belirli bir ID girin:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.find(1)
  Product Load (0.2ms)  SELECT "products".* FROM "products" WHERE "products"."id" = 1 LIMIT 1 /*application='Store'*/
</span><span class="gp">=&gt; #&lt;Product:0x000000012054af08 id: 1, name: "T-Shirt", created_at: "2024-11-09 16:35:01.117836000 +0000", updated_at: "2024-11-09 16:35:01.117836000 +0000"&gt;</span><span class="w">
</span></code></pre></div></div>

<p>Bu bir <code class="language-plaintext highlighter-rouge">SELECT</code> sorgusu oluşturur, ancak <code class="language-plaintext highlighter-rouge">id</code> sütunu için aktarılan <code class="language-plaintext highlighter-rouge">1</code> ile eşleşen bir <code class="language-plaintext highlighter-rouge">WHERE</code> belirtir. Ayrıca, yalnızca tek bir kayıt döndürmek için bir <code class="language-plaintext highlighter-rouge">LIMIT</code> ekler.</p>

<p>Bu kez, veritabanından yalnızca tek bir kayıt aldığımız için <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation</code> yerine bir <code class="language-plaintext highlighter-rouge">Product</code> örneği alıyoruz.</p>

<h3 id="kayıtları-güncelleme">Kayıtları Güncelleme</h3>

<p>Kayıtlar 2 şekilde güncellenebilir: <code class="language-plaintext highlighter-rouge">update</code> kullanılarak veya öznitelikler atandıktan sonra <code class="language-plaintext highlighter-rouge">save</code> çağrısı yapılarak.</p>

<p>Bir Product örneği üzerinde <code class="language-plaintext highlighter-rouge">update</code> çağrısı yapabilir ve veritabanına kaydedilecek yeni özelliklerin bir Hash’ini iletebiliriz. Bu; öznitelikleri atayacak, doğrulamaları (validations) çalıştıracak ve değişiklikleri tek bir metot çağrısında veritabanına kaydedecektir.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product = Product.find(1)
store(dev)&gt; product.update(name: "Shoes")
  TRANSACTION (0.1ms)  BEGIN immediate TRANSACTION /*application='Store'*/
  Product Update (0.3ms)  UPDATE "products" SET "name" = 'Shoes', "updated_at" = '2024-11-09 22:38:19.638912' WHERE "products"."id" = 1 /*application='Store'*/
  TRANSACTION (0.4ms)  COMMIT TRANSACTION /*application='Store'*/
</span><span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Bu, veritabanındaki “T-Shirt” ürününün adını “Shoes” olarak güncelledi.
Bunu <code class="language-plaintext highlighter-rouge">Product.all</code> dosyasını tekrar çalıştırarak görün.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.all
</span></code></pre></div></div>

<p>İki ürün göreceksiniz: Shoes ve Pants.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">  Product Load (0.3ms)  SELECT "products".* FROM "products" /* loading for pp */ LIMIT 11 /*application='Store'*/
</span><span class="p">=&gt;</span>
<span class="p">[</span><span class="kt">#&lt;</span><span class="no">Product</span><span class="p">:</span><span class="mh">0x000000012c0f7300</span>
  <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"Shoes"</span><span class="p">,</span>
  <span class="ss">created_at: </span><span class="s2">"2024-12-02 20:29:56.303546000 +0000"</span><span class="p">,</span>
<span class="gp">  updated_at: "2024-12-02 20:30:14.127456000 +0000"&gt;</span><span class="p">,</span>
<span class="c"> #&lt;Product:0x000000012c0f71c0
</span><span class="go">  id: 2,
  name: "Pants",
  created_at: "2024-12-02 20:30:02.997261000 +0000",
</span><span class="gp">  updated_at: "2024-12-02 20:30:02.997261000 +0000"&gt;</span><span class="p">]</span>
</code></pre></div></div>

<p>Alternatif olarak, öznitelikleri atayabilir, değişiklikleri doğrulamaya ve veritabanına kaydetmeye hazır olduğumuzda <code class="language-plaintext highlighter-rouge">save</code> çağrısı yapabiliriz.</p>

<p>“Shoes” adını yeniden “T-Shirt” olarak değiştirelim.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product = Product.find(1)
store(dev)&gt; product.name = "T-Shirt"
</span><span class="p">=&gt;</span> <span class="s2">"T-Shirt"</span>
<span class="n">store</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">product</span><span class="p">.</span><span class="nf">save</span>
  <span class="no">TRANSACTION</span> <span class="p">(</span><span class="mf">0.1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span> <span class="n">immediate</span> <span class="no">TRANSACTION</span> <span class="sr">/*application='Store'*/</span>
  <span class="no">Product</span> <span class="no">Update</span> <span class="p">(</span><span class="mf">0.2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">UPDATE</span> <span class="s2">"products"</span> <span class="no">SET</span> <span class="s2">"name"</span> <span class="o">=</span> <span class="s1">'T-Shirt'</span><span class="p">,</span> <span class="s2">"updated_at"</span> <span class="o">=</span> <span class="s1">'2024-11-09 22:39:09.693548'</span> <span class="no">WHERE</span> <span class="s2">"products"</span><span class="o">.</span><span class="s2">"id"</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/*</span><span class="n">application</span><span class="o">=</span><span class="s1">'Store'</span><span class="o">*</span><span class="sr">/
  TRANSACTION (0.0ms)  COMMIT TRANSACTION /</span><span class="o">*</span><span class="n">application</span><span class="o">=</span><span class="s1">'Store'</span><span class="o">*</span><span class="sr">/
=&gt; true
</span></code></pre></div></div>

<h3 id="kayıtları-silme">Kayıtları Silme</h3>

<p>Bir kaydı veritabanından silmek için <code class="language-plaintext highlighter-rouge">destroy</code> metodu kullanılabilir.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product.destroy
  TRANSACTION (0.1ms)  BEGIN immediate TRANSACTION /*application='Store'*/
  Product Destroy (0.4ms)  DELETE FROM "products" WHERE "products"."id" = 1 /*application='Store'*/
  TRANSACTION (0.1ms)  COMMIT TRANSACTION /*application='Store'*/
</span><span class="gp">=&gt; #&lt;Product:0x0000000125813d48 id: 1, name: "T-Shirt", created_at: "2024-11-09 22:39:38.498730000 +0000", updated_at: "2024-11-09 22:39:38.498730000 +0000"&gt;</span><span class="w">
</span></code></pre></div></div>

<p>Bu işlem T-Shirt ürününü veritabanımızdan sildi. Bunu <code class="language-plaintext highlighter-rouge">Product.all</code> ile doğrulayarak yalnızca Pants ürününü döndürdüğünü görebiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; Product.all
  Product Load (1.9ms)  SELECT "products".* FROM "products" /* loading for pp */ LIMIT 11 /*application='Store'*/
</span><span class="p">=&gt;</span>
<span class="p">[</span><span class="kt">#&lt;</span><span class="no">Product</span><span class="p">:</span><span class="mh">0x000000012abde4c8</span>
  <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"Pants"</span><span class="p">,</span>
  <span class="ss">created_at: </span><span class="s2">"2024-11-09 22:33:19.638912000 +0000"</span><span class="p">,</span>
<span class="gp">  updated_at: "2024-11-09 22:33:19.638912000 +0000"&gt;</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="doğrulamalar">Doğrulamalar</h3>

<p>Active Record, veritabanına eklenen verilerin belirli kurallara uymasını sağlamanıza olanak tanıyan <em>doğrulamalar</em> (validations) sağlar.</p>

<p>Tüm ürünlerin bir <code class="language-plaintext highlighter-rouge">name</code>‘e sahip olması gerektiğinden emin olmak için Product modeline bir <code class="language-plaintext highlighter-rouge">presence</code> doğrulaması ekleyelim.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Rails’in geliştirme sırasında değişiklikleri otomatik olarak yeniden yüklediğini hatırlayabilirsiniz. Ancak, kodda güncelleme yaptığınızda konsol çalışıyorsa, konsolu manuel olarak yenilemeniz gerekir. Şimdi bunu “reload!” komutunu çalıştırarak yapalım.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; reload!
Reloading...
</span></code></pre></div></div>

<p>Rails konsolunda isimsiz bir Product oluşturmayı deneyelim.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product = Product.new
store(dev)&gt; product.save
</span><span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<p>Bu kez <code class="language-plaintext highlighter-rouge">save</code>, <code class="language-plaintext highlighter-rouge">name</code> özniteliği belirtilmediği için <code class="language-plaintext highlighter-rouge">false</code> döndürür.</p>

<p>Rails, geçerli girdiden emin olmak için oluşturma, güncelleme ve kaydetme işlemleri sırasında otomatik olarak doğrulamaları çalıştırır. Doğrulamalar tarafından oluşturulan hataların bir listesini görmek için, örnekleme üzerinde <code class="language-plaintext highlighter-rouge">errors</code> çağrısı yapabiliriz.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product.errors
</span><span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveModel</span><span class="o">::</span><span class="no">Errors</span> <span class="p">[</span><span class="kt">#&lt;</span><span class="no">ActiveModel</span><span class="o">::</span><span class="no">Error</span> <span class="n">attribute</span><span class="o">=</span><span class="nb">name</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="n">blank</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{}</span><span class="kt">&gt;</span><span class="p">]</span><span class="kt">&gt;</span>
</code></pre></div></div>

<p>Bu, bize tam olarak hangi hataların mevcut olduğunu söyleyebilen bir <code class="language-plaintext highlighter-rouge">ActiveModel::Errors</code> nesnesi döndürür.</p>

<p>Ayrıca bizim için kullanıcı arayüzümüzde kullanabileceğimiz dostça hata mesajları da oluşturabilir.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product.errors.full_messages
</span><span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"Name can't be blank"</span><span class="p">]</span>
</code></pre></div></div>

<p>Şimdi Products için bir web arayüzü oluşturalım.</p>

<p>Şimdilik konsolla işimiz bitti, bu yüzden <code class="language-plaintext highlighter-rouge">exit</code> komutunu çalıştırarak konsoldan çıkabilirsiniz.</p>

<h2 id="bir-i̇steğin-railsteki-yolculuğu">Bir İsteğin Rails’teki Yolculuğu</h2>

<p>Rails’in “Merhaba” demesini sağlamak için en azından bir <em>route</em>, bir <em>action</em> içeren bir <em>controller</em> ve bir <em>view</em> oluşturmanız gerekir. Route, bir isteği bir controller eylemiyle (action) eşler. Bir controller eylemi, isteği işlemek için gerekli çalışmaları gerçekleştirir ve view için verileri hazırlar. Bir view, verileri istenen biçimde görüntüler.</p>

<p>Uygulanma açısından: Route’lar bir Ruby <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL (Domain-Specific Language)</a> dili ile yazılmış kurallardır. Controller’lar Ruby sınıflarıdır ve genel metotları eylemlerdir. View’ler ise genellikle HTML ve Ruby karışımıyla yazılmış şablonlardır.</p>

<p>Kısaca bu şekilde, ancak bu adımların her birini daha ayrıntılı olarak inceleyeceğiz.</p>

<h2 id="route">Route</h2>

<p>Rails’te route, gelen bir HTTP isteğinin işlenmek üzere uygun controller’a ve eyleme nasıl yönlendirileceğini belirleyen URL’in bir parçasıdır. İlk olarak, URL’ler ve HTTP İstek metotları hakkında hızlı bir hatırlatma yapalım.</p>

<h3 id="urlin-parçaları">URL’in Parçaları</h3>

<p>Bir URL’in farklı parçalarını inceleyelim:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://example.org/products?sale=true&amp;sort=asc
</code></pre></div></div>

<p>Bu URL’de her parçanın bir adı vardır:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">https</code> bir <strong>protokol</strong>dür.</li>
  <li><code class="language-plaintext highlighter-rouge">example.org</code> bir <strong>hizmet sağlayıcı</strong>dır.</li>
  <li><code class="language-plaintext highlighter-rouge">/products</code> bir <strong>yol</strong> adıdır.</li>
  <li><code class="language-plaintext highlighter-rouge">?sale=true&amp;sort=asc</code> bir <strong>sorgu parametresi</strong>dir.</li>
</ul>

<h3 id="http-metotları-ve-amaçları">HTTP Metotları ve Amaçları</h3>

<p>HTTP istekleri, sunucuya belirli bir URL için hangi eylemi gerçekleştirmesi gerektiğini söylemek için metotlar kullanır. İşte en yaygın metotlar:</p>

<ul>
  <li>Bir <code class="language-plaintext highlighter-rouge">GET</code> isteği, sunucuya belirli bir URL için verileri almasını söyler (örn,
bir sayfa yükleme veya bir kayıt getirme).</li>
  <li>Bir <code class="language-plaintext highlighter-rouge">POST</code> isteği, işlenmek üzere URL’e veri gönderir (genellikle yeni bir kayıt oluşturur).</li>
  <li>Bir <code class="language-plaintext highlighter-rouge">PUT</code> veya <code class="language-plaintext highlighter-rouge">PATCH</code> isteği, mevcut bir kaydı güncellemek için bir URL’e veri gönderir.</li>
  <li>Bir URL’e yapılan <code class="language-plaintext highlighter-rouge">DELETE</code> isteği sunucuya bir kaydı silmesini söyler.</li>
</ul>

<h3 id="railste-route">Rails’te Route</h3>

<p>Rails’teki bir <code class="language-plaintext highlighter-rouge">route</code> , bir HTTP metodu ile bir URL yolunu eşleştiren bir kod satırını ifade eder. Route ayrıca Rails’e bir isteğe hangi <code class="language-plaintext highlighter-rouge">controller</code> ve <code class="language-plaintext highlighter-rouge">action</code>‘ın yanıt vermesi gerektiğini söyler.</p>

<p>Rails’te bir route tanımlamak için kod editörünüze geri dönün ve
aşağıdaki route’u <code class="language-plaintext highlighter-rouge">config/routes.rb</code> dosyasına ekleyin.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/products"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#index"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bu route Rails’e <code class="language-plaintext highlighter-rouge">/products</code> yoluna GET istekleri aramasını söyler. Bu örnekte, isteğin yönlendirileceği yer için <code class="language-plaintext highlighter-rouge">"products#index"</code>‘i belirttik.</p>

<p>Rails eşleşen bir istek gördüğünde, isteği <code class="language-plaintext highlighter-rouge">ProductsController</code> ve bu controller’ın içindeki <code class="language-plaintext highlighter-rouge">index</code> eylemine gönderecektir. Rails bu şekilde isteği işleyecek ve tarayıcıya bir yanıt döndürecektir.</p>

<p>Route’larımızda protokol, domain (alan adı) veya sorgu parametrelerini belirtmemize gerek olmadığını fark edeceksiniz. Bunun temel nedeni; protokol ve domain’in, isteğin sunucunuza ulaşmasını sağlamasıdır. Buradan, Rails isteği alır ve hangi route’ların tanımlandığına bağlı olarak isteğe yanıt vermek için hangi yolu kullanacağını bilir. Sorgu parametreleri, Rails’in isteğe uygulamak için kullanabileceği seçenekler gibidir; bu nedenle genellikle controller’da verileri filtrelemek için kullanılırlar.</p>

<picture class="flowdiagram">
  <source srcset="/assets/images/rails/getting_started/routing_dark.jpg" media="(prefers-color-scheme:dark)" />
  <img src="/assets/images/rails/getting_started/routing_light.jpg" />
</picture>

<p>Başka bir örneğe bakalım. Bu satırı önceki route’tan sonra ekleyin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post</span> <span class="s2">"/products"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#create"</span>
</code></pre></div></div>

<p>Burada, Rails’e “/products” adresine POST isteklerini almasını ve bunları <code class="language-plaintext highlighter-rouge">create</code> eylemini kullanarak <code class="language-plaintext highlighter-rouge">ProductsController</code> ile işlemesini söyledik.</p>

<p>Route’ların belirli kalıplara sahip URL’ler ile eşleşmesi de gerekebilir. Peki bu nasıl çalışır?</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/products/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#show"</span>
</code></pre></div></div>

<p>Bu route’un içinde <code class="language-plaintext highlighter-rouge">:id</code> var. Buna <code class="language-plaintext highlighter-rouge">parametre</code> denir ve bu, daha sonra isteği işlemek için kullanılmak üzere URL’in bir bölümünü yakalar.</p>

<p>Bir kullanıcı <code class="language-plaintext highlighter-rouge">/products/1</code> öğesini ziyaret ederse, <code class="language-plaintext highlighter-rouge">:id</code> parametresi <code class="language-plaintext highlighter-rouge">1</code> olarak ayarlanır ve bu, controller eyleminde 1 ID’sine sahip Product kaydını aramak ve görüntülemek için kullanılabilir. <code class="language-plaintext highlighter-rouge">/products/2</code>, ID’si 2 olan Product’ı görüntüler ve bu böyle devam eder.</p>

<p>Route parametrelerinin Integer olması da gerekmez.</p>

<p>Örneğin, makaleler içeren bir blogunuz olabilir ve <code class="language-plaintext highlighter-rouge">/blog/hello-world</code> ile aşağıdaki route’u eşleştirebilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/blog/:title"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"blog#show"</span>
</code></pre></div></div>

<p>Rails, <code class="language-plaintext highlighter-rouge">/blog/hello-world</code> içinden <code class="language-plaintext highlighter-rouge">hello-world</code> öğesini yakalayacaktır ve bu, eşleşen title’a sahip blog gönderisini aramak için kullanılabilir.</p>

<h4 id="crud-routeları">CRUD Route’ları</h4>

<p>Bir kaynak için genellikle ihtiyaç duyacağınız 4 yaygın eylem vardır: Create (Oluştur), Read (Oku), Update (Güncelle), Delete (Sil) (CRUD). Bu da 8 tipik route’a karşılık gelir:</p>

<ul>
  <li>Index - Tüm kayıtları gösterir</li>
  <li>New - Yeni bir kayıt oluşturmak için bir form oluşturur</li>
  <li>Create - Yeni form gönderimini işler, hataları ele alır ve kaydı oluşturur</li>
  <li>Show - Spesifik bir kaydı görüntülemek için işler</li>
  <li>Edit - Spesifik bir kaydı güncellemek için bir formu işler</li>
  <li>Update (full - tam) - Edit formu gönderimini yönetir, hataları ele alır ve tüm kaydı günceller ve genellikle bir PUT isteği tarafından tetiklenir.</li>
  <li>Update (partial - kısmi) - Edit formu gönderimini yönetir, hataları ele alır ve kaydın belirli özniteliklerini günceller ve genellikle bir PATCH isteği tarafından tetiklenir.</li>
  <li>Destroy - Spesifik bir kaydı silmeyi yönetir</li>
</ul>

<p>Bu CRUD eylemleri için aşağıdaki şekilde route’lar ekleyebiliriz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/products"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#index"</span>

<span class="n">get</span> <span class="s2">"/products/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#new"</span>
<span class="n">post</span> <span class="s2">"/products"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#create"</span>

<span class="n">get</span> <span class="s2">"/products/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#show"</span>

<span class="n">get</span> <span class="s2">"/products/:id/edit"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#edit"</span>
<span class="n">patch</span> <span class="s2">"/products/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#update"</span>
<span class="n">put</span> <span class="s2">"/products/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#update"</span>

<span class="n">delete</span> <span class="s2">"/products/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"products#destroy"</span>
</code></pre></div></div>

<h4 id="kaynak-routelar">Kaynak Route’lar</h4>

<p>Bu route’ları her seferinde yazmak gereksizdir, bu yüzden Rails bunları tanımlamak için bir kısayol sağlar. Aynı CRUD route’larının tümünü oluşturmak için yukarıdaki route’ları bu tek satırla değiştirin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:products</span>
</code></pre></div></div>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Tüm bu CRUD eylemlerini istemiyorsanız, tam olarak neye ihtiyacınız olduğunu belirtirsiniz. Ayrıntılar için <a href="../routing/">Routing</a> bölümüne göz atın.
  </div>
</div>

<h3 id="route-komutları">Route Komutları</h3>

<p>Rails, uygulamanızın yanıt verdiği tüm route’ları görüntüleyen bir komut sağlar.</p>

<p>Terminalinizde aşağıdaki komutu çalıştırın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails routes
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">resources :products</code> tarafından oluşturulan route’ların çıktısını aşağıdaki şekilde göreceksiniz:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                  Prefix Verb   URI Pattern                                                                                       Controller#Action
                                products GET    /products(.:format)                                                                               products#index
                                         POST   /products(.:format)                                                                               products#create
                             new_product GET    /products/new(.:format)                                                                           products#new
                            edit_product GET    /products/:id/edit(.:format)                                                                      products#edit
                                 product GET    /products/:id(.:format)                                                                           products#show
                                         PATCH  /products/:id(.:format)                                                                           products#update
                                         PUT    /products/:id(.:format)                                                                           products#update
                                         DELETE /products/:id(.:format)                                                                           products#destroy
</code></pre></div></div>

<p>Ayrıca health checks gibi diğer yerleşik Rails özelliklerinden gelen route’ları da göreceksiniz.</p>

<h2 id="controller--action">Controller &amp; Action</h2>

<p>Artık Products için route’lar tanımladığımıza göre, bu URL’lere gelen istekleri işlemek için controller ve action’ları uygulayalım.</p>

<p>Bu komut, bir index action’ı ile bir <code class="language-plaintext highlighter-rouge">ProductsController</code> oluşturacaktır. Route’ları zaten ayarladığımız için, bir flag (aşağıdaki –skip-routes) kullanarak bu kısmı atlayabiliriz.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate controller Products index <span class="nt">--skip-routes</span>
      create  app/controllers/products_controller.rb
      invoke  erb
      create    app/views/products
      create    app/views/products/index.html.erb
      invoke  test_unit
      create    <span class="nb">test</span>/controllers/products_controller_test.rb
      invoke  helper
      create    app/helpers/products_helper.rb
      invoke    test_unit
</code></pre></div></div>

<p>Bu komut controller için bir avuç dosya oluşturur:</p>

<ul>
  <li>Controller’ın kendisini</li>
  <li>Oluşturduğumuz controller için bir views klasörü</li>
  <li>Controller oluştururken belirttiğimiz action için bir view dosyası</li>
  <li>Bu controller için bir test dosyası</li>
  <li>View’lerdeki mantığı ayıklamak için bir helper dosyası</li>
</ul>

<p>Şimdi <code class="language-plaintext highlighter-rouge">app/controllers/products_controller.rb</code> dosyasında tanımlanan ProductsController’a bir göz atalım. Şuna benziyor:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Dosya adının <code>products_controller.rb</code> olduğunu ve bu dosyanın tanımladığı <code>ProductsController</code> sınıfının alt çizgili hali olduğunu fark edebilirsiniz. Bu kalıp, Rails'in diğer dillerde gördüğünüz gibi <code>require</code> kullanmak zorunda kalmadan kodu otomatik olarak yüklemesine yardımcı olur.
  </div>
</div>

<p>Buradaki <code class="language-plaintext highlighter-rouge">index</code> metodu bir Action’dır. Boş bir metot olmasına rağmen, Rails varsayılan olarak eşleşen bir isme sahip bir şablon oluşturacaktır.</p>

<p><code class="language-plaintext highlighter-rouge">index</code> action’ı <code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> dosyasını oluşturacaktır. Bu dosyayı kod editörümüzde açarsak, oluşturduğu HTML’i görürüz.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Products#index<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/products/index.html.erb<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<h3 id="i̇stek-oluşturma">İstek Oluşturma</h3>

<p>Bunu tarayıcımızda görelim. İlk olarak, Rails sunucusunu başlatmak için terminalinizde <code class="language-plaintext highlighter-rouge">bin/rails server</code> komutunu çalıştırın. Ardından http://localhost:3000 adresini açın. Rails karşılama sayfasını göreceksiniz.</p>

<p>Tarayıcıda http://localhost:3000/products adresini açarsak, Rails product index’ini HTML olarak oluşturacaktır.</p>

<p>Tarayıcımız <code class="language-plaintext highlighter-rouge">/products</code> isteğinde bulundu ve Rails bu route’u <code class="language-plaintext highlighter-rouge">products#index</code> ile eşleştirdi. Rails isteği <code class="language-plaintext highlighter-rouge">ProductsController</code>‘a gönderdi ve <code class="language-plaintext highlighter-rouge">index</code> action’ını çağırdı. Bu action boş olduğu için, Rails eşleşen şablonu <code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> adresinde işledi ve tarayıcımıza döndürdü. Çok güzel!</p>

<p><code class="language-plaintext highlighter-rouge">config/routes.rb</code> dosyasını açıp bu satırı eklersek eğer, Rails’e ana dizin route’unun Products index action’ını render etmesi/ekranda göstermesi gerektiğini söyleyebiliriz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span> <span class="s2">"products#index"</span>
</code></pre></div></div>

<p>Şimdi http://localhost:3000 adresini ziyaret ettiğinizde, Rails Products#index’i oluşturacaktır.</p>

<h3 id="örnek-değişkenler">Örnek Değişkenler</h3>

<p>Bunu bir adım daha ileri götürelim ve veritabanımızdan bazı kayıtları render edelim.</p>

<p><code class="language-plaintext highlighter-rouge">index</code> action’ında bir veritabanı sorgusu ekleyelim ve bunu bir instance variable’a atayalım. Rails, view’lerle veri paylaşmak için instance variable’ları (@ ile başlayan değişkenler) kullanır.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> dosyasında HTML’i şu ERB ile değiştirebiliriz:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">debug</span> <span class="vi">@products</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>ERB, <a href="https://docs.ruby-lang.org/en/master/ERB.html">Embedded Ruby</a>‘nin kısaltmasıdır ve Rails ile dinamik olarak HTML oluşturmak için Ruby kodu çalıştırmamızı sağlar. <code class="language-plaintext highlighter-rouge">&lt;%= %&gt;</code> etiketi ERB’ye içindeki Ruby kodunu çalıştırmasını ve dönüş değerini çıktı olarak vermesini söyler. Bizim durumumuzda bu, <code class="language-plaintext highlighter-rouge">@products</code>‘ı alır, YAML’a dönüştürür ve YAML’ı çıktı olarak verir.</p>

<p>Şimdi tarayıcınızda http://localhost:3000/ adresini yenileyin, çıktının değiştiğini göreceksiniz. Gördüğünüz şey, veritabanınızdaki kayıtların YAML formatında görüntülenmesidir.</p>

<p><code class="language-plaintext highlighter-rouge">debug</code> helper’ı, hata ayıklama konusunda yardımcı olmak için değişkenleri YAML formatında yazdırır. Örneğin, dikkat etmeyip çoğul <code class="language-plaintext highlighter-rouge">@products</code> yerine tekil <code class="language-plaintext highlighter-rouge">@product</code> yazdıysanız, debug helper’ı değişkenin controller’da doğru şekilde ayarlanmadığını belirlemenize yardımcı olabilir.</p>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Mevcut olan daha fazla helper görmek için <a href="../action_view_helpers/">Action View Helper Kılavuzu</a>'na göz atın.
  </div>
</div>

<p>Tüm product/ürün isimlerimizi render etmek için <code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> dosyasını güncelleyelim.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Products<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"products"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@products</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>ERB kullanarak, bu kod <code class="language-plaintext highlighter-rouge">@products</code> <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation</code> nesnesindeki her ürün boyunca döngü gerçekleştirir ve ürün adını içeren bir <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> etiketi render eder.</p>

<p>Bu sefer yeni bir ERB etiketi de kullandık. <code class="language-plaintext highlighter-rouge">&lt;% %&gt;</code> Ruby kodunu değerlendirir ancak dönüş değerini çıktı olarak vermez. Bu, HTML’imizde istemediğimiz bir array çıktısı verecek olan <code class="language-plaintext highlighter-rouge">@products.each</code>‘in çıktısını yok sayar.</p>

<h3 id="crud-eylemleri">CRUD Eylemleri</h3>

<p>Birbirinden ayrı ürünlere erişebilmemiz gerekiyor. Bu, bir kaynağı okumak için CRUD’daki R’dir.</p>

<p><code class="language-plaintext highlighter-rouge">resources :products</code> route’umuzla bireysel ürünler için route’u zaten tanımladık. Bu, <code class="language-plaintext highlighter-rouge">products#show</code>‘a işaret eden <code class="language-plaintext highlighter-rouge">/products/:id</code> route’unu oluşturur.</p>

<p>Şimdi bu action’ı <code class="language-plaintext highlighter-rouge">ProductsController</code>‘a eklememiz ve çağrıldığında ne olacağını tanımlamamız gerekiyor.</p>

<h3 id="ürünleri-bireysel-olarak-gösterme">Ürünleri Bireysel Olarak Gösterme</h3>

<p>Products Controller’ı açın ve <code class="language-plaintext highlighter-rouge">show</code> action’ını şu şekilde ekleyin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Buradaki <code class="language-plaintext highlighter-rouge">show</code> action’ı <em>tekil</em> <code class="language-plaintext highlighter-rouge">@product</code> tanımlar çünkü veritabanından tek bir kayıt yüklüyor, yani başka bir deyişle söylemek gerekirse: Bu, tek bir ürünü göster, demek. <code class="language-plaintext highlighter-rouge">index</code>‘te çoğul <code class="language-plaintext highlighter-rouge">@products</code> kullanırız çünkü birden fazla ürün yüklüyoruz.</p>

<p>Veritabanını sorgulamak için istek parametrelerine erişmek amacıyla <code class="language-plaintext highlighter-rouge">params</code> kullanırız. Bu durumda, <code class="language-plaintext highlighter-rouge">/products/:id</code> route’umuzdaki <code class="language-plaintext highlighter-rouge">:id</code>‘yi kullanıyoruz. <code class="language-plaintext highlighter-rouge">/products/1</code> adresini ziyaret ettiğimizde, params hash’i <code class="language-plaintext highlighter-rouge">{id: 1}</code> içerir ve bu da <code class="language-plaintext highlighter-rouge">show</code> action’ımızın veritabanından ID’si <code class="language-plaintext highlighter-rouge">1</code> olan Product’ı yüklemek için <code class="language-plaintext highlighter-rouge">Product.find(1)</code> çağırmasıyla sonuçlanır.</p>

<p>Sırada show action’ı için bir view’e ihtiyacımız var. Rails isimlendirme kurallarını takip ederek, <code class="language-plaintext highlighter-rouge">ProductsController</code>, <code class="language-plaintext highlighter-rouge">app/views</code> içindeki <code class="language-plaintext highlighter-rouge">products</code> alt klasöründe view’leri bekler.</p>

<p><code class="language-plaintext highlighter-rouge">show</code> action’ı <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> adında bir dosya bekler. Bu dosyayı editörümüzde oluşturalım ve aşağıdaki içeriği ekleyelim:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Back"</span><span class="p">,</span> <span class="n">products_path</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Index sayfasının her ürün için show sayfasına link vermesi faydalı olur, böylece yönlendirme için onlara tıklayabiliriz. <code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> view’i güncelleyerek <code class="language-plaintext highlighter-rouge">show</code> action’ının path’i için bir anchor etiketi kullanarak bu yeni sayfaya link verebiliriz.</p>

<pre><code class="language-erb#6,8">&lt;h1&gt;Products&lt;/h1&gt;

&lt;div id="products"&gt;
  &lt;% @products.each do |product| %&gt;
    &lt;div&gt;
      &lt;a href="/products/&lt;%= product.id %&gt;"&gt;
        &lt;%= product.name %&gt;
      &lt;/a&gt;
    &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre>

<p>Bu sayfayı tarayıcınızda yenileyin. Çalıştığını göreceksiniz, ancak daha iyisini yapabiliriz.</p>

<p>Rails, path’ler ve URL’ler oluşturmak için helper metotları sağlar. <code class="language-plaintext highlighter-rouge">bin/rails routes</code> komutunu çalıştırdığınızda Prefix sütununu göreceksiniz. Bu prefix’ler, Ruby kodu ile URL oluşturmak için kullanabileceğiniz helper’larla eşleşir.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                  Prefix Verb   URI Pattern                                                                                       Controller#Action
                                products GET    /products(.:format)                                                                               products#index
                                 product GET    /products/:id(.:format)                                                                           products#show
</code></pre></div></div>

<p>Bu route prefix’leri bize aşağıdaki gibi helper’lar verir:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">products_path</code> <code class="language-plaintext highlighter-rouge">"/products"</code> oluşturur</li>
  <li><code class="language-plaintext highlighter-rouge">products_url</code> <code class="language-plaintext highlighter-rouge">"http://localhost:3000/products"</code> oluşturur</li>
  <li><code class="language-plaintext highlighter-rouge">product_path(1)</code> <code class="language-plaintext highlighter-rouge">"/products/1"</code> oluşturur</li>
  <li><code class="language-plaintext highlighter-rouge">product_url(1)</code> <code class="language-plaintext highlighter-rouge">"http://localhost:3000/products/1"</code> oluşturur</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">_path</code> tarayıcının mevcut domain için olduğunu anladığı göreceli (relative) bir path döndürür.</p>

<p><code class="language-plaintext highlighter-rouge">_url</code> protokol, host ve port dahil tam bir URL döndürür.</p>

<p>URL helper’ları tarayıcı dışında görüntülenecek e-postaları render etmek için faydalıdır.</p>

<p><code class="language-plaintext highlighter-rouge">link_to</code> helper’ıyla birleştirildiğinde, anchor etiketleri oluşturabilir ve bunu Ruby’de temiz bir şekilde yapmak için URL helper’ını kullanabiliriz. <code class="language-plaintext highlighter-rouge">link_to</code>, (<code class="language-plaintext highlighter-rouge">product.name</code>) linki için görüntülecek içeriği  ve <code class="language-plaintext highlighter-rouge">href</code> özelliği için link verilecek path veya URL’i (<code class="language-plaintext highlighter-rouge">product</code>) kabul eder.</p>

<p>Bu helper’ları kullanmak için kodu refactor edelim:</p>

<pre><code class="language-erb#6">&lt;h1&gt;Products&lt;/h1&gt;

&lt;div id="products"&gt;
  &lt;% @products.each do |product| %&gt;
    &lt;div&gt;
      &lt;%= link_to product.name, product_path(product.id) %&gt;
    &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre>

<h3 id="ürün-oluşturma">Ürün Oluşturma</h3>

<p>Şimdiye kadar ürünleri Rails konsolda oluşturmak zorunda kaldık, ancak bunu tarayıcıda çalışır hale getirelim.</p>

<p>Create için iki action oluşturmamız gerekiyor:</p>

<ol>
  <li>Ürün bilgilerini toplamak için yeni ürün formu</li>
  <li>Ürünü kaydetmek ve hataları kontrol etmek için controller’da create action’ı</li>
</ol>

<p>Controller action’larımızla başlayalım.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">new</code> action’ı form alanlarını görüntülemek için kullanacağımız yeni bir <code class="language-plaintext highlighter-rouge">Product</code> örneği oluşturur.</p>

<p><code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> dosyasını new action’ına link verecek şekilde güncelleyebiliriz.</p>

<pre><code class="language-erb#3">&lt;h1&gt;Products&lt;/h1&gt;

&lt;%= link_to "New product", new_product_path %&gt;

&lt;div id="products"&gt;
  &lt;% @products.each do |product| %&gt;
    &lt;div&gt;
      &lt;%= link_to product.name, product_path(product.id) %&gt;
    &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre>

<p>Bu yeni <code class="language-plaintext highlighter-rouge">Product</code> için formu render etmek amacıyla <code class="language-plaintext highlighter-rouge">app/views/products/new.html.erb</code> dosyasını oluşturalım.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New product<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@product</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Bu view’de ürün oluşturmak için HTML formu oluşturmak amacıyla Rails <code class="language-plaintext highlighter-rouge">form_with</code> helper’ını kullanıyoruz. Bu helper; CSRF token’lar, sağlanan <code class="language-plaintext highlighter-rouge">model:</code> temelinde URL oluşturma ve hatta submit butonu text’ini modele göre uyarlama gibi şeyleri işlemek için bir <em>form builder</em> kullanır.</p>

<p>Bu sayfayı tarayıcınızda açıp View Source yaparsanız, formun HTML’i şöyle görünecektir:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/products"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"UHQSKXCaFqy_aoK760zpSMUPy6TMnsLNgbPMABwN1zpW-Jx6k-2mISiF0ulZOINmfxPdg5xMyZqdxSW1UK-H-Q"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"product_name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"product[name]"</span> <span class="na">id=</span><span class="s">"product_name"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Create Product"</span> <span class="na">data-disable-with=</span><span class="s">"Create Product"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>Form builder güvenlik için bir CSRF token eklemiş, formu UTF-8 desteği için yapılandırmış, input field isimlerini ayarlamış ve hatta submit butonu için disabled durumu eklemiştir.</p>

<p>Form builder’a yeni bir <code class="language-plaintext highlighter-rouge">Product</code> örneği geçirdiğimiz için, otomatik olarak yeni bir kayıt oluşturmak için varsayılan route olan <code class="language-plaintext highlighter-rouge">/products</code>‘a <code class="language-plaintext highlighter-rouge">POST</code> isteği gönderecek şekilde yapılandırılmış bir form oluşturdu.</p>

<p>Bunu işlemek için öncelikle controller’ımızda <code class="language-plaintext highlighter-rouge">create</code> action’ını uygulamamız gerekiyor.</p>

<pre><code class="language-ruby#14-26">class ProductsController &lt; ApplicationController
  def index
    @products = Product.all
  end

  def show
    @product = Product.find(params[:id])
  end

  def new
    @product = Product.new
  end

  def create
    @product = Product.new(product_params)
    if @product.save
      redirect_to @product
    else
      render :new, status: :unprocessable_entity
    end
  end

  private
    def product_params
      params.expect(product: [ :name ])
    end
end
</code></pre>

<h4 id="güçlü-parametreler">Güçlü Parametreler</h4>

<p><code class="language-plaintext highlighter-rouge">create</code> action’ı form tarafından gönderilen veriyi işler, ancak güvenlik için filtrelenmesi gerekir. İşte <code class="language-plaintext highlighter-rouge">product_params</code> metodunun devreye girdiği yer burasıdır.</p>

<p><code class="language-plaintext highlighter-rouge">product_params</code>‘ta Rails’e, params’ı incelemesini ve değer olarak bir parametre array’i ile <code class="language-plaintext highlighter-rouge">:product</code> adında bir anahtar (key) olduğundan emin olmasını söylüyoruz. Products için izin verilen tek parametre <code class="language-plaintext highlighter-rouge">:name</code>‘dir ve Rails diğer tüm parametreleri yok sayacaktır. Bu, uygulamamızı hack’lemeye çalışabilecek kötü niyetli kullanıcılardan korur.</p>

<h4 id="hata-yönetimi">Hata Yönetimi</h4>

<p>Bu params’ları yeni <code class="language-plaintext highlighter-rouge">Product</code>‘a atadıktan sonra, onu veritabanına kaydetmeyi deneyebiliriz. <code class="language-plaintext highlighter-rouge">@product.save</code> Active Record’a doğrulamaları çalıştırmasını ve kaydı veritabanına kaydetmesini söyler.</p>

<p><code class="language-plaintext highlighter-rouge">save</code> başarılı olursa, yeni ürüne yönlendirmek istiyoruz. <code class="language-plaintext highlighter-rouge">redirect_to</code>‘ya bir Active Record nesnesi verildiğinde, Rails o kaydın show action’ı için bir path oluşturur.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">redirect_to</span> <span class="vi">@product</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">@product</code> bir <code class="language-plaintext highlighter-rouge">Product</code> örneği olduğu için, Rails model adını çoğullaştırır ve yönlendirme yapmak için <code class="language-plaintext highlighter-rouge">"/products/2"</code> üretmek amacıyla nesnenin ID’sini path’e dahil eder.</p>

<p><code class="language-plaintext highlighter-rouge">save</code> başarısız olduğunda ve kayıt geçerli olmadığında, kullanıcının geçersiz veriyi düzeltebilmesi için formu yeniden render etmek istiyoruz. <code class="language-plaintext highlighter-rouge">else</code> ile Rails’e <code class="language-plaintext highlighter-rouge">render :new</code> geçiyoruz. Rails <code class="language-plaintext highlighter-rouge">Products</code> controller’ında olduğumuzu bilir, bu yüzden <code class="language-plaintext highlighter-rouge">app/views/products/new.html.erb</code> dosyasını render etmelidir. <code class="language-plaintext highlighter-rouge">create</code>‘te <code class="language-plaintext highlighter-rouge">@product</code> değişkenini ayarladığımız için, o şablonu render edebiliriz ve form veritabanına kaydedilememiş olsa bile <code class="language-plaintext highlighter-rouge">Product</code> verimizle doldurulacaktır.</p>

<p>Ayrıca tarayıcıya bu POST isteğinin başarısız olduğunu ve buna göre işlem yapması gerektiğini söylemek için HTTP durumunu 422 Unprocessable Entity (İşlenemeyen Varlık) olarak ayarlıyoruz.</p>

<h3 id="ürünleri-düzenleme">Ürünleri Düzenleme</h3>

<p>Kayıtları düzenleme süreci kayıt oluşturmaya çok benzer. <code class="language-plaintext highlighter-rouge">new</code> ve <code class="language-plaintext highlighter-rouge">create</code> action’ları yerine <code class="language-plaintext highlighter-rouge">edit</code> ve <code class="language-plaintext highlighter-rouge">update</code> ile bunları yapacağız.</p>

<p>Bunları controller’da aşağıdaki şekilde uygulayalım:</p>

<pre><code class="language-ruby#23-34">class ProductsController &lt; ApplicationController
  def index
    @products = Product.all
  end

  def show
    @product = Product.find(params[:id])
  end

  def new
    @product = Product.new
  end

  def create
    @product = Product.new(product_params)
    if @product.save
      redirect_to @product
    else
      render :new, status: :unprocessable_entity
    end
  end

  def edit
    @product = Product.find(params[:id])
  end

  def update
    @product = Product.find(params[:id])
    if @product.update(product_params)
      redirect_to @product
    else
      render :edit, status: :unprocessable_entity
    end
  end

  private
    def product_params
      params.expect(product: [ :name ])
    end
end
</code></pre>

<p>Daha sonra <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> dosyasına bir “Edit” linki ekleyebiliriz:</p>

<pre><code class="language-erb#4">&lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;

&lt;%= link_to "Back", products_path %&gt;
&lt;%= link_to "Edit", edit_product_path(@product) %&gt;
</code></pre>

<h4 id="before-actionlar">Before Action’lar</h4>

<p><code class="language-plaintext highlighter-rouge">edit</code> ve <code class="language-plaintext highlighter-rouge">update</code> işlemleri <code class="language-plaintext highlighter-rouge">show</code> gibi mevcut bir veritabanı kaydı gerektirdiğinden bunu <code class="language-plaintext highlighter-rouge">before_action</code> içine kopyalayabiliriz.</p>

<p>Bir <code class="language-plaintext highlighter-rouge">before_action</code>, action’lar arasında paylaşılan kodu çekmenize ve action’dan <em>önce</em> çalıştırmanıza olanak tanır. Yukarıdaki controller kodunda <code class="language-plaintext highlighter-rouge">@product = Product.find(params[:id])</code> üç farklı metotta tanımlanmıştır. Bu sorguyu <code class="language-plaintext highlighter-rouge">set_product</code> adlı bir before action’a çıkarmak her action için kodumuzu temizler.</p>

<p>Bu, DRY (Don’t Repeat Yourself - Kendini Tekrar Etme) felsefesinin çalışan güzel bir örneğidir.</p>

<pre><code class="language-ruby#2,8-9,24-25,27-33,36-38">class ProductsController &lt; ApplicationController
  before_action :set_product, only: %i[ show edit update ]

  def index
    @products = Product.all
  end

  def show
  end

  def new
    @product = Product.new
  end

  def create
    @product = Product.new(product_params)
    if @product.save
      redirect_to @product
    else
      render :new, status: :unprocessable_entity
    end
  end

  def edit
  end

  def update
    if @product.update(product_params)
      redirect_to @product
    else
      render :edit, status: :unprocessable_entity
    end
  end

  private
    def set_product
      @product = Product.find(params[:id])
    end

    def product_params
      params.expect(product: [ :name ])
    end
end
</code></pre>

<h4 id="partial-çıkarma">Partial Çıkarma</h4>

<p>Yeni ürün oluşturmak için zaten bir form yazdık. Bunu edit ve update için yeniden kullanabilsek güzel olmaz mıydı? Bir view’i birden fazla yerde yeniden kullanmanıza olanak tanıyan “partials” adlı bir özellik kullanarak bunu yapabiliriz.</p>

<p>Formu <code class="language-plaintext highlighter-rouge">app/views/products/_form.html.erb</code> adlı bir dosyaya taşıyabiliriz. Dosya adı bunun bir partial olduğunu belirtmek için alt çizgi ile başlar.</p>

<p>Ayrıca herhangi bir instance variable’ı, partial’ı render ettiğimizde tanımlayabileceğimiz bir local variable (yerel değişken) ile değiştirmek istiyoruz. Bunu <code class="language-plaintext highlighter-rouge">@product</code>‘ı <code class="language-plaintext highlighter-rouge">product</code> ile değiştirerek yapacağız.</p>

<pre><code class="language-erb#1">&lt;%= form_with model: product do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :name %&gt;
    &lt;%= form.text_field :name %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Local variable'lar kullanmak partial'ların aynı sayfada her seferinde farklı bir değerle birden fazla kez yeniden kullanılmasına olanak tanır. Bu, index sayfası gibi öğe listelerini render ederken işe yarar.
  </div>
</div>

<p>Bu partial’ı <code class="language-plaintext highlighter-rouge">app/views/products/new.html.erb</code> view’inde kullanmak için formu bir render çağrısıyla değiştirebiliriz:</p>

<pre><code class="language-erb#3">&lt;h1&gt;New product&lt;/h1&gt;

&lt;%= render "form", product: @product %&gt;
&lt;%= link_to "Cancel", products_path %&gt;
</code></pre>

<p>Form partial sayesinde edit view’i  neredeyse tamamen aynı şey oluyor. <code class="language-plaintext highlighter-rouge">app/views/products/edit.html.erb</code> dosyasını aşağıdakilerle oluşturalım:</p>

<pre><code class="language-erb#3">&lt;h1&gt;Edit product&lt;/h1&gt;

&lt;%= render "form", product: @product %&gt;
&lt;%= link_to "Cancel", @product %&gt;
</code></pre>

<p>View partial’ları hakkında daha fazla bilgi edinmek için <a href="../action_view_overview/">Action View Kılavuzu</a>‘na göz atın.</p>

<h3 id="ürünleri-silme">Ürünleri Silme</h3>

<p>Uygulamamız gereken son özellik ise ürünleri silmek. <code class="language-plaintext highlighter-rouge">DELETE /products/:id</code> isteklerini işlemek için <code class="language-plaintext highlighter-rouge">ProductsController</code>‘ımıza bir <code class="language-plaintext highlighter-rouge">destroy</code> action’ı ekleyeceğiz.</p>

<p><code class="language-plaintext highlighter-rouge">before_action :set_product</code>‘a <code class="language-plaintext highlighter-rouge">destroy</code> eklemek, <code class="language-plaintext highlighter-rouge">@product</code> instance variable’ını diğer action’lar için yaptığımız şekilde ayarlamamızı sağlar.</p>

<pre><code class="language-ruby#2,35-38">class ProductsController &lt; ApplicationController
  before_action :set_product, only: %i[ show edit update destroy ]

  def index
    @products = Product.all
  end

  def show
  end

  def new
    @product = Product.new
  end

  def create
    @product = Product.new(product_params)
    if @product.save
      redirect_to @product
    else
      render :new, status: :unprocessable_entity
    end
  end

  def edit
  end

  def update
    if @product.update(product_params)
      redirect_to @product
    else
      render :edit, status: :unprocessable_entity
    end
  end

  def destroy
    @product.destroy
    redirect_to products_path
  end

  private
    def set_product
      @product = Product.find(params[:id])
    end

    def product_params
      params.expect(product: [ :name ])
    end
end
</code></pre>

<p>Bunun çalışması için, <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> dosyasına bir “Delete” butonu eklememiz gerekiyor:</p>

<pre><code class="language-erb#5">&lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;

&lt;%= link_to "Back", products_path %&gt;
&lt;%= link_to "Edit", edit_product_path(@product) %&gt;
&lt;%= button_to "Delete", @product, method: :delete, data: { turbo_confirm: "Are you sure?" } %&gt;
</code></pre>

<p><code class="language-plaintext highlighter-rouge">button_to</code>, içinde “Delete” yazılı bir buton bulunan bir form oluşturur. Bu butona tıklandığında, controller’ımızdaki <code class="language-plaintext highlighter-rouge">destroy</code> action’ını tetikleyen <code class="language-plaintext highlighter-rouge">/products/:id</code> adresine <code class="language-plaintext highlighter-rouge">DELETE</code> isteği oluşturan formu gönderir.</p>

<p><code class="language-plaintext highlighter-rouge">turbo_confirm</code> data özelliği, Turbo JavaScript kütüphanesine formu göndermeden önce kullanıcıdan onay istemesini söyler. Bunu kısa bir süre sonra daha ayrıntılı şekilde inceleyeceğiz.</p>

<h2 id="kimlik-doğrulama-ekleme">Kimlik Doğrulama Ekleme</h2>

<p>Herkes ürünleri düzenleyebilir veya silebilir, ki bu güvenli değil. Ürünleri yönetmek için bir kullanıcının kimlik doğrulaması (authentication) yapmış olmasını gerektirerek biraz güvenlik ekleyelim.</p>

<p>Rails, kullanabileceğimiz bir authentication generator ile birlikte gelir. User ve Session modelleri ile uygulamamıza giriş yapmak için gerekli controller’ları ve view’leri oluşturur.</p>

<p>Terminalinize geri dönün ve aşağıdaki komutu çalıştırın:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate authentication
</code></pre></div></div>

<p>Ardından veritabanına User ve Session tablolarını eklemek için migrate ile değişiklikleri uygulayın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p>Bir User oluşturmak için Rails konsolunu açın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails console
</code></pre></div></div>

<p>Rails konsolda User oluşturmak için <code class="language-plaintext highlighter-rouge">User.create!</code> metodunu kullanın. Örnek yerine kendi e-posta ve şifrenizi kullanmaktan çekinmeyin.</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; User.create! email_address: "you@example.org", password: "s3cr3t", password_confirmation: "s3cr3t"
</span></code></pre></div></div>

<p>Generator tarafından eklenen <code class="language-plaintext highlighter-rouge">bcrypt</code> gem’ini alması için Rails sunucunuzu yeniden başlatın. BCrypt, kimlik doğrulaması için şifreleri güvenli bir şekilde hash’lemek için kullanılır.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails server
</code></pre></div></div>

<p>Herhangi bir sayfayı ziyaret ettiğinizde, Rails kullanıcı adı ve şifre soracaktır. User kaydını oluştururken kullandığınız e-posta ve şifreyi girin.</p>

<p>http://localhost:3000/products/new adresini ziyaret ederek deneyin.</p>

<p>Doğru kullanıcı adı ve şifreyi girerseniz, geçiş yapmanıza izin verecektir. Tarayıcınız ayrıca bu kimlik bilgilerini gelecekteki istekler için saklayacaktır, böylece her sayfa görüntülemesinde yazmanız gerekmez.</p>

<h3 id="log-out-ekleme">Log Out Ekleme</h3>

<p>Uygulamadan çıkış yapmak için <code class="language-plaintext highlighter-rouge">app/views/layouts/application.html.erb</code> dosyasının üstüne bir buton ekleyebiliriz. Bu layout, header veya footer gibi her sayfaya dahil etmek istediğiniz HTML’i koyduğunuz yerdir.</p>

<p><code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> içine “Home”a bir link ve “Log out” butonu ile küçük bir <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code> bölümü ekleyin ve <code class="language-plaintext highlighter-rouge">yield</code>‘i <code class="language-plaintext highlighter-rouge">&lt;main&gt;</code> etiketi ile sarın.</p>

<pre><code class="language-erb#5-8,10,12">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;!-- ... --&gt;
  &lt;body&gt;
    &lt;nav&gt;
      &lt;%= link_to "Home", root_path %&gt;
      &lt;%= button_to "Log out", session_path, method: :delete if authenticated? %&gt;
    &lt;/nav&gt;

    &lt;main&gt;
      &lt;%= yield %&gt;
    &lt;/main&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Bu, yalnızca kullanıcı kimliği doğrulanmışsa Log out butonunu görüntüleyecektir. Tıklandığında, kullanıcının çıkış yapmasını sağlayacak olan session path’ine DELETE isteği gönderecektir.</p>

<h3 id="doğrulanmamış-erişime-i̇zin-verme">Doğrulanmamış Erişime İzin Verme</h3>

<p>Ancak store uygulamamızın product index ve show sayfaları herkese erişilebilir olmalıdır. Varsayılan olarak, Rails authentication generator tüm sayfaları yalnızca kimliği doğrulanan kullanıcılarla sınırlandıracaktır.</p>

<p>Misafirlerin ürünleri görüntülemesine izin vermek için controller’ımızda doğrulanmamış erişime (unauthenticated access) izin verebiliriz.</p>

<pre><code class="language-ruby#2">class ProductsController &lt; ApplicationController
  allow_unauthenticated_access only: %i[ index show ]
  # ...
end
</code></pre>

<p>Çıkış yapın ve products index ve show sayfalarını ziyaret ederek kimlik doğrulaması olmadan erişilebilir olduklarını görün.</p>

<h3 id="linkleri-yalnızca-doğrulanmış-kullanıcılar-için-gösterme">Linkleri Yalnızca Doğrulanmış Kullanıcılar için Gösterme</h3>

<p>Yalnızca giriş yapmış kullanıcılar ürün oluşturabileceği için, <code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> view’ini yalnızca kullanıcı doğrulanmış ise yeni ürün linkini görüntüleyecek şekilde değiştirebiliriz.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New product"</span><span class="p">,</span> <span class="n">new_product_path</span> <span class="k">if</span> <span class="n">authenticated?</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Log out butonuna tıklayınca New linkinin gizlendiğini göreceksiniz. http://localhost:3000/session/new adresinde yeniden giriş yaptıktan sonra index sayfasında New linkini göreceksiniz.</p>

<p>İsteğe bağlı olarak, kullanıcı doğrulaması yapılmamışsa “Login” linki eklemek için navbar’a bu route için bir link ekleyebilirsiniz.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Login"</span><span class="p">,</span> <span class="n">new_session_path</span> <span class="k">unless</span> <span class="n">authenticated?</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Ayrıca <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> view’indeki “Edit” ve “Delete” linklerini yalnızca doğrulama yapılmışsa görüntülenecek şekilde güncelleyebilirsiniz.</p>

<pre><code class="language-erb#4,7">&lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;

&lt;%= link_to "Back", products_path %&gt;
&lt;% if authenticated? %&gt;
  &lt;%= link_to "Edit", edit_product_path(@product) %&gt;
  &lt;%= button_to "Delete", @product, method: :delete, data: { turbo_confirm: "Are you sure?" } %&gt;
&lt;% end %&gt;
</code></pre>

<h2 id="ürünleri-önbelleğe-alma">Ürünleri Önbelleğe Alma</h2>

<p>Bazen bir sayfanın belirli bölümlerini önbelleğe almak (cache) performansı artırabilir. Rails bu süreci, varsayılan olarak gelen veritabanı destekli bir cache store olan Solid Cache ile basitleştirir.</p>

<p><code class="language-plaintext highlighter-rouge">cache</code> metodunu kullanarak HTML’i önbellekte saklayabiliriz. <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> dosyasındaki header’ı cache’leyelim.</p>

<pre><code class="language-erb#1,3">&lt;% cache @product do %&gt;
  &lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;
&lt;% end %&gt;
</code></pre>

<p><code class="language-plaintext highlighter-rouge">cache</code>‘e <code class="language-plaintext highlighter-rouge">@product</code> geçirerek Rails, ürün için benzersiz bir cache anahtarı oluşturur. Active Record nesneleri <code class="language-plaintext highlighter-rouge">"products/1"</code> gibi bir String döndüren bir <code class="language-plaintext highlighter-rouge">cache_key</code> metoduna sahiptir. View’lerdeki <code class="language-plaintext highlighter-rouge">cache</code> helper’ı, bunu template digest (şablon özeti) ile birleştirerek bu HTML için benzersiz bir anahtar oluşturur.</p>

<p>Geliştirme sırasında önbelleğe almayı etkinleştirmek için terminalinizde aşağıdaki komutu çalıştırın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails dev:cache
</code></pre></div></div>

<p>Bir ürünün show action’ını ziyaret ettiğinizde (<code class="language-plaintext highlighter-rouge">/products/2</code> gibi), Rails sunucu loglarınızda yeni cache satırlarını göreceksiniz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Read fragment views/products/show:a5a585f985894cd27c8b3d49bb81de3a/products/1-20240918154439539125 <span class="o">(</span>1.6ms<span class="o">)</span>
Write fragment views/products/show:a5a585f985894cd27c8b3d49bb81de3a/products/1-20240918154439539125 <span class="o">(</span>4.0ms<span class="o">)</span>
</code></pre></div></div>

<p>Bu sayfayı ilk kez açtığımızda, Rails bir cache anahtarı oluşturacak ve cache store’da var olup olmadığını soracaktır. Bu <code class="language-plaintext highlighter-rouge">Read fragment</code> satırıdır.</p>

<p>Bu, sayfanın ilk görüntülenmesi olduğu için cache mevcut değildir, bu yüzden HTML oluşturulur ve önbelleğe yazılır. Bunu loglardaki <code class="language-plaintext highlighter-rouge">Write fragment</code> satırı olarak görebiliriz.</p>

<p>Sayfayı yeniledikten sonra logların artık <code class="language-plaintext highlighter-rouge">Write fragment</code> içermediğini göreceksiniz.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Read fragment views/products/show:a5a585f985894cd27c8b3d49bb81de3a/products/1-20240918154439539125 <span class="o">(</span>1.3ms<span class="o">)</span>
</code></pre></div></div>

<p>Cache girişi son istek tarafından yazıldığı için Rails, ikinci istekte cache girişini bulur. Rails ayrıca, kayıtlar güncellendiğinde cache anahtarını değiştirir, böylece asla eski cache verisini render etmediğinden emin olur.</p>

<p><a href="../caching_with_rails/">Rails ile Önbelleğe Alma</a> kılavuzunda daha fazla bilgi edinin.</p>

<h2 id="action-text-ile-zengin-metin-alanları">Action Text ile Zengin Metin Alanları</h2>

<p>Birçok uygulama, gömülü öğeler (yani multimedya öğeleri) içeren zengin metinlere (rich text) ihtiyaç duyar ve Rails, Action Text ile bu işlevselliği kullanıma hazır olarak sunar.</p>

<p>Action Text’i kullanmak için önce indirin:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails action_text:install
<span class="nv">$ </span>bundle <span class="nb">install</span>
<span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p>Tüm yeni özeliklerin yüklendiğinden emin olmak için Rails sunucunuzu yeniden başlatın.</p>

<p>Şimdi, ürünümüze rich text açıklama (description) alanı ekleyelim.</p>

<p>İlk olarak, <code class="language-plaintext highlighter-rouge">Product</code> modeline aşağıdakini ekleyin:</p>

<pre><code class="language-ruby#2">class Product &lt; ApplicationRecord
  has_rich_text :description
  validates :name, presence: true
end
</code></pre>

<p><code class="language-plaintext highlighter-rouge">app/views/products/_form.html.erb</code> içindeki submit butonundan önce açıklamayı düzenlemek için zengin metin alanı içerecek şekilde form artık güncellenebilir.</p>

<pre><code class="language-erb#4-7">&lt;%= form_with model: product do |form| %&gt;
  &lt;%# ... %&gt;
  &lt;div&gt;
    &lt;%= form.label :description, style: "display: block" %&gt;
    &lt;%= form.rich_textarea :description %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>Controller’ımızın da form gönderildiğinde bu yeni parametreye izin vermesi gerekiyor, bu yüzden <code class="language-plaintext highlighter-rouge">app/controllers/products_controller.rb</code> içinde izin verilen parametreleri description’ı içerecek şekilde güncelleyeceğiz:</p>

<pre><code class="language-ruby#3">    # Sadece güvenilir parametrelerin listesine izin ver.
    def product_params
      params.expect(product: [ :name, :description ])
    end
</code></pre>

<p>Ayrıca show view’ini de <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> içindeki açıklamayı görüntüleyecek şekilde güncellememiz gerekiyor:</p>

<pre><code class="language-erb#3">&lt;% cache @product do %&gt;
  &lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;
  &lt;%= @product.description %&gt;
&lt;% end %&gt;
</code></pre>

<p>Rails tarafından oluşturulan cache anahtarı, view değiştirildiğinde de değişir. Bu, cache’in view şablonunun en son sürümüyle senkronize kalmasını sağlar.</p>

<p>Yeni bir ürün oluşturun ve ona kalın ve italik metin içeren bir açıklama ekleyin. Show sayfasının biçimlendirilmiş metni gösterdiğini ve ürünü düzenlerken metin alanında bu zengin metni koruduğunu göreceksiniz.</p>

<p>Daha fazla bilgi edinmek için <a href="../action_text_overview/">Action Text</a> sayfasına göz atın.</p>

<h2 id="active-storage-ile-dosya-yükleme">Active Storage ile Dosya Yükleme</h2>

<p>Action Text, Rails’in dosya yüklemeyi kolaylaştıran Active Storage adlı bir başka özelliği üzerine inşa edilmiştir.</p>

<p>Bir ürünü düzenlemeyi ve bir görseli zengin metin editörüne sürüklemeyi deneyin, ardından kaydı güncelleyin. Rails’in bu görseli yüklediğini ve zengin metin editörü içinde işlediğini göreceksiniz. Harika, değil mi?!</p>

<p>Active Storage’ı doğrudan da kullanabiliriz. <code class="language-plaintext highlighter-rouge">Product</code> modeline öne çıkan bir görsel ekleyelim.</p>

<pre><code class="language-ruby#2">class Product &lt; ApplicationRecord
  has_one_attached :featured_image
  has_rich_text :description
  validates :name, presence: true
end
</code></pre>

<p>Ardından, submit butonundan önce product formumuza bir dosya yükleme alanı ekleyebiliriz:</p>

<pre><code class="language-erb#4-7">&lt;%= form_with model: product do |form| %&gt;
  &lt;%# ... %&gt;
  &lt;div&gt;
    &lt;%= form.label :featured_image, style: "display: block" %&gt;
    &lt;%= form.file_field :featured_image, accept: "image/*" %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p><code class="language-plaintext highlighter-rouge">app/controllers/products_controller.rb</code> içinde <code class="language-plaintext highlighter-rouge">:featured_image</code>‘i izin verilen parametre olarak ekleyin:</p>

<pre><code class="language-ruby#3">    # Sadece güvenilir parametrelerin listesine izin ver.
    def product_params
      params.expect(product: [ :name, :description, :featured_image ])
    end
</code></pre>

<p>Son olarak, <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> içinde ürünümüz için öne çıkan görseli görüntülemek istiyoruz. Aşağıdakini en üste ekleyin.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="vi">@product</span><span class="p">.</span><span class="nf">featured_image</span> <span class="k">if</span> <span class="vi">@product</span><span class="p">.</span><span class="nf">featured_image</span><span class="p">.</span><span class="nf">attached?</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Bir ürün için görsel yüklemeyi deneyin. Kaydettikten sonra show sayfasında görselin görüntülendiğini göreceksiniz.</p>

<p>Daha fazla ayrıntı için <a href="../active_storage_overview/">Active Storage</a> sayfasına göz atın.</p>

<h2 id="uluslararasılaştırma-i18n">Uluslararasılaştırma (I18n)</h2>

<p>Rails, uygulamanızı diğer dillere çevirmeyi kolaylaştırır.</p>

<p>View’lerimizdeki <code class="language-plaintext highlighter-rouge">translate</code> veya <code class="language-plaintext highlighter-rouge">t</code> helper’ı, isme göre bir çeviri arar ve mevcut locale için metni döndürür.</p>

<p><code class="language-plaintext highlighter-rouge">app/views/products/index.html.erb</code> dosyasında, header etiketini bir çeviri kullanacak şekilde güncelleyelim.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">t</span> <span class="s2">"hello"</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<p>Sayfayı yenilediğimizde, header metni olarak <code class="language-plaintext highlighter-rouge">Hello world</code> görüyoruz. Peki bu nereden geldi?</p>

<p>Varsayılan dil İngilizce olduğu için Rails, locale altında eşleşen bir anahtar için <code class="language-plaintext highlighter-rouge">config/locales/en.yml</code> (<code class="language-plaintext highlighter-rouge">rails new</code> sırasında oluşturulan bir dosya) dosyasına bakar.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">en</span><span class="pi">:</span>
  <span class="na">hello</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">world"</span>
</code></pre></div></div>

<p>Editörümüzde Türkçe için yeni bir locale dosyası oluşturalım ve <code class="language-plaintext highlighter-rouge">config/locales/tr.yml</code> dosyasına bir çeviri ekleyelim.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tr</span><span class="pi">:</span>
  <span class="na">hello</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Merhaba</span><span class="nv"> </span><span class="s">dünya"</span>
</code></pre></div></div>

<p>Rails’e hangi locale’i kullanacağını söylememiz gerekiyor. En basit seçenek URL’de bir locale parametresi aramaktır. Bunu <code class="language-plaintext highlighter-rouge">app/controllers/application_controller.rb</code> dosyasında aşağıdaki şekilde yapabiliriz:</p>

<pre><code class="language-ruby#4,6-9">class ApplicationController &lt; ActionController::Base
  # ...

  around_action :switch_locale

  def switch_locale(&amp;action)
    locale = params[:locale] || I18n.default_locale
    I18n.with_locale(locale, &amp;action)
  end
end
</code></pre>

<p>Bu, her istekte çalışacak ve parametrelerde <code class="language-plaintext highlighter-rouge">locale</code> arayacak veya varsayılan locale’e geri dönecektir. İstek için locale’i ayarlar ve tamamlandıktan sonra sıfırlar.</p>

<ul>
  <li>http://localhost:3000/products?locale=en adresini ziyaret edin, İngilizce çeviriyi göreceksiniz.</li>
  <li>http://localhost:3000/products?locale=tr adresini ziyaret edin, Türkçe çeviriyi göreceksiniz.</li>
  <li>http://localhost:3000/products adresini locale parametresi olmadan ziyaret edin, İngilizce’ye geri dönecektir.</li>
</ul>

<p>Index header’ını <code class="language-plaintext highlighter-rouge">"Hello world"</code> yerine gerçek bir çeviri kullanacak şekilde güncelleyelim.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">t</span> <span class="s2">".title"</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    <code>title</code>'ın önündeki <code>.</code>'yı fark ettiniz mi? Bu, Rails'e göreceli (relative) locale araması kullanmasını söyler. Göreceli aramalar, controller ve action'ı otomatik olarak anahtara dahil eder, böylece onları her seferinde yazmanıza gerek kalmaz. <code>.title</code> için İngilizce locale ile  <code>en.products.index.title</code> araması yapacaktır.
  </div>
</div>

<p><code class="language-plaintext highlighter-rouge">config/locales/en.yml</code> dosyasında controller, view ve çeviri adımızla eşleşecek şekilde <code class="language-plaintext highlighter-rouge">products</code> ve <code class="language-plaintext highlighter-rouge">index</code> altına <code class="language-plaintext highlighter-rouge">title</code> anahtarını eklemek istiyoruz.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">en</span><span class="pi">:</span>
  <span class="na">hello</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">world"</span>
  <span class="na">products</span><span class="pi">:</span>
    <span class="na">index</span><span class="pi">:</span>
      <span class="na">title</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Products"</span>
</code></pre></div></div>

<p>Türkçe locales dosyasında da aynı şeyi yapabiliriz:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tr</span><span class="pi">:</span>
  <span class="na">hello</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Merhaba</span><span class="nv"> </span><span class="s">dünya"</span>
  <span class="na">products</span><span class="pi">:</span>
    <span class="na">index</span><span class="pi">:</span>
      <span class="na">title</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Ürünler"</span>
</code></pre></div></div>

<p>Artık İngilizce locale’i görüntülerken “Products”, Türkçe locale’i görüntülerken “Ürünler” göreceksiniz.</p>

<p><a href="../i18n/">Rails Uluslararasılaştırma (I18n) API</a> hakkında daha fazla bilgi edinin.</p>

<h2 id="stok-bildirimleri-ekleme">Stok Bildirimleri Ekleme</h2>

<p>E-ticaret mağazalarının yaygın bir özelliği, bir ürün tekrar stokta olduğunda bildirim almak için e-posta aboneliğidir. Rails’in temellerini gördüğümüze göre, bu özelliği mağazamıza ekleyelim.</p>

<h3 id="temel-envanter-takibi">Temel Envanter Takibi</h3>

<p>İlk olarak, stoğu takip edebilmek için Product modeline bir envanter sayısı ekleyelim. Bu migration’ı aşağıdaki komutla oluşturabiliriz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate migration AddInventoryCountToProducts inventory_count:integer
</code></pre></div></div>

<p>Ardından migration’ı çalıştıralım.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/views/products/_form.html.erb</code> dosyasındaki product formuna envanter sayısını eklememiz gerekecek.</p>

<pre><code class="language-erb#4-7">&lt;%= form_with model: product do |form| %&gt;
  &lt;%# ... %&gt;

  &lt;div&gt;
    &lt;%= form.label :inventory_count, style: "display: block" %&gt;
    &lt;%= form.number_field :inventory_count %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>Ayrıca controller’da  izin verilen parametrelere <code class="language-plaintext highlighter-rouge">:inventory_count</code>‘un eklenmesi gerekiyor.</p>

<pre><code class="language-ruby#2">    def product_params
      params.expect(product: [ :name, :description, :featured_image, :inventory_count ])
    end
</code></pre>

<p>Envanter sayımızın asla negatif bir sayı olmamasını doğrulamak da yararlı olacaktır, bu yüzden modelimize bunun için bir validation da ekleyelim.</p>

<pre><code class="language-ruby#6">class Product &lt; ApplicationRecord
  has_one_attached :featured_image
  has_rich_text :description

  validates :name, presence: true
  validates :inventory_count, numericality: { greater_than_or_equal_to: 0 }
end
</code></pre>

<p>Bu değişikliklerle artık mağazamızdaki ürünlerin envanter sayısını güncelleyebiliriz.</p>

<h3 id="ürünlere-abone-ekleme">Ürünlere Abone Ekleme</h3>

<p>Kullanıcılara bir ürünün tekrar stokta olduğunu bildirmek için, bu aboneleri takip etmemiz gerekiyor.</p>

<p>Bu e-posta adreslerini saklamak ve bunları ilgili ürünle ilişkilendirmek için Subscriber adlı bir model oluşturalım.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate model Subscriber product:belongs_to email
</code></pre></div></div>

<p>Ardından yeni migration’ı çalıştırın:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p>Yukarıda <code class="language-plaintext highlighter-rouge">product:belongs_to</code> ekleyerek Rails’e aboneler ve ürünlerin bire-çok ilişkisi olduğunu söyledik, yani bir Subscriber tek bir Product instance’ına “ait”.</p>

<p>Ancak bir Product birçok aboneye sahip olabilir, bu yüzden Product modelimize <code class="language-plaintext highlighter-rouge">has_many :subscribers, dependent: :destroy</code> ekleyerek bu iki model arasındaki ilişkinin ikinci kısmını ekliyoruz. Bu, Rails’e iki veritabanı tablosu arasındaki sorguları nasıl birleştireceğini söyler.</p>

<pre><code class="language-ruby#2">class Product &lt; ApplicationRecord
  has_many :subscribers, dependent: :destroy
  has_one_attached :featured_image
  has_rich_text :description

  validates :name, presence: true
  validates :inventory_count, numericality: { greater_than_or_equal_to: 0 }
end
</code></pre>

<p>Şimdi bu aboneleri oluşturmak için bir controller’a ihtiyacımız var. Bunu <code class="language-plaintext highlighter-rouge">app/controllers/subscribers_controller.rb</code> dosyasında aşağıdaki kodla oluşturalım:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SubscribersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">allow_unauthenticated_access</span>
  <span class="n">before_action</span> <span class="ss">:set_product</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@product</span><span class="p">.</span><span class="nf">subscribers</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">subscriber_params</span><span class="p">).</span><span class="nf">first_or_create</span>
    <span class="n">redirect_to</span> <span class="vi">@product</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"You are now subscribed."</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">set_product</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:product_id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">subscriber_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">expect</span><span class="p">(</span><span class="ss">subscriber: </span><span class="p">[</span> <span class="ss">:email</span> <span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Yönlendirmemiz Rails flash’inde bir notice ayarlar. Flash, bir sonraki sayfada gösterilecek mesajları saklamak için kullanılır.</p>

<p>Flash mesajını görüntülemek için notice’i <code class="language-plaintext highlighter-rouge">app/views/layouts/application.html.erb</code> dosyasında body içine ekleyelim:</p>

<pre><code class="language-erb#4">&lt;html&gt;
  &lt;!-- ... --&gt;
  &lt;body&gt;
    &lt;div class="notice"&gt;&lt;%= notice %&gt;&lt;/div&gt;
    &lt;!-- ... --&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Kullanıcıların belirli bir ürüne abone olması için, iç içe route kullanacağız. Böylece abonenin hangi ürüne ait olduğunu biliyor olacağız. <code class="language-plaintext highlighter-rouge">config/routes.rb</code> dosyasında <code class="language-plaintext highlighter-rouge">resources :products</code>‘ı aşağıdaki şekilde değiştirin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">resources</span> <span class="ss">:products</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:subscribers</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span> <span class="ss">:create</span> <span class="p">]</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Product show sayfasında envanter olup olmadığını kontrol edebilir ve stok miktarını görüntüleyebiliriz. Bunun dışında, tekrar stokta olduğunda bildirim almak için abone olma formuyla birlikte stokta yok mesajı görüntüleyebiliriz.</p>

<p><code class="language-plaintext highlighter-rouge">app/views/products/_inventory.html.erb</code> adresinde yeni bir partial oluşturun ve aşağıdakini ekleyin:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">product</span><span class="p">.</span><span class="nf">inventory_count?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">product</span><span class="p">.</span><span class="nf">inventory_count</span> <span class="cp">%&gt;</span> in stock<span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>Out of stock<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>Email me when available.<span class="nt">&lt;/p&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="n">product</span><span class="p">,</span> <span class="no">Subscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"you@example.com"</span><span class="p">,</span> <span class="ss">required: </span><span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Submit"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Ardından <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> dosyasını <code class="language-plaintext highlighter-rouge">cache</code> bloğundan sonra bu partial’ı render edecek şekilde güncelleyin.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"inventory"</span><span class="p">,</span> <span class="ss">product: </span><span class="vi">@product</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<h3 id="stok-e-posta-bildirimleri">Stok E-posta Bildirimleri</h3>

<p>Action Mailer, Rails’in e-posta göndermenizi sağlayan bir özelliğidir. Bir ürün tekrar stokta olduğunda aboneleri bilgilendirmek için kullanacağız.</p>

<p>Aşağıdaki komutla bir mailer oluşturabiliriz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails g mailer Product in_stock
</code></pre></div></div>

<p>Bu, bir <code class="language-plaintext highlighter-rouge">in_stock</code> metoduyla <code class="language-plaintext highlighter-rouge">app/mailers/product_mailer.rb</code> adresinde bir sınıf oluşturur.</p>

<p>Bu metodu bir abonenin e-posta adresine posta göndermek için güncelleyin.</p>

<pre><code class="language-ruby#7-10">class ProductMailer &lt; ApplicationMailer
  # .subject, config/locales/en.yml adresindeki I18n dosyanızda
  # aşağıdaki arama ile ayarlanabilir:
  #
  #   en.product_mailer.in_stock.subject
  #
  def in_stock
    @product = params[:product]
    mail to: params[:subscriber].email
  end
end
</code></pre>

<p>Mailer generator ayrıca views klasörümüzde iki e-posta şablonu oluşturur: Biri HTML için, diğeri Text için. Bunları ürüne bir mesaj ve bağlantı içerecek şekilde güncelleyebiliriz.</p>

<p><code class="language-plaintext highlighter-rouge">app/views/product_mailer/in_stock.html.erb</code> dosyasını şu şekilde değiştirin:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Good news!<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="vi">@product</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">product_url</span><span class="p">(</span><span class="vi">@product</span><span class="p">)</span> <span class="cp">%&gt;</span> is back in stock.<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<p>Ve <code class="language-plaintext highlighter-rouge">app/views/product_mailer/in_stock.text.erb</code> dosyasını da:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Good news!

<span class="cp">&lt;%=</span> <span class="vi">@product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span> is back in stock.
<span class="cp">&lt;%=</span> <span class="n">product_url</span><span class="p">(</span><span class="vi">@product</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Mailer’larda <code class="language-plaintext highlighter-rouge">product_path</code> yerine <code class="language-plaintext highlighter-rouge">product_url</code> kullanıyoruz çünkü e-posta istemcilerinin bağlantıya tıklandığında tarayıcıda açmak için tam URL’i bilmesi gerekiyor.</p>

<p>Rails konsolunu açıp göndereceğimiz bir ürün ve aboneyi yükleyerek bir e-postayı test edebiliriz:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">store(dev)&gt; product = Product.first
store(dev)&gt; subscriber = product.subscribers.find_or_create_by(email: "subscriber@example.org")
store(dev)&gt; ProductMailer.with(product: product, subscriber: subscriber).in_stock.deliver_later
</span></code></pre></div></div>

<p>Loglarda bir e-posta yazdırdığını göreceksiniz.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ProductMailer#in_stock: processed outbound mail in 63.0ms
Delivered mail 66a3a9afd5d4a_108b04a4c41443@local.mail (33.1ms)
Date: Fri, 26 Jul 2024 08:50:39 -0500
From: from@example.com
To: subscriber@example.com
Message-ID: &lt;66a3a9afd5d4a_108b04a4c41443@local.mail&gt;
Subject: In stock
Mime-Version: 1.0
Content-Type: multipart/alternative;
 boundary="--==_mimepart_66a3a9afd235e_108b04a4c4136f";
 charset=UTF-8
Content-Transfer-Encoding: 7bit


----==_mimepart_66a3a9afd235e_108b04a4c4136f
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

Good news!

T-Shirt is back in stock.
http://localhost:3000/products/1


----==_mimepart_66a3a9afd235e_108b04a4c4136f
Content-Type: text/html;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

&lt;!-- BEGIN app/views/layouts/mailer.html.erb --&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
    &lt;style&gt;
      /* Email styles need to be inline */
    &lt;/style&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;!-- BEGIN app/views/product_mailer/in_stock.html.erb --&gt;&lt;h1&gt;Good news!&lt;/h1&gt;

&lt;p&gt;&lt;a href="http://localhost:3000/products/1"&gt;T-Shirt&lt;/a&gt; is back in stock.&lt;/p&gt;
&lt;!-- END app/views/product_mailer/in_stock.html.erb --&gt;
  &lt;/body&gt;
&lt;/html&gt;
&lt;!-- END app/views/layouts/mailer.html.erb --&gt;
----==_mimepart_66a3a9afd235e_108b04a4c4136f--

Performed ActionMailer::MailDeliveryJob (Job ID: 5e2bd5f2-f54f-4088-ace3-3f6eb15aaf46) from Async(default) in 111.34ms
</code></pre></div></div>

<p>Bu e-postaları tetiklemek için Product modelinde envanter sayısı 0’dan pozitif bir sayıya değiştiğinde e-posta göndermek için bir callback kullanabiliriz.</p>

<pre><code class="language-ruby#9-19">class Product &lt; ApplicationRecord
  has_many :subscribers, dependent: :destroy
  has_one_attached :featured_image
  has_rich_text :description

  validates :name, presence: true
  validates :inventory_count, numericality: { greater_than_or_equal_to: 0 }

  after_update_commit :notify_subscribers, if: :back_in_stock?

  def back_in_stock?
    inventory_count_previously_was.zero? &amp;&amp; inventory_count &gt; 0
  end

  def notify_subscribers
    subscribers.each do |subscriber|
      ProductMailer.with(product: self, subscriber: subscriber).in_stock.deliver_later
    end
  end
end
</code></pre>

<p><code class="language-plaintext highlighter-rouge">after_update_commit</code>, değişiklikler veritabanına kaydedildikten sonra tetiklenen bir Active Record callback’idir. <code class="language-plaintext highlighter-rouge">if: :back_in_stock?</code>, callback’e yalnızca <code class="language-plaintext highlighter-rouge">back_in_stock?</code> metodu true döndürürse çalışmasını söyler.</p>

<p>Active Record, özniteliklerdeki değişiklikleri takip eder, bu yüzden <code class="language-plaintext highlighter-rouge">back_in_stock?</code>, <code class="language-plaintext highlighter-rouge">inventory_count_previously_was</code> kullanarak <code class="language-plaintext highlighter-rouge">inventory_count</code>‘un önceki değerini kontrol eder. Ardından bunu mevcut envanter sayısıyla karşılaştırarak ürünün tekrar stokta olup olmadığını belirleyebiliriz.</p>

<p><code class="language-plaintext highlighter-rouge">notify_subscribers</code>, bu belirli ürün için tüm aboneler için <code class="language-plaintext highlighter-rouge">subscribers</code> tablosunu sorgulamak üzere Active Record ilişkisini kullanır ve ardından her birine gönderilecek <code class="language-plaintext highlighter-rouge">in_stock</code> e-postasını kuyruğa alır.</p>

<h3 id="bir-concern-çıkarma">Bir Concern Çıkarma</h3>

<p>Product modeli artık bildirimleri işlemek için makul miktarda koda sahip. Kodumuzu daha iyi organize etmek için bunu bir <code class="language-plaintext highlighter-rouge">ActiveSupport::Concern</code>‘e çıkarabiliriz. Bir Concern, bunları kullanmayı kolaylaştırmak için bazı syntactic sugar içeren bir Ruby modülüdür. (Not: Syntactic sugar; bir programlama dilinde belirli işlevleri daha okunabilir ve kullanıcı dostu hale getirmek için eklenen sözdizimi öğeleridir.)</p>

<p>İlk olarak Notifications modülünü oluşturalım.</p>

<p><code class="language-plaintext highlighter-rouge">app/models/product/notifications.rb</code> adresinde aşağıdaki içerikle bir dosya oluşturun:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Product::Notifications</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">has_many</span> <span class="ss">:subscribers</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
    <span class="n">after_update_commit</span> <span class="ss">:notify_subscribers</span><span class="p">,</span> <span class="ss">if: :back_in_stock?</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">back_in_stock?</span>
    <span class="n">inventory_count_previously_was</span><span class="p">.</span><span class="nf">zero?</span> <span class="o">&amp;&amp;</span> <span class="n">inventory_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">notify_subscribers</span>
    <span class="n">subscribers</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">subscriber</span><span class="o">|</span>
      <span class="no">ProductMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">product: </span><span class="nb">self</span><span class="p">,</span> <span class="ss">subscriber: </span><span class="n">subscriber</span><span class="p">).</span><span class="nf">in_stock</span><span class="p">.</span><span class="nf">deliver_later</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bir sınıfa bir modül dahil ettiğinizde, <code class="language-plaintext highlighter-rouge">included</code> bloğunun içindeki herhangi bir kod o sınıfın parçasıymış gibi çalışır. Aynı zamanda, modülde tanımlanan metotlar o sınıfın nesnelerinde (instance’larında) çağırabileceğiniz normal metotlar haline gelir.</p>

<p>Bildirim tetikleyen kod Notification modülüne çıkarıldığına göre, Product modeli Notifications modülünü dahil edecek şekilde basitleştirilebilir.</p>

<pre><code class="language-ruby#2">class Product &lt; ApplicationRecord
  include Notifications

  has_one_attached :featured_image
  has_rich_text :description

  validates :name, presence: true
  validates :inventory_count, numericality: { greater_than_or_equal_to: 0 }
end
</code></pre>

<p>Concern’ler Rails uygulamanızın özelliklerini düzenlemenin harika bir yoludur. Product’a daha fazla özellik ekledikçe, sınıf karışık hale gelecektir. Bunun yerine, aboneleri işleme ve bildirimlerin nasıl gönderildiğine dair tüm işlevselliği içeren <code class="language-plaintext highlighter-rouge">Product::Notifications</code> gibi bağımsız bir modüle her özelliği çıkarmak için Concern’leri kullanabiliriz.</p>

<p>Kodu concern’lere çıkarmak ayrıca özellikleri yeniden kullanılabilir hale getirmeye yardımcı olur. Örneğin, abone bildirimlerine ihtiyaç duyan yeni bir model tanıtabiliriz. Bu modül aynı işlevselliği sağlamak için birden fazla modelde kullanılabilir.</p>

<h3 id="abonelik-i̇ptal-bağlantıları">Abonelik İptal Bağlantıları</h3>

<p>Bir abone bir noktada aboneliğini iptal etmek isteyebilir, bu yüzden bunu sonraki adımda oluşturalım.</p>

<p>Öncelikle, e-postalara dahil edeceğimiz URL’de abonelik iptali için bir route’a ihtiyacımız var.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">resource</span> <span class="ss">:unsubscribe</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span> <span class="ss">:show</span> <span class="p">]</span>
</code></pre></div></div>

<p>Active Record’un farklı amaçlar için veritabanı kayıtlarını bulmak üzere benzersiz token’lar oluşturabilen <code class="language-plaintext highlighter-rouge">generates_token_for</code> adlı bir özelliği vardır. Bunu e-postanın abonelik iptal URL’inde kullanmak üzere benzersiz bir abonelik iptal token’ı oluşturmak için kullanabiliriz.</p>

<pre><code class="language-ruby#3">class Subscriber &lt; ApplicationRecord
  belongs_to :product
  generates_token_for :unsubscribe
end
</code></pre>

<p>Controller’ımız önce URL’deki token’dan Subscriber kaydını arayacaktır. Abone bulunduğunda, kaydı yok edecek ve ana sayfaya yönlendirecektir. <code class="language-plaintext highlighter-rouge">app/controllers/unsubscribes_controller.rb</code> oluşturun ve aşağıdaki kodu ekleyin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UnsubscribesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">allow_unauthenticated_access</span>
  <span class="n">before_action</span> <span class="ss">:set_subscriber</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@subscriber</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Unsubscribed successfully."</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">set_subscriber</span>
    <span class="vi">@subscriber</span> <span class="o">=</span> <span class="no">Subscriber</span><span class="p">.</span><span class="nf">find_by_token_for</span><span class="p">(</span><span class="ss">:unsubscribe</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="ss">:token</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Son olarak, e-posta şablonlarımıza abonelik iptal bağlantısını ekleyelim.</p>

<p><code class="language-plaintext highlighter-rouge">app/views/product_mailer/in_stock.html.erb</code> dosyasına bir <code class="language-plaintext highlighter-rouge">link_to</code> ekleyin:</p>

<pre><code class="language-erb#5">&lt;h1&gt;Good news!&lt;/h1&gt;

&lt;p&gt;&lt;%= link_to @product.name, product_url(@product) %&gt; is back in stock.&lt;/p&gt;

&lt;%= link_to "Unsubscribe", unsubscribe_url(token: params[:subscriber].generate_token_for(:unsubscribe)) %&gt;
</code></pre>

<p><code class="language-plaintext highlighter-rouge">app/views/product_mailer/in_stock.text.erb</code> dosyasına URL’i düz metin olarak ekleyin:</p>

<pre><code class="language-erb#6">Good news!

&lt;%= @product.name %&gt; is back in stock.
&lt;%= product_url(@product) %&gt;

Unsubscribe: &lt;%= unsubscribe_url(token: params[:subscriber].generate_token_for(:unsubscribe)) %&gt;
</code></pre>

<p>Abonelik iptal bağlantısına tıklandığında, abone kaydı veritabanından silinecektir. Controller ayrıca geçersiz veya süresi dolmuş token’ları herhangi bir hata vermeden güvenli bir şekilde işler.</p>

<p>Başka bir e-posta göndermek ve loglardaki abonelik iptal bağlantısını test etmek için Rails konsolunu kullanın.</p>

<h2 id="css-ve-javascript-ekleme">CSS ve JavaScript Ekleme</h2>

<p>CSS ve JavaScript, web uygulamaları geliştirmenin temelini oluşturur, bu yüzden bunları Rails ile nasıl kullanacağımızı öğrenelim.</p>

<h3 id="propshaft">Propshaft</h3>

<p>Rails’in asset pipline’ı Propshaft olarak adlandırılır. CSS, JavaScript, görseller ve diğer asset’leri alır ve tarayıcınıza sunar. Üretim ortamında, Propshaft sayfalarınızı daha hızlı hale getirmek için önbelleklenebilmeleri adına asset’lerinizin her sürümünü takip eder. Bunun nasıl çalıştığı hakkında daha fazla bilgi edinmek için <a href="../asset_pipeline/">Asset Pipeline</a> kılavuzuna göz atın.</p>

<p><code class="language-plaintext highlighter-rouge">app/assets/stylesheets/application.css</code> dosyasını değiştirip fontmuzu sans-serif olarak değiştirelim.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">nav</span> <span class="p">{</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">flex-end</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.875em</span><span class="p">;</span>
  <span class="nl">gap</span><span class="p">:</span> <span class="m">0.5rem</span><span class="p">;</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">1024px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">nav</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">inline-block</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">main</span> <span class="p">{</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">1024px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.notice</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="nx">green</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span><span class="nc">.product</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span>
  <span class="nl">gap</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
  <span class="nl">flex-direction</span><span class="p">:</span> <span class="nb">row</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span><span class="nc">.product</span> <span class="nt">img</span> <span class="p">{</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span>
  <span class="nl">flex-basis</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ardından bu yeni stilleri kullanmak için <code class="language-plaintext highlighter-rouge">app/views/products/show.html.erb</code> dosyasını güncelleyeceğiz.</p>

<pre><code class="language-erb#1,3,6,18-19">&lt;p&gt;&lt;%= link_to "Back", products_path %&gt;&lt;/p&gt;

&lt;section class="product"&gt;
  &lt;%= image_tag @product.featured_image if @product.featured_image.attached? %&gt;

  &lt;section class="product-info"&gt;
    &lt;% cache @product do %&gt;
      &lt;h1&gt;&lt;%= @product.name %&gt;&lt;/h1&gt;
      &lt;%= @product.description %&gt;
    &lt;% end %&gt;

    &lt;%= render "inventory", product: @product %&gt;

    &lt;% if authenticated? %&gt;
      &lt;%= link_to "Edit", edit_product_path(@product) %&gt;
      &lt;%= button_to "Delete", @product, method: :delete, data: { turbo_confirm: "Are you sure?" } %&gt;
    &lt;% end %&gt;
  &lt;/section&gt;
&lt;/section&gt;
</code></pre>

<p>Sayfanızı yenileyin. CSS’in uygulandığını göreceksiniz.</p>

<h3 id="import-mapler">Import Map’ler</h3>

<p>Rails varsayılan olarak JavaScript için import haritalarını kullanır. Bu, hiçbir derleme adımı olmadan modern JavaScript modülleri yazmanıza olanak tanır.</p>

<p>JavaScript pinlerini <code class="language-plaintext highlighter-rouge">config/importmap.rb</code> dosyasında bulabilirsiniz. Bu dosya, tarayıcıda importmap etiketini oluşturmak için kullanılan JavaScript paket adlarını kaynak dosyayla eşleştirir.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ./bin/importmap çalıştırarak npm paketlerini pinleyin</span>

<span class="n">pin</span> <span class="s2">"application"</span>
<span class="n">pin</span> <span class="s2">"@hotwired/turbo-rails"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"turbo.min.js"</span>
<span class="n">pin</span> <span class="s2">"@hotwired/stimulus"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"stimulus.min.js"</span>
<span class="n">pin</span> <span class="s2">"@hotwired/stimulus-loading"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"stimulus-loading.js"</span>
<span class="n">pin_all_from</span> <span class="s2">"app/javascript/controllers"</span><span class="p">,</span> <span class="ss">under: </span><span class="s2">"controllers"</span>
<span class="n">pin</span> <span class="s2">"trix"</span>
<span class="n">pin</span> <span class="s2">"@rails/actiontext"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"actiontext.esm.js"</span>
</code></pre></div></div>

<div class="guide-alert guide-alert-info">
  <div class="guide-alert-icon">💡</div>
  <div class="guide-alert-content">
    Her pin, bir JavaScript paket adını (örn. <code>"@hotwired/turbo-rails"</code>) belirli bir dosya veya URL'e (örn. <code>"turbo.min.js"</code>) eşleştirir. <code>pin_all_from</code> bir dizindeki tüm dosyaları (örn. <code>app/javascript/controllers</code>) bir ad alanına (örn. <code>"controllers"</code>) eşleştirir.
  </div>
</div>

<p>Import map’ler, modern JavaScript özelliklerini desteklerken kurulumu temiz ve minimal tutar.</p>

<p>Peki, import map’imizde zaten bulunan bu JavaScript dosyaları nelerdir? Bunlar, Rails’in varsayılan olarak kullandığı Hotwire adlı bir frontend framework’üdür.</p>

<h3 id="hotwire">Hotwire</h3>

<p>Hotwire, sunucu tarafında oluşturulan HTML’den tam olarak yararlanmak için tasarlanmış bir JavaScript framework’üdür. 3 temel bileşenden oluşur:</p>

<ol>
  <li><a href="https://turbo.hotwired.dev/"><strong>Turbo</strong></a> navigation, form gönderimleri,
sayfa bileşenleri ve herhangi bir özel JavaScript yazmadan güncellemeleri yönetir.</li>
  <li><a href="https://stimulus.hotwired.dev/"><strong>Stimulus</strong></a> sayfaya işlevsellik eklemek
için kendi özel JavaScript’inize ihtiyaç duyduğunuzda bir framework sağlar.</li>
  <li><a href="https://native.hotwired.dev/"><strong>Native</strong></a> web uygulamanızı gömüp
onu yerel mobil özelliklerle aşamalı olarak geliştirerek hibrit mobil uygulamalar yapmanıza olanak tanır.</li>
</ol>

<p>Henüz herhangi bir JavaScript yazmadık, ancak frontend’de Hotwire kullanıyorduk. Örneğin, ürün eklemek ve düzenlemek için oluşturduğunuz form Turbo tarafından destekleniyordu.</p>

<p><a href="../asset_pipeline/">Asset Pipeline</a> ve <a href="../working_with_javascript_in_rails/">Rails’te JavaScript ile Çalışma</a> kılavuzlarında daha fazla bilgi edinin.</p>

<h2 id="test">Test</h2>

<p>Rails güçlü bir test paketi ile gelir. Bir ürün stokta olduğunda doğru sayıda e-posta gönderildiğinden emin olmak için bir test yazalım.</p>

<h3 id="fixture">Fixture</h3>

<p>Rails kullanarak bir model oluşturduğunuzda, <code class="language-plaintext highlighter-rouge">test/fixtures</code> dizinine karşılık gelen bir fixture dosyasını otomatik olarak oluşturur.</p>

<p>Fixture’ler, testler çalıştırılmadan önce test veritabanınızı dolduran önceden tanımlanmış veri kümeleridır. Kayıtları, hatırlaması kolay isimlerle tanımlamanıza olanak tanır ve testlerinizde bunlara erişimi kolaylaştırır.</p>

<p>Bu dosya varsayılan olarak boş olacaktır - testleriniz için fixture’lerle doldurmanız gerek.</p>

<p>Aşağıdakilerle <code class="language-plaintext highlighter-rouge">test/fixtures/products.yml</code> konumundaki product fixture dosyasını güncelleyelim:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tshirt</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">T-Shirt</span>
  <span class="na">inventory_count</span><span class="pi">:</span> <span class="m">15</span>
</code></pre></div></div>

<p>Ve aboneler için, <code class="language-plaintext highlighter-rouge">test/fixtures/subscribers.yml</code> dosyasına şu iki fixture’ü ekleyelim:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">david</span><span class="pi">:</span>
  <span class="na">product</span><span class="pi">:</span> <span class="s">tshirt</span>
  <span class="na">email</span><span class="pi">:</span> <span class="s">david@example.org</span>

<span class="na">chris</span><span class="pi">:</span>
  <span class="na">product</span><span class="pi">:</span> <span class="s">tshirt</span>
  <span class="na">email</span><span class="pi">:</span> <span class="s">chris@example.org</span>
</code></pre></div></div>

<p>Burada <code class="language-plaintext highlighter-rouge">Product</code> fixture’üne name ile başvurabildiğimizi fark edeceksiniz. Rails bunu bizim için veritabanında otomatik olarak ilişkilendirir, böylece testlerde kayıt ID’leri ve ilişkileri yönetmek zorunda kalmayız.</p>

<p>Bu fixture’ler test paketimizi çalıştırdığımızda otomatik olarak veritabanına eklenecektir.</p>

<h3 id="e-postaları-test-etme">E-postaları Test Etme</h3>

<p><code class="language-plaintext highlighter-rouge">test/models/product_test.rb</code> dosyasına bir test ekleyelim:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"test_helper"</span>

<span class="k">class</span> <span class="nc">ProductTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">TestHelper</span>

  <span class="nb">test</span> <span class="s2">"sends email notifications when back in stock"</span> <span class="k">do</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">products</span><span class="p">(</span><span class="ss">:tshirt</span><span class="p">)</span>

    <span class="c1"># Set product out of stock</span>
    <span class="n">product</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">inventory_count: </span><span class="mi">0</span><span class="p">)</span>

    <span class="n">assert_emails</span> <span class="mi">2</span> <span class="k">do</span>
      <span class="n">product</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">inventory_count: </span><span class="mi">99</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bu testin ne yaptığını açıklayalım.</p>

<p>İlk olarak, test sırasında gönderilen e-postaları izleyebilmek için Action Mailer test helper’ları dahil ediyoruz.</p>

<p><code class="language-plaintext highlighter-rouge">tshirt</code> fixture’ü <code class="language-plaintext highlighter-rouge">products()</code> fixture helper’ı kullanılarak yüklenir ve bu kayıt için Active Record nesnesini döndürür. Her fixture, her çalışmada veritabanı ID’leri farklı olabileceğinden fixture’lere name ile başvurmayı kolaylaştırmak için test paketinde bir helper oluşturur.</p>

<p>Ardından tişörtün stokta olmadığından emin olmak için envanterini 0’a güncelleriz.</p>

<p>Sonra, blok içindeki kod tarafından 2 e-posta oluşturulduğundan emin olmak için <code class="language-plaintext highlighter-rouge">assert_emails</code> kullanırız. E-postaları tetiklemek için, blok içinde ürünün envanter sayısını güncelleriz. Bu, Product modelindeki <code class="language-plaintext highlighter-rouge">notify_subscribers</code> callback’ini tetikleyerek e-posta gönderir. Bu işlem tamamlandığında, <code class="language-plaintext highlighter-rouge">assert_emails</code> e-postaları sayar ve beklenen sayıyla eşleştiğinden emin olur.</p>

<p>Test paketini <code class="language-plaintext highlighter-rouge">bin/rails test</code> ile veya dosya adını geçerek tek bir test dosyasını çalıştırabiliriz.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails <span class="nb">test test</span>/models/product_test.rb
Running 1 tests <span class="k">in </span>a single process <span class="o">(</span>parallelization threshold is 50<span class="o">)</span>
Run options: <span class="nt">--seed</span> 3556

<span class="c"># Running:</span>

<span class="nb">.</span>

Finished <span class="k">in </span>0.343842s, 2.9083 runs/s, 5.8166 assertions/s.
1 runs, 2 assertions, 0 failures, 0 errors, 0 skips
</code></pre></div></div>

<p>Testimiz geçti!</p>

<p>Rails ayrıca <code class="language-plaintext highlighter-rouge">test/mailers/product_mailer_test.rb</code> dosyasında <code class="language-plaintext highlighter-rouge">ProductMailer</code> için örnek bir test oluşturdu. Onun da testi geçmesi için güncelleyelim.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"test_helper"</span>

<span class="k">class</span> <span class="nc">ProductMailerTest</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="nb">test</span> <span class="s2">"in_stock"</span> <span class="k">do</span>
    <span class="n">mail</span> <span class="o">=</span> <span class="no">ProductMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">product: </span><span class="n">products</span><span class="p">(</span><span class="ss">:tshirt</span><span class="p">),</span> <span class="ss">subscriber: </span><span class="n">subscribers</span><span class="p">(</span><span class="ss">:david</span><span class="p">)).</span><span class="nf">in_stock</span>
    <span class="n">assert_equal</span> <span class="s2">"In stock"</span><span class="p">,</span> <span class="n">mail</span><span class="p">.</span><span class="nf">subject</span>
    <span class="n">assert_equal</span> <span class="p">[</span> <span class="s2">"david@example.org"</span> <span class="p">],</span> <span class="n">mail</span><span class="p">.</span><span class="nf">to</span>
    <span class="n">assert_equal</span> <span class="p">[</span> <span class="s2">"from@example.com"</span> <span class="p">],</span> <span class="n">mail</span><span class="p">.</span><span class="nf">from</span>
    <span class="n">assert_match</span> <span class="s2">"Good news!"</span><span class="p">,</span> <span class="n">mail</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">encoded</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Şimdi tüm test paketini çalıştıralım ve tüm testlerin geçtiğinden emin olalım.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails <span class="nb">test
</span>Running 2 tests <span class="k">in </span>a single process <span class="o">(</span>parallelization threshold is 50<span class="o">)</span>
Run options: <span class="nt">--seed</span> 16302

<span class="c"># Running:</span>

..

Finished <span class="k">in </span>0.665856s, 3.0037 runs/s, 10.5128 assertions/s.
2 runs, 7 assertions, 0 failures, 0 errors, 0 skips
</code></pre></div></div>

<p>Bunu, uygulama özelliklerinin tam kapsamını içeren bir test paketi oluşturmaya devam etmek için başlangıç noktası olarak kullanabilirsiniz.</p>

<p><a href="../testing/">Rails Uygulamalarını Test Etme</a> hakkında daha fazla bilgi edinin.</p>

<h2 id="rubocop-ile-tutarlı-biçimlendirilmiş-kod">RuboCop ile Tutarlı Biçimlendirilmiş Kod</h2>

<p>Kod yazarken bazen tutarsız biçimlendirme kullanabiliriz. Rails, kodumuzun tutarlı biçimde formatlanmasına yardımcı olan RuboCop adlı bir linter ile gelir.</p>

<p>Kodumuzun tutarlılığını kontrol etmek için şunu çalıştırabiliriz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rubocop
</code></pre></div></div>

<p>Bu, herhangi bir ihlali yazdıracak ve ne olduklarını söyleyecektir.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Inspecting 53 files
.....................................................

53 files inspected, no offenses detected
</code></pre></div></div>

<p>RuboCop, <code class="language-plaintext highlighter-rouge">--autocorrect</code> flag’ini (veya kısa versiyonu <code class="language-plaintext highlighter-rouge">-a</code>) kullanarak ihlalleri otomatik olarak düzeltebilir.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bin/rubocop -a
</code></pre></div></div>

<h2 id="güvenlik">Güvenlik</h2>

<p>Rails, uygulamanızla ilgili güvenlik sorunlarını kontrol etmek için Brakeman gem’ini içerir - oturum ele geçirme, oturum sabitleme veya yeniden yönlendirme gibi saldırılara yol açabilecek güvenlik açıkları.</p>

<p>Terminalinize <code class="language-plaintext highlighter-rouge">bin/brakeman</code> yazarak çalıştırın. Bu, uygulamanızı analiz edip bir rapor çıkaracaktır.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/brakeman
Loading scanner...
...

<span class="o">==</span> Overview <span class="o">==</span>

Controllers: 6
Models: 6
Templates: 15
Errors: 0
Security Warnings: 0

<span class="o">==</span> Warning Types <span class="o">==</span>


No warnings found
</code></pre></div></div>

<p><a href="../security/">Rails Uygulamalarının Güvenliği</a> hakkında daha fazla bilgi edinin.</p>

<h2 id="github-actions-ile-sürekli-entegrasyon">GitHub Actions ile Sürekli Entegrasyon</h2>

<p>Rails uygulamaları; rubocop, brakeman ve test paketimizi çalıştıran önceden yazılmış bir GitHub Actions yapılandırması içeren bir <code class="language-plaintext highlighter-rouge">.github</code> klasörü oluşturur.</p>

<p>Kodumuzu GitHub Actions’ın etkin olduğu bir GitHub deposuna push ettiğimizde, otomatik olarak bu adımları çalıştıracak ve her biri için başarı veya başarısızlık durumlarını rapor edecektir. Bu, kod değişikliklerimizi kusurlar ve sorunlar açısından izlememize ve çalışmamız için tutarlı kalite sağlamamıza olanak tanır.</p>

<h2 id="üretim-ortamına-dağıtım">Üretim Ortamına Dağıtım</h2>

<p>Ve şimdi eğlenceli kısma geldik: Uygulamanızı dağıtıma (deploy) çıkaralım.</p>

<p>Rails, uygulamamızı doğrudan bir sunucuya dağıtmak için kullanabileceğimiz <a href="https://kamal-deploy.org">Kamal</a> adlı bir dağıtım aracı ile gelir. Kamal, uygulamanızı çalıştırmak ve sıfır kesinti ile dağıtmak için Docker konteynerlerini kullanır.</p>

<p>Rails varsayılan olarak, Kamal’ın Docker image derlemek için kullanacağı üretime hazır bir Dockerfile ile gelir ve tüm bağımlılıkları ve yapılandırmalarıyla uygulamanızın konteynerleştirilmiş bir sürümünü oluşturur. Bu Dockerfile, üretim ortamında asset’leri verimli bir şekilde sıkıştırmak ve sunmak için <a href="https://github.com/basecamp/thruster">Thruster</a> kullanır.</p>

<p>Kamal ile dağıtıma çıkmak için şunlara ihtiyacımız var:</p>

<ul>
  <li>1GB veya daha fazla RAM’e sahip Ubuntu LTS çalıştıran bir sunucu. Sunucu
düzenli güvenlik ve hata düzeltmeleri alabilmesi için Uzun Vadeli Destek (Long-Term Support - LTS) sürümüne sahip Ubuntu işletim sistemini çalıştırmalıdır. Hetzner, DigitalOcean ve diğer hosting hizmetleri başlamak için sunucular sağlar.</li>
  <li>Bir <a href="https://hub.docker.com">Docker Hub</a> hesabı ve erişim token’ı. Docker Hub,
sunucuda indirilebilmesi ve çalıştırılabilmesi için uygulamanın image’ini saklar.</li>
</ul>

<p>Docker Hub’da, uygulama image’iniz için bir <a href="https://hub.docker.com/repository/create">Depo oluşturun</a>. Depo adı olarak “store” kullanın.</p>

<p><code class="language-plaintext highlighter-rouge">config/deploy.yml</code> dosyasını açın. <code class="language-plaintext highlighter-rouge">192.168.0.1</code>‘i sunucunuzun IP adresi, <code class="language-plaintext highlighter-rouge">your-user</code>‘ı ise Docker Hub kullanıcı adınızla değiştirin.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Uygulamanızın adı. Konteynerleri benzersiz şekilde yapılandırmak için kullanılır.</span>
<span class="na">service</span><span class="pi">:</span> <span class="s">store</span>

<span class="c1"># Konteyner image'in adı.</span>
<span class="na">image</span><span class="pi">:</span> <span class="s">your-user/store</span>

<span class="c1"># Bu sunuculara dağıt.</span>
<span class="na">servers</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">192.168.0.1</span>

<span class="c1"># Image host için kimlik bilgileri.</span>
<span class="na">registry</span><span class="pi">:</span>
  <span class="c1"># Docker Hub kullanmıyorsanız kayıt sunucusunu belirtin.</span>
  <span class="c1"># server: registry.digitalocean.com / ghcr.io / ...</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">your-user</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">proxy:</code> bölümü altında, uygulamanız için SSL’i etkinleştirmek üzere bir alan adı (domain) ekleyebilirsiniz. DNS kaydınızın sunucuya işaret ettiğinden emin olun. Kamal, alan adı için SSL sertifikası vermek üzere LetsEncrypt kullanacaktır.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">proxy</span><span class="pi">:</span>
  <span class="na">ssl</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">app.example.com</span>
</code></pre></div></div>

<p>Kamal’ın uygulamanız için Docker image push edebilmesi için Docker’ın web sitesinde Read &amp; Write izinleri olan <a href="https://app.docker.com/settings/personal-access-tokens/create">bir erişim token’ı oluşturun</a>.</p>

<p>Ardından Kamal’ın bulabilmesi için terminalde erişim token’ını dışa aktarın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">KAMAL_REGISTRY_PASSWORD</span><span class="o">=</span>your-access-token
</code></pre></div></div>

<p>Sunucunuzu kurmak ve uygulamanızı ilk kez dağıtıma çıkarmak için aşağıdaki komutu çalıştırın.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/kamal setup
</code></pre></div></div>

<p>Tebrikler! Yeni Rails uygulamanız artık canlıda/üretim ortamında!</p>

<p>Yeni Rails uygulamanızı çalışırken görmek için tarayıcınızı açın ve sunucunuzun IP adresini girin. Store projenizin çalışır durumda olduğunu görmelisiniz.</p>

<p>Bundan sonra, uygulamanızda değişiklik yapıp bunları üretime çıkarmak istediğinizde, şunu çalıştırabilirsiniz:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/kamal deploy
</code></pre></div></div>

<h3 id="üretim-ortamına-kullanıcı-ekleme">Üretim Ortamına Kullanıcı Ekleme</h3>

<p>Üretim ortamında ürün oluşturmak ve düzenlemek için üretim veritabanında bir User kaydına ihtiyacımız var.</p>

<p>Rails konsolunda bir üretim ortamı açmak için Kamal’ı kullanabilirsiniz.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/kamal console
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">store</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">email_address: </span><span class="s2">"you@example.org"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"s3cr3t"</span><span class="p">,</span> <span class="ss">password_confirmation: </span><span class="s2">"s3cr3t"</span><span class="p">)</span>
</code></pre></div></div>

<p>Artık bu e-posta ve şifre ile üretim ortamına giriş yapabilir ve ürünleri yönetebilirsiniz.</p>

<h3 id="solid-queue-ile-arka-plan-i̇şleri">Solid Queue ile Arka Plan İşleri</h3>

<p>Arka plan işleri, görevleri kullanıcı deneyimini kesintiye uğratmadan ayrı bir süreçte arka planda asenkronize olarak çalıştırmanıza olanak tanır. 10.000 alıcıya stok e-postaları gönderdiğinizi hayal edin. Bu biraz zaman alabilir, bu yüzden Rails uygulamasını responsive (duyarlı) tutmak için bu görevi bir arka plan işine yükleyebiliriz.</p>

<p>Geliştirme ortamında Rails, ActiveJob ile arka plan işlerini işlemek için <code class="language-plaintext highlighter-rouge">:async</code> kuyruk adaptörünü kullanır. Async, bekleyen işleri bellekte depolar ancak yeniden başlatıldığında bekleyen işleri kaybeder. Bu, geliştirme ortamı için harikadır ancak üretim ortamı için değil.</p>

<p>Arka plan işlerini daha sağlam hale getirmek için Rails, üretim ortamları için <code class="language-plaintext highlighter-rouge">solid_queue</code> kullanır. Solid Queue işleri veritabanında saklar ve bunları ayrı bir süreçte yürütür.</p>

<p>Solid Queue, <code class="language-plaintext highlighter-rouge">config/deploy.yml</code> dosyasına <code class="language-plaintext highlighter-rouge">SOLID_QUEUE_IN_PUMA: true</code> ortam değişkeni kullanılarak üretim Kamal dağıtımımız için etkinleştirilmiştir. Bu, web sunucumuz Puma’ya Solid Queue sürecini otomatik olarak başlatıp durdurmasını söyler.</p>

<p>E-postalar Action Mailer’ın <code class="language-plaintext highlighter-rouge">deliver_later</code> metoduyla gönderildiğinde, bu e-postalar HTTP isteğini geciktirmemek için arka planda gönderilmek üzere Active Job’a gönderilecektir. Üretim ortamında Solid Queue ile e-postalar arka planda gönderilecek, gönderilmezse otomatik olarak yeniden denenecek ve yeniden başlatmalar sırasında işler veritabanında güvenli tutulacaktır.</p>

<picture class="flowdiagram">
  <source srcset="/assets/images/rails/getting_started/background_jobs_dark.jpg" media="(prefers-color-scheme:dark)" />
  <img src="/assets/images/rails/getting_started/background_jobs_light.jpg" />
</picture>

<h2 id="sırada-ne-var">Sırada Ne Var?</h2>

<p>İlk Rails uygulamanızı oluşturup dağıtıma çıkardığınız için tebrikler!</p>

<p>Öğrenmeye devam etmek için özellik eklemeye ve güncellemeleri dağıtıma çıkarmaya devam etmenizi öneririz. İşte bazı fikirler:</p>

<ul>
  <li>CSS ile tasarımı geliştirin</li>
  <li>Ürün Değerlendirmeleri ekleyin</li>
  <li>Uygulamayı başka bir dile çevirmeyi tamamlayın</li>
  <li>Ödemeler için bir ödeme akışı ekleyin</li>
  <li>Kullanıcıların ürünleri kaydetmesi için istek listeleri ekleyin</li>
  <li>Ürün görselleri için bir carousel ekleyin</li>
</ul>

<p>Ayrıca diğer Ruby on Rails Kılavuzlarını okuyarak daha fazlasını öğrenmenizi öneririz:</p>

<ul>
  <li><a href="../active_record_basics/">Active Record Temelleri</a></li>
  <li><a href="../layouts_and_rendering/">Rails’te Layout ve Render</a></li>
  <li><a href="../testing/">Rails Uygulamalarını Test Etme</a></li>
  <li><a href="../debugging_rails_applications/">Rails Uygulamalarında Hata Ayıklama</a></li>
  <li><a href="../security/">Rails Uygulamalarının Güvenliği</a></li>
</ul>

<p>Mutlu geliştirmeler!</p>
</div>
  </article>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toc = document.getElementById("toc");
    const headings = document.querySelectorAll(
      ".guide-content h2, .guide-content h3, .guide-content h4"
    );

    if (headings.length > 0) {
      const tocList = document.createElement("ul");
      const headingMap = new Map();

      // Türkçe karakterleri URL-dostu hale getiren fonksiyon
      function turkishToSlug(text) {
        const turkishChars = {
          'ç': 'c', 'Ç': 'c',
          'ğ': 'g', 'Ğ': 'g',
          'ı': 'i', 'I': 'i',
          'İ': 'i', 'i': 'i',
          'ö': 'o', 'Ö': 'o',
          'ş': 's', 'Ş': 's',
          'ü': 'u', 'Ü': 'u'
        };
        
        return text
          .split('')
          .map(char => turkishChars[char] || char)
          .join('')
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '');
      }

      // Aynı ID'nin tekrarlanmasını önlemek için sayaç
      const idCounts = new Map();

      headings.forEach(function (heading, index) {
        // Başlık metninden anlamlı ID oluştur
        const headingText = heading.textContent.trim();
        let baseId = turkishToSlug(headingText);
        
        // Boş ID kontrolü
        if (!baseId) {
          baseId = "heading-" + index;
        }
        
        // Tekrarlanan ID'leri önle
        let finalId = baseId;
        if (idCounts.has(baseId)) {
          const count = idCounts.get(baseId) + 1;
          idCounts.set(baseId, count);
          finalId = baseId + "-" + count;
        } else {
          idCounts.set(baseId, 1);
        }
        
        heading.id = finalId;

        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#" + finalId;
        a.textContent = headingText;
        a.className = "toc-" + heading.tagName.toLowerCase();

        li.appendChild(a);
        tocList.appendChild(li);

        headingMap.set(finalId, a);
      });

      toc.appendChild(tocList);

      // Başlıkların görünürlük oranlarını takip et
      const visibilityMap = new Map();

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const id = entry.target.getAttribute("id");
            visibilityMap.set(id, entry.intersectionRatio);
          });

          // En çok görünür olan başlığı bul
          let mostVisibleId = null;
          let maxRatio = 0;

          visibilityMap.forEach((ratio, id) => {
            if (ratio > maxRatio) {
              mostVisibleId = id;
              maxRatio = ratio;
            }
          });

          if (mostVisibleId) {
            headingMap.forEach((linkEl) => linkEl.classList.remove("active"));
            const activeLink = headingMap.get(mostVisibleId);
            if (activeLink) {
              activeLink.classList.add("active");

              // Ortalamak için:
              const linkTop = activeLink.offsetTop;
              const linkHeight = activeLink.offsetHeight;
              const tocScrollParent = toc;
              const tocHeight = tocScrollParent.offsetHeight;

              tocScrollParent.scrollTo({
                top: linkTop - tocHeight / 2 + linkHeight / 2,
                behavior: "smooth",
              });
            }
          }
        },
        {
          threshold: [0, 0.25, 0.5, 0.75, 1.0],
        }
      );

      headings.forEach((heading) => {
        observer.observe(heading);
      });

      const toggleBtn = document.getElementById("toc-toggle");
      const sidebar = document.querySelector(".guide-sidebar");

      toggleBtn.addEventListener("click", function () {
        sidebar.classList.toggle("open");
      });
      const closeBtn = document.querySelector(".toc-close");

      closeBtn?.addEventListener("click", function () {
        sidebar.classList.remove("open");
      });
    }
  });
</script>
        <!-- <footer class="guide-footer"> -->
        <div class="feedback">
          <h3>Geri Bildirim</h3>
          <p>
            Bu rehberin kalitesinin iyileştirilmesine yardımcı olmanızı
            öneririz.
          </p>
          <p>
            Herhangi bir yazım hatası veya olgusal hata görürseniz lütfen
            katkıda bulunun. Başlamak için,
            <a
              href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation"
              >dokümantasyon katkıları</a
            >
            bölümünü okuyabilirsiniz.
          </p>
          <p>
            Ayrıca eksik veya güncel olmayan içerik de bulabilirsiniz. Lütfen
            main için eksik olan belgeleri ekleyin. Sorunların main dalda zaten
            düzeltilip düzeltilmediğini doğrulamak için önce
            <a href="https://edgeguides.rubyonrails.org/">Edge Guides</a>'ı
            kontrol ettiğinizden emin olun. Stil ve kurallar için
            <a
              href="https://guides.rubyonrails.org/v8.0/ruby_on_rails_guides_guidelines.html"
              >Ruby on Rails Guides Guidelines</a
            >'ı kontrol edin.
          </p>
          <p>
            Herhangi bir sebepten dolayı düzeltebileceğiniz bir şey bulursanız
            ancak kendiniz patch yapamıyorsanız lütfen bir
            <a href="https://github.com/rails/rails/issues">issue</a> açın.
          </p>
          <p>
            Ve son olarak, Ruby on Rails dokümantasyonu ile ilgili her türlü
            tartışma resmi
            <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs/6"
              >Ruby on Rails Forum</a
            >'unda memnuniyetle karşılanacaktır.
          </p>
        </div>
      </div>
    </main>

    <button id="scrollToTop" class="scroll-to-top" aria-label="Yukarı çık">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polyline points="18,15 12,9 6,15"></polyline>
      </svg>
    </button>

    <footer class="footer">
      <div class="container">
        <p>
          Bu çalışma <a href=" Creative Commons Attribution-ShareAlike 4.0 International">Creative Commons Attribution-ShareAlike 4.0 International</a> Lisansı kapsamında lisanslanmıştır.
          </p>
        <p>
          "Rails", "Ruby on Rails" ve Rails logosu David Heinemeier Hansson'un ticari markalarıdır. Tüm hakları saklıdır.
        </p><br/>
        <p>
          &copy; 2025 Rails Kılavuzları Türkçe Çevirisi.
          <a href="https://github.com/DilanKaya127">Dilan Kaya</a> tarafından
          hazırlanmıştır.
          Orijinal dokümantasyon
          <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine
          aittir.
        </p>
        

      </div>
    </footer>

    <script>
      hljs.highlightAll();
      // Yukarı çık butonu işlevselliği
      const scrollToTopBtn = document.getElementById("scrollToTop");

      // Scroll pozisyonunu kontrol et
      window.addEventListener("scroll", function () {
        if (window.pageYOffset > 500) {
          scrollToTopBtn.classList.add("visible");
        } else {
          scrollToTopBtn.classList.remove("visible");
        }
      });

      // Butona tıklandığında yukarı çık
      scrollToTopBtn.addEventListener("click", function () {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      });
    </script>
  </body>
</html>
