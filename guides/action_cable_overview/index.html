<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Action Cable'a Genel Bakış - Rails Dokümantasyonu - Türkçe
    </title>
    <link
      rel="stylesheet"
      href="/assets/css/rails.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css"
    />

    <link
      rel="icon"
      type="image/svg"
      href="/assets/images/rails/logo_rails-circle.svg"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-Y6Q8S53SSQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-Y6Q8S53SSQ");
    </script>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <h1 class="logo">
            <a href="/rails/">
              <img
                src="/assets/images/rails/logo_rails-circle.svg"
                alt="Rails Logo"
                class="logo-image"
              />
            </a>
          </h1>
          <nav class="nav">
            <a href="/">Ana Sayfa</a>
            <!-- <a href="https://dilankaya127.github.io">Portföy</a> -->

            <div class="dropdown">
              <a class="dropbtn">Kılavuzlar</a>
              <div class="dropdown-content multi-column">
                 
                <div class="dropdown-column">
                  <h4>Buradan Başlayın</h4>
                  
                  <a href="/rails/guides/getting_started">Rails ile Başlarken</a>
                  
                  <a href="/rails/guides/install_ruby_on_rails">Ruby on Rails İndirme Kılavuzu</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Model</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Migration</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Doğrulamaları</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Callback</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record İlişkileri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Sorgu Arayüzü</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Model Temelleri</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>View</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Overview</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Layout ve Rendering</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Helper</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action View Form Helper</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Controller</h4>
                  
                  <a href="/rails/guides/action_controller_overview">Action Controller</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Controller İleri Konular</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Dışarıdan İçeriye Routing</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Diğer Bileşenler</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Support Core Uzantılar</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Mailer Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Mailbox Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Action Text</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Job Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Storage</a>
                  
                  <a href="/rails/guides/action_cable_overview">Action Cable</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Daha Derin Konular</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uluslararasılaştırma API</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarını Test Etme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarında Hata Ayıklama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarını Yapılandırma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Komut Satırı</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Asset Pipeline</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails'te JavaScript ile Çalışma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Başlatma Süreci</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Otomatik Yükleme ve Yeniden Yükleme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Support Instrumentation</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">API Özel Uygulamalar için Rails Kullanımı</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Ürün Çıkarmak</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Dağıtım için Performans Ayarlama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails ile Önbelleğe Alma: Genel Bakış</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarının Güvenliğini Sağlama</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulamalarında Hata Bildirim</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>İleri Seviye Active Record</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record ve PostgreSQL</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Çoklu Veritabanı</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Active Record Şifreleme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Bileşik Birincil Anahtarlar</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Rails Uygulamalarını Büyütelim</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Eklentileri Oluşturmanın Temelleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rack'te Rails</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Generator ve Şablonları Oluşturma ve Özelleştirme</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Engine ile Çalışmaya Başlarken</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Uygulama Şablonları</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails'te İş Parçacığı Oluşturma ve Kod Yürütme</a>
                  
                </div>
                  
                <div class="dropdown-column">
                  <h4>Katkıda Bulunun</h4>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Ruby on Rails'e Katkıda Bulunma</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">API Dokümantasyon Yönergeleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Kılavuz Yönergeleri</a>
                  
                  <a href="/rails/guides/missing_pages/currently_being_worked">Rails Core Geliştirme Bağımlılıklarını Yükleme</a>
                  
                </div>
                     
              </div>
            </div>
            <a href="https://github.com/dilankaya127/rails-tr-TR">GitHub</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="container">
        <div class="guide-container">
  <button id="toc-toggle" class="toc-toggle">☰ İçindekiler</button>

  <aside class="guide-sidebar">
    <div class="guide-toc">
      <div id="toc"></div>
      <button class="toc-close" aria-label="İçindekileri Kapat">✕</button>
    </div>
  </aside>

  <article class="guide-content">
    <div class="guide-body"><p><strong>RESMİ KILAVUZA BU ADRES ÜZERİNDEN ULAŞABİLİRSİNİZ: <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a></strong></p>

<hr />

<h1 id="action-cablea-genel-bakış">Action Cable’a Genel Bakış</h1>

<p>Bu kılavuzda Action Cable’ın nasıl çalıştığını ve WebSocketleri kullanarak
gerçek zamanlı özellikleri Rails uygulamanıza nasıl dahil edeceğinizi öğreneceksiniz.</p>

<p>Bu kılavuzu okuduktan sonra şunları bileceksiniz:</p>

<ul>
  <li>Action Cable’ın ne olduğunu, backend ve frontende nasıl entegre edeceğinizi</li>
  <li>Action Cable’ı nasıl kuracağınızı</li>
  <li>Kanalları nasıl kuracağınızı</li>
  <li>Action Cable’ı çalıştırmak için dağıtım ve mimari kurulumunu</li>
</ul>

<h2 id="action-cable-nedir">Action Cable Nedir?</h2>

<p>Action Cable, Rails uygulamanıza
<a href="https://en.wikipedia.org/wiki/WebSocket">WebSocket</a>‘i sorunsuz bir şekilde entegre eder.
Performans ve ölçeklenebilirliği sağlarken aynı zamanda gerçek zamanlı özelliklerin,
Rails uygulamanızın geri kalanında olduğu gibi aynı stil ve formda Ruby’de yazılmasını sağlar. 
Hem istemci taraflı Javascript framework’ü hem sunucu taraflı Ruby framework’ü
sağlayan bir full-stack aracıdır. Active Record veya tercih ettiğiniz bir ORM ile yazılmış kendi tüm domain modelinize erişiminiz vardır.</p>

<h2 id="terimler">Terimler</h2>

<p>Action Cable, HTTP’nin istek-yanıt protokolü yerine WebSocket kullanır.
Hem Action Cable hem WebSocket daha az bilinen bazı terminolojiler sunar:</p>

<h3 id="bağlantılar">Bağlantılar</h3>

<p><em>Bağlantılar (Connections)</em> istemci-sunucu ilişkisinin temelini oluşturur. Tek bir Action Cable sunucusu birden fazla bağlantının üstesinden gelebilir. Her bir WebSocket bağlantısı için bir bağlantı örneği vardır. Tek bir kullanıcı eğer birden fazla tarayıcı sekmesi veya cihaz kullanıyorsa uygulamanıza açık birden fazla Websocket’e sahip olabilir.</p>

<h3 id="tüketiciler">Tüketiciler</h3>

<p>Bir WebSocket bağlantısının istemcisine <em>tüketici (consumer)</em> denir. Action Cable’da tüketici, istemci-taraflı Javascript framework’ü tarafından oluşturulur.</p>

<h3 id="kanallar">Kanallar</h3>

<p>Her bir tüketici sırayla birden fazla <em>kanala (channel)</em> abone olabilir. Her kanal, bir controllerın tipik bir MVC kurulumunda yaptığına benzer bir şekilde mantıksal bir iş birimini kapsar. Örneğin, <code class="language-plaintext highlighter-rouge">ChatChannel</code> ve <code class="language-plaintext highlighter-rouge">AppearancesChannel</code> adında kanallarınız olsun. Bir tüketici bu kanallardan birine veya her ikisine de abone olabilir. Bir tüketicinin en azından bir kanala abone olması gerekir.</p>

<h3 id="aboneler">Aboneler</h3>

<p>Tüketici bir kanala abone olduğunda <em>abone (subscriber)</em> gibi davranır. Abone ile kanal arasındaki bağlantıya ise abonelik denir. Bir tüketici belirli bir kanala istediği kadar abone olabilir. Örneğin, bir tüketici birden fazla chat odasına (room) aynı anda abone olabilir. (Fiziksel bir kullanıcının bağlantınıza açık olan her bir sekme veya cihaz için bir tane olmak üzere birden fazla tüketicisinin olabildiğini unutmayın.)</p>

<h3 id="yayınlaabone-ol">Yayınla/Abone Ol</h3>

<p><a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Yayınla/Abone Ol (Pub/Sub)</a> paradigması; bilgi gönderenlerin (yayıncıların), belirli alıcıları belirtmeden, soyut bir alıcılar sınıfına (abonelere) verileri gönderdiği bir mesaj kuyruğu paradigmasını ifade eder. Action Cable, sunucu ile çok sayıda istemci arasında iletişim kurmak için bu yaklaşımı kullanır.</p>

<h3 id="yayınlar">Yayınlar</h3>

<p>Bir yayın (broadcasting); yayıncının ilettiği her şeyin, o isimle yayın yapılan yayını dinleyen kanal abonelerine doğrudan gönderildiği bir yayınla/abone ol (pub/sub) bağlantısıdır. Her kanal, sıfır veya daha fazla yayını dinleyebilir.</p>

<h2 id="sunucu-taraflı-bileşenler">Sunucu Taraflı Bileşenler</h2>

<h3 id="bağlantılar-1">Bağlantılar</h3>

<p>Sunucu tarafından kabul edilen her WebSocket için bir bağlantı nesnesi oluşturulur. Bu nesne, bundan sonra oluşturulacak tüm <em>kanal aboneliklerinin</em> ebeveyni (parent) haline gelir. Bağlantının kendisi, kimlik doğrulama ve yetkilendirme dışında herhangi bir spesifik uygulama mantığı ile ilgilenmez. Bir WebSocket bağlantısının istemcisine bağlantı <em>tüketicisi</em> denir. Bireysel bir kullanıcı her bir açık tarayıcı sekmesi, penceresi veya cihazı için tüketici-bağlantı çifti oluşturur.</p>

<p>Bağlantılar, <a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Base.html"><code class="language-plaintext highlighter-rouge">ActionCable::Connection::Base</code></a> sınıfını genişleten (extend) <code class="language-plaintext highlighter-rouge">ApplicationCable::Connection</code> sınıfının örnekleridir. <code class="language-plaintext highlighter-rouge">ApplicationCable::Connection</code>da gelen bağlantıyı yetkilendirirsiniz ve kullanıcı tanımlanabiliyorsa bağlantı kurmaya devam edersiniz.</p>

<h4 id="bağlantı-kurulumu">Bağlantı Kurulumu</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/application_cable/connection.rb</span>
<span class="k">module</span> <span class="nn">ApplicationCable</span>
  <span class="k">class</span> <span class="nc">Connection</span> <span class="o">&lt;</span> <span class="no">ActionCable</span><span class="o">::</span><span class="no">Connection</span><span class="o">::</span><span class="no">Base</span>
    <span class="n">identified_by</span> <span class="ss">:current_user</span>

    <span class="k">def</span> <span class="nf">connect</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">current_user</span> <span class="o">=</span> <span class="n">find_verified_user</span>
    <span class="k">end</span>

    <span class="kp">private</span>
      <span class="k">def</span> <span class="nf">find_verified_user</span>
        <span class="k">if</span> <span class="n">verified_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">cookies</span><span class="p">.</span><span class="nf">encrypted</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">])</span>
          <span class="n">verified_user</span>
        <span class="k">else</span>
          <span class="n">reject_unauthorized_connection</span>
        <span class="k">end</span>
      <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Buradaki <a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Identification/ClassMethods.html#method-i-identified_by"><code class="language-plaintext highlighter-rouge">identified_by</code></a>, daha sonra spesifik bir bağlantıyı bulmak için kullanılabilen bağlantı tanımlayıcısını (identifier) belirtir. Unutmayın, tanımlayıcı olarak işaretlenen her şey, bağlantı dışında oluşturulan herhangi bir kanal örneği üzerinde otomatik olarak aynı isimle bir temsilci oluşturur.</p>

<p>Bu örnek, uygulamanızın başka bir yerinde kullanıcının çoktan bir kimlik doğrulaması gerçekleştirmiş olduğunuzu ve başarılı bir kimlik doğrulamasının kullanıcı ID’si ile şifrelenmiş bir çerez (cookie) ayarlayacağını varsayar.</p>

<p>Yeni bir bağlantı girişiminde bulunulduğunda çerez otomatik olarak bağlantı örneğine gönderilir, ve siz bunu <code class="language-plaintext highlighter-rouge">current_user</code>ı ayarlamak için kullanırsınız. Aynı mevcut kullanıcı tarafından tanımladığınız bağlantıyla, daha sonra belirli bir kullanıcı tarafından açılan tüm açık bağlantıları geri alabilmeyi (veya kullanıcı silinir ya da yetkisiz hale gelirse potansiyel olarak tüm bağlantıları kesebilmeyi) sağlarsınız.</p>

<p>Eğer yetkilendirme yaklaşımınız bir oturum kullanmayı kapsıyorsai oturumu depolamak için çerezleri kullanırsınız. Oturum çerezinizin adı <code class="language-plaintext highlighter-rouge">_session</code> ve kullanıcı ID’niz  <code class="language-plaintext highlighter-rouge">user_id</code> ise bu yaklaşımı kullanabilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">verified_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">cookies</span><span class="p">.</span><span class="nf">encrypted</span><span class="p">[</span><span class="s2">"_session"</span><span class="p">][</span><span class="s2">"user_id"</span><span class="p">])</span>
</code></pre></div></div>

<h4 id="i̇stisna-yönetimi">İstisna Yönetimi</h4>

<p>Varsayılan olarak, işlenmemiş (unhandled) istisnalar yakalanır ve Rails’in kayıt tutucusunda (logger) tutulur. Eğer bu istisnaları global olarak yakalamak ve örneğin harici bir hata (bug) takip servisine bildirmek isterseniz, <a href="https://api.rubyonrails.org/classes/ActiveSupport/Rescuable/ClassMethods.html#method-i-rescue_from"><code class="language-plaintext highlighter-rouge">rescue_from</code></a> ile bunu yapabilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/application_cable/connection.rb</span>
<span class="k">module</span> <span class="nn">ApplicationCable</span>
  <span class="k">class</span> <span class="nc">Connection</span> <span class="o">&lt;</span> <span class="no">ActionCable</span><span class="o">::</span><span class="no">Connection</span><span class="o">::</span><span class="no">Base</span>
    <span class="n">rescue_from</span> <span class="no">StandardError</span><span class="p">,</span> <span class="ss">with: :report_error</span>

    <span class="kp">private</span>
      <span class="k">def</span> <span class="nf">report_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="no">SomeExternalBugtrackingService</span><span class="p">.</span><span class="nf">notify</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="bağlantı-callbackleri">Bağlantı Callback’leri</h4>

<p><a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Callbacks.html"><code class="language-plaintext highlighter-rouge">ActionCable::Connection::Callbacks</code></a> abone olma, abonelik iptali veya bir eylem gerçekleştirme gibi istemciye komut gönderilirken çağrılan callback hook’ları sağlar:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Callbacks/ClassMethods.html#method-i-before_command"><code class="language-plaintext highlighter-rouge">before_command</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Callbacks/ClassMethods.html#method-i-after_command"><code class="language-plaintext highlighter-rouge">after_command</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Connection/Callbacks/ClassMethods.html#method-i-around_command"><code class="language-plaintext highlighter-rouge">around_command</code></a></li>
</ul>

<h3 id="kanallar-1">Kanallar</h3>

<p>Bir <em>kanal</em>, bir controllerın tipik bir MVC kurulumunda yaptığına benzer bir şekilde mantıksal bir iş birimini kapsar. Varsayılan olarak Rails, kanal oluşturucuyu (channel generator) ilk kez kullandığınızda, kanallarınız arasında paylaşılan mantığı kapsüllemek için bir ebeveyn sınıf olan <code class="language-plaintext highlighter-rouge">ApplicationCable::Channel</code> (ki bu sınıf <code class="language-plaintext highlighter-rouge">ActionCable::Channel::Base</code> sınıfını genişletir/extend eder) oluşturur.</p>

<h4 id="ebeveyn-kanal-kurulumu">Ebeveyn Kanal Kurulumu</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/application_cable/channel.rb</span>
<span class="k">module</span> <span class="nn">ApplicationCable</span>
  <span class="k">class</span> <span class="nc">Channel</span> <span class="o">&lt;</span> <span class="no">ActionCable</span><span class="o">::</span><span class="no">Channel</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Kendi kanal sınıflarınız şu örnekler gibi görünebilir:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/appearance_channel.rb</span>
<span class="k">class</span> <span class="nc">AppearanceChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bir tüketici, bu kanallardan birine veya her ikisine birden abone olabilir.</p>

<h4 id="abonelikler">Abonelikler</h4>

<p>Tüketiciler kanallara abone olarak “abone” durumuna gelirler. Bağlantılarına abonelik denir. Üretilen mesajlar daha sonra kanal tüketicisi tarafından gönderilen bir tanımlayıcıya göre bu kanal aboneliklerine yönlendirilir.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="c1"># Tüketici başarılı bir şekilde</span>
  <span class="c1"># bu kanala abone olduğunda çağrılır.</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="i̇stisna-yönetimi-1">İstisna Yönetimi</h4>

<p><code class="language-plaintext highlighter-rouge">ApplicationCable::Connection</code>da olduğu gibi, ortaya çıkan istisnaları işlemek için belirli bir kanalda <a href="https://api.rubyonrails.org/classes/ActiveSupport/Rescuable/ClassMethods.html#method-i-rescue_from"><code class="language-plaintext highlighter-rouge">rescue_from</code></a>‘u da kullanabilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="n">rescue_from</span> <span class="s2">"MyError"</span><span class="p">,</span> <span class="ss">with: :deliver_error_message</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">deliver_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="c1"># broadcast_to(...)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="kanal-callbackleri">Kanal Callback’leri</h4>

<p><a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks.html"><code class="language-plaintext highlighter-rouge">ActionCable::Channel::Callbacks</code></a>, bir kanalın yaşam döngüsü sırasında çağrılan callback hook’larını sağlar:</p>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-before_subscribe"><code class="language-plaintext highlighter-rouge">before_subscribe</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-after_subscribe"><code class="language-plaintext highlighter-rouge">after_subscribe</code></a> (<a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-on_subscribe"><code class="language-plaintext highlighter-rouge">on_subscribe</code></a> takma adıyla anılır)</li>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-before_unsubscribe"><code class="language-plaintext highlighter-rouge">before_unsubscribe</code></a></li>
  <li><a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-after_unsubscribe"><code class="language-plaintext highlighter-rouge">after_unsubscribe</code></a> (<a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Callbacks/ClassMethods.html#method-i-on_unsubscribe"><code class="language-plaintext highlighter-rouge">on_unsubscribe</code></a> takma adıyla anılır)</li>
</ul>

<h2 id="i̇stemci-taraflı-bileşenler">İstemci Taraflı Bileşenler</h2>

<h3 id="bağlantılar-2">Bağlantılar</h3>

<p>Tüketiciler kendi taraflarında bir bağlantı örneğine ihtiyaç duyarlar. Bu, Rails tarafından varsayılan olarak oluşturulan aşağıdaki JavaScript kullanılarak kurulabilir:</p>

<h4 id="tüketici-bağlantısı">Tüketici Bağlantısı</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/consumer.js</span>
<span class="c1">// Action Cable, Rails'te WebSocket ilebaşa çıkmak için bir framework sağlar.</span>
<span class="c1">// WebSocket özelliklerinin bulunduğu yeni kanalları</span>
<span class="c1">// `bin/rails generate channel` komutunu kullanarak oluşturabilirsiniz.</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">createConsumer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@rails/actioncable</span><span class="dl">"</span>

<span class="k">export</span> <span class="k">default</span> <span class="nf">createConsumer</span><span class="p">()</span>
</code></pre></div></div>

<p>Bu, varsayılan olarak sunucunuzdaki <code class="language-plaintext highlighter-rouge">/cable</code> ile bağlantı kuracak bir tüketici hazırlayacaktır. İlgi duyduğunuz en az bir aboneliği ayrıca belirtmediğiniz sürece bağlantı kurulmayacaktır.</p>

<p>Tüketici, isteğe bağlı olarak bağlanılacak URL’i belirten bir bağımsız değişken alabilir. Bu bir string veya WebSocket açıldığında çağrılacak string döndüren bir fonksiyon olabilir.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bağlanmak için farklı bir URL belirtin </span>
<span class="nf">createConsumer</span><span class="p">(</span><span class="dl">'</span><span class="s1">wss://example.com/cable</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// veya HTTP üzerinden websocket kullanırken:</span>
<span class="nf">createConsumer</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://ws.example.com/cable</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// URL'i dinamik olarak oluşturmak için</span>
<span class="c1">// bir fonksiyon kullanın</span>
<span class="nf">createConsumer</span><span class="p">(</span><span class="nx">getWebSocketURL</span><span class="p">)</span>

<span class="kd">function</span> <span class="nf">getWebSocketURL</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">auth-token</span><span class="dl">'</span><span class="p">)</span>
  <span class="k">return</span> <span class="s2">`wss://example.com/cable?token=</span><span class="p">${</span><span class="nx">token</span><span class="p">}</span><span class="s2">`</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="aboneler-1">Aboneler</h4>

<p>Bir tüketici, belirli bir kanala abonelik oluşturarak abone olur:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/chat_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Best Room</span><span class="dl">"</span> <span class="p">})</span>

<span class="c1">// app/javascript/channels/appearance_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AppearanceChannel</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p>Bu, aboneliği oluştururken, alınan verilere yanıt vermek için gereken işlevsellik daha sonra açıklanacaktır.</p>

<p>Bir tüketici belirli bir kanala istediği sayıda abone olabilir. Örneğin, bir tüketici aynı anda birden fazla sohbet odasına abone olabilir:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/chat_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1st Room</span><span class="dl">"</span> <span class="p">})</span>
<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2nd Room</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<h2 id="i̇stemci-sunucu-etkileşimleri">İstemci-Sunucu Etkileşimleri</h2>

<h3 id="yayın-akışları">Yayın Akışları</h3>

<p><em>Yayın akışları (Streams)</em>, kanalların yayınlanan içeriği (yayınları) abonelerine yönlendirdiği mekanizmayı sağlar. Örneğin, aşağıdaki kod, <code class="language-plaintext highlighter-rouge">:room</code> parametresinin değeri <code class="language-plaintext highlighter-rouge">"Best Room"</code> olduğunda <code class="language-plaintext highlighter-rouge">chat_Best Room</code> adlı yayına abone olmak için <a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Streams.html#method-i-stream_from"><code class="language-plaintext highlighter-rouge">stream_from</code></a> kullanır:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">stream_from</span> <span class="s2">"chat_</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:room</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ardından, Rails uygulamanızın başka bir yerinde <a href="https://api.rubyonrails.org/classes/ActionCable/Server/Broadcasting.html#method-i-broadcast"><code class="language-plaintext highlighter-rouge">broadcast</code></a> çağrısı yaparak böyle bir odaya yayın yapabilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActionCable</span><span class="p">.</span><span class="nf">server</span><span class="p">.</span><span class="nf">broadcast</span><span class="p">(</span><span class="s2">"chat_Best Room"</span><span class="p">,</span> <span class="p">{</span> <span class="ss">body: </span><span class="s2">"This Room is Best Room."</span> <span class="p">})</span>
</code></pre></div></div>

<p>Bir modelle ilişkili bir yayın akışınız varsa, yayın adı kanal ve modelden oluşturulabilir. Örneğin, aşağıdaki kod <code class="language-plaintext highlighter-rouge">posts:Z2lkOi8vVGVzdEFwcC9Qb3N0LzE</code> gibi bir yayına abone olmak için <a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Streams.html#method-i-stream_for"><code class="language-plaintext highlighter-rouge">stream_for</code></a> kullanır. Burada <code class="language-plaintext highlighter-rouge">Z2lkOi8vVGVzdEFwc9Qb3N0LzE</code>, Post modelinin GlobalID’sidir.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PostsChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="n">stream_for</span> <span class="n">post</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Daha sonra <a href="https://api.rubyonrails.org/classes/ActionCable/Channel/Broadcasting/ClassMethods.html#method-i-broadcast_to"><code class="language-plaintext highlighter-rouge">broadcast_to</code></a> çağrısı yaparak bu kanala yayın yapabilirsiniz:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">PostsChannel</span><span class="p">.</span><span class="nf">broadcast_to</span><span class="p">(</span><span class="vi">@post</span><span class="p">,</span> <span class="vi">@comment</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="yayınlar-1">Yayınlar</h3>

<p>Bir <em>yayın</em>, bir yayıncı tarafından iletilen herhangi bir şeyin doğrudan adı geçen yayını yayınlayan kanal abonelerine yönlendirildiği bir yayınla/abone ol bağlantısıdır. Her kanal sıfır veya daha fazla yayın yayınlıyor olabilir.</p>

<p>Yayınlar tamamen çevrimiçi bir kuyruktur ve zamana bağlıdır. Eğer bir tüketici yayın akışında değilse (belirli bir kanala abone değilse), daha sonra bağlanması durumunda yayını alamayacaktır.</p>

<h3 id="abonelikler-1">Abonelikler</h3>

<p>Bir tüketici bir kanala abone olduğunda, bir abone olarak hareket eder. Bu bağlantıya abonelik denir. Gelen mesajlar daha sonra kablo tüketicisi (cable consumer) tarafından gönderilen bir tanımlayıcıya (identifier) dayalı olarak bu kanal aboneliklerine yönlendirilir.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/chat_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Best Room</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span>
  <span class="nf">received</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">appendLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">appendLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">createLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">[data-chat-room='Best Room']</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">element</span><span class="p">.</span><span class="nf">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">createLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`
      &lt;article class="chat-line"&gt;
        &lt;span class="speaker"&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">sent_by</span><span class="dl">"</span><span class="p">]}</span><span class="s2">&lt;/span&gt;
        &lt;span class="body"&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">]}</span><span class="s2">&lt;/span&gt;
      &lt;/article&gt;
    `</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="kanallara-parametre-geçirme">Kanallara Parametre Geçirme</h3>

<p>Bir abonelik oluştururken parametreleri istemci tarafından sunucu tarafına geçirebilirsiniz. Örneğin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">stream_from</span> <span class="s2">"chat_</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:room</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">subscriptions.create</code>‘e ilk argüman olarak geçirilen bir nesne, kablo kanalındaki params hash’i olur. <code class="language-plaintext highlighter-rouge">channel</code> anahtar sözcüğü gereklidir:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/chat_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Best Room</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span>
  <span class="nf">received</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">appendLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">appendLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">createLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">[data-chat-room='Best Room']</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">element</span><span class="p">.</span><span class="nf">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">createLine</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`
      &lt;article class="chat-line"&gt;
        &lt;span class="speaker"&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">sent_by</span><span class="dl">"</span><span class="p">]}</span><span class="s2">&lt;/span&gt;
        &lt;span class="body"&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">]}</span><span class="s2">&lt;/span&gt;
      &lt;/article&gt;
    `</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Uygulamanızda bir yerde,</span>
<span class="c1"># belki de bir NewCommentJob'dan bu çağrılır.</span>
<span class="no">ActionCable</span><span class="p">.</span><span class="nf">server</span><span class="p">.</span><span class="nf">broadcast</span><span class="p">(</span>
  <span class="s2">"chat_</span><span class="si">#{</span><span class="n">room</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="ss">sent_by: </span><span class="s2">"Paul"</span><span class="p">,</span>
    <span class="ss">body: </span><span class="s2">"This is a cool chat app."</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="bir-mesajı-yeniden-yayınlama">Bir Mesajı Yeniden Yayınlama</h3>

<p>Yaygın bir kullanım durumu, bir istemci tarafından gönderilen bir mesajın diğer bağlı istemcilere <em>yeniden yayınlanmasıdır</em>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/chat_channel.rb</span>
<span class="k">class</span> <span class="nc">ChatChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">stream_from</span> <span class="s2">"chat_</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:room</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="no">ActionCable</span><span class="p">.</span><span class="nf">server</span><span class="p">.</span><span class="nf">broadcast</span><span class="p">(</span><span class="s2">"chat_</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:room</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/chat_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">chatChannel</span> <span class="o">=</span> <span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ChatChannel</span><span class="dl">"</span><span class="p">,</span> <span class="na">room</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Best Room</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span>
  <span class="nf">received</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// data =&gt; { sent_by: "Paul", body: "This is a cool chat app." }</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">chatChannel</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span> <span class="na">sent_by</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Paul</span><span class="dl">"</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">This is a cool chat app.</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p>Yeniden yayın, mesajı gönderen istemci de dahil olmak üzere tüm bağlı istemciler tarafından alınacaktır. Parametrelerin kanala abone olduğunuzda olduğu gibi aynı olduğunu unutmayın.</p>

<h2 id="full-stack-örnekler">Full-Stack Örnekler</h2>

<p>Aşağıdaki kurulum adımları her iki örnek için de ortaktır:</p>

<ol>
  <li><a href="#baglanti-kurulumu">Bağlantınızı kurun</a>.</li>
  <li><a href="#ebeveyn-kanal-kurulumu">Ebeveyn kanalı kurun</a>.</li>
  <li><a href="#tuketici-baglantisi">Tüketicinizi bağlayın</a>.</li>
</ol>

<h3 id="örnek-1-kullanıcı-görünümleri">Örnek 1: Kullanıcı Görünümleri</h3>

<p>İşte bir kullanıcının çevrimiçi olup olmadığını ve hangi sayfada olduğunu izleyen basit bir kanal örneği. (Bu, çevrimiçi olduklarında kullanıcı adının yanında yeşil bir nokta göstermek gibi varlık özellikleri oluşturmak için kullanışlıdır.)</p>

<p>Sunucu tarafı görünüm kanalını oluşturun:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/appearance_channel.rb</span>
<span class="k">class</span> <span class="nc">AppearanceChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">current_user</span><span class="p">.</span><span class="nf">appear</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">unsubscribed</span>
    <span class="n">current_user</span><span class="p">.</span><span class="nf">disappear</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">appear</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">current_user</span><span class="p">.</span><span class="nf">appear</span><span class="p">(</span><span class="ss">on: </span><span class="n">data</span><span class="p">[</span><span class="s2">"appearing_on"</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">away</span>
    <span class="n">current_user</span><span class="p">.</span><span class="nf">away</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Bir abonelik başlatıldığında <code class="language-plaintext highlighter-rouge">subscribed</code> callback’i tetiklenir ve bu fırsatı “mevcut kullanıcı gerçekten göründü” demek için kullanırız. Bu görünme/kaybolma API’yı Redis, bir veritabanı veya başka bir şey tarafından desteklenebilir.</p>

<p>İstemci tarafı görünüm kanalı aboneliğini oluşturun:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/appearance_channel.js</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="dl">"</span><span class="s2">AppearanceChannel</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">// Abonelik oluşturulduğunda bir kez çağrılır.</span>
  <span class="nf">initialized</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="c1">// Abonelik sunucuda kullanıma hazır olduğunda çağrılır.</span>
  <span class="nf">connected</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">install</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>
  <span class="p">},</span>

  <span class="c1">// WebSocket bağlantısı kapatıldığında çağrılır.</span>
  <span class="nf">disconnected</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">uninstall</span><span class="p">()</span>
  <span class="p">},</span>

  <span class="c1">// Abonelik sunucu tarafından reddedildiğinde çağrılır.</span>
  <span class="nf">rejected</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">uninstall</span><span class="p">()</span>
  <span class="p">},</span>

  <span class="nf">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">documentIsActive</span> <span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="nf">appear</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">away</span><span class="p">()</span>
  <span class="p">},</span>

  <span class="nf">appear</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Sunucuda `AppearanceChannel#appear(data)` öğesini çağırır.</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">perform</span><span class="p">(</span><span class="dl">"</span><span class="s2">appear</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">appearing_on</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">appearingOn</span> <span class="p">})</span>
  <span class="p">},</span>

  <span class="nf">away</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Sunucuda `AppearanceChannel#away` öğesini çağırır.</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">perform</span><span class="p">(</span><span class="dl">"</span><span class="s2">away</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">install</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">focus</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">blur</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">turbo:load</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">visibilitychange</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="nf">uninstall</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nf">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">focus</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nf">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">blur</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">turbo:load</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">visibilitychange</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="kd">get</span> <span class="nf">documentIsActive</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">visibilityState</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">visible</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nf">hasFocus</span><span class="p">()</span>
  <span class="p">},</span>

  <span class="kd">get</span> <span class="nf">appearingOn</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">[data-appearing-on]</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">element</span> <span class="p">?</span> <span class="nx">element</span><span class="p">.</span><span class="nf">getAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-appearing-on</span><span class="dl">"</span><span class="p">)</span> <span class="p">:</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h4 id="i̇stemci-sunucu-etkileşimi">İstemci-Sunucu Etkileşimi</h4>

<ol>
  <li>
    <p><strong>İstemci</strong>, <code class="language-plaintext highlighter-rouge">createConsumer()</code> aracılığıyla <strong>Sunucu</strong>ya bağlanır.
  (<code class="language-plaintext highlighter-rouge">consumer.js</code>). <strong>Sunucu</strong> bu   bağlantıyı <code class="language-plaintext highlighter-rouge">current_user</code> ile tanımlar.</p>
  </li>
  <li>
    <p><strong>İstemci</strong>, <code class="language-plaintext highlighter-rouge">consumer.subscriptions.create({ channel: "AppearanceChannel" })</code> aracılığıyla 
  görünüm kanalına abone olur. (<code class="language-plaintext highlighter-rouge">appearance_channel.js</code>)</p>
  </li>
  <li>
    <p><strong>Sunucu</strong> görünüm kanalı için yeni bir abonelik başlatıldığını fark eder ve <code class="language-plaintext highlighter-rouge">current_user</code> üzerinde <code class="language-plaintext highlighter-rouge">appear</code> metodunu çağırarak <code class="language-plaintext highlighter-rouge">subscribed</code> callback’ini çalıştırır. (<code class="language-plaintext highlighter-rouge">appearance_channel.rb</code>)</p>
  </li>
  <li>
    <p><strong>İstemci</strong> bir abonelik kurulduğunu fark eder ve <code class="language-plaintext highlighter-rouge">connected</code> 
  (<code class="language-plaintext highlighter-rouge">appearance_channel.js</code>) öğesini çağırır, bu da <code class="language-plaintext highlighter-rouge">install</code> ve <code class="language-plaintext highlighter-rouge">appear</code> öğelerini çağırır. <code class="language-plaintext highlighter-rouge">appear</code> sunucuda <code class="language-plaintext highlighter-rouge">AppearanceChannel#appear(data)</code> öğesini çağırır ve <code class="language-plaintext highlighter-rouge">{ appearing_on: this.appearingOn }</code> şeklinde bir veri hash’i sağlar. Bu mümkündür çünkü sunucu tarafı kanal örneği, sınıfta bildirilen tüm genel metotları (callback’ler hariç) otomatik olarak açığa çıkarır, böylece bunlara bir aboneliğin <code class="language-plaintext highlighter-rouge">perform</code> metodu aracılığıyla uzak yordam çağrıları/uzaktan fonksiyon çağrısı olarak erişilebilir.</p>
  </li>
  <li>
    <p><strong>Sunucu</strong>, <code class="language-plaintext highlighter-rouge">current_user</code> (<code class="language-plaintext highlighter-rouge">appearance_channel.rb</code>) tarafından tanımlanan
  bağlantı için görünüm kanalında <code class="language-plaintext highlighter-rouge">appear</code> action’ı için istek alır. <strong>Sunucu</strong> veri hash’inden <code class="language-plaintext highlighter-rouge">:appearing_on</code> anahtarına sahip veriyi alır ve <code class="language-plaintext highlighter-rouge">current_user.appear</code> dosyasına aktarılan <code class="language-plaintext highlighter-rouge">:on</code> anahtarının değeri olarak ayarlar.</p>
  </li>
</ol>

<h3 id="örnek-2-yeni-web-bildirimlerinin-alınması">Örnek 2: Yeni Web Bildirimlerinin Alınması</h3>

<p>Görünüm örneği, sunucu işlevselliğinin WebSocket bağlantısı üzerinden istemci tarafı çağrısına maruz bırakılmasıyla ilgiliydi. Ancak WebSocket ile ilgili en güzel şey, bunun iki yönlü bir yol olmasıdır. Şimdi, sunucunun istemciye bir action çağrısında bulunduğu bir örnek gösterelim.</p>

<p>Bu, ilgili yayın akışlarına yayın yaptığınızda istemci tarafı web bildirimlerini tetiklemenizi sağlayan bir web bildirim kanalıdır:</p>

<p>Sunucu tarafı web bildirimleri kanalını oluşturun:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/channels/web_notifications_channel.rb</span>
<span class="k">class</span> <span class="nc">WebNotificationsChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">stream_for</span> <span class="n">current_user</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>İstemci tarafı web bildirimleri kanal aboneliğini oluşturun:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/javascript/channels/web_notifications_channel.js</span>
<span class="c1">// Web bildirimleri gönderme hakkını</span>
<span class="c1">// zaten talep ettiğinizi varsayan istemci tarafı.</span>
<span class="k">import</span> <span class="nx">consumer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./consumer</span><span class="dl">"</span>

<span class="nx">consumer</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="dl">"</span><span class="s2">WebNotificationsChannel</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="nf">received</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nc">Notification</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">],</span> <span class="p">{</span> <span class="na">body</span><span class="p">:</span> <span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">]</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Uygulamanızın başka bir yerinden bir web bildirim kanalı örneğine içerik yayınlayın:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Uygulamanızda bir yerde,</span>
<span class="c1"># belki de bir NewCommentJob'dan bu çağrılır.</span>
<span class="no">WebNotificationsChannel</span><span class="p">.</span><span class="nf">broadcast_to</span><span class="p">(</span>
  <span class="n">current_user</span><span class="p">,</span>
  <span class="ss">title: </span><span class="s2">"New things!"</span><span class="p">,</span>
  <span class="ss">body: </span><span class="s2">"All the news fit to print"</span>
<span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">WebNotificationsChannel.broadcast_to</code> çağrısı, her kullanıcı için ayrı bir yayın adı altında geçerli abonelik bağdaştırıcısının abone ol/yayınla kuyruğuna bir mesaj yerleştirir. ID’si 1 olan bir kullanıcı için yayın adı <code class="language-plaintext highlighter-rouge">web_notifications:1</code> olur.</p>

<p>Kanala, <code class="language-plaintext highlighter-rouge">web_notifications:1</code> adresine gelen her şeyi <code class="language-plaintext highlighter-rouge">received</code> callback’ini çağırarak doğrudan istemciye aktarması talimatı verilmiştir. Argüman olarak geçirilen veri; sunucu tarafındaki yayın çağrısına ikinci parametre olarak gönderilen hash, kablo boyunca yolculuk için JSON olarak kodlanmış ve <code class="language-plaintext highlighter-rouge">received</code> olarak gelen veri argümanı için paketten çıkarılmış veridir.</p>

<h3 id="daha-kapsamlı-örnekler">Daha Kapsamlı Örnekler</h3>

<p>Bir Rails uygulamasında Action Cable’ın nasıl kurulacağına ve kanalların nasıl ekleneceğine dair tam bir örnek için <a href="https://github.com/rails/actioncable-examples">rails/actioncable-examples</a> deposuna bakın.</p>

<h2 id="yapılandırma">Yapılandırma</h2>

<p>Action Cable’ın iki gerekli yapılandırması (configuration) vardır: Bir abonelik bağdaştırıcısı ve izin verilen istek kökenleri (Not: Allowed request origins; Sunucunun kabul edeceği istemci isteklerinin hangi alan adlarından (origin) gelebileceğini tanımlar.).</p>

<h3 id="abonelik-bağdaştırıcısı">Abonelik Bağdaştırıcısı</h3>

<p>Action Cable varsayılan olarak <code class="language-plaintext highlighter-rouge">config/cable.yml</code> içinde bir yapılandırma dosyası arar. Dosya, her Rails ortamı için bir bağdaştırıcı belirtmelidir. Bağdaştırıcılar hakkında ek bilgi için <a href="#bagimliliklar">Bağımlılıklar</a> bölümüne bakın.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">async</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">test</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">redis://10.10.3.153:6381</span>
  <span class="na">channel_prefix</span><span class="pi">:</span> <span class="s">appname_production</span>
</code></pre></div></div>

<h4 id="bağdaştırıcı-yapılandırması">Bağdaştırıcı Yapılandırması</h4>

<p>Aşağıda son kullanıcılar için mevcut olan abonelik bağdaştırıcılarının bir listesi bulunmaktadır.</p>

<h5 id="asenkron-bağdaştırıcı">Asenkron Bağdaştırıcı</h5>

<p>Asenkron bağdaştırıcı geliştirme/test için tasarlanmıştır, üretimde kullanılmamalıdır.</p>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
    Asenkron bağdaştırıcı yalnızca aynı süreç içinde çalışır, bu nedenle kablo güncellemelerini bir konsoldan manuel olarak tetiklemek ve sonuçları tarayıcıda görmek için, bunu <code>bin/rails console</code> ile başlatılan bir terminalden değil, web konsolundan (geliştirme sürecinin içinde çalışan) yapmanız gerekir! Web konsolunun görünmesini sağlamak için herhangi bir action'a veya herhangi bir ERB şablon view'e <code>console</code> ekleyin.
  </div>
</div>

<h5 id="solid-cable-bağdaştırıcısı">Solid Cable Bağdaştırıcısı</h5>

<p>Solid Cable bağdaştırıcısı, Active Record kullanan veritabanı destekli bir çözümdür. MySQL, SQLite ve PostgreSQL ile test edilmiştir. <code class="language-plaintext highlighter-rouge">bin/rails solid_cable:install</code> çalıştırıldığında otomatik olarak <code class="language-plaintext highlighter-rouge">config/cable.yml</code> kurulacak ve <code class="language-plaintext highlighter-rouge">db/cable_schema.rb</code> oluşturulacaktır. Bundan sonra, <code class="language-plaintext highlighter-rouge">config/database.yml</code> dosyasını veritabanınıza göre ayarlayarak manuel olarak güncellemeniz gerekir.Bkz. <a href="https://github.com/rails/solid_cable?tab=readme-ov-file#installation">Solid Cable Kurulumu</a>.</p>

<h5 id="redis-bağdaştırıcısı">Redis Bağdaştırıcısı</h5>

<p>Redis bağdaştırıcısı, kullanıcıların Redis sunucusuna işaret eden bir URL sağlamasını gerektirir.
Ek olarak, birden fazla uygulama için aynı Redis sunucusunu kullanırken kanal adı çakışmalarını önlemek için bir <code class="language-plaintext highlighter-rouge">channel_prefix</code> sağlanabilir. Daha fazla ayrıntı için <a href="https://redis.io/docs/manual/pubsub/#database--scoping">Redis Pub/Sub</a> belgelerine bakın.</p>

<p>Redis bağdaştırıcısı SSL/TLS bağlantılarını da destekler. Gerekli SSL/TLS parametreleri, YAML yapılandırma dosyasındaki <code class="language-plaintext highlighter-rouge">ssl_params</code> anahtarında geçirilebilir.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">rediss://10.10.3.153:tls_port</span>
  <span class="na">channel_prefix</span><span class="pi">:</span> <span class="s">appname_production</span>
  <span class="na">ssl_params</span><span class="pi">:</span>
    <span class="na">ca_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/path/to/ca.crt"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ssl_params</code>a verilen seçenekler doğrudan <code class="language-plaintext highlighter-rouge">OpenSSL::SSL::SSLContext#set_params</code> metoduna aktarılır ve SSL bağlamının herhangi bir geçerli niteliği olabilir.
Mevcut diğer nitelikler için lütfen <a href="https://docs.ruby-lang.org/en/master/OpenSSL/SSL/SSLContext.html">OpenSSL::SSL::SSLContext</a> belgelerine bakın.</p>

<p>Bir güvenlik duvarının arkasındaki redis bağdaştırıcısı için self-signed sertifikalar kullanıyorsanız ve sertifika kontrolünü atlamayı tercih ediyorsanız, ssl <code class="language-plaintext highlighter-rouge">verify_mode</code>, <code class="language-plaintext highlighter-rouge">OpenSSL::SSL::VERIFY_NONE</code> olarak ayarlanmalıdır.</p>

<div class="guide-alert guide-alert-danger">
  <div class="guide-alert-icon">❗</div>
  <div class="guide-alert-content">
    Güvenlik etkilerini kesinlikle anlamadığınız sürece üretime çıkarken <code>VERIFY_NONE</code>kullanılması önerilmez. Redis bağdaştırıcısı için bu seçeneği ayarlamak için yapılandırma <code>ssl_params' { verify_mode: &lt;%= OpenSSL::SSL::VERIFY_NONE %&gt; }</code> şeklinde olmalıdır.
  </div>
</div>

<h5 id="postgresql-bağdaştırıcısı">PostgreSQL Bağdaştırıcısı</h5>

<p>PostgreSQL bağdaştırıcısı, bağlantı için Active Record’un bağlantı havuzunu ve dolayısıyla uygulamanın `config/database.yml’ veritabanı yapılandırmasını kullanır.
Bu durum gelecekte değişebilir. <a href="https://github.com/rails/rails/issues/27214">#27214</a></p>

<div class="guide-alert guide-alert-warning">
  <div class="guide-alert-icon">📝</div>
  <div class="guide-alert-content">
   PostgreSQL'in <code>NOTIFY</code> (bildirim göndermek için kullanılan komut) üzerinde <a href="https://www.postgresql.org/docs/current/sql-notify.html">8000 byte sınırı</a> vardır ve bu, büyük yüklerle (payload) uğraşırken bir kısıtlama olabilir.
  </div>
</div>

<h3 id="i̇zin-verilen-i̇stek-kökenleri">İzin Verilen İstek Kökenleri</h3>

<p>Action Cable yalnızca sunucu yapılandırmasına bir array olarak aktarılan belirtilen kökenlerden (origin) gelen istekleri kabul edecektir. Kökenler, eşleşme için bir kontrolün gerçekleştirileceği string’lerin veya düzenli ifadelerin örnekleri olabilir.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">allowed_request_origins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://rubyonrails.com"</span><span class="p">,</span> <span class="sr">%r{http://ruby.*}</span><span class="p">]</span>
</code></pre></div></div>

<p>Herhangi bir kökenden gelen istekleri devre dışı bırakmak ve izin vermek için:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">disable_request_forgery_protection</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Varsayılan olarak Action Cable, geliştirme ortamında çalışırken localhost:3000 adresinden gelen tüm isteklere izin verir.</p>

<h3 id="tüketici-yapılandırması">Tüketici Yapılandırması</h3>

<p>URL’i yapılandırmak için HTML layout HEAD’inize <a href="https://api.rubyonrails.org/classes/ActionCable/Helpers/ActionCableHelper.html#method-i-action_cable_meta_tag"><code class="language-plaintext highlighter-rouge">action_cable_meta_tag</code></a> çağrısı ekleyin. Bu, genellikle ortam yapılandırma dosyalarında <a href="../configuring/#action-cable-url-yapilandirmasi"><code class="language-plaintext highlighter-rouge">config.action_cable.url</code></a> aracılığıyla ayarlanan bir URL veya yol kullanır.</p>

<h3 id="i̇ş-parçacığı-havuzu-yapılandırması">İş Parçacığı Havuzu Yapılandırması</h3>

<p>İş parçacığı havuzu, bağlantı callback’lerini ve kanal action’larını sunucunun ana iş parçacığından ayrı olarak çalıştırmak için kullanılır. Action Cable, uygulamanın iş parçacığı havuzunda aynı anda işlenen iş parçacığı sayısını yapılandırmasına olanak tanır.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">worker_pool_size</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre></div></div>

<p>Ayrıca, sunucunuzun iş parçacığınızla en az aynı sayıda veritabanı bağlantısı sağlaması gerektiğini unutmayın. Varsayılan iş parçacığı havuzu boyutu 4 olarak ayarlanmıştır, bu da en az 4 veritabanı bağlantısını kullanılabilir hale getirmeniz gerektiği anlamına gelir. Bunu <code class="language-plaintext highlighter-rouge">config/database.yml</code> içinde <code class="language-plaintext highlighter-rouge">pool</code> niteliği aracılığıyla değiştirebilirsiniz.</p>

<h3 id="i̇stemci-tarafı-log-kaydı">İstemci Tarafı Log Kaydı</h3>

<p>İstemci tarafı log kaydı varsayılan olarak devre dışıdır. Bunu <code class="language-plaintext highlighter-rouge">ActionCable.logger.enabled</code> değerini true olarak ayarlayarak etkinleştirebilirsiniz.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">ActionCable</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@rails/actioncable</span><span class="dl">'</span>

<span class="nx">ActionCable</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div></div>

<h3 id="diğer-yapılandırmalar">Diğer Yapılandırmalar</h3>

<p>Yapılandırılacak diğer yaygın seçenek ise bağlantı başına log kaydediciye uygulanan günlük etiketleridir. İşte etiketleme sırasında varsa kullanıcı hesabı kimliğini, yoksa “no-account” kullanan bir örnek:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">log_tags</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">-&gt;</span> <span class="n">request</span> <span class="p">{</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s2">"user_account_id"</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"no-account"</span> <span class="p">},</span>
  <span class="ss">:action_cable</span><span class="p">,</span>
  <span class="o">-&gt;</span> <span class="n">request</span> <span class="p">{</span> <span class="n">request</span><span class="p">.</span><span class="nf">uuid</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Tüm yapılandırma seçeneklerinin tam listesi için <code class="language-plaintext highlighter-rouge">ActionCable::Server::Configuration</code> sınıfına bakın.</p>

<h2 id="bağımsız-kablo-sunucularını-çalıştırma">Bağımsız Kablo Sunucularını Çalıştırma</h2>

<p>Action Cable, Rails uygulamanızın bir parçası olarak ya da bağımsız bir sunucu olarak çalışabilir. Geliştirme aşamasında, Rails uygulamanızın bir parçası olarak çalıştırmak genellikle iyidir, ancak üretim ortamında bağımsız olarak çalıştırmalısınız.</p>

<h3 id="uygulamada">Uygulamada</h3>

<p>Action Cable, Rails uygulamanızla birlikte çalışabilir. Örneğin, <code class="language-plaintext highlighter-rouge">/websocket</code> üzerindeki WebSocket isteklerini dinlemek için, bu yolu <a href="../configuring/#action-cable-baglanti-yolu-yapilandirmasi"><code class="language-plaintext highlighter-rouge">config.action_cable.mount_path</code></a> olarak belirtin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/application.rb</span>
<span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">mount_path</span> <span class="o">=</span> <span class="s2">"/websocket"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Layout’ta <a href="https://api.rubyonrails.org/classes/ActionCable/Helpers/ActionCableHelper.html#method-i-action_cable_meta_tag"><code class="language-plaintext highlighter-rouge">action_cable_meta_tag</code></a> çağrılmışsa kablo sunucusuna bağlanmak için <code class="language-plaintext highlighter-rouge">ActionCable.createConsumer()</code> işlevini kullanabilirsiniz. Aksi takdirde, <code class="language-plaintext highlighter-rouge">createConsumer</code> için ilk argüman olarak bir yol belirtilir (örneğin, <code class="language-plaintext highlighter-rouge">ActionCable.createConsumer("/websocket")</code>).</p>

<p>Oluşturduğunuz her sunucu örneği ve sunucunuzun ortaya çıkardığı her iş parçacığı için yeni bir Action Cable örneğiniz olacaktır, ancak Redis veya PostgreSQL bağdaştırıcısı mesajları bağlantılar arasında senkronize tutar.</p>

<h3 id="standalone">Standalone</h3>

<p>Kablo sunucuları normal uygulama sunucunuzdan ayrılabilir. Hâlâ bir Rack uygulamasıdır, ancak kendi Rack uygulamasıdır. Önerilen temel kurulum aşağıdaki gibidir:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cable/config.ru</span>
<span class="nb">require_relative</span> <span class="s2">"../config/environment"</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">eager_load!</span>

<span class="n">run</span> <span class="no">ActionCable</span><span class="p">.</span><span class="nf">server</span>
</code></pre></div></div>

<p>Ardından sunucuyu başlatmak için:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>puma <span class="nt">-p</span> 28080 cable/config.ru
</code></pre></div></div>

<p>Bu, 28080 numaralı bağlantı noktasında bir kablo sunucusu başlatır. Rails’e bu sunucuyu kullanmasını söylemek için yapılandırmanızı güncelleyin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/environments/development.rb</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">mount_path</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">action_cable</span><span class="p">.</span><span class="nf">url</span> <span class="o">=</span> <span class="s2">"ws://localhost:28080"</span> <span class="c1"># üretime çıkarken wss:// kullanın</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Son olarak, <a href="#tuketici-yapilandirmasi">tüketiciyi doğru şekilde yapılandırdığınızdan</a> emin olun .</p>

<h3 id="notlar">Notlar</h3>

<p>WebSocket sunucusunun oturuma erişimi yoktur, ancak çerezlere erişimi vardır. Bu, kimlik doğrulama işlemini gerçekleştirmeniz gerektiğinde kullanılabilir. Bu <a href="https://greg.molnar.io/blog/actioncable-devise-authentication/">makalede</a> Devise ile bunu yapmanın bir yolunu görebilirsiniz .</p>

<h2 id="bağımlılıklar">Bağımlılıklar</h2>

<p>Action Cable, yayınla/abone ol iç bileşenlerini işlemek için bir abonelik bağdaştırıcısı arabirimi (interface) sağlar. Varsayılan olarak; asenkron, satır içi, PostgreSQL ve Redis bağdaştırıcıları dahil edilmiştir. Yeni Rails uygulamalarında varsayılan bağdaştırıcı asenkron (<code class="language-plaintext highlighter-rouge">async</code>) bağdaştırıcısıdır.</p>

<p>Ruby tarafı <a href="https://github.com/faye/websocket-driver-ruby">websocket-driver</a>, <a href="https://github.com/celluloid/nio4r">nio4r</a> ve <a href="https://github.com/ruby-concurrency/concurrent-ruby">concurrent-ruby</a> üzerine inşa edilmiştir.</p>

<h2 id="dağıtım">Dağıtım</h2>

<p>Action Cable, WebSockets ve iş parçacıklarının bir kombinasyonu tarafından desteklenmektedir. Hem framework tesisatı hem de kullanıcı tarafından belirtilen kanal çalışması Ruby’nin yerel iş parçacığı desteği kullanılarak dahili olarak ele alınır. Bu, herhangi bir iş parçacığı güvenliği günahı işlemediğiniz sürece mevcut tüm Rails modellerinizi sorunsuz bir şekilde kullanabileceğiniz anlamına gelir.</p>

<p>Action Cable sunucusu Rack socket hijacking API’ını uygular, böylece uygulama sunucusunun çok iş parçacıklı olup olmadığına bakılmaksızın bağlantıları dahili olarak yönetmek için çok iş parçacıklı bir modelin kullanılmasına izin verir.</p>

<p>Bu sebeple Action Cable, Unicorn, Puma ve Passenger gibi popüler sunucularla çalışır.</p>

<h2 id="test">Test</h2>

<p>Action Cable işlevselliğinizi nasıl test edeceğinize ilişkin ayrıntılı talimatları <a href="../testing/#action-cable-test">Test</a> kılavuzu bölümünde bulabilirsiniz.</p>
</div>
  </article>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toc = document.getElementById("toc");
    const headings = document.querySelectorAll(
      ".guide-content h2, .guide-content h3, .guide-content h4"
    );

    if (headings.length > 0) {
      const tocList = document.createElement("ul");
      const headingMap = new Map();

      // Türkçe karakterleri URL-dostu hale getiren fonksiyon
      function turkishToSlug(text) {
        const turkishChars = {
          'ç': 'c', 'Ç': 'c',
          'ğ': 'g', 'Ğ': 'g',
          'ı': 'i', 'I': 'i',
          'İ': 'i', 'i': 'i',
          'ö': 'o', 'Ö': 'o',
          'ş': 's', 'Ş': 's',
          'ü': 'u', 'Ü': 'u'
        };
        
        return text
          .split('')
          .map(char => turkishChars[char] || char)
          .join('')
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '');
      }

      // Aynı ID'nin tekrarlanmasını önlemek için sayaç
      const idCounts = new Map();

      headings.forEach(function (heading, index) {
        // Başlık metninden anlamlı ID oluştur
        const headingText = heading.textContent.trim();
        let baseId = turkishToSlug(headingText);
        
        // Boş ID kontrolü
        if (!baseId) {
          baseId = "heading-" + index;
        }
        
        // Tekrarlanan ID'leri önle
        let finalId = baseId;
        if (idCounts.has(baseId)) {
          const count = idCounts.get(baseId) + 1;
          idCounts.set(baseId, count);
          finalId = baseId + "-" + count;
        } else {
          idCounts.set(baseId, 1);
        }
        
        heading.id = finalId;

        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#" + finalId;
        a.textContent = headingText;
        a.className = "toc-" + heading.tagName.toLowerCase();

        li.appendChild(a);
        tocList.appendChild(li);

        headingMap.set(finalId, a);
      });

      toc.appendChild(tocList);

      // Başlıkların görünürlük oranlarını takip et
      const visibilityMap = new Map();

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const id = entry.target.getAttribute("id");
            visibilityMap.set(id, entry.intersectionRatio);
          });

          // En çok görünür olan başlığı bul
          let mostVisibleId = null;
          let maxRatio = 0;

          visibilityMap.forEach((ratio, id) => {
            if (ratio > maxRatio) {
              mostVisibleId = id;
              maxRatio = ratio;
            }
          });

          if (mostVisibleId) {
            headingMap.forEach((linkEl) => linkEl.classList.remove("active"));
            const activeLink = headingMap.get(mostVisibleId);
            if (activeLink) {
              activeLink.classList.add("active");

              // Ortalamak için:
              const linkTop = activeLink.offsetTop;
              const linkHeight = activeLink.offsetHeight;
              const tocScrollParent = toc;
              const tocHeight = tocScrollParent.offsetHeight;

              tocScrollParent.scrollTo({
                top: linkTop - tocHeight / 2 + linkHeight / 2,
                behavior: "smooth",
              });
            }
          }
        },
        {
          threshold: [0, 0.25, 0.5, 0.75, 1.0],
        }
      );

      headings.forEach((heading) => {
        observer.observe(heading);
      });

      const toggleBtn = document.getElementById("toc-toggle");
      const sidebar = document.querySelector(".guide-sidebar");

      toggleBtn.addEventListener("click", function () {
        sidebar.classList.toggle("open");
      });
      const closeBtn = document.querySelector(".toc-close");

      closeBtn?.addEventListener("click", function () {
        sidebar.classList.remove("open");
      });
    }
  });
</script>
        <!-- <footer class="guide-footer"> -->
        <div class="feedback">
          <h3>Geri Bildirim</h3>
          <p>
            Bu rehberin kalitesinin iyileştirilmesine yardımcı olmanızı
            öneririz.
          </p>
          <p>
            Herhangi bir yazım hatası veya olgusal hata görürseniz lütfen
            katkıda bulunun. Başlamak için,
            <a
              href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation"
              >dokümantasyon katkıları</a
            >
            bölümünü okuyabilirsiniz.
          </p>
          <p>
            Ayrıca eksik veya güncel olmayan içerik de bulabilirsiniz. Lütfen
            main için eksik olan belgeleri ekleyin. Sorunların main dalda zaten
            düzeltilip düzeltilmediğini doğrulamak için önce
            <a href="https://edgeguides.rubyonrails.org/">Edge Guides</a>'ı
            kontrol ettiğinizden emin olun. Stil ve kurallar için
            <a
              href="https://guides.rubyonrails.org/v8.0/ruby_on_rails_guides_guidelines.html"
              >Ruby on Rails Guides Guidelines</a
            >'ı kontrol edin.
          </p>
          <p>
            Herhangi bir sebepten dolayı düzeltebileceğiniz bir şey bulursanız
            ancak kendiniz patch yapamıyorsanız lütfen bir
            <a href="https://github.com/rails/rails/issues">issue</a> açın.
          </p>
          <p>
            Ve son olarak, Ruby on Rails dokümantasyonu ile ilgili her türlü
            tartışma resmi
            <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs/6"
              >Ruby on Rails Forum</a
            >'unda memnuniyetle karşılanacaktır.
          </p>
        </div>
      </div>
    </main>

    <button id="scrollToTop" class="scroll-to-top" aria-label="Yukarı çık">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polyline points="18,15 12,9 6,15"></polyline>
      </svg>
    </button>

    <footer class="footer">
      <div class="container">
        <p>
          Bu çalışma <a href=" Creative Commons Attribution-ShareAlike 4.0 International">Creative Commons Attribution-ShareAlike 4.0 International</a> Lisansı kapsamında lisanslanmıştır.
          </p>
        <p>
          "Rails", "Ruby on Rails" ve Rails logosu David Heinemeier Hansson'un ticari markalarıdır. Tüm hakları saklıdır.
        </p><br/>
        <p>
          &copy; 2025 Rails Kılavuzları Türkçe Çevirisi.
          <a href="https://github.com/DilanKaya127">Dilan Kaya</a> tarafından
          hazırlanmıştır.
          Orijinal dokümantasyon
          <a href="https://guides.rubyonrails.org">Ruby on Rails</a> ekibine
          aittir.
        </p>
        

      </div>
    </footer>

    <script>
      hljs.highlightAll();
      // Yukarı çık butonu işlevselliği
      const scrollToTopBtn = document.getElementById("scrollToTop");

      // Scroll pozisyonunu kontrol et
      window.addEventListener("scroll", function () {
        if (window.pageYOffset > 500) {
          scrollToTopBtn.classList.add("visible");
        } else {
          scrollToTopBtn.classList.remove("visible");
        }
      });

      // Butona tıklandığında yukarı çık
      scrollToTopBtn.addEventListener("click", function () {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      });
    </script>
  </body>
</html>
